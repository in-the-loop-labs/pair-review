{"id":"pair_review-07kx","title":"Phase 1: @pierre/diffs Proof of Concept","description":"## Objective\nEvaluate @pierre/diffs viability before committing to full integration.\n\n## Tasks\n- [ ] Install @pierre/diffs package\n- [ ] Create isolated test page for basic diff rendering\n- [ ] Measure actual bundle size impact (full vs tree-shaken)\n- [ ] Test Shadow DOM CSS integration issues\n- [ ] Document Shiki theme compatibility with pair-review themes\n- [ ] Test annotation framework basic capabilities\n\n## Acceptance Criteria\n- Clear understanding of bundle size (minified + gzipped)\n- Know whether Shadow DOM blocks our CSS customizations\n- Documented list of @pierre/diffs features that work out-of-box\n- Go/no-go decision documented for proceeding to Phase 2\n\n## Estimated Effort\n8-16 hours\n\n## Dependencies\nNone - this is exploratory work","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-09T07:04:49.129992-05:00","created_by":"tim","updated_at":"2026-01-09T07:04:49.129992-05:00","dependencies":[{"issue_id":"pair_review-07kx","depends_on_id":"pair_review-pquz","type":"parent-child","created_at":"2026-01-09T07:05:04.851429-05:00","created_by":"tim"}]}
{"id":"pair_review-0ed","title":"Persist side panel expanded/collapsed state in localStorage","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T17:33:11.400722-05:00","updated_at":"2025-12-31T17:53:53.039731-05:00","closed_at":"2025-12-31T17:53:53.039731-05:00"}
{"id":"pair_review-0fh","title":"Remove worktree_path from pr_data JSON","description":"Worktree path is stored in both worktrees table and pr_data JSON. Remove duplication - worktrees table is source of truth.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-29T09:20:02.446966-05:00","updated_at":"2025-12-29T09:20:02.446966-05:00"}
{"id":"pair_review-0l0","title":"UI: Repo settings page for default instructions","description":"Create a settings page for each repo where users can configure default analysis instructions. These instructions will apply to all PRs in the repo unless overridden by PR-specific instructions. Page should have a form with textarea for instructions and save functionality.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T18:26:07.266194-05:00","updated_at":"2026-01-01T14:28:01.899024-05:00","closed_at":"2026-01-01T14:28:01.899024-05:00","dependencies":[{"issue_id":"pair_review-0l0","depends_on_id":"pair_review-f8b","type":"blocks","created_at":"2025-12-31T18:26:22.38828-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-0l0","depends_on_id":"pair_review-3o2","type":"blocks","created_at":"2025-12-31T18:26:24.687176-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-0oj","title":"Auto-cleanup stale worktrees on server start","description":"## Problem\nWorktrees accumulate on disk and are never cleaned up automatically.\n\n## Solution\nOn server startup, asynchronously clean up worktrees not accessed within retention period.\n\n## Implementation\n1. Add config option: `worktree_retention_days` (default: 7)\n2. Add `WorktreeManager.cleanupStaleWorktrees()` method:\n   - Query DB for worktrees where `last_accessed_at \u003c (now - retention_days)`\n   - For each stale worktree:\n     - Run `git worktree remove --force {path}`\n     - Delete directory if remove fails\n     - Delete DB record\n   - Log to console: \"Cleaned up N stale worktrees\"\n3. Call cleanup async after server starts (don't block startup)\n4. Add `git worktree prune` call to clean orphaned registrations\n\n## Logging\n- Console log only (silent to user)\n- Format: `[pair-review] Cleaned up 3 stale worktrees (older than 7 days)`\n\n## Dependencies\n- Requires worktrees database table (pair_review-452)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T15:56:21.67418-05:00","updated_at":"2025-12-28T16:29:09.862917-05:00","closed_at":"2025-12-28T16:29:09.862917-05:00","dependencies":[{"issue_id":"pair_review-0oj","depends_on_id":"pair_review-452","type":"blocks","created_at":"2025-12-28T15:56:34.986646-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-0oj","depends_on_id":"pair_review-e4k","type":"blocks","created_at":"2025-12-28T15:56:43.516493-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-11e","title":"Praise suggestions: Style with purple theme","description":"Update praise/positive suggestions to match prototype:\n- Purple left border instead of amber\n- Star icon\n- 'Nice Work' label instead of type badge\n- Purple-tinted gradient header\nFiles: public/js/pr.js, public/css/pr.css","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T21:04:40.853145-05:00","updated_at":"2025-12-30T21:47:11.773098-05:00","closed_at":"2025-12-30T21:47:11.773098-05:00","dependencies":[{"issue_id":"pair_review-11e","depends_on_id":"pair_review-1mp","type":"blocks","created_at":"2025-12-30T21:05:05.479866-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-11v","title":"AI suggestions sidebar disappears when empty","description":"this may be fixed by other issues, but this sidebar should never entirely disappear. It makes viewing level-specific suggestions invisible","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T09:19:20.418582-05:00","updated_at":"2025-12-27T09:19:20.418582-05:00"}
{"id":"pair_review-12o","title":"Bug: Adopted AI suggestions incorrectly show expanded content warning","description":"Adopted AI suggestions are displaying the 'expanded content' file comment warning even when the comment is on a line that is part of the original diff hunk, including lines that were actually modified in the diff.\n\nExpected behavior: Only show the expanded content warning for comments on lines that are truly outside the diff hunks (i.e., context lines that were expanded by the user).\n\nLikely cause: The line type detection logic is incorrectly classifying diff hunk lines as expanded content, possibly due to:\n- Incorrect position tracking when suggestions are adopted\n- Mismatch between how AI suggestions store line info vs how the warning logic checks it\n- Off-by-one errors in line number comparison","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-01T11:08:51.208029-05:00","updated_at":"2026-01-01T11:21:46.633762-05:00","closed_at":"2026-01-01T11:21:46.633762-05:00"}
{"id":"pair_review-13b","title":"when adopting AI suggestions do not remove from sidebar","description":"instead of removing there should be some other visual indication instead, such as the entry being all gray or otherwise de-emphasized in some way -- but not entirely removed. this suggestions are still present in the diff, but collapsed, so it should still be possible to navigate to them","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T09:02:19.696331-05:00","updated_at":"2025-12-28T08:14:38.828974-05:00","closed_at":"2025-12-28T08:14:38.828974-05:00"}
{"id":"pair_review-149d","title":"Cannot dismiss AI suggestion when another suggestion for same line was already dismissed/adopted","description":"## Bug Description\n\nWhen a user attempts to dismiss an AI suggestion on a line that already has another dismissed (or adopted) suggestion, the Review panel does not update correctly. The 2nd AI suggestion remains in an inconsistent state.\n\n## Steps to Reproduce\n1. Have multiple AI suggestions on the same line\n2. Dismiss (or adopt) the first suggestion\n3. Attempt to dismiss the second suggestion on the same line\n4. Observe the Review panel does not update for the 2nd dismissal\n\n## Expected Behavior\nEach AI suggestion should be independently dismissable/adoptable, with the Review panel updating correctly for each action.\n\n## Actual Behavior\nThe Review panel fails to update when dismissing a 2nd suggestion on a line that already has a dismissed/adopted suggestion.\n\n## Context\nA similar issue was previously fixed for the 'restore' action on the same line. This bug appears to be a related edge case in the same code path.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-27T20:51:36.862108-05:00","created_by":"tim","updated_at":"2026-01-28T08:00:31.687065-05:00","closed_at":"2026-01-28T08:00:31.687065-05:00","close_reason":"Fixed collapseAISuggestion to select correct suggestion div by ID instead of first match"}
{"id":"pair_review-1b8i","title":"Remove confirmation dialog when deleting a single user comment","description":"Currently, deleting a single user comment shows a confirmation dialog. This adds unnecessary friction for a low-risk, easily reversible action. The confirmation dialog should be removed for single comment deletions.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-21T14:59:43.388979-05:00","created_by":"tim","updated_at":"2026-01-21T15:24:06.792547-05:00","closed_at":"2026-01-21T15:24:06.792547-05:00","close_reason":"Removed confirmation dialogs from single comment deletion in both Local mode and File-level comments to match PR mode behavior"}
{"id":"pair_review-1l3","title":"Check for stale PR data before starting AI analysis","description":"Before initiating AI analysis, check if the local PR data is stale (i.e., the remote PR has been updated since last sync). If stale:\n\n1. Prompt user with options: refresh PR first (recommended) or continue with stale data\n2. Default/highlight the refresh option since users will most likely want current data\n3. Show what changed if possible (e.g., 'PR has 2 new commits since last sync')\n\nThis prevents wasted analysis on outdated code and avoids confusion when suggestions don't match the current PR state.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-01T10:09:25.665192-05:00","updated_at":"2026-01-03T21:57:48.468296-05:00","closed_at":"2026-01-03T21:57:48.468296-05:00"}
{"id":"pair_review-1mp","title":"Epic: Implement Design Refresh UI","description":"Migrate the current application UI to match the design-refresh prototype. This involves updating CSS styling, HTML structure, and JavaScript components to achieve visual parity with the prototype at design-refresh/index.html.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T21:03:47.98069-05:00","updated_at":"2025-12-30T21:47:21.622644-05:00","closed_at":"2025-12-30T21:47:21.622644-05:00"}
{"id":"pair_review-1tkf","title":"Suggestion text incorrectly includes both removed and added lines for modified line comments","description":"When adding a suggestion in the editor for a modified line (a line that was changed, showing both removed and added versions), the suggestion text incorrectly includes both the removed line and the added line.\n\n**Expected behavior:**\nOnly the line that the comment is being made on should be included in the suggestion text. For a comment on an added line (right side), only the added line should be included.\n\n**Actual behavior:**\nBoth the removed line (left side) and added line (right side) are included in the suggestion text.\n\n**Impact:**\nThis creates confusing suggestions that include code from both the old and new versions, making it unclear what the suggestion is actually proposing.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-05T19:37:05.256075-05:00","created_by":"tim","updated_at":"2026-01-06T08:37:39.790873-05:00","closed_at":"2026-01-06T08:37:39.790873-05:00","close_reason":"Fixed by filtering suggestion code extraction by side (LEFT/RIGHT)"}
{"id":"pair_review-1ui","title":"Bug: Re-analysis shows combined instructions instead of just custom instructions","description":"When re-running AI analysis, the custom instructions textarea is pre-populated with both repo default instructions AND the user's custom instructions combined, instead of just the user's custom instructions.\n\n**Steps to reproduce:**\n1. Configure repo default instructions in settings\n2. Run AI analysis with additional custom instructions\n3. Click to re-run analysis\n4. The textarea shows repo defaults + custom instructions combined\n\n**Expected behavior:**\n- Only the user's custom instructions should pre-populate the textarea\n- Repo default instructions are shown separately (in the banner)\n- The server handles combining them with XML tags\n\n**Current behavior:**\n- The combined instructions are stored in `reviews.custom_instructions`\n- On re-analysis, `fetchLastCustomInstructions()` returns the combined value\n- This leads to duplication when combined again with repo defaults\n\n**Fix needed:**\n- Store only the user's custom instructions (without repo defaults) in the review record\n- The server-side combining should happen fresh each time, not persist the combined result\n- Alternatively, store them as separate fields in the review record","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-01T21:15:15.078552-05:00","updated_at":"2026-01-02T08:07:40.429045-05:00","closed_at":"2026-01-02T08:07:40.429045-05:00"}
{"id":"pair_review-1w0","title":"AI suggestions: Add level indicator dots","description":"Add analysis level indicator to suggestion headers showing Line/File/Architecture levels:\n- 3 dots in header right side\n- Active dot highlighted in amber\n- Label text showing analysis type (e.g., 'LINE ANALYSIS')\n- Match prototype .ai-suggestion-level styling\nFiles: public/js/pr.js, public/css/pr.css","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T21:04:32.341948-05:00","updated_at":"2025-12-30T21:47:11.764909-05:00","closed_at":"2025-12-30T21:47:11.764909-05:00","dependencies":[{"issue_id":"pair_review-1w0","depends_on_id":"pair_review-1mp","type":"blocks","created_at":"2025-12-30T21:04:56.174238-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-255d","title":"Add unit tests for Gemini, Claude, and Codex providers","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-11T17:58:49.212708-05:00","created_by":"tim","updated_at":"2026-01-11T17:58:49.212708-05:00"}
{"id":"pair_review-27s","title":"Add API contract tests","description":"Add tests that verify API response shapes match frontend expectations.\n\n## Problem solved\nFrontend code expects specific property names (e.g., changed_files, file_changes).\nCurrent tests verify status codes but not exact response structure.\n\n## Implementation\n- Define expected response schemas for each endpoint\n- Test that actual responses match schemas exactly\n- Include property names, types, and required fields\n- Fail tests if response shape changes unexpectedly\n\n## Key endpoints to cover\n- GET /api/pr/:owner/:repo/:number (PR metadata)\n- GET /api/pr/:owner/:repo/:number/diff (files and diff)\n- GET /api/pr/:owner/:repo/:number/ai-suggestions\n- POST /api/user-comment (comment creation)\n\n## Benefits\n- Catches property name mismatches early\n- Documents API contracts explicitly\n- Prevents silent breaking changes","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-03T08:21:57.057273-05:00","updated_at":"2026-01-03T08:21:57.057273-05:00"}
{"id":"pair_review-28g","title":"Unified Review Navigation Panel","description":"Transform the AI Analysis panel into a unified Review panel with segmented navigation (All | AI Findings | Comments). Add keyboard navigation (j/k) and distinct styling for different item types.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-03T12:31:01.255874-05:00","updated_at":"2026-01-03T12:59:45.892834-05:00","closed_at":"2026-01-03T12:59:45.892834-05:00"}
{"id":"pair_review-2em5","title":"General Release v1.0","description":"Epic to track all work required for the general v1.0 release of pair-review.\n\nIMPORTANT: Do NOT close this epic until explicit approval from Tim. This epic orchestrates the release and should only be closed when the release is actually shipped.\n\nThis epic represents making pair-review ready for public use with professional polish, complete documentation, and all core functionality working reliably.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-08T20:54:12.929013-05:00","created_by":"tim","updated_at":"2026-01-08T20:54:39.14704-05:00","dependencies":[{"issue_id":"pair_review-2em5","depends_on_id":"pair_review-shov","type":"blocks","created_at":"2026-01-08T20:55:10.03757-05:00","created_by":"tim"},{"issue_id":"pair_review-2em5","depends_on_id":"pair_review-vdbw","type":"blocks","created_at":"2026-01-08T20:55:10.134277-05:00","created_by":"tim"},{"issue_id":"pair_review-2em5","depends_on_id":"pair_review-vdt2","type":"blocks","created_at":"2026-01-08T20:55:10.20325-05:00","created_by":"tim"},{"issue_id":"pair_review-2em5","depends_on_id":"pair_review-van2","type":"blocks","created_at":"2026-01-08T20:55:15.921394-05:00","created_by":"tim"},{"issue_id":"pair_review-2em5","depends_on_id":"pair_review-gk3","type":"blocks","created_at":"2026-01-08T20:55:16.017403-05:00","created_by":"tim"},{"issue_id":"pair_review-2em5","depends_on_id":"pair_review-zys","type":"blocks","created_at":"2026-01-08T20:55:16.071275-05:00","created_by":"tim"},{"issue_id":"pair_review-2em5","depends_on_id":"pair_review-37c1","type":"blocks","created_at":"2026-01-08T20:55:16.170614-05:00","created_by":"tim"},{"issue_id":"pair_review-2em5","depends_on_id":"pair_review-68n","type":"blocks","created_at":"2026-01-08T20:55:16.219315-05:00","created_by":"tim"},{"issue_id":"pair_review-2em5","depends_on_id":"pair_review-5ma8","type":"blocks","created_at":"2026-01-08T20:57:19.196918-05:00","created_by":"tim"},{"issue_id":"pair_review-2em5","depends_on_id":"pair_review-xnnw","type":"blocks","created_at":"2026-01-09T06:37:49.842334-05:00","created_by":"tim"},{"issue_id":"pair_review-2em5","depends_on_id":"pair_review-6cj8","type":"blocks","created_at":"2026-01-20T20:05:23.966502-05:00","created_by":"tim"}]}
{"id":"pair_review-2em5.1","title":"Review AI provider permissions during code review","description":"Audit and document the permissions required by each AI provider (Claude CLI, Gemini CLI, Codex) when performing code reviews. Ensure the application follows least-privilege principles and that users understand what access they're granting. Consider: filesystem access scope, network permissions, any environment variables or credentials exposed to the provider processes.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T12:29:15.551649-05:00","created_by":"tim","updated_at":"2026-01-13T20:52:49.683098-05:00","closed_at":"2026-01-13T20:52:49.683098-05:00","close_reason":"Implemented","dependencies":[{"issue_id":"pair_review-2em5.1","depends_on_id":"pair_review-2em5","type":"parent-child","created_at":"2026-01-11T12:29:15.554851-05:00","created_by":"tim"}]}
{"id":"pair_review-2ip","title":"Settings page does not respect dark/light theme from PR page","description":"When navigating to the settings page from the PR page, the settings page always shows in light theme regardless of the current theme setting on the PR page.\n\n**Steps to reproduce:**\n1. Open a PR in the app\n2. Switch to dark theme using the theme toggle\n3. Click the settings icon to navigate to the settings page\n4. Settings page displays in light theme instead of dark\n\n**Expected behavior:**\nThe settings page should respect the same theme preference that's active on the PR page.\n\n**Likely cause:**\nTheme preference is stored in localStorage but the settings page may not be reading it on load, or uses different theme initialization logic.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T08:15:12.032814-05:00","updated_at":"2026-01-02T08:16:07.435393-05:00","closed_at":"2026-01-02T08:16:07.435393-05:00"}
{"id":"pair_review-2nn","title":"E2E tests for review submission","description":"Test review workflow - selecting review type, entering summary, submitting, success/failure toast feedback, different review types (Approve/Comment/Request Changes)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:09:47.740092-05:00","created_by":"tim","updated_at":"2026-01-05T07:21:48.938023-05:00","closed_at":"2026-01-05T07:21:48.938023-05:00","close_reason":"Closed"}
{"id":"pair_review-2rfo","title":"Fix pr_id collision between PR mode and local mode","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-15T17:26:16.574481-05:00","created_by":"tim","updated_at":"2026-01-15T21:48:32.147995-05:00","closed_at":"2026-01-15T21:48:32.147995-05:00","close_reason":"Standardized on reviews.id for both AI suggestions and user comments. PR mode now creates/uses reviews.id instead of pr_metadata.id, matching local mode. All 1204 unit tests and 171 E2E tests pass.","comments":[{"id":11,"issue_id":"pair_review-2rfo","author":"tim","text":"## Summary\n\nAI suggestions and user comments from local mode sessions appear on PR mode sessions (and vice versa) due to comments.pr_id storing two different ID types:\n\n- PR mode: stores pr_metadata.id\n- Local mode: stores reviews.id\n\nWhen IDs collide (e.g., pr_metadata.id = 14 and reviews.id = 14), data leaks between sessions.\n\n## Root Cause\n\nThe comments table has a single pr_id column used for both pr_metadata.id (PR reviews) and reviews.id (local reviews). These are separate auto-increment sequences that can produce the same values.\n\n## Evidence\n\n- pr_metadata max ID: 14\n- reviews max ID: 28  \n- Many orphaned comments with pr_id \u003e 14 (from local mode)\n- New PR with pr_metadata.id = 14 shows suggestions from local review reviews.id = 14\n\n## Code Locations\n\nPR mode stores pr_metadata.id:\n- src/routes/analysis.js:220 - passes prMetadata.id to analyzer\n- src/routes/pr.js:89 - returns id: prMetadata.id to frontend\n\nLocal mode stores reviews.id:\n- src/routes/local.js:404 - passes reviewId to analyzer\n- src/routes/local.js:1092-1093 - passes reviewId as pr_id for comments\n\nAnalyzer stores with ambiguous pr_id:\n- src/ai/analyzer.js:1291-1296 - INSERT INTO comments (pr_id, ...)\n\n## Proposed Fix\n\nStandardize on reviews.id everywhere:\n\n1. Always create a reviews record when loading a PR (via getOrCreate)\n2. Return reviews.id as the id field in PR API responses\n3. Pass reviews.id to analyzer instead of prMetadata.id\n4. Update all comment/suggestion queries to use reviews.id\n\nThis eliminates ID namespace collision - only one ID space (reviews) is used.\n\n## Files to Modify\n\n- src/routes/pr.js - return reviews.id instead of pr_metadata.id\n- src/routes/analysis.js - get/create review, pass review.id to analyzer\n- src/routes/comments.js - update queries if needed\n- src/database.js - possibly rename column pr_id to review_id for clarity","created_at":"2026-01-15T22:26:50Z"}]}
{"id":"pair_review-2t8d","title":"Add hunk headers to git-diff-lines annotated output","description":"## Problem\n\nThe `git-diff-lines` annotated output currently consumes hunk headers (`@@ -start,count +start,count @@`) to set line numbers but doesn't output any marker indicating chunk boundaries.\n\nExample output showing a ~1200 line gap with no visual indicator:\n```\n 782 |  788 |     ${prContext}...\n1973 | 1979 |     const generatedFilesSection = ...\n```\n\nThe frontend can infer chunk boundaries from line number jumps, but there's no explicit separator.\n\n## Proposed Solution\n\nAdd hunk header lines to the annotated output. Options:\n1. Preserve original git hunk header: `@@ -1973,7 +1979,7 @@ function context`\n2. Simplified format: `--- chunk break (lines 789-1978 not shown) ---`\n3. Custom format showing gap: `... 1185 lines hidden ...`\n\n## Changes Needed\n\n1. **src/utils/diff-annotator.js**: Output a hunk marker instead of silently consuming the header (around line 260)\n2. **Frontend**: Update diff display to recognize and render hunk headers (currently works without them via line number inference)\n\n## Current Behavior\n\nThe diff-annotator parses hunk headers at line 230 in `diff-annotator.js`, uses them to initialize `oldLineNum` and `newLineNum`, then continues without outputting anything.","status":"closed","priority":4,"issue_type":"feature","created_at":"2026-01-08T16:52:58.934268-05:00","created_by":"tim","updated_at":"2026-01-08T17:04:21.569542-05:00","closed_at":"2026-01-08T17:04:21.569542-05:00","close_reason":"Implemented hunk header output in git-diff-lines: annotated output now includes chunk boundary markers with format '@@ OLD:start NEW:start @@ [function context]'"}
{"id":"pair_review-30u","title":"Validation and testing","description":"Verify all functionality in Chrome browser. Ensure existing tests pass. Test keyboard navigation, segment switching, and navigation to items in diff view.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:31:16.205193-05:00","updated_at":"2026-01-03T12:59:45.868778-05:00","closed_at":"2026-01-03T12:59:45.868778-05:00","dependencies":[{"issue_id":"pair_review-30u","depends_on_id":"pair_review-28g","type":"blocks","created_at":"2026-01-03T12:31:27.551927-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-30u","depends_on_id":"pair_review-419","type":"blocks","created_at":"2026-01-03T12:31:27.63069-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-30u","depends_on_id":"pair_review-9ce","type":"blocks","created_at":"2026-01-03T12:31:27.649139-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-30u","depends_on_id":"pair_review-d9j","type":"blocks","created_at":"2026-01-03T12:31:27.667878-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-37c1","title":"Different repo clone behavior: CLI PR URL vs web UI index page","description":"## Problem\nWhen starting a review, pair-review may use different repository sources depending on how it was initiated:\n- CLI with PR URL: May use one approach for finding/creating the repo\n- Web UI index page: May use a different approach\n\nThis could lead to inconsistent behavior or not using an existing local clone when it's available.\n\n## Investigation needed\n- Document the exact code paths for both entry points\n- Identify if one path uses local clone while the other always clones fresh\n- Ensure consistent behavior between CLI and web UI\n\n## Related\nSee also: pair_review-3ibs (Support sparse checkouts and prefer existing local clones)","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-08T15:32:10.421208-05:00","created_by":"tim","updated_at":"2026-01-20T20:06:03.088723-05:00","closed_at":"2026-01-20T20:06:03.088723-05:00","close_reason":"Already addressed"}
{"id":"pair_review-38y","title":"URL input field should be much wider","description":"The URL input field on the landing page is still too narrow. It should be approximately 3 times its current width to properly accommodate GitHub PR URLs without truncation.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-29T08:05:31.540895-05:00","updated_at":"2025-12-29T08:28:12.108173-05:00","closed_at":"2025-12-29T08:28:12.108173-05:00","dependencies":[{"issue_id":"pair_review-38y","depends_on_id":"pair_review-jbp","type":"blocks","created_at":"2025-12-29T08:05:54.642524-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-3am","title":"Bug: Commit SHA not updated in UI after refreshing PR","description":"After refreshing a PR to fetch the latest changes, the commit SHA displayed in the UI is not updated to reflect the new HEAD. The UI continues showing the old SHA even though the diff content has been refreshed.\n\nExpected behavior: The displayed commit SHA should update to match the latest fetched commit after a PR refresh.\n\nLikely cause: The SHA display element is not being re-rendered or the state variable holding the SHA is not being updated when PR data is refreshed.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-01T11:13:49.054664-05:00","updated_at":"2026-01-01T11:58:11.081625-05:00","closed_at":"2026-01-01T11:58:11.081625-05:00"}
{"id":"pair_review-3c5h","title":"Implement prompt optimization architecture","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-13T21:05:29.970724-05:00","created_by":"tim","updated_at":"2026-01-13T21:05:29.970724-05:00","dependencies":[{"issue_id":"pair_review-3c5h","depends_on_id":"pair_review-wtog","type":"blocks","created_at":"2026-01-13T21:06:09.697859-05:00","created_by":"tim"}],"comments":[{"id":9,"issue_id":"pair_review-3c5h","author":"tim","text":"## Overview\n\nImplement the 4×3×N prompt optimization architecture documented in `docs/architecture/prompt-optimization.md`.\n\n**Matrix**: 4 prompts (Level 1-3 + Orchestration) × 3 tiers (fast/balanced/thorough) × N providers\n\n**Approach**: Claude prompts as canonical baseline, other providers derive optimized variants.\n\n## Key References\n- Design doc: `docs/architecture/prompt-optimization.md`\n- Current prompts: `src/ai/analyzer.js` (buildLevel1Prompt, buildLevel2Prompt, buildLevel3Prompt)\n\n## Phases\n1. Foundation - directory structure + Level 2 Balanced as proof of concept\n2. Complete Baselines - all 12 baseline prompts\n3. Optimization Tooling - tools to generate provider variants\n4. Provider Variants - Gemini, OpenAI optimized prompts\n\n## Implementation Notes\n- Run old and new in parallel during migration\n- Use Task tools to preserve context in main session\n- Each phase delivers incremental value","created_at":"2026-01-14T02:05:39Z"}]}
{"id":"pair_review-3e6d","title":"Improve E2E test database isolation between test files","description":"The E2E test suite creates a single in-memory SQLite database (`:memory:`) in global-setup.js that persists across all test files. While this is fast, it means tests aren't truly isolated from each other - data created in one test file can affect tests in another file.\n\n**Current state:**\n- Single in-memory database shared across all tests\n- `workers: 1` mitigates parallelism issues\n- Tests can see leftover data from previous test files\n\n**Potential improvements:**\n1. Create a fresh database for each test file in a `beforeAll` hook\n2. Add a mechanism to reset tables to a known state between test files\n3. Use file-based databases with unique names per test file\n\n**Short-term mitigation (already in place):**\n- `fullyParallel: false` and `workers: 1` prevent parallel test execution\n- Comment added to document this shared state\n\nThis becomes more important as the test suite grows and timing issues can cause tests to interfere with each other.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-05T08:14:29.861696-05:00","created_by":"tim","updated_at":"2026-01-05T08:14:29.861696-05:00"}
{"id":"pair_review-3ibs","title":"Support sparse checkouts and prefer existing local clones","description":"## Problem\nWhen running pair-review from an existing local clone (e.g., a sparse checkout of a large monorepo), pair-review ignores the local repo and clones fresh to ~/.pair-review/repos/. This is wasteful and doesn't respect the user's sparse checkout configuration.\n\n## Current Behavior\n- Always clones to ~/.pair-review/repos/{owner}/{repo} if no cached clone exists\n- No awareness of sparse checkout settings\n- Doesn't detect or use the user's existing local clone\n\n## Desired Behavior\n1. **Prefer existing local clone**: When run from within a git repo, use that as the source for worktrees instead of cloning fresh\n2. **Sparse checkout awareness**: Inherit or copy sparse-checkout config when creating worktrees\n3. **Config option**: Allow specifying sparse patterns per repo in settings\n\n## Use Case\nUsers working in large monorepos with sparse checkouts shouldn't need pair-review to clone the entire repo when they already have a local clone configured the way they need it.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-08T15:16:17.909755-05:00","created_by":"tim","updated_at":"2026-01-08T15:16:28.540939-05:00"}
{"id":"pair_review-3ig","title":"Consolidate comment buttons into split button","description":"## Problem\nThe PR header has 3 comment-related buttons that clutter the UI:\n- Preview Comments\n- Clear Comments  \n- N comments (Submit Review)\n\n## Solution\nReplace with a single **split button** pattern:\n\n```\n┌──────────────────┬───┐\n│   2 comments     │ ▾ │  ← Two click targets\n└──────────────────┴───┘\n        ↓            ↓\n   Primary       Dropdown\n   Action        Menu\n```\n\n### Behavior\n- **Click main area** → executes configurable primary action (Submit Review or Preview)\n- **Click dropdown arrow** → shows menu with all options:\n  ```\n  ┌─────────────────┐\n  │ ✓ Submit Review │  ← checkmark shows current default\n  │   Preview       │\n  │ ───────────────│\n  │   Clear All     │\n  └─────────────────┘\n  ```\n\n### Configuration\nAdd to `~/.pair-review/config.json`:\n```json\n{\n  \"comment_button_action\": \"submit\"  // or \"preview\"\n}\n```\n\nDefault: \"submit\" (most users want quick submission)\n\n### Implementation Details\n\n1. **Create SplitButton component** (`public/js/components/SplitButton.js`)\n   - Renders button with main area + dropdown arrow\n   - Handles click events for both targets\n   - Manages dropdown open/close state\n   - Closes dropdown on outside click\n\n2. **Update pr.js header rendering** (around line 468)\n   - Remove: Preview Comments, Clear Comments, N comments buttons\n   - Add: Single split button instance\n   - Wire up actions: openPreviewModal(), clearAllUserComments(), openReviewModal()\n\n3. **Add API endpoint** for config\n   - GET `/api/config` - returns user config including comment_button_action\n   - Already may exist, just need to add new field\n\n4. **CSS styling** (`public/css/pr.css`)\n   - Split button styling matching existing btn-primary/green style\n   - Dropdown menu styling\n   - Checkmark indicator for current default\n   - Separator line before Clear All (destructive action)\n\n### Files to modify\n- `public/js/components/SplitButton.js` (new)\n- `public/js/pr.js` (header buttons ~line 468, updateCommentCount)\n- `public/css/pr.css` (split button styles)\n- `src/server.js` or config handler (if config endpoint needs update)\n\n### Reference\nSimilar patterns:\n- VS Code Run button with debug config dropdown\n- GitHub \"Merge pull request\" dropdown\n- Chrome download button","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-28T13:01:15.891622-05:00","updated_at":"2025-12-28T13:22:01.510553-05:00","closed_at":"2025-12-28T13:22:01.510553-05:00"}
{"id":"pair_review-3o2","title":"DB schema: Repo settings table for persistent configuration","description":"Create new database table to store per-repo settings including default analysis instructions. Table should key off repo identifier (owner/repo) and support future extension for other repo-level settings.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T18:26:05.864283-05:00","updated_at":"2026-01-01T14:18:45.769445-05:00","closed_at":"2026-01-01T14:18:45.769445-05:00","dependencies":[{"issue_id":"pair_review-3o2","depends_on_id":"pair_review-f8b","type":"blocks","created_at":"2025-12-31T18:26:22.344443-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-3ru","title":"Middle panel sizing incorrect on initial load until AI panel toggled","description":"The diff view middle panel doesn't size correctly on initial page load. Toggling the AI panel causes a recalculation that fixes it. Fixed by changing flex: 1 to flex: 1 1 0 on .diff-view to force flex-basis: 0 calculation.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T09:01:55.60817-05:00","updated_at":"2025-12-31T09:02:02.512319-05:00","closed_at":"2025-12-31T09:02:02.512319-05:00"}
{"id":"pair_review-3ur","title":"UI: Add navigation for user comments like AI suggestions","description":"Add a navigator component for user comments similar to the existing AI suggestion navigator. Currently users must scroll through the diff to find their comments, or use the preview panel which only shows text without edit capability.\n\nDesired functionality:\n- List of user comments with ability to jump to each one in the diff\n- Edit capability from the navigator (or quick jump to edit in place)\n- Visual indicator of comment count\n- Possibly filter/sort options (by file, by status if we add draft/submitted states)\n\nCould potentially unify with or mirror the AI suggestion navigator pattern for consistency.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T21:26:43.921839-05:00","updated_at":"2026-01-04T19:13:44.325013-05:00","closed_at":"2026-01-04T19:13:44.325013-05:00","close_reason":"Implemented - user comments integrated into AIPanel with Comments segment, navigation, and count display"}
{"id":"pair_review-416","title":"Add provider to config schema","description":"Add provider field to config (global and per-repo). Default to claude. Store in ~/.pair-review/config.json and repo settings.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:41:50.62802-05:00","updated_at":"2026-01-03T13:00:35.082341-05:00","closed_at":"2026-01-03T13:00:35.082341-05:00"}
{"id":"pair_review-419","title":"Track and display user comments in Review panel","description":"Integrate with CommentManager to load user comments (including adopted suggestions). Display comments in the findings list when 'Comments' or 'All' segment is selected. Comments should show their type, location, and preview text.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:31:16.122466-05:00","updated_at":"2026-01-03T12:46:05.895798-05:00","closed_at":"2026-01-03T12:46:05.895798-05:00","dependencies":[{"issue_id":"pair_review-419","depends_on_id":"pair_review-28g","type":"blocks","created_at":"2026-01-03T12:31:27.494366-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-419","depends_on_id":"pair_review-8v7","type":"blocks","created_at":"2026-01-03T12:31:27.571314-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-41r","title":"Separate index.html and pr.html pages","description":"Currently the landing page and PR review page share index.html, which causes issues with elements appearing where they shouldn't. These should be separate HTML files:\n\n- index.html: Landing page with URL input and recent reviews\n- pr.html: PR review page with diff view, sidebars, etc.\n\nThis is a cleaner architecture that avoids CSS/JS conflicts and show/hide logic.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T08:05:33.62306-05:00","updated_at":"2025-12-29T08:26:46.101998-05:00","closed_at":"2025-12-29T08:26:46.101998-05:00","dependencies":[{"issue_id":"pair_review-41r","depends_on_id":"pair_review-jbp","type":"blocks","created_at":"2025-12-29T08:05:54.686022-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-44k","title":"Fix navigation counter bug (8 of 7)","description":"Navigation counter has bugs:\n- Starts at '- of 7' which looks odd (should maybe show '0 of 7' or just '7 items')\n- Goes up to '8 of 7' which is clearly wrong\n- Need to investigate the counting logic","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-03T13:36:04.035438-05:00","updated_at":"2026-01-03T13:44:30.979702-05:00","closed_at":"2026-01-03T13:44:30.979702-05:00","dependencies":[{"issue_id":"pair_review-44k","depends_on_id":"pair_review-epg","type":"blocks","created_at":"2026-01-03T13:36:14.381756-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-452","title":"Add dedicated worktrees database table","description":"## Problem\nWorktree paths are currently stored in `pr_metadata.pr_data` JSON blob. This makes queries for cleanup, recently-used lists, and tracking difficult.\n\n## Solution\nCreate a dedicated `worktrees` table:\n\n```sql\nCREATE TABLE worktrees (\n  id TEXT PRIMARY KEY,           -- Random ID (like beads naming)\n  pr_number INTEGER NOT NULL,\n  repository TEXT NOT NULL,      -- owner/repo format\n  branch TEXT NOT NULL,          -- PR head branch\n  path TEXT NOT NULL,            -- Full filesystem path\n  created_at TEXT NOT NULL,      -- ISO timestamp\n  last_accessed_at TEXT NOT NULL,-- ISO timestamp, updated on each use\n  UNIQUE(pr_number, repository)\n);\n\nCREATE INDEX idx_worktrees_last_accessed ON worktrees(last_accessed_at);\nCREATE INDEX idx_worktrees_repo ON worktrees(repository);\n```\n\n## Implementation\n1. Add table creation to `src/database.js`\n2. Add migration logic to handle existing worktrees (scan directory, populate table)\n3. Create WorktreeRepository class with CRUD methods:\n   - `create(prInfo)` → returns worktree record\n   - `findByPR(prNumber, repository)` → returns worktree or null\n   - `updateLastAccessed(id)` → touches last_accessed_at\n   - `findStale(olderThan)` → returns worktrees not accessed since date\n   - `delete(id)` → removes record\n   - `listRecent(limit)` → returns recently accessed worktrees\n\n## Notes\n- Keep `pr_metadata.pr_data` blob for backward compat but stop writing worktree_path there\n- Random ID generation should match beads style (alphanumeric, ~6 chars)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T15:55:47.036368-05:00","updated_at":"2025-12-28T16:08:29.231282-05:00","closed_at":"2025-12-28T16:08:29.231282-05:00","dependencies":[{"issue_id":"pair_review-452","depends_on_id":"pair_review-e4k","type":"blocks","created_at":"2025-12-28T15:56:43.415803-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-4a5","title":"Update GitHub client to use line/side/commit_id API","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T21:40:15.535398-05:00","updated_at":"2025-12-31T21:43:49.084277-05:00","closed_at":"2025-12-31T21:43:49.084277-05:00","dependencies":[{"issue_id":"pair_review-4a5","depends_on_id":"pair_review-f3v","type":"blocks","created_at":"2025-12-31T21:40:23.053043-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-4d8","title":"CLI: Add --local flag with optional path argument","description":"Add --local flag to pair-review CLI.\n\n## Changes to bin/pair-review.js\n- Add option: `--local [path]` - Review uncommitted local changes\n- Path is optional, defaults to current working directory\n\n## Changes to src/main.js\n- Early branch: detect `flags.local` before PR argument parsing\n- If local mode: call `handleLocalReview(targetPath, flags)`\n- If PR mode: existing `handlePullRequestReview()` flow\n\n## Validation\n- Verify target path is a git repository\n- Error if path doesn't exist or isn't a git repo","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T09:00:18.351805-05:00","created_by":"tim","updated_at":"2026-01-04T09:22:50.8454-05:00","closed_at":"2026-01-04T09:22:50.8454-05:00","close_reason":"Implementation complete, all 183 tests pass","dependencies":[{"issue_id":"pair_review-4d8","depends_on_id":"pair_review-8h3","type":"blocks","created_at":"2026-01-04T09:00:35.111482-05:00","created_by":"tim"},{"issue_id":"pair_review-4d8","depends_on_id":"pair_review-gvx","type":"blocks","created_at":"2026-01-04T09:00:36.514894-05:00","created_by":"tim"}]}
{"id":"pair_review-4fix","title":"Refactor createGapSection to accept endLineNew parameter","description":"The createGapSection function in hunk-parser.js creates gap rows but doesn't accept an endLineNew parameter. Currently, callers must reach into the returned object's internals to set expandControls.dataset.endLineNew after creation, which breaks encapsulation.\n\nConsider adding an optional endLineNew parameter to createGapSection's signature. This would make the API more explicit and avoid post-creation dataset manipulation.\n\nThis requires changing createGapSection and all its call sites, so it's a larger refactoring task.\n\nReference: Code review feedback from hidden lines expansion fix (Jan 2026).","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-13T12:55:03.733199-05:00","created_by":"tim","updated_at":"2026-01-13T12:55:03.733199-05:00"}
{"id":"pair_review-4gbg","title":"Inserting suggestion for modified line includes text from both OLD and NEW lines","description":"## Bug Description\n\nWhen inserting a suggestion on a modified line (shown as a deletion in OLD and addition in NEW in the diff view), the suggestion incorrectly includes text from both the OLD deleted line and the NEW added line, resulting in duplicated/concatenated content.\n\n## Steps to Reproduce\n1. View a diff with a modified line (appears as deleted line in OLD, added line in NEW)\n2. Insert a suggestion for that line\n3. Observe the suggestion text\n\n## Expected Behavior\nThe suggestion should only include the text from the NEW (added) line, since that represents the current state of the code being reviewed.\n\n## Actual Behavior\nThe suggestion includes text from both the OLD (deleted) line and the NEW (added) line, resulting in incorrect/duplicated content.\n\n## Technical Context\nModified lines in unified diffs are represented as a deletion followed by an addition. The suggestion insertion logic appears to be capturing both lines instead of just the relevant NEW line.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-27T20:52:21.049948-05:00","created_by":"tim","updated_at":"2026-01-27T21:03:57.175071-05:00","closed_at":"2026-01-27T21:03:57.175071-05:00","close_reason":"Fixed by propagating side property through comment display and edit flows. Changes: (1) displayUserComment now stores side in commentRow.dataset, (2) displayUserCommentInEditMode stores side in both commentRow.dataset and textarea data-side, (3) editUserComment in both pr.js and local.js reads side from commentRow and adds to edit textarea, (4) saveUserComment now includes side in commentData passed to displayUserComment."}
{"id":"pair_review-4k0","title":"Use random IDs for worktree directory names","description":"## Problem\nCurrent naming `{owner}-{repo}-{number}` is predictable and suggests these directories are for user access. They should be for application use only.\n\n## Solution\nUse random alphanumeric IDs (like beads issue naming) for worktree directories:\n- Before: `~/.pair-review/worktrees/anthropic-pair-review-123`\n- After: `~/.pair-review/worktrees/x7k` or `~/.pair-review/worktrees/a3m9p`\n\n## Implementation\n1. Update `WorktreeManager.createWorktreeForPR()` to:\n   - Generate random ID (6 alphanumeric chars)\n   - Use ID as directory name\n   - Store mapping in worktrees table\n2. Update `getWorktreePath()` to look up path from DB by PR info\n3. Remove any logic that derives path from PR number\n\n## Dependencies\n- Requires worktrees database table (pair_review-452)\n\n## Migration\n- Existing worktrees can be renamed or left as-is until cleanup\n- New worktrees use random naming immediately","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T15:56:20.310439-05:00","updated_at":"2025-12-28T16:19:15.852915-05:00","closed_at":"2025-12-28T16:19:15.852915-05:00","dependencies":[{"issue_id":"pair_review-4k0","depends_on_id":"pair_review-452","type":"blocks","created_at":"2025-12-28T15:56:34.943059-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-4k0","depends_on_id":"pair_review-e4k","type":"blocks","created_at":"2025-12-28T15:56:43.462161-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-4kl1","title":"Allow 'which' command in AI provider shell tools","description":"## Summary\nAdd `which` to the allowed shell commands for AI providers. This command is useful for AI agents to verify that required tools (like git, rg, gh) are available in the PATH before attempting to use them.\n\n## Context\nCurrently the allowed tools lists in providers don't include `which`, which prevents the AI from introspecting the environment to check tool availability.\n\n## Files to update\n- `src/ai/claude-provider.js` - Add 'which' to allowed tools\n- `src/ai/gemini-provider.js` - Add 'which' to allowed tools  \n- `src/ai/copilot-provider.js` - Add 'which' to allowed tools\n- `src/ai/codex-provider.js` - Add 'which' to allowed tools","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-22T14:30:34.593425-05:00","created_by":"tim","updated_at":"2026-01-22T14:30:42.051136-05:00"}
{"id":"pair_review-4nwb","title":"Refine Claude baseline prompts through manual iteration","description":"The prompt optimization architecture was originally motivated by improving Claude prompts specifically, before expanding to multi-provider support. The Claude baseline prompts should be refined through manual iteration and testing.\n\nThis is separate from the Phase 4 provider variant generation work - no tooling needed. Focus on:\n\n- Refining focus-areas based on what Sonnet tends to miss or over-flag\n- Adjusting severity-calibration if confidence scores are poorly calibrated  \n- Tweaking output-instructions if JSON compliance is inconsistent\n- Testing prompts against real PRs and iterating based on results\n\nThe tagged format in src/ai/prompts/baseline/ makes sections clearly delineated for targeted refinement.\n\nReference: docs/architecture/prompt-optimization.md","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-14T06:17:54.027263-05:00","created_by":"tim","updated_at":"2026-01-14T06:18:05.198557-05:00"}
{"id":"pair_review-4oyn","title":"Clear all button unreliable - sometimes requires page refresh","description":"The 'Clear all' button in the UI is unreliable. Sometimes clicking it does nothing and a page refresh is required before it works. Users are likely to encounter this during normal usage.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-23T07:47:32.36541-05:00","created_by":"tim","updated_at":"2026-01-23T21:58:32.540557-05:00","closed_at":"2026-01-23T21:58:32.540557-05:00","close_reason":"Fixed by using event delegation for dropdown menu item clicks. The bug was caused by updateDropdownMenu() replacing innerHTML while the dropdown was open, orphaning event listeners attached to old DOM elements."}
{"id":"pair_review-4qyk","title":"Review and clarify E2E test file responsibilities for comment tests","description":"## Background\n\nReview feedback noted potential overlap between `comments-review.spec.js` and `comment-crud.spec.js`.\n\n## Analysis\n\n### comments-review.spec.js (296 lines)\nTests focused on:\n- **Comment Creation** (4 tests): Basic form display, textarea, buttons, cancel behavior\n- **Review Modal** (4 tests): Review button, modal opening, review event options, cancel\n- **API Integration** (3 tests): PR data fetch, diff fetch, error handling\n- **UI State Management** (2 tests): UI updates, file selection\n- **Accessibility** (3 tests): Headings, buttons, keyboard nav\n\n### comment-crud.spec.js (660 lines)\nTests focused on:\n- **Comment Creation and Submission** (4 tests): Full typing/submit flow, keyboard shortcuts\n- **Comment Editing** (4 tests): Edit mode, save, cancel\n- **Comment Deletion** (4 tests): Delete flow, confirmation dialog\n- **Multi-line Drag Selection** (3 tests)\n- **Comment Persistence** (2 tests): Refresh, navigation\n- **Comment API Integration** (3 tests): Save, delete, update APIs\n- **Comment Display** (3 tests): Timestamp, line info, icons\n\n## Overlap Assessment\n\nThe overlap is **minor and intentional**:\n- `comments-review.spec.js` tests basic comment form behavior as part of the review workflow\n- `comment-crud.spec.js` provides comprehensive CRUD testing\n\n### Current Division of Responsibility\n- **comments-review.spec.js**: Review submission workflow, general UI, accessibility\n- **comment-crud.spec.js**: Complete comment lifecycle (CRUD operations)\n\n## Recommendation\n\n**Low priority** - The current division is reasonable:\n1. Files have distinct purposes despite some overlap\n2. Overlap is in basic \"sanity check\" tests that are quick to run\n3. Merging could create an unwieldy large file\n\n### If consolidation is desired:\n- Move the 4 basic \"Comment Creation\" tests from `comments-review.spec.js` to `comment-crud.spec.js`\n- Rename `comments-review.spec.js` to `review-submission.spec.js` to clarify its purpose\n- Keep API Integration, UI State, and Accessibility tests in the review file\n\n## Decision\nThis is a low-priority cleanup task. Consider addressing during a larger test refactoring effort.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T10:32:50.61043-05:00","created_by":"tim","updated_at":"2026-01-05T10:33:08.87848-05:00"}
{"id":"pair_review-4sj","title":"Pass custom instructions to orchestration layer for filtering","description":"Custom instructions are passed to Levels 1-3 but NOT to the orchestration step. This means the orchestration can't use user preferences to filter or prioritize suggestions.\n\n**Current behavior:**\n- `customInstructions` passed to `analyzeLevel1/2/3` ✓\n- `orchestrateWithAI(allSuggestions, prMetadata)` - no instructions\n- `buildOrchestrationPrompt` - no instructions parameter\n\n**Expected behavior:**\n- Orchestration should receive custom instructions\n- Use them to prioritize/filter suggestions based on user focus areas\n- Example: If user selected 'Security' focus, orchestration should favor security-related findings\n\n**Implementation:**\n1. Add `customInstructions` parameter to `orchestrateWithAI()`\n2. Add `customInstructions` parameter to `buildOrchestrationPrompt()`\n3. Include instructions section in orchestration prompt\n4. Pass `customInstructions` through from `analyzeAllLevels()`\n\n**Files to modify:**\n- `src/ai/analyzer.js`: `orchestrateWithAI`, `buildOrchestrationPrompt`, `analyzeAllLevels`","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-01T21:20:51.914494-05:00","updated_at":"2026-01-02T08:10:30.076524-05:00","closed_at":"2026-01-02T08:10:30.076524-05:00"}
{"id":"pair_review-4ui","title":"Future: Reply to AI suggestions as iterative feedback","description":"Allow users to reply to individual AI suggestions. These replies would be stored and incorporated as additional context/instructions when re-running analysis. This creates a conversational feedback loop where the AI can refine its suggestions based on reviewer feedback. Example: User replies 'This pattern is intentional for performance reasons' to a suggestion, and future analysis rounds consider this context. Depends on the custom instructions infrastructure being in place first.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-31T18:35:58.447329-05:00","updated_at":"2025-12-31T18:36:13.15488-05:00","dependencies":[{"issue_id":"pair_review-4ui","depends_on_id":"pair_review-f8b","type":"blocks","created_at":"2025-12-31T18:36:06.752312-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-4ui","depends_on_id":"pair_review-jlp","type":"blocks","created_at":"2025-12-31T18:36:06.783365-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-4yx3","title":"Suggestion grouping key can mis-parse file paths with colons","description":"## Problem\n\nIn `public/js/modules/suggestion-manager.js`, suggestions are grouped using a colon-delimited key format:\n```javascript\nconst key = `${file}:${line_start}:${side}`;\n```\n\nThis key is later parsed by splitting on `:` and popping from the end:\n```javascript\nconst parts = location.split(':');\nconst side = parts.pop();\nconst lineStr = parts.pop();\nconst file = parts.join(':');\n```\n\nWhile the reverse-parsing approach handles Windows drive letters (e.g., `C:\\path`), it can still fail for:\n- File paths with multiple colons in directory names (rare but possible on macOS/Linux)\n- Any path where a colon appears in an unexpected position\n\n## Impact\n\nSuggestions for files with colons in their paths would be routed to the wrong file or fail to display entirely.\n\n## Suggested Fix\n\nReplace the colon-delimited string key with a structured approach:\n1. Use a Map with object keys, or\n2. Use JSON encoding: `JSON.stringify({file, line, side})` as the key\n3. Use a delimiter that's invalid in file paths (though none exist universally)\n\nOption 2 (JSON) is simplest:\n```javascript\n// Creating key\nconst key = JSON.stringify({ file: suggestion.file, line: suggestion.line_start, side });\n\n// Parsing key\nconst { file, line, side } = JSON.parse(location);\n```\n\n## Current Mitigation\n\nA comment documents this limitation. The issue is rare in practice since colons in file paths are uncommon.","status":"open","priority":3,"issue_type":"bug","created_at":"2026-01-12T15:58:35.955405-05:00","created_by":"tim","updated_at":"2026-01-12T15:58:35.955405-05:00"}
{"id":"pair_review-4z8","title":"Page over-scrolls leaving white region at bottom","description":"The PR review page allows scrolling beyond the content, revealing a white/blank region at the bottom of the viewport. This suggests a CSS layout issue - likely the body/container height is not properly constrained to the viewport, or there's extra margin/padding causing content to extend beyond what's visible.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T08:23:34.0589-05:00","updated_at":"2025-12-31T08:24:45.683937-05:00","closed_at":"2025-12-31T08:24:45.683937-05:00"}
{"id":"pair_review-59c8","title":"Council default selection: last-used per review, repo default, MRU dropdown ordering","description":"Default council selection priority: (1) last council used for this specific review, (2) repo default council from config, (3) New Council. Store last_council_id on review/analysis. Add defaultCouncilId to repo config. Sort dropdown by last_used_at DESC (add column to councils table). Update last_used_at on analysis launch.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-02-08T06:50:25.149809-05:00","created_by":"tim","updated_at":"2026-02-08T06:50:25.149809-05:00"}
{"id":"pair_review-5d1g","title":"Improve E2E test mocking with dependency injection","description":"The E2E test setup in global-setup.js modifies class prototypes directly (e.g., GitHubClient.prototype.fetchPullRequest). This global mutation persists for the entire Node process and has several limitations:\n\n- Makes tests order-dependent\n- Prevents parallel test execution\n- Mocks cannot be reset or varied between different test scenarios\n\n**Current approach** (in global-setup.js):\n```javascript\nGitHubClient.prototype.fetchPullRequest = async () =\u003e mockGitHubResponses.fetchPullRequest;\n```\n\n**Proposed solution:**\nUse dependency injection where GitHubClient is instantiated with mock functions, or use a mock factory that routes receive. This would allow:\n- Per-test mock variations\n- Test isolation\n- Potential parallel test execution\n\nFor now, this approach is pragmatic for a local test app and works correctly.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-05T08:01:25.487769-05:00","created_by":"tim","updated_at":"2026-01-05T08:01:25.487769-05:00"}
{"id":"pair_review-5ma8","title":"Set up CI pipeline with GitHub Actions","description":"Configure GitHub Actions to run automated testing on every push and pull request.\n\nCI pipeline should:\n- Run on every push and PR\n- Execute all unit tests (npm test)\n- Execute all integration tests\n- Execute E2E tests (npm run test:e2e)\n- Report test failures clearly\n- Run on multiple Node.js versions if appropriate\n- Generate and optionally publish test coverage reports\n\nThis ensures code quality is maintained and all tests pass before merging changes.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-08T20:57:15.584069-05:00","created_by":"tim","updated_at":"2026-01-19T07:33:57.992558-05:00","closed_at":"2026-01-19T07:33:57.992558-05:00","close_reason":"CI pipeline already implemented"}
{"id":"pair_review-5vi","title":"CLI should open PR page directly, not landing page","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-29T08:35:36.782001-05:00","updated_at":"2025-12-29T08:37:31.598826-05:00","closed_at":"2025-12-29T08:37:31.598826-05:00"}
{"id":"pair_review-5wj","title":"Simplify AI findings item display","description":"The finding items are visually busy. Consider:\n- Show only filename (line number available on hover via title attribute)\n- Icon is redundant with category text - pick one\n- Icons are not unique per category (same icon for multiple categories) - either make unique or remove\n- Consult frontend-design skill for cleaner layout","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T13:36:04.060975-05:00","updated_at":"2026-01-03T13:44:30.980133-05:00","closed_at":"2026-01-03T13:44:30.980133-05:00","dependencies":[{"issue_id":"pair_review-5wj","depends_on_id":"pair_review-epg","type":"blocks","created_at":"2026-01-03T13:36:14.401479-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-68n","title":"Write tests for AI analyzer orchestration","description":"Create unit tests for src/ai/analyzer.js. Test the 3-level analysis system, orchestration logic, suggestion deduplication, and error handling. Mock Claude CLI responses.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-02T22:05:28.59471-05:00","updated_at":"2026-01-02T22:05:28.59471-05:00","dependencies":[{"issue_id":"pair_review-68n","depends_on_id":"pair_review-70n","type":"blocks","created_at":"2026-01-02T22:05:43.125049-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-6bde","title":"Council dropdown search/filter for large council lists","description":"When users accumulate many councils, the dropdown becomes unwieldy. Add a text filter input at the top of the council selector dropdown that filters options as the user types. Standard pattern (like GitHub branch selector). Low priority — most users will have \u003c10 councils for a while.","status":"open","priority":4,"issue_type":"feature","created_at":"2026-02-08T06:50:26.112669-05:00","created_by":"tim","updated_at":"2026-02-08T06:50:26.112669-05:00"}
{"id":"pair_review-6cj8","title":"Add SPDX license headers to all source files","description":"CLAUDE.md requires 'SPDX-License-Identifier: GPL-3.0-or-later' at the start of all source code files. Currently ~40 files are missing this header:\n- ~20 JavaScript files in src/ (config.js, main.js, server.js, local-review.js, all AI providers, database.js, routes, utilities)\n- ~19 JavaScript files in public/js/ (repo-settings.js, tier-icons.js, suggestion-ui.js, etc.)\n\nThis is a compliance requirement for GPL-3.0 open source release.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-20T20:05:19.682317-05:00","created_by":"tim","updated_at":"2026-01-22T11:00:29.920583-05:00","closed_at":"2026-01-22T11:00:29.920583-05:00","close_reason":"Added SPDX-License-Identifier: GPL-3.0-or-later headers to 77 source files (28 in src/, 49 in public/js/, tests/, and bin/). All 1486 tests pass."}
{"id":"pair_review-6cs9","title":"Support glob-based sparse-checkout patterns","description":"ensurePRDirectoriesInSparseCheckout in src/git/worktree.js uses startsWith() to compare directory paths against sparse-checkout patterns. This only works correctly for cone mode (directory-based patterns). If a repository uses non-cone mode with glob patterns (e.g., '*.js', '**/test/'), the pattern matching would fail to detect coverage correctly. Refactor the pattern matching to support glob syntax when non-cone sparse-checkout is in use.","status":"open","priority":4,"issue_type":"task","created_at":"2026-02-04T16:26:28.427326-05:00","created_by":"tim","updated_at":"2026-02-04T16:26:33.855654-05:00"}
{"id":"pair_review-6cz","title":"Add unit tests for CodexProvider.parseCodexResponse","description":"Add unit tests for the parseCodexResponse method to lock in expectations and prevent regressions.\n\nTest cases needed:\n- Valid JSONL with agent_message containing JSON\n- Malformed JSONL lines (should skip gracefully)\n- Agent message containing non-JSON text\n- Raw stdout JSON fallback when no agent_message found\n- Empty stdout handling\n\nReference: src/ai/codex-provider.js:192","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-03T20:53:46.608688-05:00","updated_at":"2026-01-03T20:53:46.608688-05:00"}
{"id":"pair_review-6kr","title":"P1: All comments submitted as file-level instead of only expanded lines","description":"When adopting AI suggestions, the diff_position and side were not being passed to the user comment creation API. This caused all adopted comments to be treated as expanded context lines and submitted as file-level comments instead of line-level comments. Fixed by extracting diffPosition and side from the target row in getFileAndLineInfo() and passing them through createUserCommentFromSuggestion() to the API.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-01T10:34:27.243119-05:00","updated_at":"2026-01-01T10:57:19.257665-05:00","closed_at":"2026-01-01T10:57:19.257665-05:00"}
{"id":"pair_review-6mb","title":"API routes: Add /api/local/* endpoints","description":"Add parallel API routes for local review mode.\n\n## New File: src/routes/local.js\n\n### Endpoints\n- `GET /api/local/:reviewId` - Get local review metadata\n- `GET /api/local/:reviewId/diff` - Get local diff\n- `POST /api/local/:reviewId/analyze` - Start AI analysis\n- `POST /api/local/:reviewId/analyze/level2` - Level 2 analysis\n- `POST /api/local/:reviewId/analyze/level3` - Level 3 analysis\n- `GET /api/local/:reviewId/suggestions` - Get AI suggestions\n- `GET /api/local/:reviewId/user-comments` - Get user comments\n- `POST /api/local/:reviewId/user-comments` - Add user comment\n- `DELETE /api/local/:reviewId/user-comments` - Delete comments\n\n### Implementation Notes\n- Reuse existing analysis/comment logic where possible\n- No submit-review endpoint (GitHub submission disabled)\n- reviewId is the database ID, not the path@sha identifier\n\n## Register Routes\n- Add to src/server.js route setup","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T09:00:20.520539-05:00","created_by":"tim","updated_at":"2026-01-04T09:27:13.653314-05:00","closed_at":"2026-01-04T09:27:13.653314-05:00","close_reason":"Implementation complete, all 183 tests pass","dependencies":[{"issue_id":"pair_review-6mb","depends_on_id":"pair_review-8h3","type":"blocks","created_at":"2026-01-04T09:00:35.197491-05:00","created_by":"tim"},{"issue_id":"pair_review-6mb","depends_on_id":"pair_review-ba1","type":"blocks","created_at":"2026-01-04T09:00:36.602312-05:00","created_by":"tim"}]}
{"id":"pair_review-6mcq","title":"Local mode should check if files have changed before analysis","description":"In PR mode, the system checks if the PR state has changed (new commits, etc.) before initiating analysis to avoid analyzing stale data. Local mode currently lacks this check - it should verify that the working directory files haven't changed since the last analysis was initiated. Without this, users could start an analysis, make additional edits to files, and receive results that don't match their current working state. The fix should compare file modification times or content hashes before analysis to warn or prompt the user if files have changed.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-06T11:25:46.94712-05:00","created_by":"tim","updated_at":"2026-01-06T12:19:11.436005-05:00","closed_at":"2026-01-06T12:19:11.436005-05:00","close_reason":"Implemented check-stale endpoint for local mode that compares stored diff stats with current working directory state. Frontend now shows dialog when files have changed, offering Refresh \u0026 Analyze, Analyze Anyway, or Cancel options."}
{"id":"pair_review-6q8o","title":"Silence confusing 'Could not read file from base commit' warning in local mode","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-10T09:27:06.279507-05:00","created_by":"tim","updated_at":"2026-01-13T20:54:16.004783-05:00","closed_at":"2026-01-13T20:54:16.004783-05:00","close_reason":"Done","comments":[{"id":2,"issue_id":"pair_review-6q8o","author":"tim","text":"## Problem\n\nIn local mode, users see confusing warnings like:\n\n```\n[AI ⚠] Could not read file public/js/utils/tier-icons.js from base commit: fatal: path 'public/js/utils/tier-icons.js' exists on disk, but not in 'ddbdcbefb18f8b5465fa52b27c126694edaf2313', falling back to HEAD\n```\n\nThis occurs for **newly created files** that don't exist in the commit captured at review start time. The fallback to reading from the working directory succeeds, so the warning is just noise that confuses users.\n\n## Location\n\n`src/routes/pr.js:682` - the `logger.warn()` call in the context expansion try/catch block.\n\n## Solution\n\nChange the `logger.warn` to `logger.debug` (or remove it entirely). The fallback behavior is correct and expected for new files - no need to alarm users about it.\n\n## Context\n\nThe warning is triggered when AI analysis tries to read file contents from the base commit for context expansion. For files created after that commit, git correctly reports they don't exist at that SHA. The system handles this gracefully by reading from the working directory instead.","created_at":"2026-01-10T14:27:16Z"}]}
{"id":"pair_review-6qg","title":"Navigation: Add link to repo settings from PR view","description":"Add a navigation element (link or button) in the PR view that allows users to access the repo settings page. Consider placement in header or sidebar where it's discoverable but not intrusive.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T18:26:08.17695-05:00","updated_at":"2026-01-01T14:28:01.90379-05:00","closed_at":"2026-01-01T14:28:01.90379-05:00","dependencies":[{"issue_id":"pair_review-6qg","depends_on_id":"pair_review-f8b","type":"blocks","created_at":"2025-12-31T18:26:22.436209-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-6qg","depends_on_id":"pair_review-0l0","type":"blocks","created_at":"2025-12-31T18:26:25.683573-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-6ztt","title":"Incorporate Codex variant improvements into baseline prompts","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-19T15:49:33.377684-05:00","created_by":"tim","updated_at":"2026-01-19T15:49:33.377684-05:00","comments":[{"id":18,"issue_id":"pair_review-6ztt","author":"tim","text":"## Context\nThe Codex prompt variants (optimized for gpt-5.1-codex-max) contain several improvements worth incorporating into baseline prompts.\n\n## Improvements to Consider\n\n### High Priority\n1. **Scope Guardrails with Negation** (Level 3 `purpose`)\n   - Add explicit boundaries: \"This is NOT a general codebase review or architectural audit\"\n   - Prevents model drift into unrelated analysis\n\n2. **Priority Tagging on Focus Areas** (Level 2/3 `focus-areas`)\n   - Add \"(high priority)\" markers to Architecture \u0026 Contracts sections\n   - Helps model triage what matters most\n\n3. **Condense File-Level Guidance** (Level 3)\n   - Merge `file-level-guidance` into `guidelines` section\n   - Tighten to: \"Use fileLevelSuggestions only for whole-file concerns\"\n\n### Medium Priority\n4. **Line-Level Preference** (All levels)\n   - Move \"prefer line-level over file-level\" instruction earlier in prompts\n\n5. **Orchestration Role Clarity**\n   - Use explicit verbs: \"curate, deduplicate, prioritize impact\"\n\n6. **Praise Limit** (Orchestration)\n   - Add \"Limit praise to 2-3 most noteworthy items\"\n\n### Skip (Provider-Specific)\n- Section reordering (constraint-first parsing)\n- Aggressive language compression\n","created_at":"2026-01-19T20:50:00Z"}]}
{"id":"pair_review-70n","title":"Set up test framework (Vitest) for pair-review","description":"Install Vitest test framework and configure it for the project. Create basic test structure with tests/unit/, tests/integration/ directories. Add test scripts to package.json.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T22:05:26.701982-05:00","updated_at":"2026-01-02T22:09:17.045015-05:00","closed_at":"2026-01-02T22:09:17.045015-05:00"}
{"id":"pair_review-73j","title":"Test stability and coverage improvements","description":"Improve test coverage to catch frontend-backend integration issues like those found during the codebase health refactoring.\n\nCurrent test coverage:\n- Database layer: good (116 tests)\n- API routes: good (60 tests)\n- Frontend: none\n- E2E flows: none\n- API contracts: none\n\nGoals:\n- Catch regressions before they reach production\n- Verify frontend correctly consumes API responses\n- Test complete user flows end-to-end\n- Ensure API response shapes match frontend expectations","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-03T08:21:33.515718-05:00","updated_at":"2026-01-03T08:21:33.515718-05:00","dependencies":[{"issue_id":"pair_review-73j","depends_on_id":"pair_review-gxh","type":"blocks","created_at":"2026-01-03T08:22:07.431165-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-73j","depends_on_id":"pair_review-27s","type":"blocks","created_at":"2026-01-03T08:22:07.457037-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-73j","depends_on_id":"pair_review-o75","type":"blocks","created_at":"2026-01-03T08:22:07.479486-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-73j","depends_on_id":"pair_review-lmk","type":"blocks","created_at":"2026-01-03T08:22:07.503103-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-73j","depends_on_id":"pair_review-x12","type":"blocks","created_at":"2026-01-05T07:10:00.510117-05:00","created_by":"tim"},{"issue_id":"pair_review-73j","depends_on_id":"pair_review-hdq","type":"blocks","created_at":"2026-01-05T07:10:01.689325-05:00","created_by":"tim"},{"issue_id":"pair_review-73j","depends_on_id":"pair_review-2nn","type":"blocks","created_at":"2026-01-05T07:10:03.190303-05:00","created_by":"tim"},{"issue_id":"pair_review-73j","depends_on_id":"pair_review-f3f","type":"blocks","created_at":"2026-01-05T07:10:04.703493-05:00","created_by":"tim"},{"issue_id":"pair_review-73j","depends_on_id":"pair_review-nwv","type":"blocks","created_at":"2026-01-05T07:10:05.647206-05:00","created_by":"tim"},{"issue_id":"pair_review-73j","depends_on_id":"pair_review-mxo","type":"blocks","created_at":"2026-01-05T07:10:06.599742-05:00","created_by":"tim"},{"issue_id":"pair_review-73j","depends_on_id":"pair_review-r62","type":"blocks","created_at":"2026-01-05T07:10:07.494736-05:00","created_by":"tim"}]}
{"id":"pair_review-7a5","title":"Abstract model selection from Claude-specific to provider-agnostic tiers","description":"The current model selection UI is tightly coupled to Claude-specific model names (Haiku, Sonnet, Opus). Per the original design intention to support multiple AI providers, refactor to use provider-agnostic tiers: Fast, Balanced, and Thorough. Each tier would have provider-specific descriptions/mappings. For example:\n\n- **Fast**: Quick analysis, lower cost (Claude: Haiku, OpenAI: GPT-4o-mini, etc.)\n- **Balanced**: Good tradeoff of speed and quality (Claude: Sonnet, OpenAI: GPT-4o, etc.)  \n- **Thorough**: Most comprehensive analysis (Claude: Opus, OpenAI: o1, etc.)\n\nThis aligns with the adapter pattern mentioned in CLAUDE.md for future AI provider extensibility. The mapping between tiers and actual models would be defined per-provider in the adapter configuration.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-02T13:31:26.457031-05:00","updated_at":"2026-01-03T21:41:25.089899-05:00","closed_at":"2026-01-03T13:03:50.459913-05:00"}
{"id":"pair_review-7g5","title":"AI suggestions: Remove confidence percentage display","description":"The prototype does not show confidence percentages on suggestions. Remove or hide the confidence display from AI suggestion cards to match the cleaner prototype design.\nFiles: public/js/pr.js, public/css/pr.css","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T21:04:33.596219-05:00","updated_at":"2025-12-30T21:46:02.341721-05:00","closed_at":"2025-12-30T21:46:02.341721-05:00","dependencies":[{"issue_id":"pair_review-7g5","depends_on_id":"pair_review-1mp","type":"blocks","created_at":"2025-12-30T21:04:58.555494-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-7mw2","title":"Markdown syntax highlighting treats underscores as italic markers within words","description":"## Problem\nIn Markdown files, underscores within words (like `update_policy`) are being incorrectly interpreted as italic markers, causing inconsistent syntax highlighting. The underscore and text following it (e.g., `_policy`) appears in a different style than the preceding text.\n\n## Example\nIn the screenshot, line 92 shows:\n```\n### Step 5a: Automatic Deployment (update_policy: auto)\n```\nThe `_policy` portion is highlighted differently than `update`, suggesting the highlighter is treating the underscore as starting an italic block.\n\n## Related\nThis is similar to a previously fixed issue with Ruby syntax highlighting where underscores in identifiers were mishandled.\n\n## Expected Behavior\nUnderscores within words/identifiers should not trigger italic formatting - only underscores surrounded by whitespace or at word boundaries should be treated as Markdown formatting.\n\n## Investigation Needed\n- Review how the syntax highlighter handles Markdown files\n- Check if the fix applied for Ruby can be adapted for Markdown\n- Look at highlight.js or Prism configuration for Markdown language definition","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-23T15:22:09.404473-05:00","created_by":"tim","updated_at":"2026-02-02T21:55:54.835208-05:00","closed_at":"2026-02-02T21:55:54.835208-05:00","close_reason":"Fixed in commit 399977e on md-highlight branch. Added fixMarkdownHighlighting() post-processing to strip mid-word emphasis spans from highlight.js output."}
{"id":"pair_review-7rho","title":"Support Graphite URLs for PR review","description":"Add support for pasting Graphite URLs as input to pair-review. The GitHub PR number can be extracted from Graphite URLs and used to open the review.\n\nGraphite is a popular tool for managing stacked PRs on GitHub. Users should be able to use Graphite URLs directly instead of needing to extract the PR number manually.\n\nExample Graphite URL format (to research):\n- https://app.graphite.dev/github/pr/...\n\nImplementation:\n- Update URL parsing logic to detect Graphite URLs\n- Extract GitHub PR number from Graphite URL format\n- Use extracted PR number to proceed with normal review flow\n- Should work with both CLI and web interface inputs\n\nRelated files:\n- CLI entry point that parses PR input\n- URL parsing/validation logic","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-05T15:02:31.612823-05:00","created_by":"tim","updated_at":"2026-01-07T13:21:45.539287-05:00","closed_at":"2026-01-07T13:21:45.539287-05:00","close_reason":"Implemented Graphite URL support for both .dev and .com domains with full test coverage"}
{"id":"pair_review-7u7u","title":"Refactor GET endpoints to not create review records","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T06:04:35.49807-05:00","created_by":"tim","updated_at":"2026-01-16T06:19:24.397443-05:00","closed_at":"2026-01-16T06:19:24.397443-05:00","close_reason":"Fixed in refactor-reviewid branch. main.js now uses review.id, and GET endpoints use getReviewByPR instead of getOrCreate.","comments":[{"id":14,"issue_id":"pair_review-7u7u","author":"tim","text":"Three GET endpoints currently use getOrCreate() which creates a review record as a side effect:\n\n- GET /api/pr/:owner/:repo/:number (pr.js:70)\n- GET /api/pr/:owner/:repo/:number/has-ai-suggestions (analysis.js:763)  \n- GET /api/pr/:owner/:repo/:number/ai-suggestions (analysis.js:856)\n\nThis violates REST principles where GET should be idempotent with no side effects.\n\nProposed fix:\n1. Create explicit POST endpoint for session initialization\n2. CLI and index page use POST to create review on startup\n3. Change GET endpoints to use getReviewByPR() and handle null appropriately\n4. Return 404 or empty results when no review exists\n\nThe user-comments GET endpoint already does this correctly - use it as the pattern.","created_at":"2026-01-16T11:04:48Z"}]}
{"id":"pair_review-7yo","title":"Refactor ClaudeCLI to ClaudeProvider","description":"Wrap existing ClaudeCLI in a ClaudeProvider that implements the AIProvider interface.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:41:47.554598-05:00","updated_at":"2026-01-03T12:52:41.328891-05:00","closed_at":"2026-01-03T12:52:41.328891-05:00","dependencies":[{"issue_id":"pair_review-7yo","depends_on_id":"pair_review-bnm","type":"blocks","created_at":"2026-01-03T12:42:06.782689-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-81qf","title":"support collapsed state for files in diff view","description":"Provide a control to collapse and expand a file. In addition to better match GitHub we could include a Viewed checkbox. The github behavior is that files that have viewed check for a specific PR load as collapsed, so this is state we would need to persist for files in a PR.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T16:42:19.878505-05:00","created_by":"tim","updated_at":"2026-01-09T21:43:08.832058-05:00","closed_at":"2026-01-09T21:43:08.832058-05:00","close_reason":"Implemented file collapse/expand with Viewed checkbox"}
{"id":"pair_review-821","title":"Database migration not applying: last_ai_run_id column missing","description":"Console error persists: 'Failed to update pr_metadata with last_ai_run_id: SQLITE_ERROR: no such column: last_ai_run_id'\n\n## Root Cause Confirmed\nDatabase has schema version **5** but code has CURRENT_SCHEMA_VERSION **3**. Migration logic skips all migrations when currentVersion \u003e= CURRENT_SCHEMA_VERSION (5 \u003e= 3), so migration 3 (which adds last_ai_run_id) never runs.\n\nThis happened because another worktree/branch with higher schema version ran against the same database.\n\n## Fix Required\nChange migration approach from version-only checks to **column existence checks**:\n1. On startup, verify required columns exist regardless of version number\n2. Run ALTER TABLE for any missing columns\n3. Or: Always run the column-existence checks in each migration, not just when version is lower\n\n## Workaround\n```bash\nsqlite3 ~/.pair-review/database.db \"ALTER TABLE pr_metadata ADD COLUMN last_ai_run_id TEXT;\"\n```\n\nRelated: pair_review-k21 (proper database migration version tracking)","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-04T20:26:16.247486-05:00","created_by":"tim","updated_at":"2026-01-06T12:09:48.524883-05:00","closed_at":"2026-01-06T12:09:48.524883-05:00","close_reason":"Closed"}
{"id":"pair_review-87y","title":"Add back navigation from settings page to originating PR","description":"Currently there's no way to navigate back from the repo settings page to a PR page you might have come from. Add a contextual back link at the top of the settings page that says something like 'Return to PR#57'. Implementation approach: Store the referring PR context in localStorage when navigating to settings from a PR page. On settings page load, check localStorage for this context and render the back link if present. Clear the stored context when appropriate (e.g., when navigating directly to settings, or after using the back link).","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-02T08:25:59.439329-05:00","updated_at":"2026-01-02T11:35:11.548387-05:00","closed_at":"2026-01-02T11:35:11.548387-05:00"}
{"id":"pair_review-8h3","title":"Local Mode: Review uncommitted changes without GitHub","description":"Add --local flag to pair-review for reviewing uncommitted local changes.\n\n## Overview\nEnable pair-review to work with local uncommitted changes instead of GitHub PRs. This replaces local-review with a more capable AI-integrated solution.\n\n## Key Decisions\n- **Identifier**: repo-path + HEAD-sha (new session on commit)\n- **Persistence**: SQLite database (consistent with PR mode)\n- **Worktree**: Skip entirely for local mode\n- **CLI**: `pair-review --local [path]` explicit flag\n- **Diff scope**: Unstaged changes + untracked files (matches local-review)\n- **Routes**: Parallel /api/local/* routes (Option A)\n\n## Disabled in Local Mode\n- Submit Review to GitHub\n- PR metadata display\n\n## UI Changes\n- 'Local Mode' badge in header\n- Current branch name displayed (styled differently)\n- Repository name from filesystem path\n\n## Out of Scope (Future)\n- Staged vs unstaged separation\n- Branch-based sessions (vs HEAD-based)","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-04T08:59:36.116975-05:00","created_by":"tim","updated_at":"2026-01-04T09:38:45.213076-05:00","closed_at":"2026-01-04T09:38:45.213076-05:00","close_reason":"All 6 subtasks complete. Local mode fully implemented."}
{"id":"pair_review-8hw","title":"Add path normalization utility for file paths","description":"Create a utility function to normalize file paths consistently across the codebase. This is foundational for file path validation work.\n\nRequirements:\n- Normalize ./src/foo.js → src/foo.js\n- Handle double slashes: src//foo.js → src/foo.js\n- Strip leading/trailing slashes consistently\n- Apply to both diff file paths and AI suggestion paths\n\nThis enables reliable string matching for the database failsafe filter and other validation layers.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T15:13:48.707126-05:00","created_by":"tim","updated_at":"2026-01-04T15:21:40.065783-05:00","closed_at":"2026-01-04T15:21:40.065783-05:00","close_reason":"Implemented multi-level file path validation"}
{"id":"pair_review-8kf","title":"Improve empty state UI in Review panel","description":"The empty state in the Review panel (before AI analysis runs) looks incomplete:\n\nCurrent issues:\n- '— of 0' navigation counter looks broken when empty\n- Tabs showing '(0)' three times emphasizes emptiness\n- Plain 'No AI suggestions for this PR' message doesn't guide user action\n- Lots of wasted vertical space\n\nRecommended improvements:\n1. Hide navigation counter when count is zero\n2. Hide or dim tab counts when zero\n3. Replace plain text with structured empty state:\n   - Icon (subtle sparkle)\n   - Headline: 'Ready for AI Review'\n   - Subtext: 'Click Analyze with AI to get suggestions'\n   - Optional tip about 3-level analysis\n4. Differentiate 'never run' vs 'zero results' states:\n   - Before: 'Ready for AI Review'\n   - After with zero: '✓ No issues found - AI analysis complete'\n\nSee frontend-design skill recommendations for CSS approach.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-04T08:22:40.13106-05:00","created_by":"tim","updated_at":"2026-01-04T12:04:40.044771-05:00","closed_at":"2026-01-04T12:04:40.044771-05:00","close_reason":"Implemented structured empty states with icons and guidance"}
{"id":"pair_review-8mr","title":"Split public/js/pr.js into focused modules","description":"public/js/pr.js is ~21k tokens (over 20k limit). Split into: diff-renderer.js (diff parsing/rendering), comment-manager.js (comment UI), suggestion-manager.js (AI suggestion handling), line-tracker.js (line number mapping). Keep PRManager as thin orchestrator.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T22:05:30.602837-05:00","updated_at":"2026-01-02T23:19:30.776258-05:00","closed_at":"2026-01-02T23:19:30.776258-05:00","dependencies":[{"issue_id":"pair_review-8mr","depends_on_id":"pair_review-y8v","type":"blocks","created_at":"2026-01-02T22:05:45.977928-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-8p6","title":"Fix hidden suggestion expansion performance and edge cases","description":"Address feedback: 1) O(n*m) performance issue - build visible line lookup map, 2) Extract file element lookup helper, 3) Create getLineNumber helper, 4) Handle line ranges (lineEnd), 5) Add better debugging, 6) Filter suggestions on unmodified files in orchestration","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T18:34:37.038953-05:00","updated_at":"2025-12-31T18:37:25.669766-05:00","closed_at":"2025-12-31T18:37:25.669766-05:00"}
{"id":"pair_review-8s6","title":"Add pagination or 'Show more' for older worktrees on index page","description":"Currently the index page only shows recent worktrees. Users should be able to access older worktrees that are still valid but not displayed.\n\nOptions:\n- 'Show more' button to load additional worktrees\n- Pagination controls\n- Infinite scroll\n\nThis would allow users to return to PRs they reviewed previously without having to re-enter the PR URL.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-04T19:50:20.100262-05:00","created_by":"tim","updated_at":"2026-01-04T19:50:20.100262-05:00"}
{"id":"pair_review-8t9","title":"Add subtle grid background pattern","description":"Add the subtle grid pattern overlay from the prototype design:\n- Applied to body::before pseudo-element\n- 24px grid size\n- Very subtle white lines (rgba(255,255,255,0.01))\n- pointer-events: none, z-index: 0\nFiles: public/css/pr.css","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T21:04:36.397859-05:00","updated_at":"2025-12-30T21:46:02.363131-05:00","closed_at":"2025-12-30T21:46:02.363131-05:00","dependencies":[{"issue_id":"pair_review-8t9","depends_on_id":"pair_review-1mp","type":"blocks","created_at":"2025-12-30T21:05:01.606341-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-8uli","title":"Local mode file path normalization inconsistency","description":"In local mode, some file paths are normalized and displayed as relative paths while others remain absolute. This inconsistency may result in AI suggestions that cannot be attached to files because the path formats don't match.\n\nPotential impact:\n- AI suggestions may fail to display inline with the correct files\n- Path comparison logic may not find matching files\n- User confusion when paths appear differently in the UI\n\nAreas to investigate:\n- File path handling in local-review.js\n- Path normalization in the diff display\n- AI suggestion path matching logic\n- Consistency between frontend and backend path representations","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-07T13:51:10.563713-05:00","created_by":"tim","updated_at":"2026-01-07T19:46:01.300221-05:00","closed_at":"2026-01-07T19:46:01.300221-05:00","close_reason":"Fixed regex in local-review.js to properly normalize untracked file paths"}
{"id":"pair_review-8v7","title":"Add segmented control to AI Panel","description":"Replace 'AI Analysis' title with 'Review' and add segmented control with three options: All | AI Findings | Comments. Show counts in each segment. Wire up click handlers to switch views.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:31:16.096055-05:00","updated_at":"2026-01-03T12:36:16.698265-05:00","closed_at":"2026-01-03T12:36:16.698265-05:00","dependencies":[{"issue_id":"pair_review-8v7","depends_on_id":"pair_review-28g","type":"blocks","created_at":"2026-01-03T12:31:27.472982-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-92sq","title":"Fix --ai-draft mode to use review.id instead of prMetadata.id","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-16T06:04:34.529702-05:00","created_by":"tim","updated_at":"2026-01-16T06:19:24.395444-05:00","closed_at":"2026-01-16T06:19:24.395444-05:00","close_reason":"Fixed in refactor-reviewid branch. main.js now uses review.id, and GET endpoints use getReviewByPR instead of getOrCreate.","comments":[{"id":13,"issue_id":"pair_review-92sq","author":"tim","text":"src/main.js line 720 uses prMetadata.id for the --ai-draft flow. This has the same ID collision issue that was fixed in the web routes. The analyzer.analyzeAllLevels call at line 730 passes prMetadata.id, meaning AI suggestions get stored with the wrong ID.\n\nFix: Get or create a review record and use review.id instead, matching the pattern in src/routes/analysis.js.","created_at":"2026-01-16T11:04:47Z"}]}
{"id":"pair_review-991","title":"Bug: Cannot adopt/edit AI suggestions on deleted lines","description":"When attempting to adopt or edit an AI suggestion on a deleted line in the diff, an error appears: 'Failed to adopt suggestion: Could not determine file and line information'. This should now be supported after the recent side/LEFT handling improvements, but something is still failing in the adoption flow for deleted lines.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-01T12:22:08.0053-05:00","updated_at":"2026-01-01T12:37:39.400047-05:00","closed_at":"2026-01-01T12:37:39.400047-05:00"}
{"id":"pair_review-9bz","title":"Allow selective file review via checkboxes in diff file list","description":"Add the ability to customize which files are included in AI analysis by presenting checkboxes next to each file in the diff file list. Users could select/deselect files before triggering analysis, and the AI prompts would be adjusted to only analyze the selected files. This would be useful for: (1) Large PRs where users want to focus AI analysis on specific areas, (2) Excluding generated files, config changes, or lock files from review, (3) Iterative reviews where some files have already been manually reviewed.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-02T08:13:20.955622-05:00","updated_at":"2026-01-02T08:13:20.955622-05:00"}
{"id":"pair_review-9ce","title":"Implement j/k keyboard navigation","description":"Add global keyboard handlers for j/k to navigate through the active list (respecting current segment filter). Show navigation counter (e.g., '2 of 5'). Highlight current item in panel and scroll to it in diff view.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:31:16.150129-05:00","updated_at":"2026-01-03T12:52:22.682238-05:00","closed_at":"2026-01-03T12:52:22.682238-05:00","dependencies":[{"issue_id":"pair_review-9ce","depends_on_id":"pair_review-28g","type":"blocks","created_at":"2026-01-03T12:31:27.513651-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-9ce","depends_on_id":"pair_review-8v7","type":"blocks","created_at":"2026-01-03T12:31:27.590646-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-9dh5","title":"Add PR author to PR list view on index page","description":"The PR list view on the index page should display the PR author for each entry.\n\nThis helps users quickly identify:\n- Who created each PR\n- Filter/scan for PRs from specific team members\n- Distinguish between similar PRs\n\nImplementation:\n1. Ensure PR author data is fetched/stored when loading PR list\n2. Add author column or badge to the PR list UI\n3. Consider showing GitHub avatar for visual recognition","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-21T11:35:56.776759-05:00","created_by":"tim","updated_at":"2026-01-21T12:09:31.780317-05:00","closed_at":"2026-01-21T12:09:31.780317-05:00","close_reason":"Added Author column to PR list view on index page. The author data was already being fetched and stored - just needed UI display."}
{"id":"pair_review-9rj","title":"Worktree delete uses parseInt on TEXT id","description":"The delete endpoint does parseInt(req.params.id) but worktree IDs are TEXT (alphanumeric strings like 'x2z'), causing parseInt to return NaN","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-29T09:19:51.428113-05:00","updated_at":"2025-12-29T09:21:54.731385-05:00","closed_at":"2025-12-29T09:21:54.731385-05:00"}
{"id":"pair_review-9s7","title":"Add toggle to include/exclude staged changes in local mode","description":"## Summary\nAdd a UI toggle in local mode to optionally include staged changes in the diff view and AI review.\n\n## Current Behavior\n- Local mode only shows unstaged changes + untracked files\n- Staged changes are excluded from both display and AI review\n- Users can use `git add` to 'hide' files from review\n\n## Proposed Behavior\n- Add a toggle switch in the toolbar (e.g., 'Include Staged')\n- Default: OFF (current behavior - unstaged only)\n- When ON: Include both staged and unstaged changes\n- Toggle state persists in localStorage\n- Affects both diff display and AI analysis\n\n## Implementation Notes\n\n### Effort: Low-medium (~30-60 min)\n\nInfrastructure already exists - `generateLocalDiff()` already generates staged diff separately, just doesn't include it.\n\n### Changes Required\n\n1. **UI** (local.html): Add toggle switch in toolbar area\n2. **State** (local.js): Store toggle in localStorage, pass to API calls\n3. **Backend** (routes/local.js): Add `?includeStaged=true` query param to:\n   - GET /api/local/:reviewId/diff\n   - POST /api/local/:reviewId/refresh\n4. **Diff generation** (local-review.js): Conditionally combine staged+unstaged based on param\n5. **Frontend** (local.js): Re-fetch diff when toggle changes\n\n### Related Code\n- `generateLocalDiff()` in src/local-review.js already tracks staged separately\n- Stats already count staged files (shown as 'excluded from review')","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-04T15:17:52.059492-05:00","created_by":"tim","updated_at":"2026-01-04T15:17:52.059492-05:00"}
{"id":"pair_review-9tw","title":"add syntax high-lighting","description":"Use a library to do this","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:51:02.674219-05:00","updated_at":"2025-12-28T11:47:37.398279-05:00","closed_at":"2025-12-28T11:47:37.398279-05:00"}
{"id":"pair_review-9zm1","title":"Multi-line PR comments not applying start line via GitHub API","description":"When submitting PR review comments that span a range of lines (R1-R2), we are not correctly using the GitHub API's multi-line comment support.\n\n**Current behavior:** Comments that should span lines R1-R2 are being associated with only the end line (R2).\n\n**Expected behavior:** Multi-line comments should use GitHub's multi-line review comment API parameters:\n- `start_line` = R1 (first line of the range)\n- `line` = R2 (last line of the range)\n\n**Impact:** Comments appear anchored to the wrong location in the GitHub PR UI, losing the visual context of the full code range they reference.\n\n**Investigation needed:**\n- Check how we're constructing the review comment payload in the GitHub submission code\n- Verify we're using the correct API fields (`start_line`, `start_side`, `line`, `side`)\n- Test with actual multi-line comment submissions","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-22T14:17:16.674493-05:00","created_by":"tim","updated_at":"2026-01-22T21:46:09.304391-05:00","closed_at":"2026-01-22T21:46:09.304391-05:00","close_reason":"Fixed"}
{"id":"pair_review-a033","title":"Large review submission fails - need batch comment submission","description":"## Problem\nSubmitting a review with a large number of comments (42 in this case) fails partially. Approximately 12-13 of the 42 comments failed to submit.\n\n## Root Cause (Suspected)\nGitHub's GraphQL API likely has limits on the number of comments that can be submitted in a single request, or rate limiting kicks in when trying to submit many comments at once.\n\n## Proposed Solution\nImplement batched comment submission:\n\n1. **Create the review first** (without comments, or with first batch)\n2. **Submit comments in batches** - Use multiple GraphQL calls to add comments in groups of ~25\n3. **Complete or save as draft** - After all comment batches succeed, finalize the review status\n\n## Implementation Details\n- Batch size: 25 comments (conservative to stay well under any limits)\n- Sequential batch submission with error handling per batch\n- If a batch fails, retry logic or report which specific comments failed\n- Maintain atomicity where possible - if too many batches fail, consider rolling back or leaving as draft\n\n## Acceptance Criteria\n- Reviews with 40+ comments submit successfully\n- User gets clear feedback on submission progress for large reviews\n- Failed comments are clearly reported so user can retry or manually add them\n\n## Testing\n- Test with reviews containing 25, 50, 75+ comments\n- Verify behavior when individual batches fail","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-23T16:25:06.906429-05:00","created_by":"tim","updated_at":"2026-01-24T07:18:02.36053-05:00","closed_at":"2026-01-24T07:18:02.36053-05:00","close_reason":"Implemented batched comment submission - comments now submitted in batches of 25 with retry logic, atomic behavior (all or nothing), removed 50-comment limit"}
{"id":"pair_review-a39","title":"AI Panel: Style depth level checkmarks","description":"Update analysis depth indicators in AI panel:\n- Complete levels show green checkmark icon in green-tinted box\n- Active level shows pulsing amber dot\n- Pending levels show gray circle\n- Use .depth-level-complete class styling from prototype\nFiles: public/css/pr.css, public/js/components/AIPanel.js","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T21:04:37.591808-05:00","updated_at":"2025-12-30T21:47:11.779885-05:00","closed_at":"2025-12-30T21:47:11.779885-05:00","dependencies":[{"issue_id":"pair_review-a39","depends_on_id":"pair_review-1mp","type":"blocks","created_at":"2025-12-30T21:05:02.438283-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-a4d","title":"Wrap long lines","description":"the github UI wraps long lines in the diff display. pair-review should do the same. When a line is wrapped, no line number is shown in the gutter. This must be handled correctly for line selection for commenting, etc.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:47:22.374732-05:00","updated_at":"2025-12-27T09:42:46.785704-05:00","closed_at":"2025-12-27T09:42:46.785704-05:00"}
{"id":"pair_review-acor","title":"Capture HEAD SHA in analysis run details for PR and local mode","description":"Analysis run records should capture the git HEAD SHA at the time the analysis was performed:\n\n**PR Mode**: Capture the last commit SHA of the PR branch being analyzed\n\n**Local Mode**: Capture the current HEAD SHA when local changes were evaluated\n\nThis provides crucial traceability to know exactly which code state was analyzed, enabling:\n- Verification that analysis is still relevant to current code\n- Ability to diff what changed since last analysis\n- Historical record of what commit each analysis corresponds to\n\nLikely implementation:\n1. Add 'head_sha' column to analysis runs table/schema\n2. Fetch HEAD SHA via git during analysis initiation\n3. Store and display in analysis history UI","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-21T11:29:59.474732-05:00","created_by":"tim","updated_at":"2026-01-21T13:29:13.815825-05:00","closed_at":"2026-01-21T13:29:13.815825-05:00","close_reason":"Implemented head_sha tracking in analysis runs for both PR and Local modes"}
{"id":"pair_review-ae9","title":"start review from web UI","description":"should be able to paste in a PR URL and have the running UI create workspace to view diff; maybe optionally start the AI review though that could be a separate step for simplicity","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T08:26:05.337455-05:00","updated_at":"2025-12-28T16:45:39.805603-05:00","closed_at":"2025-12-28T16:45:39.805603-05:00","dependencies":[{"issue_id":"pair_review-ae9","depends_on_id":"pair_review-e4k","type":"blocks","created_at":"2025-12-28T15:56:43.559511-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-amkm","title":"return cost for review","description":"returning cost for a review would be an interesting feature, even if it is just logged in the console initially","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-10T06:46:37.967666-05:00","created_by":"tim","updated_at":"2026-01-10T06:46:37.967666-05:00"}
{"id":"pair_review-ana","title":"AI suggestions: Update action button styling","description":"Update suggestion action buttons to match prototype:\n- Adopt: green background (#3fb950), white text, checkmark icon\n- Edit: gray background with border, pencil icon\n- Dismiss: transparent, gray text turns red on hover, X icon\n- All buttons should have icons before text\nFiles: public/js/pr.js, public/css/pr.css","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T21:04:34.579838-05:00","updated_at":"2025-12-30T21:46:02.348945-05:00","closed_at":"2025-12-30T21:46:02.348945-05:00","dependencies":[{"issue_id":"pair_review-ana","depends_on_id":"pair_review-1mp","type":"blocks","created_at":"2025-12-30T21:04:59.720866-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-arnh","title":"Refactor: Extract common AI response parsing from providers","description":"Multiple AI providers (cursor-agent, gemini, codex, and potentially others) have similar JSON extraction/parsing logic in their response parsing methods (parseCursorAgentResponse, parseGeminiResponse, parseCodexResponse). This duplicated logic could be centralized into a shared utility, possibly extending the existing json-extractor.js module or creating a new response-parser utility that handles the common patterns:\n\n1. Try to parse stdout as JSON directly\n2. Check for known wrapper structures (response, content, text fields)\n3. Extract nested JSON from text fields\n4. Fall back to extractJSON for embedded JSON in non-JSON responses\n\nThis would reduce code duplication and ensure consistent parsing behavior across all providers.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-13T14:56:00.171135-05:00","created_by":"tim","updated_at":"2026-01-13T14:56:00.171135-05:00"}
{"id":"pair_review-atf0","title":"Graceful MCP stdio shutdown with browser notification","description":"When the MCP client (AI agent) disconnects stdin, the pair-review process currently stays alive indefinitely because the Express server keeps it running. This leaves orphaned processes from npx invocations.\n\n**Desired behavior:**\n1. Detect when the MCP stdio transport closes (agent disconnects)\n2. Broadcast a shutdown notification to any connected browser clients\n3. Show a modal/overlay in the web UI: 'Server was shut down by the agent — this page is no longer functional'\n4. After a brief delay (~500ms) for message delivery, close the DB and exit the process\n\n**Implementation sketch:**\n\nBackend (~30 lines):\n- Add an SSE endpoint (e.g. /api/events) that holds open response objects in an array\n- Add a broadcastShutdown() function that writes a 'shutdown' event to all connected clients\n- In src/mcp-stdio.js, after mcpServer.connect(transport), hook the transport/server close event: broadcast shutdown, wait 500ms, close DB, process.exit(0)\n\nFrontend (~20 lines):\n- Add a shared script (or inline in each page) that creates an EventSource to /api/events\n- On receiving a 'shutdown' event, show a non-dismissable modal overlay\n- Must work on all page types: pr.html, local.html, index.html\n\nNotes:\n- No existing SSE push infrastructure exists — this would be net-new\n- SSE requires no new dependencies (just keep an Express response open and write data: lines)\n- The McpServer emits a close event when the transport disconnects\n- This is a polish item, not blocking the --mcp feature","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-31T07:58:12.063678-05:00","created_by":"tim","updated_at":"2026-01-31T07:58:12.063678-05:00"}
{"id":"pair_review-avuh","title":"Remove dead standalone analyzeLevel2/3 routes and methods","description":"## Summary\nThe frontend only uses the orchestrated analysis path via `analyzeAllLevels()`. The standalone `analyzeLevel2` and `analyzeLevel3` methods and their route handlers are dead code that should be removed.\n\n## Dead code to remove\n\n### Route handlers in src/routes/analysis.js\n- `POST /api/analyze/:owner/:repo/:pr/level2` (around lines 361-493)\n- `POST /api/analyze/:owner/:repo/:pr/level3` (around lines 498-630)\n\n### Route handlers in src/routes/local.js\n- `POST /api/local/:reviewId/analyze/level2` (around lines 528-675)\n- `POST /api/local/:reviewId/analyze/level3` (around lines 680-827)\n\n### Methods in src/ai/analyzer.js\n- `analyzeLevel2()` standalone method (around lines 1792-1861)\n- `analyzeLevel3()` standalone method (around lines 2143-2210)\n\n## What to preserve (actively used)\n- `analyzeLevel2Isolated()` - used by `analyzeAllLevels()` orchestration\n- `analyzeLevel3Isolated()` - used by `analyzeAllLevels()` orchestration\n- `buildLevel2Prompt()` - used by isolated methods\n- `buildLevel3Prompt()` - used by isolated methods\n\n## Context\nThis cleanup was done on the `refactor-variants` branch (commit 6666040) but needs to be applied to `refactor-analysis-run` for the v1.0 release.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-22T08:36:46.496053-05:00","created_by":"tim","updated_at":"2026-01-22T10:46:05.33601-05:00","closed_at":"2026-01-22T10:46:05.33601-05:00","close_reason":"Removed 750 lines of dead code: standalone analyzeLevel2/3 routes and methods. Commit e5ddfcc."}
{"id":"pair_review-b0vn","title":"Analysis run details should indicate success or failure status","description":"When viewing analysis run details/history, there is no clear indication of whether each run completed successfully or failed.\n\n**Current behavior:** Analysis runs are listed without status information about their outcome.\n\n**Expected behavior:** Each analysis run should clearly show:\n- Whether it completed successfully\n- Whether it failed (and ideally why - timeout, error, etc.)\n- Possibly partial completion status (e.g., Level 1 passed, Level 2 failed)\n\n**Benefits:**\n- Users can quickly identify problematic runs\n- Helps with debugging analysis issues\n- Provides context when comparing runs","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-22T10:25:15.228208-05:00","created_by":"tim","updated_at":"2026-01-22T14:39:31.870975-05:00","closed_at":"2026-01-22T14:39:31.870975-05:00","close_reason":"Implemented status badge and result summary in analysis run details popover"}
{"id":"pair_review-b2b","title":"Delete worktree button does nothing on landing page","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-29T08:35:37.783385-05:00","updated_at":"2025-12-29T08:37:31.599907-05:00","closed_at":"2025-12-29T08:37:31.599907-05:00"}
{"id":"pair_review-b8y","title":"Hide AI sidebar on landing page","description":"The collapsed AI suggestions sidebar still appears on the landing/index page when no PR is displayed. It should only be visible on PR review pages.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-29T08:05:32.534182-05:00","updated_at":"2025-12-29T08:26:47.275132-05:00","closed_at":"2025-12-29T08:26:47.275132-05:00","dependencies":[{"issue_id":"pair_review-b8y","depends_on_id":"pair_review-jbp","type":"blocks","created_at":"2025-12-29T08:05:54.665252-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-ba1","title":"Local review handler: Generate diff and manage sessions","description":"Create core local review handler module.\n\n## New File: src/local-review.js\n\n### handleLocalReview(targetPath, flags)\n1. Validate git repository (find .git root)\n2. Get HEAD sha for session identity\n3. Build ReviewContext object\n4. Check for existing session or create new\n5. Generate local diff\n6. Start server with local context\n\n### generateLocalDiff(repoPath)\n- Run `git diff --no-color --no-ext-diff --unified=25` (unstaged changes)\n- Get untracked files via `git ls-files --others --exclude-standard`\n- Read untracked file contents (with 1MB limit, binary detection)\n- Return combined diff structure\n\n### Session Identity\n- ID format: `${absolutePath}@${headSha}`\n- New session created when HEAD changes (after commit)\n\n## Helper Functions\n- `findGitRoot(path)` - walk up to find .git\n- `getHeadSha(repoPath)` - git rev-parse HEAD\n- `getUntrackedFiles(repoPath)` - with content reading","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T09:00:19.769198-05:00","created_by":"tim","updated_at":"2026-01-04T09:22:50.847304-05:00","closed_at":"2026-01-04T09:22:50.847304-05:00","close_reason":"Implementation complete, all 183 tests pass","dependencies":[{"issue_id":"pair_review-ba1","depends_on_id":"pair_review-8h3","type":"blocks","created_at":"2026-01-04T09:00:35.1542-05:00","created_by":"tim"},{"issue_id":"pair_review-ba1","depends_on_id":"pair_review-gvx","type":"blocks","created_at":"2026-01-04T09:00:36.55785-05:00","created_by":"tim"}]}
{"id":"pair_review-bcd","title":"File tree: Group files by directory","description":"Update file tree sidebar to group files by parent directory like prototype:\n- Show folder icons with directory names as group headers\n- Files indented under their directory group\n- Collapsible groups (optional)\nFiles: public/js/pr.js, public/css/pr.css","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T21:04:35.391898-05:00","updated_at":"2025-12-30T21:46:02.356366-05:00","closed_at":"2025-12-30T21:46:02.356366-05:00","dependencies":[{"issue_id":"pair_review-bcd","depends_on_id":"pair_review-1mp","type":"blocks","created_at":"2025-12-30T21:05:00.508286-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-bi8","title":"Add UI to view custom instructions used for AI analysis","description":"Custom instructions are stored on review records in the database (via `upsertCustomInstructions`), but there's no way to view them in the UI after an analysis completes.\n\n**Current behavior:**\n- User enters custom instructions in the analysis config modal\n- Instructions are saved to the review record in `custom_instructions` column\n- After analysis, there's no UI element showing what instructions were used\n\n**Expected behavior:**\n- Users should be able to see what custom instructions were used for a given analysis\n- This could be displayed in:\n  - The AI findings panel header/metadata\n  - An expandable section showing \"Analysis settings used\"\n  - The analysis progress modal summary\n\n**Technical notes:**\n- Data is already stored in `reviews.custom_instructions`\n- The `/api/pr/:owner/:repo/:number` endpoint could include this in response\n- Consider also showing the repo default instructions that were applied","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-01T21:05:32.991497-05:00","updated_at":"2026-01-01T21:05:32.991497-05:00"}
{"id":"pair_review-bnm","title":"Create AI provider abstraction layer","description":"Create a base AIProvider class/interface with execute() and testAvailability() methods. Both ClaudeProvider and GeminiProvider will implement this.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:41:45.017866-05:00","updated_at":"2026-01-03T12:52:41.32735-05:00","closed_at":"2026-01-03T12:52:41.32735-05:00"}
{"id":"pair_review-bo6z","title":"Migrate from sqlite3 to better-sqlite3","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-15T09:01:14.044052-05:00","created_by":"tim","updated_at":"2026-01-15T14:19:30.422014-05:00","closed_at":"2026-01-15T14:19:30.422014-05:00","close_reason":"Migration complete. Tests pass: 997 unit/integration, 171 E2E.","labels":["tech-debt"],"comments":[{"id":10,"issue_id":"pair_review-bo6z","author":"tim","text":"## Background\n\nThe sqlite3@5.1.7 package pulls in deprecated transitive dependencies via node-gyp@8.4.1:\n- gauge@4.0.4, are-we-there-yet@3.0.1, npmlog@6.0.2\n- glob@7.2.3, inflight@1.0.6\n- rimraf@3.0.2, @npmcli/move-file@1.1.2\n\nThese cause npm deprecation warnings during install. The sqlite3 package hasn't been updated since Feb 2024.\n\n## Proposed Solution\n\nMigrate to better-sqlite3 which:\n- Is actively maintained (last updated Jan 2026)\n- Has a synchronous API (simpler code)\n- Is ~5x faster for many operations\n- Has no deprecated dependencies\n\n## Scope\n\n- Update src/database.js (~730 lines) to use better-sqlite3's synchronous API\n- Update all tests that mock or use sqlite3\n- Update package.json dependency\n- Verify all database operations work correctly\n\n## Files to Modify\n\n- src/database.js - Main database module\n- src/server.js - Uses database\n- src/git/worktree.js - Uses database\n- tests/unit/comment-repository.test.js\n- tests/integration/database.test.js\n- tests/integration/routes.test.js\n- tests/e2e/global-setup.js\n\n## Risk\n\nMedium - API differences require careful migration. The synchronous API is actually simpler, but all Promise-based wrappers need to be converted.","created_at":"2026-01-15T14:01:34Z"}]}
{"id":"pair_review-br3x","title":"Refactor local.js PUT/DELETE endpoints to use CommentRepository","description":"The PUT and DELETE file-comment endpoints in src/routes/local.js (lines ~1155 and ~1208) use direct db.run calls instead of CommentRepository methods.\n\nCurrent state:\n- POST /api/local/:reviewId/file-comment uses CommentRepository.createFileComment() ✓\n- PUT /api/local/:reviewId/file-comment/:commentId uses direct run() call\n- DELETE /api/local/:reviewId/file-comment/:commentId uses direct run() call\n\nSuggested refactoring:\n1. Add updateFileComment() method to CommentRepository\n2. Add deleteFileComment() method to CommentRepository (soft delete)\n3. Update PUT endpoint to use repository method\n4. Update DELETE endpoint to use repository method\n\nThis is a style/consistency improvement, not a bug fix. The current code works correctly.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T13:08:07.487674-05:00","created_by":"tim","updated_at":"2026-01-07T13:08:07.487674-05:00"}
{"id":"pair_review-bro","title":"GitHub icon uses wrong color in dark mode","description":"In the header toolbar, the GitHub icon appears blue in dark mode while other icons use the standard light/muted color scheme.\n\nExpected: GitHub icon should use the same color treatment as other toolbar icons (refresh, theme toggle, settings) - likely the light highlight color, possibly inverted for dark mode.\n\nLocation: Header toolbar, rightmost icon","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-04T08:22:40.982122-05:00","created_by":"tim","updated_at":"2026-01-04T08:38:27.564594-05:00","closed_at":"2026-01-04T08:38:27.564594-05:00","close_reason":"Fixed GitHub icon to use text-tertiary color in dark mode"}
{"id":"pair_review-bw4x","title":"Refactor prompt loader to use dynamic require paths","description":"Refactor src/ai/prompts/index.js loadBaseline() function to use dynamic require paths instead of enumerating all prompt types and tiers.\n\n## Current State\nThe loadBaseline() function has a large switch/case block that explicitly lists every combination:\n- level1 + fast/balanced/thorough\n- level2 + fast/balanced/thorough\n- level3 + fast/balanced/thorough\n- orchestration + fast/balanced/thorough\n\n## Proposed Change\nInterpolate promptType and tier into the require path dynamically:\n```javascript\nfunction loadBaseline(promptType, tier) {\n  try {\n    return require(`./baseline/${promptType}/${tier}.js`);\n  } catch (e) {\n    return null; // Prompt not available\n  }\n}\n```\n\n## Benefits\n- Cleaner code\n- Adding new prompts doesn't require updating the loader\n- Less maintenance burden\n\n## Considerations\n- Error handling for missing files\n- Bundler compatibility if we ever bundle the app\n- Security: ensure promptType/tier are validated to prevent path traversal","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-14T21:33:13.715495-05:00","created_by":"tim","updated_at":"2026-01-14T21:33:13.715495-05:00"}
{"id":"pair_review-carh","title":"order AI suggestions in review panel","description":"order AI suggestions in the review panel by file order: display file comments first, followed by line-level comments in order by line number","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T09:18:37.500706-05:00","created_by":"tim","updated_at":"2026-01-11T14:08:58.1447-05:00","closed_at":"2026-01-11T14:08:58.1447-05:00","close_reason":"Implemented consistent file ordering across all three panels"}
{"id":"pair_review-ccl","title":"Analysis modal shows 'Analysis Complete' while analysis still running","description":"The analysis progress modal displays 'Analysis Complete' button prematurely while analysis is still in progress. The button text should reflect the actual analysis state (e.g., 'Analyzing...' or show progress) until analysis truly completes.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-03T21:30:38.11971-05:00","updated_at":"2026-01-04T14:46:57.871087-05:00","closed_at":"2026-01-04T14:46:57.871087-05:00","close_reason":"May no longer be an issue - closing until it resurfaces"}
{"id":"pair_review-cd1v","title":"Add E2E tests for context expansion in diff view","description":"Context expansion (clicking arrows to show more lines around changes in the diff view) has no E2E test coverage.\n\n## E2E Tests Needed\n\n### PR Mode\n1. Click expand arrows to show additional context lines above/below changes\n2. Verify expanded lines display with correct line numbers\n3. Handle error gracefully when file content fails to load\n\n### Local Mode\n1. Context expansion works correctly with local review sessions\n2. Files are read from local repository path (not worktree)\n3. Error handling for missing/moved files\n\n## Notes\n- Integration tests for /api/file-content-original endpoint already exist (routes.test.js)\n- These E2E tests would verify the full UI flow from click to rendered expanded context\n- Lower priority since integration tests cover the API contract","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-07T06:28:35.80131-05:00","created_by":"tim","updated_at":"2026-01-07T06:28:35.80131-05:00"}
{"id":"pair_review-cre","title":"AI sidebar navigation jumps to wrong suggestion after dismissing","description":"## Problem\nNavigation to suggestions from the AI sidebar sometimes moves to the wrong location in the code -- the location of a different suggestion.\n\n## Reproduction\n1. Have multiple AI suggestions displayed\n2. Dismiss one or more suggestions\n3. Click on a remaining suggestion in the AI sidebar\n4. Observe that navigation goes to the wrong code location\n\n## Root Cause Hypothesis\nThe AI panel appears to be using the index of non-dismissed suggestions in the UI rather than pulling navigation information directly from the entry that the user interacts with.\n\n## Expected Behavior\nClicking on a suggestion in the AI sidebar should navigate to that specific suggestion's location, regardless of which other suggestions have been dismissed.\n\n## Fix Approach\nThe click handler should extract file/line information from the clicked element's data attributes (data-file, data-line) rather than relying on array indices that may become stale after dismissals.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T16:27:10.075569-05:00","updated_at":"2025-12-31T16:43:40.592655-05:00","closed_at":"2025-12-31T16:43:40.592655-05:00"}
{"id":"pair_review-ctt","title":"Deleted line comment highlights multiple deleted lines incorrectly","description":"When clicking to comment on a deleted line, not just that line but other deleted lines also get highlighted. The selection/highlighting logic appears to be incorrectly selecting multiple lines when only one deleted line is clicked.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-01T08:49:49.517433-05:00","updated_at":"2026-01-01T12:05:13.058771-05:00","closed_at":"2026-01-01T12:05:13.058771-05:00"}
{"id":"pair_review-cu8","title":"diff display should use more of full window width when sidebars are collapsed","description":"This should be more like gitHub in terms of using most of the window width","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:49:47.191183-05:00","updated_at":"2025-12-27T10:24:50.951641-05:00","closed_at":"2025-12-27T10:24:50.951641-05:00"}
{"id":"pair_review-cwm","title":"Changed Files count shows zero in PR mode","description":"In regular PR review mode (not local mode), the 'Changed Files' count badge in the sidebar header shows zero instead of the actual number of changed files.\n\nThis was likely introduced during the local mode refactor when file count updating was added to local.js but may have broken the equivalent functionality in PR mode.\n\nThe fix likely involves ensuring that the file count is updated in pr.js when diff data is loaded, similar to how it's done in local.js:\n```javascript\nconst fileCountEl = document.querySelector('.file-count');\nif (fileCountEl) {\n  fileCountEl.textContent = files.length;\n}\n```","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-04T15:35:11.237946-05:00","created_by":"tim","updated_at":"2026-01-04T20:01:39.049017-05:00","closed_at":"2026-01-04T20:01:39.049017-05:00","close_reason":"Fixed in commit"}
{"id":"pair_review-cyf1","title":"JSON extraction fails when AI response contains valid JSON with surrounding text","status":"in_progress","priority":2,"issue_type":"bug","created_at":"2026-01-10T12:20:02.411555-05:00","created_by":"tim","updated_at":"2026-01-24T09:47:51.110167-05:00","comments":[{"id":4,"issue_id":"pair_review-cyf1","author":"tim","text":"## Problem\n\nThe orchestration level JSON extraction fails when the AI response contains valid JSON embedded within explanatory text. The response clearly contains two complete, valid JSON objects, yet all extraction strategies fail.\n\n## Example Response Pattern\n\nThe AI produces output like:\n```\nNow I have a complete view of the changes. Let me analyze...\n\n{\n  \"level\": \"orchestrated\",\n  \"suggestions\": [...]\n}\n\nLooking at the diff, I can now analyze...\n\n{\n  \"level\": \"orchestrated\",\n  \"suggestions\": [...]\n}\n```\n\n## Log Output\n\n```\n[AI ⚠] [Level orchestration] No valid suggestions found in response\n[AI ⚠] [Orchestration] WARNING: Orchestration returned 0 suggestions despite input\n[AI ⚠] [Orchestration] Input suggestion counts: Level1=10, Level2=7, Level3=5\n[AI ⚠] [Level orchestration] All JSON extraction strategies failed\n```\n\n## Expected Behavior\n\nThe extraction should be able to:\n1. Find JSON blocks within surrounding text\n2. Handle multiple JSON blocks (perhaps taking the last/most complete one)\n3. Successfully parse the valid JSON that is clearly present\n\n## Impact\n\nHigh - This causes complete loss of AI suggestions despite successful AI analysis. The user sees no suggestions even though the AI produced 7 valuable suggestions including bug reports, improvements, and praise items.","created_at":"2026-01-10T17:20:20Z"},{"id":5,"issue_id":"pair_review-cyf1","author":"tim","text":"## Potential Solution: LLM-based JSON extraction fallback\n\nWhen all regex/parsing strategies fail, pass the raw response to a fast model (e.g., Haiku) with a simple prompt like:\n\n\"Extract the valid JSON object from this text. Return ONLY the JSON, nothing else.\"\n\n**Advantages:**\n- Haiku is fast (~200ms) and cheap\n- Only invoked on the failure path, not the happy path\n- LLMs are excellent at this kind of structured extraction\n- The JSON is clearly present; it just needs extraction from surrounding text\n- Could handle edge cases like truncated JSON, multiple JSON blocks, etc.\n\n**Implementation notes:**\n- Add as final fallback after existing extraction strategies fail\n- Could use the existing Claude CLI infrastructure\n- Consider caching/reusing the extracted result\n- Log when this fallback is triggered for monitoring","created_at":"2026-01-10T17:26:32Z"},{"id":6,"issue_id":"pair_review-cyf1","author":"tim","text":"## Related Enhancement: Persist AI Summary\n\nCurrently the `summary` field from the orchestration response is returned to the frontend but never persisted. It's discarded after the polling response.\n\n**Proposed change:** Add `ai_summary TEXT` column to the `reviews` table and store the summary when analysis completes.\n\n**Benefits:**\n- Display summary in UI (e.g., at top of suggestions panel)\n- Include in review submission as an overall comment\n- Historical reference for what the AI found\n- Makes the summary field actually useful instead of wasted tokens\n\n**Implementation:**\n1. Add migration: `ALTER TABLE reviews ADD COLUMN ai_summary TEXT`\n2. Update analysis completion to store summary on the review\n3. Return summary when fetching review data\n4. Display in UI","created_at":"2026-01-10T17:37:18Z"}]}
{"id":"pair_review-d7n","title":"AI suggestions for lines that are not visible","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:46:08.631773-05:00","updated_at":"2025-12-31T20:39:48.812705-05:00","closed_at":"2025-12-31T20:39:48.812705-05:00"}
{"id":"pair_review-d9j","title":"Style differentiation for Findings vs Comments","description":"Add distinct visual styling to differentiate AI findings from user comments: different icons, subtle color treatment (e.g., purple accent for user comments vs existing colors for AI findings), and clear visual hierarchy.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:31:16.177705-05:00","updated_at":"2026-01-03T12:58:12.496366-05:00","closed_at":"2026-01-03T12:58:12.496366-05:00","dependencies":[{"issue_id":"pair_review-d9j","depends_on_id":"pair_review-28g","type":"blocks","created_at":"2026-01-03T12:31:27.532906-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-d9j","depends_on_id":"pair_review-8v7","type":"blocks","created_at":"2026-01-03T12:31:27.611418-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-dam","title":"UI: Capture custom instructions before PR analysis","description":"Add textarea/input field in the PR view that allows users to specify custom instructions before triggering AI analysis. Instructions should indicate what aspects to focus on. When re-running analysis, show previous instructions so user can reuse or modify them.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T18:26:04.776209-05:00","updated_at":"2026-01-01T14:18:45.778017-05:00","closed_at":"2026-01-01T14:18:45.778017-05:00","dependencies":[{"issue_id":"pair_review-dam","depends_on_id":"pair_review-f8b","type":"blocks","created_at":"2025-12-31T18:26:22.300484-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-dam","depends_on_id":"pair_review-fvd","type":"blocks","created_at":"2025-12-31T18:26:23.732922-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-dgm","title":"Add support for file-level user comments","description":"Enable users to add comments at the file level (not tied to a specific line). Currently the UI only supports line-level comments. File-level comments are useful for high-level observations about a file's overall structure, naming, or approach.\n\nImplementation notes:\n- GitHub submission of file-level comments is already supported\n- Data model changes likely required to store file-level comments (comments without line/position)\n- UI needs a way to add/view file-level comments (perhaps in the file header area)","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-02T16:05:25.858233-05:00","updated_at":"2026-01-05T14:45:03.725872-05:00","closed_at":"2026-01-05T14:45:03.725872-05:00","close_reason":"Replaced by epic pair_review-z1do with comprehensive implementation plan"}
{"id":"pair_review-do9","title":"Update Analyzer to use provider abstraction","description":"Change Analyzer to use provider factory instead of directly instantiating ClaudeCLI.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:41:49.550759-05:00","updated_at":"2026-01-03T12:55:03.786898-05:00","closed_at":"2026-01-03T12:55:03.786898-05:00","dependencies":[{"issue_id":"pair_review-do9","depends_on_id":"pair_review-7yo","type":"blocks","created_at":"2026-01-03T12:42:08.769683-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-do9","depends_on_id":"pair_review-n5z","type":"blocks","created_at":"2026-01-03T12:42:09.873218-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-dutu","title":"Refactor LocalManager to defer browser-global access to init() method for testability","status":"open","priority":4,"issue_type":"task","created_at":"2026-02-06T08:13:58.784805-05:00","created_by":"tim","updated_at":"2026-02-06T08:13:58.784805-05:00"}
{"id":"pair_review-e1d","title":"Add UI to view previous AI analysis runs","description":"Now that AI analysis history is preserved in the database (suggestions are no longer deleted), add UI to view previous analysis runs.\n\nFoundation work done in pair_review-ec2:\n- Old suggestions kept in DB with their ai_run_id\n- Query filters by latest ai_run_id by default\n\nUI to add:\n- Dropdown in Review panel: 'Latest analysis' / 'Jan 4, 2:15p' / 'Jan 3, 11:30a'\n- Selecting older run queries by that ai_run_id instead of latest\n- Show timestamp and maybe suggestion count for each run","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-04T09:49:00.530767-05:00","created_by":"tim","updated_at":"2026-01-04T09:49:00.530767-05:00"}
{"id":"pair_review-e4k","title":"Worktree management","description":"## Overview\nImprove how pair-review manages git worktrees for PR reviews. Currently worktrees are created with predictable names, never cleaned up, and recreated on each use.\n\n## Goals\n1. **Dedicated database tracking** - Move from JSON blob storage to proper `worktrees` table\n2. **Random naming** - Use DB-driven random IDs instead of `{owner}-{repo}-{number}` to indicate these are for app use only\n3. **Worktree reuse** - Refresh existing worktrees instead of recreating; error if local changes exist\n4. **Auto-cleanup** - Clean up stale worktrees (default: 7 days) on server start, configurable retention\n5. **Recent reviews UI** - Landing page shows recently reviewed PRs across all repos\n6. **Start from URL** - Create worktree from PR URL via web UI (existing issue ae9)\n\n## Sub-issues\n- **452**: Add dedicated worktrees database table (start here)\n- **4k0**: Use random IDs for worktree directory names\n- **k7u**: Reuse existing worktree when reopening same PR\n- **0oj**: Auto-cleanup stale worktrees on server start\n- **su1**: Add recently reviewed PRs list to landing page\n- **ae9**: Start review from web UI","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-27T09:14:28.91021-05:00","updated_at":"2025-12-28T16:45:41.212873-05:00","closed_at":"2025-12-28T16:45:41.212873-05:00"}
{"id":"pair_review-ea5v","title":"Browser notification when analysis completes","description":"Notify the user via browser notification when an AI analysis run is finished. This allows users to switch to other tabs/work while waiting for analysis and be alerted when results are ready.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-23T07:50:04.648984-05:00","created_by":"tim","updated_at":"2026-01-23T07:50:04.648984-05:00"}
{"id":"pair_review-ebz","title":"Handle stale worktrees in recent reviews","description":"Old worktrees appear in recent reviews list but clicking them leads to 404 errors. Need to either: (1) validate worktree directories exist before showing them, (2) auto-cleanup stale entries on server start, or (3) add a cleanup command. Should not show non-functional entries to users.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-29T11:48:25.816735-05:00","updated_at":"2025-12-29T11:50:10.392035-05:00","closed_at":"2025-12-29T11:50:10.392035-05:00"}
{"id":"pair_review-ec2","title":"Clear analysis results in UI when new analysis starts","description":"When a user starts a new analysis run, the previous analysis results should be cleared immediately from the UI.\n\nCurrent behavior: Old results remain visible while new analysis is running, which can be confusing.\n\nExpected behavior: Clear all previous suggestions/results as soon as the new analysis begins, showing only the loading/progress state until new results arrive.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-03T21:21:10.242884-05:00","updated_at":"2026-01-04T09:48:49.266307-05:00","closed_at":"2026-01-04T09:48:49.266307-05:00","close_reason":"Clear UI on analysis start, preserve history by querying latest ai_run_id instead of deleting"}
{"id":"pair_review-ecj","title":"Diff display missing lines between hunks with no expand control","description":"**Bug**: The unified diff display has gaps in line numbers between hunks, with no way to expand/reveal the missing lines.\n\n**Observed behavior**:\nIn the screenshot, the diff shows:\n- Lines 669-671 (left) / 718-720 (right) as context\n- Then a hunk header `@@ -699,8 +748,8 @@`\n- But lines 672-698 (left) / 721-747 (right) are completely missing\n\nThere should be ~28 lines between the context and the hunk header, but:\n1. These lines are not displayed\n2. There's no expand/reveal control to show them\n3. Users cannot access this portion of the diff\n\n**Expected behavior**:\nBetween hunks, there should be an expandable context area (like GitHub's \"Load more...\" or expand arrows) that allows users to reveal hidden lines between the displayed context and the next hunk.\n\n**Impact**: High - users cannot see portions of the diff, potentially missing important context for their review.\n\n**Likely cause**: The diff parser or renderer may be collapsing context between hunks without providing an expand mechanism, or the expand controls are not being rendered in certain cases.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-02T11:40:46.8171-05:00","updated_at":"2026-01-02T13:48:37.843347-05:00","closed_at":"2026-01-02T13:48:37.843347-05:00"}
{"id":"pair_review-epg","title":"Review panel UI refinement","description":"Address feedback on the new Review panel navigation UI. Consult frontend-design skill for refinements to reduce visual clutter while maintaining functionality.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-03T13:35:46.167983-05:00","updated_at":"2026-01-03T13:45:14.813198-05:00","closed_at":"2026-01-03T13:45:14.813198-05:00"}
{"id":"pair_review-ezw","title":"AI suggestion and user comment width should never be greater than diff display width","description":"This should be helped by wrapping long lines: pair_review-a4d","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:48:33.629798-05:00","updated_at":"2026-01-01T12:34:50.531712-05:00","closed_at":"2026-01-01T12:34:50.531712-05:00"}
{"id":"pair_review-f3f","title":"E2E tests for toast notifications","description":"Test success and error toast notifications, toast dismissal","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-05T07:09:48.500437-05:00","created_by":"tim","updated_at":"2026-01-05T07:09:48.500437-05:00"}
{"id":"pair_review-f3v","title":"Update user-comment endpoint to accept commit_sha","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T21:40:14.556475-05:00","updated_at":"2025-12-31T21:43:49.080333-05:00","closed_at":"2025-12-31T21:43:49.080333-05:00","dependencies":[{"issue_id":"pair_review-f3v","depends_on_id":"pair_review-m3j","type":"blocks","created_at":"2025-12-31T21:40:23.020503-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-f8b","title":"Customizable AI Analysis Configuration","description":"Epic for implementing user-configurable AI analysis settings. This allows users to customize how the AI reviewer behaves, what types of feedback it provides, and adjust analysis parameters to match their workflow and preferences.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-31T18:13:53.082846-05:00","updated_at":"2026-01-01T14:28:16.530815-05:00","closed_at":"2026-01-01T14:28:16.530815-05:00"}
{"id":"pair_review-fgt0","title":"Document git-diff-lines CLI command in README","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-15T07:17:27.512307-05:00","created_by":"tim","updated_at":"2026-01-15T07:17:27.512307-05:00"}
{"id":"pair_review-fn9f","title":"Add integration tests for analyzer prompt building flow","description":"Add integration tests that verify the full prompt building flow from analyzer.js through getPromptBuilder() to final output.\n\n## Background\nCurrent test coverage gap identified during Phase 1 review:\n- Unit tests cover prompt system functions (getPromptBuilder, build, buildTagged, getSections)\n- NO tests verify analyzer.buildLevel1Prompt(), buildLevel2Prompt(), buildLevel3Prompt(), buildOrchestrationPrompt()\n- NO tests verify context interpolation in real-world scenarios\n- NO tests verify fallback logic when prompts unavailable\n\n## Tests to Add\n1. Test buildLevel2Prompt() creates valid prompt with all context values interpolated\n2. Test tier selection and alias resolution (free→fast, standard→balanced, premium→thorough)\n3. Test fallback to legacy when new prompt unavailable\n4. Test all 4 prompt types (Level 1, 2, 3, Orchestration) with various tiers\n5. Verify final output has no XML section tags\n6. Verify all placeholder values are replaced\n\n## Example Test Pattern\n```javascript\ndescribe('Analyzer prompt building integration', () =\u003e {\n  it('buildLevel2Prompt should create valid prompt with all context', () =\u003e {\n    const analyzer = new Analyzer(mockDb, 'sonnet', 'claude');\n    const prompt = analyzer.buildLevel2Prompt(\n      123, '/path/to/worktree',\n      { title: 'Test PR', body: 'Test body', base_branch: 'main' },\n      [], null, ['src/file1.js']\n    );\n    expect(prompt).toBeTruthy();\n    expect(prompt).toContain('Level 2');\n    expect(prompt).not.toMatch(/\u003csection[^\u003e]*\u003e/);\n  });\n});\n```\n\n## Priority\nMedium - not urgent since code works in production, but valuable for confidence and regression prevention.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-14T07:54:40.580469-05:00","created_by":"tim","updated_at":"2026-01-14T07:54:40.580469-05:00","dependencies":[{"issue_id":"pair_review-fn9f","depends_on_id":"pair_review-v552","type":"blocks","created_at":"2026-01-14T07:54:44.908002-05:00","created_by":"tim"}]}
{"id":"pair_review-fqwt","title":"Consolidate E2E test helper functions into shared module","description":"## Problem\n\nSeveral helper functions are defined within individual E2E spec files, leading to duplication and maintenance challenges:\n\n### In `ai-analysis.spec.js`:\n- `handleAnalysisModals(page)` - Complex conditional logic to manage config modal and confirm dialog states\n- `triggerAnalysisAndWait(page)` - Triggers AI analysis and waits for completion\n- `seedAISuggestions(page)` - Pre-seeds AI suggestions via API\n\n### In `comment-crud.spec.js`:\n- `cleanupAllComments(page)` - Deletes all user comments via API\n- `openCommentFormOnLine(page, lineIndex)` - Opens comment form on a specific line\n\n## Issues\n1. **Duplication**: Similar helpers exist across files\n2. **Complexity**: `handleAnalysisModals` contains complex conditional logic with try/catch for different states\n3. **Maintenance burden**: Changes need to be made in multiple places\n\n## Proposed Solution\n\n1. Move common helpers to `tests/e2e/helpers.js` (which already exists with `waitForDiffToRender`)\n2. Review and simplify complex helpers:\n   - Break `handleAnalysisModals` into smaller, focused functions\n   - Create separate handlers for config modal and confirm dialog\n3. Consider grouping helpers by domain:\n   - Analysis helpers (modal handling, seeding suggestions)\n   - Comment helpers (CRUD operations, form interactions)\n\n## Acceptance Criteria\n- [ ] All reusable helpers consolidated into `helpers.js`\n- [ ] Complex helpers broken down into smaller, focused functions\n- [ ] All E2E tests pass after refactoring\n- [ ] Improved test isolation through clearer helper boundaries","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T10:32:07.485092-05:00","created_by":"tim","updated_at":"2026-01-05T10:32:22.809183-05:00"}
{"id":"pair_review-fv5y","title":"Add settle pattern to prevent orphan processes in other providers","description":"The cursor-agent-provider.js uses a 'settle' pattern where it re-checks the settled flag before spawning the LLM extraction process. This prevents orphan processes when a timeout fires between the close-handler entry and reaching the async LLM extraction point. Other providers (claude-cli-provider, gemini-provider) lack this pattern and could potentially spawn orphan processes. Port this defensive coding pattern to all providers that use async operations after checking completion state.","status":"open","priority":3,"issue_type":"task","created_at":"2026-02-03T06:35:09.620403-05:00","created_by":"tim","updated_at":"2026-02-03T06:35:15.479115-05:00"}
{"id":"pair_review-fvd","title":"DB schema: Store custom instructions per analysis run","description":"Add field(s) to store user-provided custom instructions for each analysis run. Instructions should be associated with the analysis so they can be retrieved when re-running. Consider adding to existing reviews table or creating analysis_runs table.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T18:26:03.893778-05:00","updated_at":"2026-01-01T14:18:45.775257-05:00","closed_at":"2026-01-01T14:18:45.775257-05:00","dependencies":[{"issue_id":"pair_review-fvd","depends_on_id":"pair_review-f8b","type":"blocks","created_at":"2025-12-31T18:26:22.249111-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-g12j","title":"AI analysis should apply comments to specific lines, not surrounding methods","description":"Currently AI suggestions sometimes target a broader context (like an entire method) when the actual issue is on a specific line. The prompts should be strengthened to encourage the AI to:\n\n1. Apply comments directly to the specific line(s) that need attention\n2. Avoid commenting on the method/function signature when the issue is in the body\n3. Be more precise about which exact line contains the bug/issue/improvement\n\nThis would improve the usefulness of suggestions by making them more actionable and easier to review.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-07T06:20:48.721699-05:00","created_by":"tim","updated_at":"2026-01-13T20:54:55.046045-05:00","closed_at":"2026-01-13T20:54:55.046045-05:00","close_reason":"Lots of work done on placement"}
{"id":"pair_review-g7f","title":"Split src/routes/pr.js into focused route modules","description":"## Problem\nsrc/routes/pr.js has grown to 2600+ lines, making it difficult to navigate and maintain.\n\n## Solution\nSplit into focused route modules:\n- `routes/analysis.js` - AI analysis endpoints (/api/analyze/*)\n- `routes/worktrees.js` - Worktree management (/api/worktrees/*)  \n- `routes/comments.js` - Comment CRUD (/api/user-comment/*, /api/ai-suggestion/*)\n- `routes/pr.js` - Core PR data endpoints (/api/pr/*)\n\n## Implementation\n1. Create new route files with extracted endpoints\n2. Update src/server.js to mount the new routers\n3. Ensure shared utilities (like broadcastProgress, getModel) are properly shared\n4. Update any imports in tests\n\n## Notes\nShould be done alongside pair_review-rhh (codebase health epic)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T16:14:39.694292-05:00","updated_at":"2026-01-02T22:58:44.228282-05:00","closed_at":"2026-01-02T22:58:44.228282-05:00","dependencies":[{"issue_id":"pair_review-g7f","depends_on_id":"pair_review-y8v","type":"blocks","created_at":"2026-01-02T22:05:45.927561-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-g7f","depends_on_id":"pair_review-tka","type":"blocks","created_at":"2026-01-02T22:05:45.953125-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-g8zw","title":"Validate AI suggestion line numbers against file length","description":"AI suggestions are sometimes attached to line numbers that don't exist in a file. Need to validate that line_start and line_end are within the file's line count. Validation should happen in: 1) Orchestration step before passing to final analysis, 2) Before database insertion. A simple check: line_start \u003c= file_line_count \u0026\u0026 line_end \u003c= file_line_count.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-05T07:38:45.593748-05:00","created_by":"tim","updated_at":"2026-01-08T08:14:55.255823-05:00","closed_at":"2026-01-08T08:14:55.255823-05:00","close_reason":"Work tracked in epic pair_review-tmt7 with detailed implementation issues"}
{"id":"pair_review-gcg","title":"Middle panel allows horizontal scroll - suggestions overflow","description":"The diff view middle panel allows horizontal scrolling because suggestion cards and diff content overflow the panel width. Fixed by: 1) Adding overflow-x:hidden to diff-view and diff-container, 2) Adding min-width:0 to flex items, 3) Adding table-layout:fixed to diff table, 4) Adding word-wrap to suggestion body text","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T08:47:01.983503-05:00","updated_at":"2025-12-31T08:47:08.13078-05:00","closed_at":"2025-12-31T08:47:08.13078-05:00"}
{"id":"pair_review-gk3","title":"Untangle AI suggestion show/hide state management","description":"Complex state management issues with AI suggestion visibility and status:\n\n## Current Behavior Problems\n\n1. **AI Panel not updated when suggestion is shown/hidden**: Clicking Show/Hide on a collapsed suggestion doesn't update the AI panel sidebar state.\n\n2. **State ambiguity for adopted vs dismissed**:\n   - Adopted suggestion → Show clicked: Should remain 'adopted' in sidebar (just expanding UI)\n   - Dismissed suggestion → Show clicked: Currently restores to 'active' via API, but sidebar may not update\n\n3. **Edge case: Adopted then user comment deleted**:\n   - User adopts suggestion → suggestion collapses, user comment created\n   - User deletes the user comment\n   - AI suggestion is still collapsed but orphaned\n   - Expected: Should revert to 'dismissed' state in AI panel\n   - Current: State is unclear\n\n## Root Cause\nMultiple code paths handle collapsing/expanding with inconsistent state sync:\n- collapseAISuggestion() for adoption\n- dismissSuggestion() for dismissal  \n- restoreSuggestion() handles both toggle and restore differently\n\n## Suggested Fix\n1. Refactor to single source of truth for suggestion state\n2. Ensure AI panel sidebar always reflects backend state\n3. Handle orphaned adopted suggestions (deleted user comment) gracefully","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-01T13:12:09.79273-05:00","updated_at":"2026-01-10T12:33:38.553207-05:00","closed_at":"2026-01-10T12:33:38.553207-05:00","close_reason":"Closed"}
{"id":"pair_review-gop7","title":"Add unit tests for ProgressModal.js","description":"ProgressModal.js contains important client-side logic including:\n- Determining whether to show the modal or wait for a background task\n- Handling SSE events for analysis progress\n- The new switchToNew logic for analysis completion\n\nCurrently lacks unit tests. Adding tests would help prevent regressions and verify complex conditional logic.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-21T07:36:43.334554-05:00","created_by":"tim","updated_at":"2026-01-21T07:36:43.334554-05:00"}
{"id":"pair_review-gvx","title":"Database schema: Add local review support","description":"Add database migrations and methods to support local reviews.\n\n## Schema Changes\n- Add `review_type` column ('pr' | 'local') with default 'pr'\n- Add `local_path` column (TEXT, nullable)\n- Add `local_head_sha` column (TEXT, nullable)\n- Make `pr_number` nullable for new inserts\n- Add unique index on (local_path, local_head_sha) WHERE review_type='local'\n\n## New Methods\n- `upsertLocalReview(context)` - create/resume local review session\n- `getLocalReview(path, headSha)` - lookup existing session\n- `getLocalReviewById(id)` - fetch by ID for routes\n\n## Notes\n- SQLite can't alter NOT NULL, so handle at app layer\n- Existing PR reviews unaffected (backward compatible)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T09:00:16.658485-05:00","created_by":"tim","updated_at":"2026-01-04T09:19:44.004881-05:00","closed_at":"2026-01-04T09:19:44.004881-05:00","close_reason":"Schema changes implemented, all 183 tests pass","dependencies":[{"issue_id":"pair_review-gvx","depends_on_id":"pair_review-8h3","type":"blocks","created_at":"2026-01-04T09:00:35.066784-05:00","created_by":"tim"}]}
{"id":"pair_review-gxh","title":"Add end-to-end tests with Playwright","description":"Add E2E tests that verify complete user flows work correctly.\n\n## Scope\n- Set up Playwright test framework\n- Test PR page loads and renders correctly\n- Test AI analysis flow (trigger, progress, results)\n- Test comment creation and editing\n- Test review submission\n\n## Key scenarios\n- Load PR page via URL path (/pr/owner/repo/number)\n- Verify file list populates\n- Verify diff renders with line numbers\n- Verify AI suggestions display after analysis\n- Verify comments can be created/edited/deleted\n\n## Benefits\n- Catches frontend-backend integration issues\n- Verifies UI renders correctly\n- Tests realistic user workflows","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T08:21:55.892454-05:00","updated_at":"2026-01-04T21:50:03.316548-05:00","closed_at":"2026-01-04T21:50:03.316548-05:00","close_reason":"Implemented Playwright e2e test framework with 33 passing tests covering PR page load, diff display, file navigation, comment creation, review modal, API integration, UI state management, and accessibility"}
{"id":"pair_review-gyx1","title":"Investigate and fix flaky E2E tests","description":"Tracking issue for flaky E2E tests that will be added to over time as flaky tests are identified. The goal is to investigate root causes and fix them to improve test reliability.","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-21T07:17:28.326391-05:00","created_by":"tim","updated_at":"2026-01-21T07:17:28.326391-05:00","comments":[{"id":20,"issue_id":"pair_review-gyx1","author":"tim","text":"First known flaky test:\n\n**Test:** `tests/e2e/comment-crud.spec.js:210:7 › Comment Editing › should save edited comment`\n\nThis test has been observed to fail intermittently. Investigation needed to determine root cause and implement a fix.","created_at":"2026-01-21T12:17:37Z"},{"id":21,"issue_id":"pair_review-gyx1","author":"tim","text":"Second flaky test identified:\n\n**Test:** `tests/integration/routes.test.js \u003e Local Review AI Suggestion Status Endpoint \u003e POST /api/local/:reviewId/ai-suggestion/:suggestionId/status \u003e should return 400 for invalid status value`\n\n**Symptom:** Test expects 400 but receives 401. Passes when run in isolation but fails intermittently in full suite.\n\n**Likely cause:** Test isolation issue - some earlier test is polluting authentication or mock state.","created_at":"2026-01-21T12:23:30Z"}]}
{"id":"pair_review-gyxd","title":"Refactor LocalManager to use Strategy/Adapter pattern instead of monkey-patching","description":"The LocalManager class currently uses monkey-patching to override PRManager methods at runtime. While this works for the current local app context, it creates architectural fragility:\n\n**Current issues:**\n- Tight coupling between LocalManager and PRManager\n- Changes to PRManager could silently break local mode\n- No tests catch regressions in patched methods\n- Harder to understand behavior since methods change at runtime\n\n**Suggested refactoring approaches:**\n1. **Strategy pattern**: PRManager delegates to an 'apiStrategy' object with different implementations for PR vs local mode\n2. **Adapter pattern**: Define a common interface, implement LocalReviewManager and PRManager as interchangeable implementations\n3. **Inheritance**: LocalManager extends PRManager and overrides specific methods\n\n**Benefits of refactoring:**\n- Explicit interface definition\n- Easier to test each mode independently\n- Reduces risk of silent regressions\n- More maintainable codebase\n\n**Current state:**\n- Monkey-patching is documented with comments explaining the approach\n- Initialization order is documented\n- Working correctly for current use case\n\nThis is low priority (P4) since the current approach works and this is a local app with a single maintainer. Consider addressing when adding more modes or significant PRManager changes.","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-05T10:42:25.361019-05:00","created_by":"tim","updated_at":"2026-01-05T10:42:25.361019-05:00"}
{"id":"pair_review-h5t7","title":"Add OLD/NEW side tracking to AI suggestion schema","description":"## Problem\n\nAI suggestions currently have no way to indicate which coordinate system their line numbers reference. The AI is instructed to use:\n- **NEW** line numbers for added/context lines (right side of diff)\n- **OLD** line numbers for deleted lines (left side of diff)\n\nBut the suggestion schema only contains:\n```json\n{\n  \"file\": \"path/to/file\",\n  \"line\": 42,\n  \"type\": \"...\",\n  ...\n}\n```\n\nThere is no `side` field, so the frontend must guess which coordinate system was intended. This can cause incorrect gap expansion when a line number exists in both OLD and NEW ranges.\n\n## Solution\n\nAdd an `old_or_new` field to the suggestion schema:\n\n```json\n{\n  \"file\": \"path/to/file\",\n  \"line\": 42,\n  \"old_or_new\": \"NEW\",\n  ...\n}\n```\n\n### Why OLD/NEW instead of LEFT/RIGHT\n\n- The annotated diff tool shows \"OLD\" and \"NEW\" columns to the AI\n- This terminology is what the AI sees and understands\n- `cat -n` shows NEW line numbers, so NEW should be the default\n- When submitting to GitHub API, map OLD→LEFT, NEW→RIGHT\n\n### Implementation\n\n1. **Update AI prompts** (src/ai/analyzer.js):\n   - Add `old_or_new` field to the suggestion JSON schema\n   - Document that NEW is the default (matches `cat -n` output)\n   - Instruct AI to use OLD only for deleted line comments\n\n2. **Update suggestion processing** (src/ai/analyzer.js):\n   - Add `old_or_new` to the suggestion object\n   - Default to \"NEW\" if not specified\n\n3. **Update frontend gap matching** (public/js/modules/gap-coordinates.js):\n   - Use the `old_or_new` field to determine which coordinate system to check first\n   - If OLD, check OLD coordinates first; if NEW, check NEW coordinates first\n\n4. **Update GitHub submission** (src/github-client.js):\n   - Map old_or_new to GitHub's `side` parameter (OLD→LEFT, NEW→RIGHT)\n\n5. **Database migration**:\n   - Add `old_or_new` column to comments table (default 'NEW')\n\n## Current Workaround\n\nThe current fix checks NEW coordinates first (since that's the majority case), then falls back to OLD. This works for most cases but may incorrectly match when a line number exists in both ranges.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-12T08:14:17.223663-05:00","created_by":"tim","updated_at":"2026-01-12T10:03:28.209615-05:00","closed_at":"2026-01-12T10:03:28.209615-05:00","close_reason":"Implemented old_or_new field in AI suggestion schema with comprehensive tests"}
{"id":"pair_review-hdq","title":"E2E tests for comment submission","description":"Test complete comment lifecycle - typing and submitting comments, comment appearing in diff, editing comments, deleting comments, multi-line drag selection","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:09:46.721162-05:00","created_by":"tim","updated_at":"2026-01-05T07:29:16.262572-05:00","closed_at":"2026-01-05T07:29:16.262572-05:00","close_reason":"Closed"}
{"id":"pair_review-hhmc","title":"Add github_reviews table for multi-review and incremental draft support","description":"## Background\n\nInvestigation of pair_review-a033 (large review submission fails) revealed a deeper data model limitation. The current schema enforces one-to-one relationship between local review sessions and GitHub reviews, which prevents several valuable workflows.\n\n## Current Limitation\n\nThe `reviews` table has:\n- A partial unique index enforcing one review record per PR\n- A single `review_id` column storing GitHub's review ID after submission\n- Comments linked to local `review_id`, not to specific GitHub reviews\n\n## Proposed Solution\n\nAdd a `github_reviews` table:\n\n\\`\\`\\`sql\nCREATE TABLE github_reviews (\n    id INTEGER PRIMARY KEY,\n    review_id INTEGER NOT NULL REFERENCES reviews(id) ON DELETE CASCADE,\n    github_review_id TEXT,           -- GitHub's ID (null if not yet created)\n    github_node_id TEXT,             -- GraphQL node ID for mutations\n    state TEXT NOT NULL DEFAULT 'local',  -- 'local', 'pending', 'submitted'\n    event TEXT,                       -- 'APPROVE', 'COMMENT', 'REQUEST_CHANGES'\n    body TEXT,                        -- Review body/summary\n    submitted_at DATETIME,\n    github_url TEXT,\n    created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n\n-- Link comments to specific GitHub reviews\nALTER TABLE comments ADD COLUMN github_review_ref INTEGER REFERENCES github_reviews(id);\n\\`\\`\\`\n\n## Capabilities This Enables\n\n1. **Multiple reviews per PR** - Natural support for ongoing PR discussions\n2. **Incremental drafts** - Save as draft, come back later, add more comments to same GitHub review\n3. **Discover existing drafts** - Query GitHub for PENDING reviews, create local record linked to it\n4. **Track submission history** - Know which comments went to which GitHub review\n\n## GitHub API Context\n\n- GitHub allows only ONE pending (draft) review per user per PR\n- Can add comments to existing pending review via `addPullRequestReviewThread`\n- Can query existing drafts: `reviews(states: PENDING)`\n\n## Related\n\n- Blocked by: pair_review-a033 (immediate batching fix)\n- This is the \"phase 2\" enhancement after the immediate bug fix","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-24T07:11:46.069344-05:00","created_by":"tim","updated_at":"2026-01-27T08:16:13.808897-05:00","closed_at":"2026-01-27T08:16:13.808897-05:00","close_reason":"Implemented github_reviews table with full API and UI support for draft discovery","dependencies":[{"issue_id":"pair_review-hhmc","depends_on_id":"pair_review-a033","type":"blocks","created_at":"2026-01-24T07:11:50.106835-05:00","created_by":"tim"}]}
{"id":"pair_review-hin0","title":"Add overall assessment comment when no suggestions to post","description":"When the AI analysis completes with no suggestions to post, the orchestration layer should leave a single praise comment with the overall assessment. This provides feedback to the user even when no issues are found.\n\n**Current behavior:**\n- When no issues are found, the review has no AI comments\n\n**Desired behavior:**\n- Leave a single praise comment containing the overall assessment\n- This gives the reviewer confidence that the analysis ran and found no issues\n- Could include summary like 'Looks good! No issues found in these changes.'\n\n**Future consideration:**\n- May want to always include an overall assessment comment (not just when no suggestions)\n- This would provide consistent feedback regardless of whether issues were found\n\n**Implementation notes:**\n- Modify orchestration layer instructions in analyzer.js\n- The praise comment should summarize what was reviewed and affirm the code quality","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-05T08:14:41.984108-05:00","created_by":"tim","updated_at":"2026-01-13T20:55:22.053359-05:00","closed_at":"2026-01-13T20:55:22.053359-05:00","close_reason":"Summary is now captured and displayed"}
{"id":"pair_review-hke","title":"Level 3 AI analysis may suggest non-existent file paths","description":"Level 3 (codebase context) AI analysis sometimes generates suggestions that reference file paths which don't exist in the PR diff.\n\n**Fix approach (multi-level):**\n- pair_review-8hw: Path normalization utility (foundation)\n- pair_review-q61: Database failsafe filter (guarantees clean UI)\n- pair_review-toh: Explicit file list in prompts (reduces hallucinations)\n- pair_review-i60: Orchestration validation (catches issues earlier)\n\nRoot causes:\n1. AI hallucinating file paths based on codebase patterns\n2. AI referencing files that exist in repo but aren't in the PR\n3. Path normalization issues between AI output and diff file names","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T21:19:27.114635-05:00","updated_at":"2026-01-04T15:21:40.071334-05:00","closed_at":"2026-01-04T15:21:40.071334-05:00","close_reason":"Implemented multi-level file path validation"}
{"id":"pair_review-hoil","title":"Phase 1: Prompt optimization foundation","description":"Create directory structure and refactor Level 2 Balanced as proof of concept.\n\nSubtasks:\n1. Create src/ai/prompts/ directory structure (index.js, config.js, baseline/, shared/)\n2. Extract Level 2 Balanced prompt from analyzer.js into tagged format\n3. Implement shared sections (validFiles, outputSchema, diffInstructions)\n4. Create runtime assembly in index.js with getPromptBuilder()\n5. Wire up to existing code path with fallback to old implementation\n\nReference: docs/architecture/prompt-optimization.md sections 5, 9, 10\n\nSuccess criteria:\n- Level 2 Balanced works via new architecture\n- All other prompts still work via fallback\n- No regressions in existing tests","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T21:05:55.616431-05:00","created_by":"tim","updated_at":"2026-01-13T21:19:10.144973-05:00","closed_at":"2026-01-13T21:19:10.144973-05:00","close_reason":"Phase 1 complete: Created prompt optimization directory structure, extracted Level 2 Balanced into tagged format, implemented shared sections and runtime assembly, wired up to analyzer.js with fallback. All 1010 tests pass."}
{"id":"pair_review-i21p","title":"files in package.json","description":"add files list to package.json to prepare for publishing","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T20:39:36.941235-05:00","created_by":"tim","updated_at":"2026-01-11T15:16:44.240006-05:00","closed_at":"2026-01-11T15:16:44.240006-05:00","close_reason":"Added files field to package.json with bin/, src/, public/, README.md, and LICENSE"}
{"id":"pair_review-i60","title":"Add orchestration validation for suggestion file paths","description":"Add a validation step in the orchestration layer that verifies AI suggestion file paths exist in the PR diff.\n\nRequirements:\n- Validate each suggestion's file path against the diff file list\n- Use normalized paths for comparison\n- Discard suggestions with invalid paths (don't attempt correction)\n- Log discarded suggestions for debugging\n- Keep validation logic simple - just check existence, no fuzzy matching\n\nNote: This is validation only, NOT correction. Correction is risky because:\n- Can't reliably determine what AI 'meant' to reference\n- Fuzzy matching could reassign suggestions to wrong files\n- Misattributed suggestions are worse than missing ones","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T15:13:51.810383-05:00","created_by":"tim","updated_at":"2026-01-04T15:21:40.070257-05:00","closed_at":"2026-01-04T15:21:40.070257-05:00","close_reason":"Implemented multi-level file path validation","dependencies":[{"issue_id":"pair_review-i60","depends_on_id":"pair_review-8hw","type":"blocks","created_at":"2026-01-04T15:14:05.854183-05:00","created_by":"tim"}]}
{"id":"pair_review-i6is","title":"Phase 2: Core Diff Rendering Migration","description":"## Objective\nReplace DiffRenderer line-by-line rendering with @pierre/diffs while preserving GitHub API compatibility.\n\n## Tasks\n- [ ] Replace DiffRenderer.renderDiffLine() with @pierre/diffs component\n- [ ] Preserve LineTracker data attributes on DOM elements for GitHub API\n- [ ] Adapt CSS to work with Shadow DOM (or use @pierre/diffs theming)\n- [ ] Maintain d2h-ins/d2h-del/d2h-cntx class compatibility or migrate CSS\n- [ ] Ensure syntax highlighting works for all supported languages\n- [ ] Test dark/light theme switching\n\n## Key Files to Modify\n- public/js/modules/diff-renderer.js\n- public/js/pr.js (renderDiffLine calls)\n- public/css/pr.css (diff styling)\n\n## Acceptance Criteria\n- Diff lines render correctly with @pierre/diffs\n- Syntax highlighting works for JS, TS, Python, Go, Rust, etc.\n- Line numbers display correctly (old/new columns)\n- Theme toggle works without page reload\n- LineTracker can still map positions for GitHub API\n\n## Estimated Effort\n16-24 hours\n\n## Dependencies\n- Phase 1 must complete with go decision","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-09T07:04:49.373011-05:00","created_by":"tim","updated_at":"2026-01-09T07:04:49.373011-05:00","dependencies":[{"issue_id":"pair_review-i6is","depends_on_id":"pair_review-07kx","type":"blocks","created_at":"2026-01-09T07:04:58.068086-05:00","created_by":"tim"},{"issue_id":"pair_review-i6is","depends_on_id":"pair_review-pquz","type":"parent-child","created_at":"2026-01-09T07:05:04.888948-05:00","created_by":"tim"}]}
{"id":"pair_review-igp","title":"Respect .gitattributes linguist-generated files","description":"Files marked with linguist-generated=true in .gitattributes (like package-lock.json, generated code) should be hidden or collapsed by default in the diff view, similar to how GitHub handles them.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-29T11:31:05.970149-05:00","updated_at":"2025-12-29T16:58:42.365511-05:00","closed_at":"2025-12-29T16:58:42.365511-05:00"}
{"id":"pair_review-ijd","title":"Add history/library of custom instructions for AI analysis","description":"Create a way to save, reuse, and manage custom instructions for AI analysis.\n\nFeatures to consider:\n- Save current custom instructions as a named preset\n- Library of saved presets (per-repo and/or global)\n- Quick-select from saved presets when configuring analysis\n- Edit/delete saved presets\n- Import/export presets\n\nUse cases:\n- Different instruction sets for different types of PRs (security review, performance review, etc.)\n- Team-shared instruction templates\n- Project-specific review guidelines that persist across sessions","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-04T09:09:43.560372-05:00","created_by":"tim","updated_at":"2026-01-04T09:09:43.560372-05:00"}
{"id":"pair_review-j7pt","title":"Add env field to Gemini/Copilot/Codex/Cursor getExtractionConfig","status":"open","priority":4,"issue_type":"task","created_at":"2026-02-07T13:51:23.756273-05:00","created_by":"tim","updated_at":"2026-02-07T13:51:23.756273-05:00"}
{"id":"pair_review-jbp","title":"Landing page polish","description":"Collection of UI/UX improvements for the landing page to achieve professional quality.\n\n## Issues\n- 38y: URL input field width\n- b8y: Hide AI sidebar on landing page  \n- 41r: Separate index.html and pr.html pages\n- v7u: Repository name styling","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-29T08:05:45.924775-05:00","updated_at":"2025-12-29T08:28:21.591188-05:00","closed_at":"2025-12-29T08:28:21.591188-05:00"}
{"id":"pair_review-jlp","title":"Analyzer: Integrate custom instructions into AI prompts","description":"Modify the AI analyzer prompts to incorporate both PR-level and repo-level custom instructions. Both should be sent to the AI with clear indication that PR instructions take priority over repo instructions when there's conflict. Use supplement model - combine both instruction sets. Use whatever instructions are available (repo only, PR only, or both).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T18:26:09.356792-05:00","updated_at":"2026-01-01T14:18:45.782995-05:00","closed_at":"2026-01-01T14:18:45.782995-05:00","dependencies":[{"issue_id":"pair_review-jlp","depends_on_id":"pair_review-f8b","type":"blocks","created_at":"2025-12-31T18:26:22.460341-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-jlp","depends_on_id":"pair_review-fvd","type":"blocks","created_at":"2025-12-31T18:26:26.812915-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-jlp","depends_on_id":"pair_review-3o2","type":"blocks","created_at":"2025-12-31T18:26:26.843132-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-jmu","title":"Cmd+Enter should save when creating a user comment","description":"Add keyboard shortcut support so users can press Cmd+Enter (Mac) or Ctrl+Enter (Windows/Linux) to save a comment instead of clicking the save button","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T18:23:25.099236-05:00","updated_at":"2026-01-01T10:25:06.816212-05:00","closed_at":"2026-01-01T10:25:06.816212-05:00"}
{"id":"pair_review-jq0","title":"Adopted AI suggestions disappear from AI panel after browser refresh","description":"## Problem\nAdopted AI suggestions are handled incorrectly when the browser is refreshed.\n\n## Current Behavior\nAfter adopting an AI suggestion and refreshing the browser:\n1. The adopted suggestion no longer appears in the AI panel\n2. The suggestion appears TWICE as user comments:\n   - The adopted user comment (correct)\n   - The original AI suggestion styled inline like a user comment (incorrect duplicate)\n3. This creates confusing duplicate display in the diff view\n\n## Expected Behavior\nAfter browser refresh:\n1. Adopted suggestions should remain in the AI panel with \"adopted\" status styling (green tint, no strikethrough)\n2. Only the resulting user comment from adoption should be visible inline\n3. The original AI suggestion should NOT be rendered as a user comment\n4. The adopted state should be properly persisted and restored\n\n## Root Cause Hypothesis\nThe adopted AI suggestions may be getting saved/loaded through a code path that treats them as user comments, causing them to be rendered twice - once through the user comments system and once through whatever is incorrectly styling the AI suggestion as a user comment.\n\n## Impact\n- Users lose visibility of which AI suggestions they've adopted in the AI panel\n- Duplicate comments clutter the diff view and cause confusion\n- The AI panel count/stats become inaccurate after refresh","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T16:29:21.159164-05:00","updated_at":"2025-12-31T16:48:12.127787-05:00","closed_at":"2025-12-31T16:48:12.127787-05:00"}
{"id":"pair_review-k21","title":"Implement proper database migration version tracking","description":"The database.js file has 5 migrations defined (versions 1-5) but there's no schema_version table or PRAGMA user_version check before running migrations. This means migrations might run repeatedly or in the wrong order, potentially corrupting the database.\n\n**Current behavior:**\n- Migrations are defined but version tracking relies on checking if columns/tables exist\n- No explicit version number stored in the database\n- Risk of migrations running out of order or being skipped\n\n**Suggested implementation:**\n- Use SQLite's PRAGMA user_version to track the current schema version\n- Check the current version before running migrations\n- Only apply migrations not yet executed\n- Update user_version after each successful migration\n\n**Example pattern:**\n```javascript\nconst currentVersion = db.pragma('user_version', { simple: true });\nif (currentVersion \u003c CURRENT_SCHEMA_VERSION) {\n  for (let v = currentVersion + 1; v \u003c= CURRENT_SCHEMA_VERSION; v++) {\n    migrations[v](db);\n    db.pragma(`user_version = ${v}`);\n  }\n}\n```\n\nThis is a fundamental database migration pattern that ensures migrations apply exactly once and in sequence.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-04T18:58:34.484872-05:00","created_by":"tim","updated_at":"2026-01-04T18:58:34.484872-05:00"}
{"id":"pair_review-k48y","title":"Diff view line number gaps prevent comment placement on expanded lines","description":"Significant regression: The diff view displays gaps in RIGHT side line numbers when expanding context. In the screenshot, line numbers jump from 1031 to 1069 (missing lines 1032-1068), but the actual code lines are shown.\n\nThis breaks the comment placement feature because:\n- Comments are supposed to be placed on hidden lines that get expanded\n- When line numbers have gaps, comments cannot be correctly positioned within the diff view\n- The line number tracking appears to be out of sync with the actual displayed content\n\nSymptoms observed:\n- LEFT line numbers: 1030, 1031, (missing), 1032, 1033, 1034, 1035\n- RIGHT line numbers: 1068, 1069, 1070, 1071, 1072, 1073 (but gap between 1031 and 1069 visible)\n- The visual display shows contiguous code but line numbers don't match\n\nAreas to investigate:\n- Diff rendering logic for expanded context sections\n- Line number calculation when expanding hidden lines\n- Context expansion code that reveals lines for comment placement","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-07T14:32:59.11647-05:00","created_by":"tim","updated_at":"2026-01-07T14:49:27.760769-05:00","closed_at":"2026-01-07T14:49:27.760769-05:00","close_reason":"Fixed in commit a19fd40. Root cause was file-content-original endpoint reading from HEAD (new version) while using OLD line numbers from gap metadata. Now uses git show base_sha:fileName to fetch BASE version ensuring correct line number mapping."}
{"id":"pair_review-k5z","title":"Legacy worktrees are orphaned and not cleaned up","description":"## Problem\nAfter disabling the broken migration (commit 51bd68e), legacy worktrees created before the random ID system are now orphaned:\n\n1. **Not in Recent Reviews** - They have no database records\n2. **Not auto-cleaned** - Cleanup only works on DB records\n3. **Disk space waste** - Users accumulate orphaned worktrees\n4. **Duplicates created** - Opening an old PR creates a NEW worktree instead of reusing\n\n## Root Cause\nThe migration was disabled because it couldn't reliably parse directory names like `in-the-loop-labs-pair-review-123` - it's ambiguous which hyphen separates owner from repo when repo names contain hyphens.\n\n## User Experience Impact\n- Old reviews invisible in UI\n- Disk fills up with orphaned worktrees\n- Re-reviewing old PRs wastes time cloning again\n\n## Recommended Fix: Smart Detection\nWhen `createWorktreeForPR` is called:\n1. Check DB for existing record (current behavior)\n2. If not found, construct legacy path from PR info: `${owner}-${repo}-${number}`\n3. Check if that legacy directory exists AND is a valid git worktree\n4. If yes: create DB record for it and reuse (no parsing ambiguity - we know the owner/repo)\n5. If no: create new worktree with random ID (current behavior)\n\nThis works because we already have the parsed PR info from GitHub - no need to reverse-parse the directory name.\n\n## Implementation\nModify `GitWorktreeManager.createWorktreeForPR()` in `src/git/worktree.js`:\n```javascript\n// After DB lookup fails, before generating new random ID:\nconst legacyDirName = `${prInfo.owner}-${prInfo.repo}-${prInfo.number}`;\nconst legacyPath = path.join(this.worktreeBaseDir, legacyDirName);\nif (await this.pathExists(legacyPath)) {\n  // Validate it's a git worktree and create DB record\n  // Then reuse it\n}\n```","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-29T16:14:40.409453-05:00","updated_at":"2025-12-29T16:24:53.964125-05:00","closed_at":"2025-12-29T16:24:53.964125-05:00"}
{"id":"pair_review-k7u","title":"Reuse existing worktree when reopening same PR","description":"## Problem\nCurrently, opening a PR always deletes and recreates the worktree. This is wasteful if the worktree already exists.\n\n## Solution\nWhen opening a PR:\n1. Check if worktree exists in DB for this PR\n2. If exists and directory is valid:\n   - Check for local uncommitted changes\n   - If local changes exist → **error** (user must resolve manually)\n   - If clean → refresh from remote (git fetch + reset to PR head)\n   - Update `last_accessed_at` timestamp\n3. If not exists → create new worktree as usual\n\n## Implementation\n1. Add `WorktreeManager.refreshWorktree(worktreeRecord)` method:\n   - `git status --porcelain` to check for changes\n   - Throw error if uncommitted changes detected\n   - `git fetch origin pull/{number}/head` \n   - `git reset --hard FETCH_HEAD`\n2. Update `createWorktreeForPR()` to check DB first\n3. Add `WorktreeManager.hasLocalChanges(worktreePath)` helper\n\n## Error Message\n\"Worktree has uncommitted changes. Please resolve manually at: {path}\"\n\n## Dependencies\n- Requires worktrees database table (pair_review-452)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T15:56:21.508022-05:00","updated_at":"2025-12-28T16:25:23.759805-05:00","closed_at":"2025-12-28T16:25:23.759805-05:00","dependencies":[{"issue_id":"pair_review-k7u","depends_on_id":"pair_review-452","type":"blocks","created_at":"2025-12-28T15:56:34.965844-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-k7u","depends_on_id":"pair_review-e4k","type":"blocks","created_at":"2025-12-28T15:56:43.493547-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-kc6","title":"worktree naming convention","description":"instead of just using a random identifier for worktrees we should use a convention that indidcates that it came from pair-review. I.e. pair-review--xyz. Including the org + repo name is likely redundant as it is already a worktree for the repo it is associated with.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T12:23:51.866154-05:00","updated_at":"2026-01-04T19:50:47.837834-05:00","closed_at":"2026-01-04T19:50:47.837834-05:00","close_reason":"Implemented in commit 0649d51"}
{"id":"pair_review-ked","title":"Add provider selection to UI","description":"Add provider dropdown/selector to AnalysisConfigModal. Model options should change based on selected provider.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:41:51.779796-05:00","updated_at":"2026-01-03T13:03:50.410235-05:00","closed_at":"2026-01-03T13:03:50.410235-05:00","dependencies":[{"issue_id":"pair_review-ked","depends_on_id":"pair_review-do9","type":"blocks","created_at":"2026-01-03T12:42:11.579846-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-ked","depends_on_id":"pair_review-416","type":"blocks","created_at":"2026-01-03T12:42:12.684736-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-kes","title":"Fix N+1 query in recent worktrees endpoint","description":"The /api/worktrees/recent endpoint fetches worktrees then queries pr_metadata individually for each. Should use JOIN query instead.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T09:20:03.302894-05:00","updated_at":"2025-12-29T09:21:57.040464-05:00","closed_at":"2025-12-29T09:21:57.040464-05:00"}
{"id":"pair_review-khdg","title":"Overhaul Analysis Run dialog for Review Councils","description":"With multiple participants in a tier, streaming back updates doesn't make sense. Replace with spinner-based UI: spinner on each level, with spinner on each participant beneath a level showing (i) not yet running, (ii) running, (iii) complete.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-02-07T16:50:49.508267-05:00","created_by":"tim","updated_at":"2026-02-07T16:50:49.508267-05:00"}
{"id":"pair_review-ki8i","title":"Phase 4: Testing and Polish","description":"## Objective\nEnsure full test coverage and performance parity after @pierre/diffs integration.\n\n## Tasks\n\n### Unit Test Updates\n- [ ] Update DiffRenderer tests for new implementation\n- [ ] Update HunkParser tests if gap logic changes\n- [ ] Update LineTracker tests for DOM structure changes\n- [ ] Update CommentManager tests for annotation integration\n\n### E2E Test Updates\n- [ ] Verify diff display tests pass\n- [ ] Test expand context functionality\n- [ ] Test comment placement and submission\n- [ ] Test AI suggestion display and adoption\n- [ ] Test generated file collapse/expand\n- [ ] Test theme switching\n\n### Performance Testing\n- [ ] Measure initial page load time (before vs after)\n- [ ] Measure large diff rendering time (1000+ lines)\n- [ ] Measure memory usage for large PRs\n- [ ] Document bundle size impact\n\n### Polish\n- [ ] Fix any CSS inconsistencies\n- [ ] Ensure keyboard navigation works\n- [ ] Test screen reader accessibility\n- [ ] Update any documentation referencing diff implementation\n\n## Acceptance Criteria\n- All existing tests pass (635 tests)\n- No performance regression \u003e10% on page load\n- Large diffs (1000+ lines) render smoothly\n- Bundle size increase documented and justified\n\n## Estimated Effort\n8-16 hours\n\n## Dependencies\n- Phase 3 must be complete","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-09T07:04:49.765769-05:00","created_by":"tim","updated_at":"2026-01-09T07:04:49.765769-05:00","dependencies":[{"issue_id":"pair_review-ki8i","depends_on_id":"pair_review-vk21","type":"blocks","created_at":"2026-01-09T07:04:58.137341-05:00","created_by":"tim"},{"issue_id":"pair_review-ki8i","depends_on_id":"pair_review-pquz","type":"parent-child","created_at":"2026-01-09T07:05:04.961608-05:00","created_by":"tim"}]}
{"id":"pair_review-km3z","title":"Add CI freshness check for generated skill prompts","description":"The static reference files in plugin/skills/agent-analyze/references/ are generated by scripts/generate-skill-prompts.js from the same source of truth as the MCP-served prompts. However, there is no CI step or pre-commit hook to verify they stay in sync after prompt modifications. Consider adding a CI check that runs 'npm run generate:skill-prompts' and verifies no files changed via 'git diff --exit-code plugin/skills/agent-analyze/references/'.","status":"open","priority":4,"issue_type":"task","created_at":"2026-02-01T10:56:13.944554-05:00","created_by":"tim","updated_at":"2026-02-01T10:56:20.673635-05:00"}
{"id":"pair_review-ku8","title":"Auto-expand hidden lines when AI suggestions target them","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T18:11:22.226972-05:00","updated_at":"2025-12-31T18:15:24.057671-05:00","closed_at":"2025-12-31T18:15:24.057671-05:00"}
{"id":"pair_review-kxai","title":"Incorporate Gemini optimizer insights into baseline prompts","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-18T17:12:13.154586-05:00","created_by":"tim","updated_at":"2026-01-18T17:12:13.154586-05:00","comments":[{"id":17,"issue_id":"pair_review-kxai","author":"tim","text":"## Summary\n\nAfter reviewing the Gemini-optimized prompt variants, several patterns emerged that could improve baseline prompts for all models. These recommendations come from analyzing what Gemini's optimizer chose to modify when adapting prompts for its own model family.\n\n## Recommended Changes\n\n### 1. Add \"Filter, Not Generator\" Framing (Level 3)\n\n**Location:** level3/*.js - guidelines or purpose section\n\n**Current:** \"Level 3 findings must require codebase context. If an issue could be identified from the file alone, it belongs in Level 2.\"\n\n**Proposed:** Add punchier framing: \"You are a filter, not a generator. Only output findings that genuinely require cross-file context. If a finding could be identified from the file alone, discard it—it belongs in a lower-level review.\"\n\n**Rationale:** More memorable, stronger imperative reduces scope creep between levels.\n\n---\n\n### 2. Add Simplified Line Number Heuristic\n\n**Location:** All diff-instructions sections\n\n**Current:** Detailed explanation of [+]/[-]/context mechanics\n\n**Proposed:** Add summary heuristic after the detailed rules: \"Simple rule: If the line exists in the new file (even if unchanged), it is NEW.\"\n\n**Rationale:** One sentence captures the mental model; serves as quick reference after reading the detailed rules.\n\n---\n\n### 3. Make Confidence Thresholds More Actionable\n\n**Location:** guidelines and confidence-guidance sections\n\n**Current (level1):** \"Lower (\u003c0.5): Prefer to omit marginal suggestions\"\n\n**Proposed:** \"Low (\u003c0.5): Do not output. If you are guessing, stay silent.\"\n\n**Rationale:** \"Prefer to omit\" invites interpretation; \"Do not output\" is unambiguous.\n\n---\n\n### 4. Add Volume Guidance to Orchestration Prompts\n\n**Location:** Orchestration prompts (all tiers)\n\n**Current:** No numeric guidance on output volume\n\n**Proposed:** Add \"Target Volume: 8-15 high-value suggestions total\" to balanced/thorough tiers, potentially lower for fast tier.\n\n**Rationale:** Prevents suggestion flooding while ensuring meaningful output. Gives the model a concrete target.\n\n---\n\n### 5. Add Confidence Boosting Rules to Orchestration\n\n**Location:** Orchestration prompts - merging/synthesis sections\n\n**Current:** General guidance to merge duplicates\n\n**Proposed:** Add explicit rules:\n- \"Boost confidence (+0.1-0.15) if multiple levels independently identify the same issue\"\n- \"Reduce confidence if levels disagree or evidence is vague\"\n\n**Rationale:** Gives concrete guidance on cross-level validation; leverages multi-level agreement as signal.\n\n---\n\n### 6. Add \"Inversion\" Thinking Step (Level 3 thorough)\n\n**Location:** reasoning-encouragement section in level3/thorough.js\n\n**Current:** Good analysis steps but no adversarial thinking prompt\n\n**Proposed:** Add step: \"Inversion: Ask 'Why might this implementation be dangerous in a future context?' Consider scaling, concurrent access, dependency drift.\"\n\n**Rationale:** Prompts adversarial thinking that catches issues pure pattern-matching misses.\n\n---\n\n## Implementation Notes\n\n- Changes should be made to baseline prompts, not variants\n- Each change is independent and can be implemented separately\n- After changes, re-run optimizer to see how variants adapt\n- Run tests after each change to ensure prompts still validate","created_at":"2026-01-18T22:12:42Z"}]}
{"id":"pair_review-l3fu","title":"Add AI Summary modal and review comment integration","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-10T21:12:56.972322-05:00","created_by":"tim","updated_at":"2026-01-11T09:29:18.188872-05:00","closed_at":"2026-01-11T09:29:18.188872-05:00","close_reason":"Implemented AI Summary modal and review comment integration","comments":[{"id":8,"issue_id":"pair_review-l3fu","author":"tim","text":"## Summary\nDisplay the AI-generated analysis summary in a simple modal, and allow users to use it as a starting point for their review comment.\n\n## Requirements\n\n### 1. AI Summary Modal\n- Make the existing icon to the left of 'Review' in the Review panel an actual clickable button\n- When clicked, opens a modal/overlay containing:\n  - **Stats bar**: Shows counts for # issues, # suggestions, # praise\n  - **Summary text**: The AI-generated summary prose\n  - **Copy button**: Small copy-icon button to copy the summary to clipboard\n- That's it. No elaborate animations, no file chips, no finding links.\n\n### 2. Submit Review Dialog Integration\n- Add a 'Copy AI summary' link above the textarea in the Submit Review dialog\n- When clicked, appends the current AI summary text to the textarea\n- Simple text link, not a button\n\n## Technical Notes\n- Summary field is already being persisted to the database (see recent work on summary column)\n- Need to ensure summary is retrieved and available to the frontend\n- Modal should respect dark/light theme\n\n## Out of Scope\n- Elaborate styling or animations\n- File navigation from summary\n- Stats breakdown by category in modal","created_at":"2026-01-11T02:13:14Z"}]}
{"id":"pair_review-l7mm","title":"Dark mode: Edit and Dismiss button icon highlights too dark","description":"In dark mode, the highlight color for icons on Edit and Dismiss buttons is too dark, making them difficult to see against the dark background.\n\n**Expected behavior:**\nIcon highlights should be lighter in dark mode for better visibility and contrast.\n\n**Actual behavior:**\nThe highlight color is too dark, reducing visibility of the icons.\n\n**Affected components:**\n- Edit button icon\n- Dismiss button icon\n\n**Visual reference:**\nSee screenshot showing dark highlights that blend too much with the dark background.","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-05T20:40:36.348396-05:00","created_by":"tim","updated_at":"2026-01-06T07:23:11.865503-05:00","closed_at":"2026-01-06T07:23:11.865503-05:00","close_reason":"Fixed by updating hover styles to use proper CSS variables without hardcoded dark fallbacks. Edit button now uses --color-bg-secondary and --color-text-primary for better contrast in dark mode."}
{"id":"pair_review-lmk","title":"Add TypeScript for shared API types","description":"Add TypeScript type definitions shared between frontend and backend.\n\n## Problem solved\nProperty name mismatches between frontend and backend (e.g., files vs changed_files)\nare only caught at runtime. Type checking would catch these at build time.\n\n## Implementation approach\n1. Create shared types in src/types/ directory\n2. Define interfaces for API request/response shapes\n3. Add JSDoc type annotations to existing JS files (gradual adoption)\n4. Or convert critical files to TypeScript\n\n## Key types needed\n- PRMetadata - PR data from main endpoint\n- DiffResponse - diff endpoint response\n- Comment - user comment structure\n- AISuggestion - AI suggestion structure\n\n## Benefits\n- Compile-time checking of property names\n- IDE autocomplete and error detection\n- Self-documenting API contracts","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-03T08:21:59.794613-05:00","updated_at":"2026-01-03T08:21:59.794613-05:00"}
{"id":"pair_review-lnh7","title":"Remove hardcoded default model fallbacks in favor of provider-driven defaults","description":"## Problem\n\nMultiple files across the codebase hardcode a specific model ID ('opus') as the default fallback. We just swept these from 'sonnet' to 'opus' across ~10 locations. This pattern means every time the default model changes, we must find and update every hardcoded reference — a maintenance burden and source of inconsistency bugs.\n\nAffected locations include: src/routes/shared.js, src/config.js, src/ai/analyzer.js, src/ai/claude-cli.js, src/routes/mcp.js, public/js/local.js, public/js/pr.js, public/js/components/AnalysisConfigModal.js, config.example.json, src/main.js.\n\n## Proposed Solution\n\nInstead of hardcoding a model ID, these fallback paths should resolve the default model dynamically from the provider:\n\n1. The Claude provider already has `getDefaultModel()` which returns the model with `default: true`\n2. Backend fallbacks should call the provider's `getDefaultModel()` (or a shared utility) instead of hardcoding 'opus'\n3. Frontend fallbacks should rely on the `/api/providers` endpoint's `defaultModel` field (which is already returned)\n4. Config example and README can document the current default but should note it may change\n\nThis way, changing the default model only requires updating the `default: true` flag in CLAUDE_MODELS — one place, one change.","status":"open","priority":3,"issue_type":"task","created_at":"2026-02-07T10:20:14.140792-05:00","created_by":"tim","updated_at":"2026-02-07T10:20:25.942482-05:00"}
{"id":"pair_review-lpxf","title":"AI analysis results don't appear when tab is inactive during completion","description":"When the pair-review browser tab is not active/focused while AI analysis completes, the results do not automatically appear in the UI. When the user returns to the tab, there is no indication that results are available — they must manually refresh the page to see the analysis results.\n\nExpected behavior: Results should either appear automatically when returning to the tab, or there should be a visible notification/indicator that new results are available.\n\nLikely root cause: The polling or event mechanism that updates the UI with analysis results may be suspended or throttled by the browser when the tab is inactive (browsers throttle timers/intervals in background tabs). When the tab regains focus, the polling may not resume or catch up properly.","status":"open","priority":2,"issue_type":"bug","created_at":"2026-02-07T10:54:28.455471-05:00","created_by":"tim","updated_at":"2026-02-07T10:54:45.133935-05:00"}
{"id":"pair_review-m3j","title":"Add commit_sha column to comments table","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T21:40:13.641056-05:00","updated_at":"2025-12-31T21:40:57.474728-05:00","closed_at":"2025-12-31T21:40:57.474728-05:00"}
{"id":"pair_review-m3p","title":"Apply file path validation to local mode analysis","description":"The multi-level file path validation approach implemented in PR #69 for PR mode needs to also be applied to local mode support (currently in progress).\n\nPR #69 added:\n- Path normalization utility for consistent comparison\n- Explicit file list in Level 2/3 analysis prompts\n- Orchestration validation to filter invalid paths\n- Database failsafe filter before storing suggestions\n\nWhen local mode analysis is implemented, ensure the same validation layers are applied:\n1. Include changed files list in prompts (from git diff or staged files)\n2. Validate suggestion paths against the actual changed files\n3. Filter invalid paths before storage\n\nReference: https://github.com/in-the-loop-labs/pair-review/pull/69","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T19:09:24.580877-05:00","created_by":"tim","updated_at":"2026-01-06T12:10:53.287932-05:00","closed_at":"2026-01-06T12:10:53.287932-05:00","close_reason":"Implemented in commit 589f510: changedFiles parameter threaded through all analysis methods, path validation at each level, database failsafe uses changedFiles for local mode"}
{"id":"pair_review-mb7","title":"Add Gemini CLI as alternative AI provider","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-03T12:41:27.377115-05:00","updated_at":"2026-01-03T13:03:50.435216-05:00","closed_at":"2026-01-03T13:03:50.435216-05:00"}
{"id":"pair_review-moe","title":"Add checkbox to clear user comments when re-analyzing","description":"When re-running AI analysis on a PR that has existing suggestions, a dialog warns that previous AI results will be cleared. \n\nConsider adding a checkbox option to also clear user comments at the same time. This would be useful when:\n- Starting fresh on a significantly changed PR\n- User comments were based on old AI suggestions that are being replaced\n- User wants a clean slate for the new analysis\n\nThe checkbox should be unchecked by default (preserving user comments is the safer default). Label could be something like 'Also clear my comments'.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-04T08:44:56.655607-05:00","created_by":"tim","updated_at":"2026-01-04T08:44:56.655607-05:00"}
{"id":"pair_review-mxo","title":"E2E tests for complete user workflows","description":"Test full workflows like: Load PR -\u003e Run AI -\u003e Adopt suggestion -\u003e Add comment -\u003e Submit review","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-05T07:09:50.539921-05:00","created_by":"tim","updated_at":"2026-01-05T07:09:50.539921-05:00"}
{"id":"pair_review-mzl","title":"Update AI prompts to allow comments on any line in modified files","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T18:11:21.349196-05:00","updated_at":"2025-12-31T18:15:24.054259-05:00","closed_at":"2025-12-31T18:15:24.054259-05:00"}
{"id":"pair_review-n5z","title":"Implement GeminiProvider for Gemini CLI","description":"Create GeminiProvider implementing AIProvider. Use positional prompt with -o json output format. Models: gemini-2.5-flash (fast), gemini-2.5-pro (balanced), gemini-2.5-pro (thorough).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:41:48.594499-05:00","updated_at":"2026-01-03T12:52:41.330643-05:00","closed_at":"2026-01-03T12:52:41.330643-05:00","dependencies":[{"issue_id":"pair_review-n5z","depends_on_id":"pair_review-bnm","type":"blocks","created_at":"2026-01-03T12:42:07.801403-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-nn5","title":"Preview modal shows incorrect/duplicate comments vs button count","description":"## Problem\nThe Preview modal is not correctly showing only the current user comments. The comment count on the button doesn't match what appears in the preview.\n\n## Current Behavior\n- Button shows N comments (e.g., \"Preview (3)\")\n- Preview modal contains more comments than expected\n- Includes doubled-up comments from AI suggestions\n- Count mismatch between button and preview content\n\n## Expected Behavior\n- Button count should accurately reflect the number of user comments\n- Preview should show exactly those comments, no more, no less\n- No duplicate entries from AI suggestions\n- Preview content should match the count displayed on the button\n\n## Related Issues\nThis may be related to pair_review-jq0 (adopted AI suggestions handled incorrectly on refresh) - the duplicate AI suggestion comments could be contaminating the preview.\n\n## Impact\n- Users cannot trust the comment count\n- Preview is unreliable for reviewing what will be submitted\n- Potential for submitting duplicate or unexpected comments to GitHub","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T16:39:52.932738-05:00","updated_at":"2025-12-31T17:06:40.870998-05:00","closed_at":"2025-12-31T17:06:40.870998-05:00"}
{"id":"pair_review-nwv","title":"E2E tests for theme toggle","description":"Test dark/light mode switching","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-05T07:09:49.680907-05:00","created_by":"tim","updated_at":"2026-01-05T07:09:49.680907-05:00"}
{"id":"pair_review-nxs","title":"Refactor createGapSection and createCollapsedSection to extract shared logic","description":"The createGapSection and createCollapsedSection functions in public/js/pr.js share ~140 lines of nearly identical logic for determining icon display, creating buttons, and attaching event handlers. Extract shared logic into helper functions (e.g., createExpandButton, determineIconDisplay, attachExpansionHandler) to reduce duplication and improve maintainability.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:53:32.750789-05:00","updated_at":"2026-01-02T23:24:41.825393-05:00","closed_at":"2026-01-02T23:24:41.825393-05:00","dependencies":[{"issue_id":"pair_review-nxs","depends_on_id":"pair_review-y8v","type":"blocks","created_at":"2026-01-02T22:05:46.001553-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-nzu7","title":"Bug: Cannot restore second dismissed suggestion on same line","description":"When two AI suggestions target the same line in a file, only the first dismissed suggestion can be restored. Attempting to restore the second does nothing.\n\n**Root cause hypothesis:** We may be missing a unique identifier to distinguish between multiple suggestions on the same line. The restore logic likely finds the first match and stops.\n\n**To investigate:**\n- How suggestions are identified in the frontend (line number alone vs unique ID)\n- How the restore action targets a specific suggestion\n- Whether suggestion IDs are properly tracked and passed to restore handlers","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-22T06:42:06.430482-05:00","created_by":"tim","updated_at":"2026-01-22T21:56:04.69699-05:00","closed_at":"2026-01-22T21:56:04.69699-05:00","close_reason":"Fixed querySelector targeting wrong element when multiple suggestions on same line"}
{"id":"pair_review-o1mc","title":"Add tests for line number validation features","description":"Comprehensive test coverage for all line number validation features.\n\n## Unit tests\n\n### diff-annotator.test.js\n- Parse and annotate simple diff (additions only)\n- Parse and annotate deletions\n- Parse and annotate mixed changes\n- Handle context lines correctly\n- Handle multiple files\n- Handle binary files (skip annotation)\n- Handle renamed files\n- OLD/NEW column numbers are accurate\n- File separators are clear\n\n### line-validation.test.js\n- buildFileLineCountMap returns correct counts\n- buildFileLineCountMap handles missing files\n- buildFileLineCountMap handles binary files\n- validateSuggestionLineNumbers passes valid suggestions\n- validateSuggestionLineNumbers filters line_start \u003e file length\n- validateSuggestionLineNumbers filters line_end \u003e file length\n- validateSuggestionLineNumbers filters line \u003c= 0\n- validateSuggestionLineNumbers passes file-level suggestions\n- convertToFileLevel option works correctly\n- Converted suggestions don't include invalid line context\n\n## Integration tests\n\n### Line validation in analysis flow\n- Suggestions with invalid lines converted to file-level\n- Valid suggestions unchanged\n- Logging occurs for conversions\n\n## E2E tests\n\n### Suggestion display\n- File-level suggestions display correctly in UI\n- Converted suggestions show appropriate title/body\n- No broken line references in UI\n\n## CLI tests\n\n### git-diff-lines script\n- Passes args through to git diff\n- Output format matches spec\n- Works with various git diff invocations","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T08:14:38.010667-05:00","created_by":"tim","updated_at":"2026-01-08T10:01:53.533556-05:00","closed_at":"2026-01-08T10:01:53.533556-05:00","close_reason":"Added 14 new tests: 5 CLI tests for git-diff-lines, 9 integration tests for line validation flow. Total 586 tests passing.","dependencies":[{"issue_id":"pair_review-o1mc","depends_on_id":"pair_review-oj6s","type":"blocks","created_at":"2026-01-08T08:14:54.21599-05:00","created_by":"tim"},{"issue_id":"pair_review-o1mc","depends_on_id":"pair_review-uz5c","type":"blocks","created_at":"2026-01-08T08:14:54.253607-05:00","created_by":"tim"},{"issue_id":"pair_review-o1mc","depends_on_id":"pair_review-roca","type":"blocks","created_at":"2026-01-08T08:14:54.287473-05:00","created_by":"tim"},{"issue_id":"pair_review-o1mc","depends_on_id":"pair_review-v58r","type":"blocks","created_at":"2026-01-08T08:14:54.326029-05:00","created_by":"tim"}]}
{"id":"pair_review-o4c","title":"Consider splitting pr.css into smaller files","description":"pr.css has grown large and contains styles for many different components (dialogs, toasts, diff view, header, etc). Consider splitting into smaller, more maintainable files:\n\n- components/dialog.css\n- components/toast.css  \n- components/header.css\n- diff.css\n- etc.\n\nThis would improve maintainability and make it easier to find relevant styles.","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-04T08:43:38.154463-05:00","created_by":"tim","updated_at":"2026-01-04T08:43:38.154463-05:00"}
{"id":"pair_review-o75","title":"Add frontend unit tests","description":"Add unit tests for critical frontend JavaScript modules.\n\n## Modules to test\n- public/js/pr.js - PRManager class\n- public/js/modules/hunk-parser.js - diff parsing\n- public/js/modules/line-tracker.js - line number tracking\n- public/js/modules/comment-manager.js - comment handling\n- public/js/modules/suggestion-manager.js - AI suggestions\n\n## Key functions to test\n- parseUnifiedDiff() - splits diff by file\n- loadAndDisplayFiles() - fetches and renders diff\n- updateFileList() - populates sidebar\n- renderDiff() - renders diff content\n\n## Implementation\n- Use Vitest with jsdom environment\n- Mock fetch() for API calls\n- Test DOM manipulation results","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-03T08:21:58.609262-05:00","updated_at":"2026-01-03T08:21:58.609262-05:00"}
{"id":"pair_review-oe53","title":"Fix 'Unexpected level status: pending for level 4' error in ProgressModal","description":"Console error observed during progress updates:\n\n```\nUnexpected level status: pending for level 4\nupdateLevelProgress    @    ProgressModal.js:480\nupdateProgress    @    ProgressModal.js:381\nmodal.eventSource.onmessage    @    local.js:952\n```\n\nThe ProgressModal is receiving an unexpected status 'pending' for level 4 during SSE progress events. This suggests either:\n1. The backend is sending level 4 events with 'pending' status when it shouldn't\n2. The frontend updateLevelProgress method doesn't handle all valid status values\n3. There's a race condition in how level progress is being reported\n\nInvestigation needed to determine root cause and appropriate fix.","status":"open","priority":3,"issue_type":"bug","created_at":"2026-01-21T07:40:12.61508-05:00","created_by":"tim","updated_at":"2026-01-21T07:40:12.61508-05:00"}
{"id":"pair_review-ofge","title":"Windows binary detection compatibility for line-validation.js","status":"open","priority":3,"issue_type":"bug","created_at":"2026-01-08T11:52:15.149347-05:00","created_by":"tim","updated_at":"2026-01-08T11:52:15.149347-05:00","labels":["platform:windows"],"comments":[{"id":1,"issue_id":"pair_review-ofge","author":"tim","text":"The `isBinaryFile` function in src/utils/line-validation.js uses the Unix-only `file --mime-encoding` command, which doesn't exist on Windows. This causes binary detection to silently fall back to treating all files as non-binary on Windows systems.\n\n**Suggested fix:** Implement a pure JavaScript binary detection approach that works cross-platform. A common technique is to read the first ~8KB of the file and check for null bytes:\n\n```javascript\nconst buffer = await fs.promises.readFile(fullPath, { encoding: null, flag: 'r' });\nconst chunk = buffer.slice(0, 8192);\nreturn chunk.includes(0);  // null bytes indicate binary\n```\n\n**Affected file:** src/utils/line-validation.js lines 11-31\n**User impact:** Degraded functionality on Windows - all files may be incorrectly treated as text files.","created_at":"2026-01-08T16:52:25Z"}]}
{"id":"pair_review-oh6a","title":"Phase 3: Prompt optimization tooling","description":"Build CLI tools for generating and managing provider variants.\n\nTools to implement:\n1. tools/optimize.js - Send tagged baseline to target model for optimization\n2. tools/extract.js - Claude agent extracts overrides from optimized output\n3. tools/validate.js - Verify variant integrity (locked sections, required present)\n4. tools/stale-check.js - Detect outdated variants when baseline changes\n\nReference: docs/architecture/prompt-optimization.md sections 6, 7, 11","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-13T21:05:56.010474-05:00","created_by":"tim","updated_at":"2026-01-13T21:05:56.010474-05:00","dependencies":[{"issue_id":"pair_review-oh6a","depends_on_id":"pair_review-v552","type":"blocks","created_at":"2026-01-13T21:06:01.440911-05:00","created_by":"tim"}]}
{"id":"pair_review-oj6s","title":"Create git-diff-lines annotated diff utility","description":"Create a utility that wraps git diff and adds explicit line numbers in a two-column format.\n\n## Implementation\n\n### Files to create\n- `src/utils/diff-annotator.js` - Core annotation logic\n- `bin/git-diff-lines` - CLI wrapper script\n\n### Output format\n```\n=== src/utils/helper.js ===\n OLD | NEW |\n  10 |  12 |      function calculate(a, b) {\n  11 |  -- | [-]    const legacy = true;\n  -- |  13 | [+]    const validated = validate(a);\n  12 |  14 |        return a + b;\n```\n\n### Requirements\n- Pass through ALL git diff arguments transparently\n- Show both OLD (base) and NEW (head) line numbers\n- Use `--` for lines that don't exist on that side\n- Mark additions with [+], deletions with [-]\n- Clear file separators\n- Handle binary files gracefully (skip annotation)\n\n### CLI usage\n```bash\ngit-diff-lines HEAD~1              # Full diff vs previous commit\ngit-diff-lines main...feature      # Branch comparison\ngit-diff-lines -- src/             # Specific path\ngit-diff-lines --stat              # Pass through any git diff option\n```\n\n### Package.json\nAdd to bin section so it's executable via npx or absolute path.\n\n## Testing\n- Unit tests for diff annotation logic\n- Test various diff formats (additions, deletions, renames, binary)\n- Test arg pass-through","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-08T08:14:31.86729-05:00","created_by":"tim","updated_at":"2026-01-08T09:20:30.117092-05:00","closed_at":"2026-01-08T09:20:30.117092-05:00","close_reason":"Implemented with unit tests, all 572 tests passing"}
{"id":"pair_review-oow","title":"Update frontend to send commit_sha with comments","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T21:40:16.499453-05:00","updated_at":"2025-12-31T21:43:49.085942-05:00","closed_at":"2025-12-31T21:43:49.085942-05:00","dependencies":[{"issue_id":"pair_review-oow","depends_on_id":"pair_review-m3j","type":"blocks","created_at":"2025-12-31T21:40:23.083176-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-p8n","title":"Change AI suggestion icon from single sparkle to sparkles","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T17:33:12.435408-05:00","updated_at":"2025-12-31T17:53:53.043807-05:00","closed_at":"2025-12-31T17:53:53.043807-05:00"}
{"id":"pair_review-pdrk","title":"Explore using Agent Client Protocol (ACP) instead of wrapping coding agent CLIs","description":"## Background\n\nCurrently pair-review integrates with AI coding agents (Claude CLI, Gemini CLI, Codex) by wrapping their CLI interfaces. This works but has limitations:\n- Each provider requires a separate adapter\n- CLI parsing is fragile and provider-specific\n- Limited control over agent behavior and context\n\n## Proposal\n\nInvestigate Agent Client Protocol (ACP) as an alternative integration approach. ACP is an emerging standard for programmatic agent communication that could provide:\n- Standardized interface across providers\n- Better programmatic control\n- Richer context passing\n- Structured responses\n\n## Tasks\n\n- [ ] Research ACP specification and current adoption\n- [ ] Identify which AI providers support ACP\n- [ ] Evaluate feasibility for pair-review use case\n- [ ] Compare tradeoffs vs current CLI wrapper approach\n- [ ] Prototype if promising","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-08T19:59:23.507146-05:00","created_by":"tim","updated_at":"2026-01-08T19:59:35.050647-05:00"}
{"id":"pair_review-pfu","title":"Frontend: Local mode detection and UI adaptations","description":"Update frontend to support local review mode.\n\n## Mode Detection\n- Detect URL pattern: `/local/:reviewId` vs `/pr/:owner/:repo/:number`\n- Set global mode flag for conditional rendering\n\n## UI Changes - Header\n- Add 'Local Mode' badge (highly visible)\n- Show current branch name (styled differently than PR branch)\n- Show repository name (from filesystem path basename)\n- Hide/remove PR-specific metadata (title, author, description)\n\n## UI Changes - Actions\n- Hide 'Submit Review to GitHub' button\n- Keep 'Export Comments' functionality (make more prominent?)\n- Keep AI analysis buttons (unchanged)\n\n## API Calls\n- Route to /api/local/* endpoints when in local mode\n- Route to /api/pr/* endpoints when in PR mode\n\n## Styling\n- Local Mode badge should be distinct (different color than PR elements)\n- Branch name should indicate 'reviewing changes TO this branch' not 'reviewing this branch'","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T09:00:21.786494-05:00","created_by":"tim","updated_at":"2026-01-04T09:38:44.212392-05:00","closed_at":"2026-01-04T09:38:44.212392-05:00","close_reason":"Frontend implementation complete with local.html and local.js","dependencies":[{"issue_id":"pair_review-pfu","depends_on_id":"pair_review-8h3","type":"blocks","created_at":"2026-01-04T09:00:35.235082-05:00","created_by":"tim"},{"issue_id":"pair_review-pfu","depends_on_id":"pair_review-6mb","type":"blocks","created_at":"2026-01-04T09:00:36.642396-05:00","created_by":"tim"}]}
{"id":"pair_review-pqb","title":"Hide type badges or restyle to prototype","description":"The prototype shows 'AI Suggestion' badge instead of type-specific badges. Either:\n- Replace type badges (Design, Improvement, Bug) with unified 'AI Suggestion' badge\n- Or restyle type badges to be more subtle and consistent\nFiles: public/js/pr.js, public/css/pr.css","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T21:04:39.823156-05:00","updated_at":"2025-12-30T21:46:02.369573-05:00","closed_at":"2025-12-30T21:46:02.369573-05:00","dependencies":[{"issue_id":"pair_review-pqb","depends_on_id":"pair_review-1mp","type":"blocks","created_at":"2025-12-30T21:05:04.692134-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-pqh","title":"Bug: Dark mode syntax highlight blue too low contrast","description":"The blue color used for values (strings, etc.) in dark mode syntax highlighting has insufficient contrast, making it hard to read:\n\n1. Against green (addition) backgrounds - very poor readability\n2. Against red (deletion) backgrounds - very poor readability  \n3. Even on unmodified lines - still too dark\n\nThe blue needs to be brighter/lighter for adequate contrast in all cases. This affects code readability during review.\n\nSee attached screenshot showing the issue on a green addition line where the blue string values are barely visible.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-01T11:21:13.6125-05:00","updated_at":"2026-01-01T12:05:13.031845-05:00","closed_at":"2026-01-01T12:05:13.031845-05:00"}
{"id":"pair_review-pquz","title":"Investigate @pierre/diffs for diff display and syntax highlighting","description":"## Background\n\nThe current diff rendering implementation in pair-review uses custom code in `public/js/modules/diff-renderer.js` and `public/js/modules/hunk-parser.js` for parsing and displaying diffs. This works but may benefit from a more robust, maintained library.\n\n## Analysis Summary (January 2026)\n\n### Current Implementation\n\n| File | Lines | Responsibility |\n|------|-------|----------------|\n| `diff-renderer.js` | 464 | Line rendering, syntax highlighting (highlight.js), comment buttons |\n| `hunk-parser.js` | 340 | Unified diff parsing, expandable context gaps, auto-expand logic |\n| `pr.js` (partial) | ~400 | File-level diff orchestration, parseUnifiedDiff(), renderFileDiff() |\n\n**Current dependencies**: highlight.js from CDN (~35KB), diff2html from CDN (lightly used)\n\n### What @pierre/diffs Offers\n\n| Feature | Current pair_review | @pierre/diffs |\n|---------|---------------------|---------------|\n| Syntax highlighting | highlight.js (60+ languages) | Shiki (VS Code engine, 150+ languages) |\n| Diff view modes | Unified only | Unified + side-by-side |\n| Inline change highlighting | Line-level only | Character/word-level |\n| Annotation framework | Custom (CommentManager) | Built-in |\n| Line selection | Custom (LineTracker) | Built-in (enableLineSelection) |\n| DOM approach | Standard DOM | CSS Grid + Shadow DOM |\n\n### Key Integration Challenges\n\n**1. Bundle Size Impact (HIGH)**\n- Shiki full bundle: ~1.2MB gzipped\n- Shiki web bundle: ~695KB gzipped\n- Current highlight.js CDN: ~35KB gzipped\n- **20x increase in syntax highlighting bundle**\n\n**2. Custom Features to Preserve (HIGH)**\n- Expandable context gaps (HunkParser.createGapSection) - GitHub-style expand up/down/all\n- Generated file badges with collapse/expand toggles\n- Function context headers showing hunk context\n- Auto-expand logic for small gaps (\u003c6 lines)\n- GitHub API position mapping via LineTracker\n\n**3. Shadow DOM Conflicts (MEDIUM)**\n- @pierre/diffs uses Shadow DOM for encapsulation\n- Would block external CSS from styling diff internals\n- Comment buttons, hover effects, selection highlighting would need rework\n\n**4. Annotation Integration (MEDIUM)**\n- Unclear if annotation framework supports AI suggestion workflows, multi-line ranges, expandable threads\n\n### Recommendation\n\n**Not recommended for v1.0 release** due to:\n1. Significant bundle size penalty for fast-startup tool\n2. Tightly integrated custom features (expandable gaps, generated file badges)\n3. Current implementation works well\n4. High integration effort for incremental improvements\n\n**Consider post-v1.0 if**:\n- Users request side-by-side diff view\n- Word-level inline diffs become priority\n- Shiki bundle concerns addressed (lazy loading)\n\n**Alternative**: Add word-level diff highlighting using lighter library like diff-match-patch (~12KB)\n\n## References\n- https://diffs.com/\n- https://www.npmjs.com/package/@pierre/diffs\n- https://shiki.style/guide/install","status":"open","priority":3,"issue_type":"epic","created_at":"2026-01-08T06:32:52.312907-05:00","created_by":"tim","updated_at":"2026-01-09T07:04:20.325395-05:00"}
{"id":"pair_review-ptt","title":"Index page should link each repo to its settings page","description":"Now that repository settings exist (for configuring AI analysis customizations like focus areas and custom instructions), the index page should provide a way to access these settings for each repository. Add a settings icon/link next to each repository entry on the index page that navigates to the repo settings page.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-02T08:24:19.373841-05:00","updated_at":"2026-01-02T11:35:11.547591-05:00","closed_at":"2026-01-02T11:35:11.547591-05:00"}
{"id":"pair_review-px3e","title":"Analysis results not loaded when first-ever analysis completes with progress dialog hidden","description":"When the first-ever analysis run for a review completes and the analysis progress dialog is hidden (minimized/closed), the analysis results are not being loaded into the UI. This only affects the first analysis run for a review - subsequent runs appear to work correctly. The user must manually refresh or trigger a reload to see the results.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-21T10:07:58.329691-05:00","created_by":"tim","updated_at":"2026-01-21T13:05:00.371566-05:00","closed_at":"2026-01-21T13:05:00.371566-05:00","close_reason":"Fixed by returning didSwitch from refresh() so handleCompletion() uses actual switch state instead of stale dialog visibility"}
{"id":"pair_review-q3q8","title":"CopilotProvider.getExtractionConfig missing shell mode check for custom commands","description":"## Problem\n\nIn `src/ai/copilot-provider.js`, the `getExtractionConfig` method does not check if the command contains a space and switch to shell mode. This is inconsistent with the other providers:\n\n- ClaudeProvider (line 248-250) - checks `useShell = claudeCmd.includes(' ')`\n- CodexProvider (line 312) - checks `useShell = codexCmd.includes(' ')`  \n- GeminiProvider (line 326) - checks `useShell = geminiCmd.includes(' ')`\n\n## Impact\n\nCustom commands with spaces in `PAIR_REVIEW_COPILOT_CMD` (e.g., 'devx copilot') would fail during LLM extraction fallback.\n\n## Solution\n\nAdd the same `useShell = copilotCmd.includes(' ')` pattern to `getExtractionConfig` for consistency:\n\n```javascript\ngetExtractionConfig(model) {\n  const copilotCmd = process.env.PAIR_REVIEW_COPILOT_CMD || 'copilot';\n  const useShell = copilotCmd.includes(' ');\n  \n  if (useShell) {\n    return {\n      command: `${copilotCmd} --model ${model} -s`,\n      args: [],\n      useShell: true,\n      promptViaStdin: true\n    };\n  }\n  return {\n    command: copilotCmd,\n    args: ['--model', model, '-s'],\n    useShell: false,\n    promptViaStdin: true\n  };\n}\n```","status":"open","priority":3,"issue_type":"bug","created_at":"2026-01-24T21:54:56.944117-05:00","created_by":"tim","updated_at":"2026-01-24T21:54:56.944117-05:00"}
{"id":"pair_review-q61","title":"Add database failsafe filter for invalid suggestion paths","description":"Add a final validation layer before saving AI suggestions to the database that filters out suggestions with file paths not in the PR diff.\n\nRequirements:\n- Compare suggestion file paths against the list of files in the PR diff\n- Use normalized paths for comparison\n- Log filtered suggestions (for debugging/tuning upstream processes)\n- Silent to users - they never see filtered garbage\n- Must be deterministic and simple\n\nThis guarantees no invalid suggestions reach the UI regardless of upstream failures.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T15:13:49.606881-05:00","created_by":"tim","updated_at":"2026-01-04T15:21:40.067845-05:00","closed_at":"2026-01-04T15:21:40.067845-05:00","close_reason":"Implemented multi-level file path validation","dependencies":[{"issue_id":"pair_review-q61","depends_on_id":"pair_review-8hw","type":"blocks","created_at":"2026-01-04T15:14:05.827714-05:00","created_by":"tim"}]}
{"id":"pair_review-qaj","title":"add support for context7","description":"This MCP could be useful for providing context on frameworks and libraries during review. It should be passed as a command line arg to . The pair-review configuration (or env variable) could be used for specifying a context7 API key.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T08:52:42.774364-05:00","updated_at":"2025-12-27T08:52:42.774364-05:00"}
{"id":"pair_review-qxu","title":"AI suggestion cards: Apply prototype card styling","description":"Update .ai-suggestion CSS to match prototype:\n- Remove any light/white backgrounds\n- Ensure consistent dark tertiary background (#181c23)\n- Amber left border (3px solid)\n- Amber glow shadow (box-shadow: 0 0 20px rgba(245,158,11,0.2))\n- Header with gradient background (amber-subtle → transparent)\n- Proper overflow:hidden and border-radius:6px\nFiles: public/css/pr.css","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T21:04:31.001466-05:00","updated_at":"2025-12-30T21:46:02.334645-05:00","closed_at":"2025-12-30T21:46:02.334645-05:00","dependencies":[{"issue_id":"pair_review-qxu","depends_on_id":"pair_review-1mp","type":"blocks","created_at":"2025-12-30T21:04:55.191321-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-r2g","title":"UI: Display latest commit SHA on PR page","description":"Show the latest commit SHA that was synced/fetched in the PR page UI. This helps reviewers understand exactly which version of the code they are reviewing, especially useful when PRs are updated during a review session. Consider placement in the header area near PR title/metadata.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T21:00:36.491345-05:00","updated_at":"2026-01-01T10:20:52.155106-05:00","closed_at":"2026-01-01T10:20:52.155106-05:00"}
{"id":"pair_review-r62","title":"E2E tests for split button dropdown","description":"Test split button dropdown options, not just main button","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-05T07:09:51.372494-05:00","created_by":"tim","updated_at":"2026-01-05T07:09:51.372494-05:00"}
{"id":"pair_review-r7r","title":"Diff view: Update hunk header styling","description":"Update diff hunk headers to match prototype:\n- 'Expand N lines' button with expand icon\n- Hunk info showing @@ diff locations in muted color\n- Background color matching tertiary bg\nFiles: public/css/pr.css","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T21:04:38.443928-05:00","updated_at":"2025-12-30T21:46:02.375187-05:00","closed_at":"2025-12-30T21:46:02.375187-05:00","dependencies":[{"issue_id":"pair_review-r7r","depends_on_id":"pair_review-1mp","type":"blocks","created_at":"2025-12-30T21:05:03.540571-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-r8q4","title":"Refactor: Extract shared helper for GraphQL comment mutation generation","description":"## Context\nIn `src/github/client.js`, the logic for constructing GraphQL comment mutations is duplicated between `createReviewGraphQL` (line ~363) and `createDraftReviewGraphQL` (line ~569).\n\nWith the recent addition of `startLine` handling for multi-line comments (PR #101), this duplication increases maintenance burden and the risk of inconsistency.\n\n## Suggestion\nExtract the mutation generation logic into a shared helper method. This would:\n- Ensure consistency for the `startLine` logic\n- Reduce code duplication across the client\n- Make future changes to comment formatting easier to maintain\n\n## Current State\nBoth methods have nearly identical code for generating the `addPullRequestReviewThread` mutation:\n```javascript\nconst startLineField = comment.start_line ? `startLine: ${comment.start_line}\\n                ` : '';\nreturn `\n  comment${index}: addPullRequestReviewThread(input: {\n    pullRequestId: $prId\n    pullRequestReviewId: $reviewId\n    path: \"${comment.path}\"\n    ${startLineField}line: ${comment.line}\n    side: ${side}\n    body: ${JSON.stringify(comment.body)}\n  }) {\n    thread { id }\n  }\n`;\n```\n\n## Acceptance Criteria\n- [ ] Create a shared helper method for generating comment mutations\n- [ ] Update both `createReviewGraphQL` and `createDraftReviewGraphQL` to use the helper\n- [ ] Ensure all existing tests pass\n- [ ] Add unit test for the helper method","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-22T16:10:43.224643-05:00","created_by":"tim","updated_at":"2026-01-22T16:10:43.224643-05:00"}
{"id":"pair_review-r8u2","title":"Add --debug CLI flag for verbose logging","status":"closed","priority":4,"issue_type":"feature","created_at":"2026-01-10T09:58:29.375211-05:00","created_by":"tim","updated_at":"2026-01-10T12:56:12.315155-05:00","closed_at":"2026-01-10T12:56:12.315155-05:00","close_reason":"Closed","comments":[{"id":3,"issue_id":"pair_review-r8u2","author":"tim","text":"## Problem\n\nDebug logging is currently only enabled via the `DEBUG=true` environment variable. This works but isn't discoverable—users won't know it exists unless they read the source code.\n\n## Solution\n\nAdd a `--debug` CLI flag that enables verbose logging:\n\n```bash\nnpx pair-review 123 --debug\n```\n\n## Implementation\n\n1. Add `--debug` flag to argument parsing in `src/main.js` (around line 111-119)\n2. Set `process.env.DEBUG = 'true'` when flag is present\n3. The existing logger already respects `process.env.DEBUG`, so no changes needed there\n4. Update help text to document the flag\n5. Optionally document in README\n\n## Related\n\n- pair_review-6q8o: Silence confusing warning by changing to debug level (this issue makes that change useful)","created_at":"2026-01-10T14:58:37Z"},{"id":7,"issue_id":"pair_review-r8u2","author":"tim","text":"Implemented --debug CLI flag: added to KNOWN_FLAGS, parseArgs() sets DEBUG=true when flag is present, updated help text and README documentation, added unit tests. Users can now use 'npx pair-review 123 --debug' to enable verbose logging.","created_at":"2026-01-10T17:56:21Z"}]}
{"id":"pair_review-rat","title":"add model selector when triggering AI analysis from UI","description":"Instead of starting analysis immediately there should be an intermediate dialog with an option to select the model. In the future, this dialog could grow to support other options like custom instructions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T09:13:51.751693-05:00","updated_at":"2026-01-01T14:18:45.78107-05:00","closed_at":"2026-01-01T14:18:45.78107-05:00"}
{"id":"pair_review-rhh","title":"codebase health","description":"some files are getting large. how should the codebase be refactored for long-term maintenanc","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-27T09:15:29.949674-05:00","updated_at":"2026-01-02T23:25:05.707533-05:00","closed_at":"2026-01-02T23:25:05.707533-05:00","dependencies":[{"issue_id":"pair_review-rhh","depends_on_id":"pair_review-g7f","type":"blocks","created_at":"2025-12-29T16:15:26.225629-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-rhh","depends_on_id":"pair_review-8mr","type":"blocks","created_at":"2026-01-02T22:05:47.192892-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-rhh","depends_on_id":"pair_review-nxs","type":"blocks","created_at":"2026-01-02T22:05:47.214985-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-roca","title":"Add line number validation infrastructure","description":"Create validation functions to check suggestion line numbers against actual file lengths.\n\n## Functions to implement\n\n### buildFileLineCountMap(worktreePath, validFiles)\n```javascript\nasync function buildFileLineCountMap(worktreePath, validFiles) {\n  // Returns Map\u003cfilePath, lineCount\u003e\n  // Handle: missing files (deleted), binary files, read errors\n}\n```\n\n### validateSuggestionLineNumbers(suggestions, fileLineCountMap, options)\n```javascript\nfunction validateSuggestionLineNumbers(suggestions, fileLineCountMap, options = {}) {\n  // options.convertToFileLevel - if true, convert invalid to file-level\n  // Returns { valid: [], converted: [], dropped: [] }\n  \n  // Validation rules:\n  // - line_start must be \u003e= 1 and \u003c= file line count\n  // - line_end must be \u003e= line_start and \u003c= file line count\n  // - File-level suggestions (null lines) pass through\n  // - Binary files skip validation\n  // - Missing files skip validation (might be deleted)\n}\n```\n\n## Integration points\n\n1. **Individual levels** (analyzeLevel1Isolated, etc.)\n   - Validate after parsing\n   - Log warnings but pass through to orchestration\n   - `convertToFileLevel: false`\n\n2. **Post-orchestration** (in analyzeAllLevels)\n   - Validate orchestrated results\n   - Convert invalid to file-level\n   - `convertToFileLevel: true`\n\n3. **Pre-storage failsafe** (in storeSuggestions)\n   - Final validation before INSERT\n   - Convert remaining invalid to file-level\n   - Pass worktreePath or line count map\n\n## Logging\n- Warn when converting suggestion to file-level\n- Include original line number in log for debugging\n- Do NOT include invalid line context in converted suggestion (per user request)\n\n## Testing\n- Unit tests for validation functions\n- Test edge cases: line 0, negative, exceeds file length\n- Test file-level suggestions pass through\n- Test binary file handling","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-08T08:14:34.011491-05:00","created_by":"tim","updated_at":"2026-01-08T09:20:30.122506-05:00","closed_at":"2026-01-08T09:20:30.122506-05:00","close_reason":"Implemented with unit tests, all 572 tests passing"}
{"id":"pair_review-rtny","title":"Incorporate Copilot variant improvements into baseline prompts","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-19T15:49:33.570418-05:00","created_by":"tim","updated_at":"2026-01-19T15:49:33.570418-05:00","comments":[{"id":19,"issue_id":"pair_review-rtny","author":"tim","text":"## Context\nThe Copilot prompt variants (optimized for Gemini) contain several improvements worth incorporating into baseline prompts.\n\n## Improvements to Consider\n\n### High Priority\n1. **Confidence ≠ Severity Distinction** (All levels)\n   - Add: \"Confidence is about certainty, not severity. A minor style issue can have high confidence.\"\n   - Prevents conflating how sure you are vs how serious the issue is\n\n2. **Failure-Mode Thinking** (Level 1 Thorough, Level 2/3)\n   - Add \"what could fail or regress\" framing to initial-setup\n   - Encourages defensive analysis\n\n3. **Scope Guardrails with Negation** (Level 3 `purpose`)\n   - Add: \"not a general audit—stay anchored to relationships created or affected by these changes\"\n\n4. **Condense File-Level Guidance** (Level 3)\n   - Replace verbose explanation with clearer test: \"Anchor issues to specific lines when possible. Use file-level suggestions only for concerns that truly span the entire file (architecture role, missing tests, integration or pattern mismatches, documentation gaps, module organization).\"\n\n### Medium Priority\n5. **Priority Tagging** (Level 2/3 `focus-areas`)\n   - Mark key areas with \"(high priority)\"\n\n6. **Orchestration Output Schema First**\n   - Consider reordering to front-load output constraints\n\n7. **Praise Limit** (Orchestration)\n   - Specify \"Include only 2-3 praise items at most\"\n\n8. **Line-Level Preference Emphasis**\n   - Add explicit rule: \"Prefer precise line-level notes over broad file-level ones\"\n\n### Skip (Provider-Specific)\n- Section reordering for constraint-first parsing\n- Generic token savings compression\n- Removal of optional sections (generated-files, file-line-counts)\n","created_at":"2026-01-19T20:50:00Z"}]}
{"id":"pair_review-rx1c","title":"Support --use-checkout in interactive PR mode","description":"--use-checkout currently only works in headless modes (--ai-draft and --ai-review). Extending it to interactive mode would let users point the web UI at an already-checked-out branch without pair-review creating its own worktree.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-30T22:05:13.159343-05:00","created_by":"tim","updated_at":"2026-01-30T22:05:28.699855-05:00"}
{"id":"pair_review-s26","title":"Improve diff hunk header display - hide raw @@ syntax, emphasize function context","description":"## Problem\n\nThe current diff view displays raw unified diff headers like:\n`@@ -5405,9 +5417,25 @@ body:not([data-theme=\"dark\"]) .theme-icon-light {`\n\nThis exposes developer plumbing as UI. The `@@` markers and line position metadata (-5405,9 +5417,25) are noise - this information is already visible in the line number columns.\n\n## Analysis: What's Useful vs. Noise\n\n| Element | Example | Usefulness | Verdict |\n|---------|---------|------------|---------|\n| `@@` markers | `@@...@@` | None - syntax artifact | **Remove** |\n| Old position | `-5405,9` | Low - visible in gutter | **Remove** |\n| New position | `+5417,25` | Low - visible in gutter | **Remove** |\n| Function context | `.theme-icon-light {` | **High** - orientation | **Emphasize** |\n\n## How Major Platforms Handle This\n\n**GitHub** (gold standard):\n- Completely hides `@@` syntax and line number metadata\n- Shows **only** the function context in a subtle, muted row\n- Uses light blue/gray background with smaller, dimmed text\n- Treats it as a \"section divider\" not a data row\n\n**GitLab**: Similar - function context only, de-emphasized styling\n\n**VS Code**: Shows function context as collapsible section header, no raw diff syntax\n\n## Recommended Visual Treatment\n\n```\nCURRENT (noisy):\n@@ -5405,9 +5417,25 @@ body:not([data-theme=\"dark\"]) .theme-icon-light {\n\nRECOMMENDED (clean):\nƒ  .theme-icon-light { ...\n```\n\n## Implementation Steps\n\n### 1. Parse and Extract Function Context\n\nCurrently in `pr.js` line ~1062:\n```javascript\nheaderRow.innerHTML = `\u003ctd colspan=\"2\" class=\"d2h-info\"\u003e${block.header}\u003c/td\u003e`;\n```\n\nChange to extract only function context:\n```javascript\nfunction extractFunctionContext(header) {\n  // header format: \"@@ -old,count +new,count @@ optional context\"\n  const match = header.match(/^@@[^@]+@@\\s*(.*)$/);\n  return match ? match[1].trim() : null;\n}\n\nconst functionContext = extractFunctionContext(block.header);\nconst contextDisplay = functionContext \n  ? `\u003cspan class=\"hunk-context-icon\"\u003eƒ\u003c/span\u003e${escapeHtml(functionContext)}`\n  : '···';  // fallback for headers without function context\n```\n\n### 2. Update Styling\n\n```css\n.d2h-info {\n  /* De-emphasize - navigational, not primary content */\n  font-size: 0.85em;\n  color: var(--color-text-muted);\n  opacity: 0.7;\n  font-family: var(--font-mono);\n  \n  /* Subtle background - lighter than current teal */\n  background: var(--color-bg-subtle);\n  \n  /* Visual breathing room */\n  padding: 4px 12px;\n  \n  /* Differentiate from code */\n  font-style: italic;\n}\n\n.hunk-context-icon {\n  margin-right: 8px;\n  opacity: 0.5;\n}\n```\n\n### 3. Dynamic Visibility Rules\n\nThe function context should be hidden/minimized when:\n\n1. **Definition is visible**: If expanded context includes a line matching the function pattern, the header becomes redundant\n2. **Hunks merge**: When expanding causes two hunks to become adjacent (no gap), remove second header\n3. **Replace with divider**: When hiding, optionally replace with subtle `───` break\n\n```javascript\nfunction shouldShowFunctionContext(hunk, expandedLines, previousHunkEnd) {\n  // Check if expanded context includes the function definition\n  const functionPattern = extractFunctionPattern(hunk.context);\n  const definitionVisible = functionPattern \u0026\u0026 expandedLines.some(line =\u003e \n    line.content.includes(functionPattern)\n  );\n  \n  // Check if this hunk has merged with the previous one\n  const mergedWithPrevious = previousHunkEnd \u0026\u0026 hunk.startLine \u003c= previousHunkEnd + 1;\n  \n  return !definitionVisible \u0026\u0026 !mergedWithPrevious;\n}\n```\n\n## Context Visibility Matrix\n\n| Scenario | Context Visible | Function Header |\n|----------|-----------------|-----------------|\n| Initial diff view | Only changed lines + 3 context | **Show** |\n| Partially expanded | ~10-20 extra lines | **Show** |\n| Fully expanded to function | Function definition visible | **Hide** (redundant) |\n| Hunks merged together | Continuous code block | **Hide** (misleading) |\n\n## Key Insight\n\nThe function context header is a **compression artifact** - it exists because git shows only a slice of the file. Once the user can see the actual function/selector definition in the expanded code, the header becomes redundant.\n\n**Goal**: Show function context when it provides orientation you can't get from visible code. Hide it when the code provides that orientation itself.\n\n## Files to Modify\n\n- `public/js/pr.js` - line ~1062 (header rendering), gap detection logic\n- `public/css/pr.css` - `.d2h-info` styling updates\n\n## Related\n\nThis is a UX improvement identified during the diff hunk bug fix work (beads-ecj).","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-02T14:02:45.477656-05:00","updated_at":"2026-01-02T15:49:17.656484-05:00","closed_at":"2026-01-02T15:49:17.656484-05:00"}
{"id":"pair_review-s33","title":"UI Redesign: Command Center Elegance","description":"Implement the full design refresh based on the prototype in design-refresh/. Key goals:\n- Position AI as a prominent co-reviewer with amber/gold identity\n- Sticky header that remains at top of window\n- Three-panel layout with AI Analysis Panel on right\n- Refined typography and spacing throughout\n- Professional, streamlined, minimal aesthetic focused on productivity\n\nReference: design-refresh/index.html","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-30T19:38:02.070042-05:00","updated_at":"2025-12-30T19:52:42.437222-05:00","closed_at":"2025-12-30T19:52:42.437222-05:00"}
{"id":"pair_review-s33.1","title":"Sticky header with PR info and actions","description":"Implement a sticky header that remains positioned at the top of the window as user scrolls through the diff.\n\nHeader should include:\n- Logo/branding on left\n- PR title, number, branch info in center\n- Stats (+/-lines, file count)\n- Action buttons on right (View on GitHub, Submit Review)\n\nReference: design-refresh/index.html .header styles","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T19:38:16.88726-05:00","updated_at":"2025-12-30T19:51:23.795126-05:00","closed_at":"2025-12-30T19:51:23.795126-05:00","dependencies":[{"issue_id":"pair_review-s33.1","depends_on_id":"pair_review-s33","type":"parent-child","created_at":"2025-12-30T19:38:16.887606-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-s33.2","title":"AI Analysis Panel (right sidebar)","description":"Add a dedicated AI Analysis Panel on the right side of the layout.\n\nPanel should include:\n- AI avatar/status indicator\n- Analysis depth indicator (Line/File/Codebase levels)\n- Findings summary with clickable list\n- Review progress tracker\n- Quick actions (Re-analyze, Explain Changes)\n- Future: Chat input placeholder\n\nThis makes AI a first-class co-reviewer presence rather than just inline suggestions.\n\nReference: design-refresh/index.html .ai-panel styles","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T19:38:17.89044-05:00","updated_at":"2025-12-30T19:51:23.797274-05:00","closed_at":"2025-12-30T19:51:23.797274-05:00","dependencies":[{"issue_id":"pair_review-s33.2","depends_on_id":"pair_review-s33","type":"parent-child","created_at":"2025-12-30T19:38:17.890773-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-s33.2","depends_on_id":"pair_review-s33.3","type":"blocks","created_at":"2025-12-30T19:38:49.692624-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-s33.3","title":"Three-panel layout structure","description":"Refactor the main layout to support three panels:\n- Left: File tree sidebar (existing, refined)\n- Center: Diff view (existing)\n- Right: AI Analysis Panel (new)\n\nThe layout should:\n- Use flexbox for responsive sizing\n- Support collapsing sidebars\n- Maintain usability at different viewport widths\n- Have consistent spacing and borders\n\nReference: design-refresh/index.html .main-layout styles","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T19:38:18.804184-05:00","updated_at":"2025-12-30T19:51:23.79651-05:00","closed_at":"2025-12-30T19:51:23.79651-05:00","dependencies":[{"issue_id":"pair_review-s33.3","depends_on_id":"pair_review-s33","type":"parent-child","created_at":"2025-12-30T19:38:18.804525-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-s33.4","title":"AI status indicator in file sidebar","description":"Add an AI co-reviewer status section at the bottom of the file tree sidebar.\n\nShould show:\n- AI avatar with animated ring when active\n- Status text (Analyzing... / Analysis complete)\n- Findings count badge\n\nThis provides persistent visibility of AI state without requiring scroll.\n\nReference: design-refresh/index.html .ai-sidebar-status styles","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T19:38:33.530776-05:00","updated_at":"2025-12-30T19:51:23.797628-05:00","closed_at":"2025-12-30T19:51:23.797628-05:00","dependencies":[{"issue_id":"pair_review-s33.4","depends_on_id":"pair_review-s33","type":"parent-child","created_at":"2025-12-30T19:38:33.531112-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-s33.4","depends_on_id":"pair_review-s33.3","type":"blocks","created_at":"2025-12-30T19:38:50.556918-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-s33.5","title":"Typography and font refresh","description":"Update typography to use the new font stack:\n- UI text: DM Sans (Google Fonts)\n- Code: JetBrains Mono (Google Fonts)\n\nAdd font imports to pr.html and update CSS font-family declarations.\n\nReference: design-refresh/styles.css font variables","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T19:38:34.484378-05:00","updated_at":"2025-12-30T19:51:23.796937-05:00","closed_at":"2025-12-30T19:51:23.796937-05:00","dependencies":[{"issue_id":"pair_review-s33.5","depends_on_id":"pair_review-s33","type":"parent-child","created_at":"2025-12-30T19:38:34.484798-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-s33.6","title":"Review submission modal redesign","description":"Update the review submission modal with the new design aesthetic.\n\nChanges:\n- Cleaner modal styling with backdrop blur\n- Review summary (comments count, AI suggestions adopted)\n- Status selector as visual radio buttons (Approve/Comment/Request Changes)\n- Refined button styling\n\nReference: design-refresh/index.html .review-modal styles","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T19:38:35.614539-05:00","updated_at":"2025-12-30T19:52:34.08008-05:00","closed_at":"2025-12-30T19:52:34.08008-05:00","dependencies":[{"issue_id":"pair_review-s33.6","depends_on_id":"pair_review-s33","type":"parent-child","created_at":"2025-12-30T19:38:35.615147-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-s7nw","title":"Synchronize test database schemas with production","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-16T13:21:21.568941-05:00","created_by":"tim","updated_at":"2026-01-16T18:21:53.511111-05:00","closed_at":"2026-01-16T18:21:53.511111-05:00","close_reason":"Synchronized E2E and integration test schemas with production - added missing columns, CHECK constraints, foreign key constraints, and enabled foreign_keys pragma","comments":[{"id":16,"issue_id":"pair_review-s7nw","author":"tim","text":"## Missing Schema Elements in E2E Tests\n\nThe E2E test database schema in tests/e2e/global-setup.js is missing several production schema elements:\n\n### Missing columns in reviews table:\n- review_type column\n- local_path column  \n- local_head_sha column\n\n### Missing constraints in comments table:\n- CHECK constraints\n- Foreign key constraints for adopted_as_id\n- Foreign key constraints for parent_id\n\n## Integration Tests Foreign Key Handling\n\nAdditionally, tests/integration/routes.test.js (line 124) explicitly disables foreign keys while production enables them:\n\nIntegration test: db.pragma('foreign_keys = OFF')\nProduction (src/database.js): db.pragma('foreign_keys = ON')\n\nThis inconsistency means:\n1. Foreign key CASCADE behavior is not tested\n2. Tests may pass with invalid foreign key references that would fail in production\n3. The test environment does not accurately represent production behavior\n\n## Recommended Fix\n\n1. Update both test schema files to match production schema exactly\n2. Enable foreign keys in integration tests\n3. Add a validation mechanism to ensure test schemas stay synchronized with production (perhaps a migration script or schema comparison test)","created_at":"2026-01-16T18:21:55Z"}]}
{"id":"pair_review-saoq","title":"Support GitHub-style emoji shortcodes in Markdown rendering","description":"## Feature Request\nAdd support for GitHub-style emoji shortcodes (e.g., `:smile:`, `:rocket:`, `:warning:`) when rendering Markdown content in the diff view and suggestion blocks.\n\n## Motivation\nGitHub supports emoji shortcodes in comments, PRs, and Markdown files. Since pair-review aims for GitHub UI familiarity, supporting the same emoji syntax would provide a consistent experience for users accustomed to GitHub's Markdown rendering.\n\n## Examples\n- `:+1:` → 👍\n- `:bug:` → 🐛\n- `:memo:` → 📝\n- `:warning:` → ⚠️\n- `:rocket:` → 🚀\n\n## Implementation Considerations\n- Could use a library like `emoji-js` or `node-emoji` for shortcode conversion\n- Need to handle both server-side rendering and client-side display\n- Should work in:\n  - AI suggestion blocks\n  - User comments\n  - Markdown file previews\n- Consider whether to support skin tone modifiers\n\n## Reference\nGitHub's emoji shortcode list: https://github.com/ikatyang/emoji-cheat-sheet","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-23T16:03:39.100473-05:00","created_by":"tim","updated_at":"2026-01-25T14:07:03.371925-05:00","closed_at":"2026-01-25T14:07:03.371925-05:00","close_reason":"Closed"}
{"id":"pair_review-seu4","title":"Extract shared ProviderModelSelector component from repo-settings and AnalysisConfigModal","description":"## Overview\n\nThere is significant code duplication between `repo-settings.js` and `AnalysisConfigModal.js` for provider/model selection UI. Both files implement nearly identical functionality:\n\n## Duplicated Code (~125 lines total)\n\n| Method | repo-settings.js | AnalysisConfigModal.js |\n|--------|------------------|------------------------|\n| `loadProviders()` | ~35 lines | ~40 lines |\n| `renderProviderButtons()` | ~20 lines | ~20 lines |\n| `renderModelCards()` | ~30 lines | ~25 lines |\n| `selectProvider()` | ~40 lines | ~30 lines |\n| `getModelIcon()` | ~8 lines | N/A (inline) |\n\n## Proposed Solution\n\nExtract a shared `ProviderModelSelector` class that handles:\n- Provider/model data loading from `/api/providers` endpoint\n- Provider toggle button rendering\n- Model card rendering with dynamic updates\n- Provider selection with intelligent tier-matching when switching providers\n- Model selection state management\n\n## Key Differences to Reconcile\n\n1. **State management**: repo-settings tracks `originalSettings`/`currentSettings` for dirty checking; modal only tracks current selection\n2. **Persistence**: repo-settings saves to database; modal returns selection to caller via callback\n3. **UI containers**: Different DOM element IDs (`#provider-toggle` vs `#provider-toggle-container`, `#model-cards` vs `#model-cards-container`)\n\n## Benefits\n\n- Reduces ~125 lines of duplicated code\n- Ensures consistent UI behavior across both contexts\n- Single place to update when adding new providers or changing selection logic\n- Easier to test provider/model selection in isolation\n\n## Implementation Approach\n\n1. Create `/public/js/components/ProviderModelSelector.js`\n2. Accept configuration options for container IDs, callbacks, and state tracking\n3. Update repo-settings.js to use the shared component\n4. Update AnalysisConfigModal.js to use the shared component\n5. Add unit tests for the shared component\n\n## Files Involved\n\n- `public/js/repo-settings.js`\n- `public/js/components/AnalysisConfigModal.js`\n- New: `public/js/components/ProviderModelSelector.js`","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-09T07:37:37.996191-05:00","created_by":"tim","updated_at":"2026-01-09T07:37:37.996191-05:00"}
{"id":"pair_review-shov","title":"Add comprehensive README.md to repository","description":"Create a professional README.md that explains:\n- What pair-review is and its core value propositions\n- Installation and setup instructions\n- Quick start guide\n- Usage examples for both PR review and local mode\n- Configuration options\n- Screenshots/demo of the UI\n- Contributing guidelines\n- Links to documentation\n\nThe README should make it easy for new users to understand what pair-review does and get started quickly.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-08T20:54:45.458567-05:00","created_by":"tim","updated_at":"2026-01-10T19:58:37.058218-05:00","closed_at":"2026-01-10T19:58:37.058218-05:00","close_reason":"README.md added with comprehensive documentation"}
{"id":"pair_review-stly","title":"Bug: AI analysis summary shows latest run instead of selected run","description":"When viewing a previous analysis run, the summary panel displays the summary from the latest run rather than from the currently selected run.\n\n**Current behavior:** Selecting a previous analysis run in the history shows that run's suggestions, but the summary panel still shows the most recent run's summary.\n\n**Expected behavior:** The summary should update to reflect the currently selected analysis run, matching the suggestions being displayed.\n\n**To investigate:**\n- Where the summary is fetched/rendered\n- How run selection affects summary display\n- Whether the summary endpoint respects the selected run ID","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-22T09:52:51.068431-05:00","created_by":"tim","updated_at":"2026-01-22T11:17:14.756318-05:00","closed_at":"2026-01-22T11:17:14.756318-05:00","close_reason":"Fixed by passing runId to has-ai-suggestions endpoint. Modified analysis.js, local.js routes to accept runId query param and return summary from selected run. Updated pr.js and local.js frontend to pass the runId."}
{"id":"pair_review-su1","title":"Add recently reviewed PRs list to landing page","description":"## Problem\nNo way to see or reopen previously reviewed PRs from the web UI. Users must remember PR numbers/URLs.\n\n## Solution\nAdd a \"Recent Reviews\" section to the landing page showing recently accessed worktrees.\n\n## UI Design\n```\n┌─────────────────────────────────────────────┐\n│  pair-review                                │\n├─────────────────────────────────────────────┤\n│                                             │\n│  [ Enter PR URL to start review ]  [Start] │\n│                                             │\n│  ─────────────────────────────────────────  │\n│                                             │\n│  Recent Reviews                             │\n│                                             │\n│  anthropic/pair-review #123                 │\n│  Fix authentication bug                     │\n│  Last opened: 2 hours ago              [→]  │\n│                                             │\n│  anthropic/claude-code #456                 │\n│  Add new feature                            │\n│  Last opened: 3 days ago               [→]  │\n│                                             │\n└─────────────────────────────────────────────┘\n```\n\n## Implementation\n1. Add API endpoint: `GET /api/worktrees/recent?limit=10`\n   - Returns list with: repository, pr_number, pr_title, last_accessed_at\n   - Join with pr_metadata for title\n2. Create landing page component (or update existing)\n3. Each item links to `/pr/{owner}/{repo}/{number}`\n4. Show all repos (cross-repository list)\n\n## Future enhancements (not in scope)\n- Search/filter by repo\n- Sort options\n- Pagination\n\n## Dependencies\n- Requires worktrees database table (pair_review-452)\n- Requires worktree reuse logic (so clicking opens existing)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T15:56:23.160887-05:00","updated_at":"2025-12-28T16:35:36.781128-05:00","closed_at":"2025-12-28T16:35:36.781128-05:00","dependencies":[{"issue_id":"pair_review-su1","depends_on_id":"pair_review-452","type":"blocks","created_at":"2025-12-28T15:56:35.00672-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-su1","depends_on_id":"pair_review-k7u","type":"blocks","created_at":"2025-12-28T15:56:35.027112-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-su1","depends_on_id":"pair_review-e4k","type":"blocks","created_at":"2025-12-28T15:56:43.538123-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-swf","title":"Remove debug console.log for diffPosition","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-01T11:45:37.976692-05:00","updated_at":"2026-01-10T12:53:14.279485-05:00","closed_at":"2026-01-10T12:53:14.279485-05:00","close_reason":"Changed logger.warn to logger.debug for expected file fallback messages in src/routes/pr.js lines 585 and 682"}
{"id":"pair_review-szr","title":"Bug: User comments cleared after submitting review to GitHub","description":"After submitting a review to GitHub, user comments no longer appear when previewing comments. The comments seem to be cleared/deleted upon submission.\n\nExpected behavior: User comments should persist after submission so users can see what they submitted, or at minimum have a record of submitted reviews.\n\nPossible causes:\n- Comments being deleted from database after successful GitHub submission\n- Query filtering out comments with a 'submitted' status\n- Comments being moved to a different table/status without updating preview logic\n\nThis affects the ability to review what was submitted and breaks the workflow if a user wants to reference their past comments.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-01T11:09:51.752573-05:00","updated_at":"2026-01-01T11:33:40.613922-05:00","closed_at":"2026-01-01T11:33:40.613922-05:00"}
{"id":"pair_review-tcv","title":"Convert backend from CommonJS to ES modules","description":"## Background\nThe backend uses CommonJS (require/module.exports) while the frontend and tests use ES modules. This causes friction with test mocking - vi.mock() only works with ES imports, requiring workarounds like vi.spyOn() on prototypes.\n\n## Scope\n- ~116 require() calls to convert to import\n- All module.exports to export\n- Replace __dirname/__filename with import.meta.url workarounds\n- Add \"type\": \"module\" to package.json\n\n## Benefits\n- Better test mocking support (vi.mock() works directly)\n- Modern JavaScript standard\n- Better static analysis and tree-shaking\n- Consistency with frontend code patterns\n\n## Notes\n- Low priority - current vi.spyOn() approach works fine\n- Good test coverage now exists to catch regressions\n- Mechanical but tedious work","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-03T07:45:56.066406-05:00","updated_at":"2026-01-03T07:45:56.066406-05:00"}
{"id":"pair_review-tj6t","title":"analysis should generate literal suggestions","description":"When an AI suggestion has a specific code change to suggest it should be encouraged to use ```suggestion syntax","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-09T14:32:08.504289-05:00","created_by":"tim","updated_at":"2026-01-09T14:32:08.504289-05:00"}
{"id":"pair_review-tka","title":"Write tests for database operations","description":"Create unit tests for src/database.js. Test CRUD operations for PRs, comments, AI suggestions. Use in-memory SQLite for fast tests. Test transaction handling and schema integrity.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T22:05:29.539368-05:00","updated_at":"2026-01-02T22:14:23.20915-05:00","closed_at":"2026-01-02T22:14:23.20915-05:00","dependencies":[{"issue_id":"pair_review-tka","depends_on_id":"pair_review-70n","type":"blocks","created_at":"2026-01-02T22:05:43.153149-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-tmt7","title":"Validate AI suggestion line numbers against file length","description":"AI suggestions are sometimes attached to line numbers that don't exist in a file. This epic tracks a comprehensive solution addressing root causes (ambiguous diff format, prompt guidance) and symptoms (invalid line numbers).\n\n## Goals\n1. Provide AI agents with unambiguous line number information via annotated diff tool\n2. Update prompts to emphasize line number precision\n3. Validate and handle invalid line numbers gracefully\n\n## Approach\n- Create git-diff-lines utility showing OLD|NEW columns\n- Update all analysis prompts with line number guidance\n- Add validation infrastructure to filter/convert invalid suggestions\n- Enhance orchestration to handle line number issues\n\n## Success Criteria\n- AI suggestions reference valid line numbers\n- Invalid line suggestions converted to file-level (not dropped silently)\n- Clear audit trail when suggestions are converted","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-08T08:13:26.197392-05:00","created_by":"tim","updated_at":"2026-01-08T10:01:54.694267-05:00","closed_at":"2026-01-08T10:01:54.694267-05:00","close_reason":"Epic complete: All 5 sub-issues implemented. Created git-diff-lines utility with OLD|NEW line number columns, added validation infrastructure, updated all AI prompts with guidance, integrated validation into orchestration flow. 586 tests passing.","dependencies":[{"issue_id":"pair_review-tmt7","depends_on_id":"pair_review-oj6s","type":"blocks","created_at":"2026-01-08T08:34:19.749775-05:00","created_by":"tim"},{"issue_id":"pair_review-tmt7","depends_on_id":"pair_review-uz5c","type":"blocks","created_at":"2026-01-08T08:34:19.788862-05:00","created_by":"tim"},{"issue_id":"pair_review-tmt7","depends_on_id":"pair_review-roca","type":"blocks","created_at":"2026-01-08T08:34:19.822379-05:00","created_by":"tim"},{"issue_id":"pair_review-tmt7","depends_on_id":"pair_review-v58r","type":"blocks","created_at":"2026-01-08T08:34:19.855897-05:00","created_by":"tim"},{"issue_id":"pair_review-tmt7","depends_on_id":"pair_review-o1mc","type":"blocks","created_at":"2026-01-08T08:34:19.890537-05:00","created_by":"tim"}]}
{"id":"pair_review-toh","title":"Add explicit file list to Level 2/3 analysis prompts","description":"Include the dynamic list of changed files in the analysis prompts for Level 2 and Level 3 analysis to reduce file path hallucinations.\n\nRequirements:\n- Add the list of files from the PR diff to the analysis prompt\n- Include clear instruction: 'suggestions should ONLY reference these files: [list]'\n- Apply to Level 2 (file context) and Level 3 (codebase context) analysis\n- Token cost is minimal since file paths are short strings\n\nThis provides explicit grounding for the AI to check against.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T15:13:50.538205-05:00","created_by":"tim","updated_at":"2026-01-04T15:21:40.06903-05:00","closed_at":"2026-01-04T15:21:40.06903-05:00","close_reason":"Implemented multi-level file path validation"}
{"id":"pair_review-twk1","title":"Introduce analysis_runs table to track run history","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-16T06:01:56.147858-05:00","created_by":"tim","updated_at":"2026-01-16T10:45:41.993169-05:00","closed_at":"2026-01-16T10:45:41.993169-05:00","close_reason":"Implemented analysis_runs table with full tracking of AI analysis runs including provider, model, custom instructions, summary, and status","comments":[{"id":12,"issue_id":"pair_review-twk1","author":"tim","text":"## Summary\n\nThe current data model lacks a proper entity for analysis runs. The ai_run_id is just a string identifier stored on comments, with no dedicated table to track run metadata. This causes several issues:\n\n1. Summary overwrites: Each review only stores one summary (on reviews.summary), so previous summaries are lost\n2. No instruction history: Custom instructions used for each run are not preserved\n3. No provider/model tracking: Which AI provider and model was used for each run is not recorded\n4. No run timestamps: When each analysis was performed is not tracked\n\n## Proposed Solution\n\nCreate an analysis_runs table with: id, review_id, ai_run_id, provider, model, custom_instructions, summary, level (1/2/3), status, created_at, completed_at.\n\n## Benefits\n\n- Full history of all analysis runs per review\n- Can compare summaries across runs\n- Know exactly what instructions/model produced which suggestions\n- Better debugging and auditing capabilities\n- Comments already have ai_run_id so migration is straightforward\n\n## Migration Path\n\n1. Create the new table\n2. Update analyzer to create analysis_runs record before running\n3. Store summary, instructions, provider/model on the run record\n4. Update frontend to show run history if desired\n5. Optionally migrate existing ai_run_id values from comments","created_at":"2026-01-16T11:02:31Z"},{"id":15,"issue_id":"pair_review-twk1","author":"tim","text":"Note: The analysis_runs table would make pr_metadata.last_ai_run_id obsolete. Instead of storing it as a column, query: SELECT ai_run_id FROM analysis_runs WHERE review_id = ? ORDER BY created_at DESC LIMIT 1. This provides the same information plus full history.","created_at":"2026-01-16T11:04:55Z"}]}
{"id":"pair_review-u1x","title":"AI Panel: Depth status shows 'Not started' after analysis completes","description":"The Analysis Depth section shows 'Not started' and all levels as pending (empty circles) even after analysis has completed and findings are displayed. Expected: After analysis completes, depth levels should show as complete (green checkmarks). Root cause: AIPanel.updateDepthStatus() may not be called when findings are loaded from existing analysis.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-30T22:06:52.963202-05:00","updated_at":"2025-12-31T16:42:12.545178-05:00","closed_at":"2025-12-31T16:42:12.545178-05:00"}
{"id":"pair_review-udd","title":"Add programmatic filter for AI suggestions on non-PR files","description":"The orchestrator prompt instructs AI to filter out suggestions for files not in the PR diff, but this relies on AI compliance. Add a post-processing step that programmatically removes any suggestions targeting files not in the actual PR diff list, as a safeguard against Level 2/3 analysis including suggestions from imported files or dependencies.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T21:50:04.748199-05:00","updated_at":"2026-01-04T15:14:05.879582-05:00","closed_at":"2026-01-04T15:14:05.879582-05:00","close_reason":"Covered by pair_review-q61 (database failsafe filter)"}
{"id":"pair_review-uxzh","title":"Local mode should respect .gitattributes and not expand generated files","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-06T20:50:22.216813-05:00","created_by":"tim","updated_at":"2026-01-06T20:50:22.216813-05:00"}
{"id":"pair_review-uz5c","title":"Update AI analysis prompts with line number guidance","description":"Update all analysis prompts to emphasize line number precision and instruct AI to use git-diff-lines.\n\n## Prompts to update\n- `buildLevel1Prompt()` - Level 1 isolated analysis\n- `buildLevel2Prompt()` - Level 2 file context analysis  \n- `buildLevel3Prompt()` - Level 3 codebase context analysis\n- `buildOrchestrationPrompt()` - Final orchestration\n\n## Content to add\n\n### Tool instruction\n```markdown\n## Viewing Code Changes\n\nUse the annotated diff tool instead of git diff directly:\n{scriptPath}\n\nThis shows explicit line numbers in two columns:\n OLD | NEW |\n  10 |  12 |      context line\n  11 |  -- | [-]  deleted line\n  -- |  13 | [+]  added line\n\nAll git diff arguments work: {scriptPath} HEAD~1, {scriptPath} -- src/\n```\n\n### Line placement guidance  \n```markdown\n## Line Number Precision\n\nYour suggestions MUST reference the EXACT line where the issue exists:\n\n1. Be literal, not conceptual\n   - BAD: Commenting on function definition when bug is inside function body\n   - GOOD: Commenting on the specific line with the issue\n\n2. Use correct line numbers\n   - For ADDED lines [+]: use the NEW column number\n   - For CONTEXT lines: use the NEW column number\n   - For DELETED lines [-]: use the OLD column number\n\n3. Verify before suggesting\n   - The annotated diff shows exact line numbers\n   - When uncertain, re-run the tool to confirm\n```\n\n## Implementation\n- Compute absolute path to git-diff-lines at runtime\n- Inject path into prompts via template variable\n- Add guidance sections to each prompt builder","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-08T08:14:32.921978-05:00","created_by":"tim","updated_at":"2026-01-08T09:58:12.276069-05:00","closed_at":"2026-01-08T09:58:12.276069-05:00","close_reason":"Implemented prompt guidance and orchestration integration, all 572 tests passing","dependencies":[{"issue_id":"pair_review-uz5c","depends_on_id":"pair_review-oj6s","type":"blocks","created_at":"2026-01-08T08:14:54.14209-05:00","created_by":"tim"}]}
{"id":"pair_review-v0of","title":"Allow starting local mode with no changes, refresh after changes added","description":"Currently local mode requires uncommitted changes to exist before starting. It would be useful to:\n\n1. Start local mode even when working directory is clean (no changes)\n2. Show empty diff view or helpful message\n3. Allow user to make changes in their editor\n4. Provide refresh button to reload diff after changes are made\n\n## Use Case\nDeveloper wants to start pair-review session, then make changes while getting live feedback. Current workflow requires changes first, then starting the tool.\n\n## Benefits\n- More flexible workflow\n- Allows exploratory coding with AI feedback\n- Better matches natural development flow (start tool, make changes, review)\n\n## Implementation Notes\n- Need to handle empty diff gracefully in UI\n- Refresh mechanism already exists for staleness detection\n- May need to poll or watch for filesystem changes","status":"closed","priority":4,"issue_type":"feature","created_at":"2026-01-07T06:34:44.338537-05:00","created_by":"tim","updated_at":"2026-01-22T14:44:10.767261-05:00","closed_at":"2026-01-22T14:44:10.767261-05:00","close_reason":"Implemented: server now starts with empty working directory, UI shows helpful message"}
{"id":"pair_review-v552","title":"Phase 2: Complete baseline prompts","description":"Migrate all 12 baseline prompts to new architecture.\n\nPrompts to migrate:\n- Level 1: fast, balanced, thorough\n- Level 2: fast, balanced, thorough (balanced done in Phase 1)\n- Level 3: fast, balanced, thorough\n- Orchestration: fast, balanced, thorough\n\nFor each prompt:\n1. Extract from analyzer.js\n2. Convert to tagged format with locked/required/optional sections\n3. Identify tier-specific sections (e.g., confidence-guidance for thorough only)\n4. Add unit tests\n\nReference: docs/architecture/prompt-optimization.md sections 2, 3, 5","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-13T21:05:55.810742-05:00","created_by":"tim","updated_at":"2026-01-14T07:43:38.263744-05:00","closed_at":"2026-01-14T07:43:38.263744-05:00","close_reason":"Phase 2 complete: All 12 baseline prompts migrated to tagged format with full test coverage","dependencies":[{"issue_id":"pair_review-v552","depends_on_id":"pair_review-hoil","type":"blocks","created_at":"2026-01-13T21:06:01.404692-05:00","created_by":"tim"}]}
{"id":"pair_review-v58r","title":"Enhance orchestration with line number validation","description":"Update orchestration to receive file line count information and validate/fix line numbers.\n\n## Changes to orchestration\n\n### Pass line counts to orchestrator\nIn `analyzeAllLevels()`, compute line counts and include in orchestration context:\n```javascript\nconst fileLineCounts = await buildFileLineCountMap(worktreePath, validFiles);\nconst orchestrationResult = await this.orchestrateWithAI(\n  allSuggestions, \n  prMetadata, \n  customInstructions,\n  fileLineCounts  // NEW parameter\n);\n```\n\n### Update orchestration prompt\nAdd to `buildOrchestrationPrompt()`:\n```markdown\n## File Line Counts for Validation\n- src/utils.js: 150 lines\n- src/api/client.js: 89 lines\n\n## Line Number Validation\nVerify each suggestion has valid line numbers:\n- line must be \u003c= file length shown above\n- If a suggestion has valuable insight but invalid line:\n  1. Try to determine correct line from context\n  2. If unable, convert to file-level (set line to null, is_file_level to true)\n  3. Update title to indicate general area (e.g., 'In handleSubmit function: ...')\n```\n\n### Post-orchestration validation\nAfter orchestration returns, run programmatic validation as safety net:\n- Catches anything AI missed\n- Converts remaining invalid suggestions to file-level\n- Logs for debugging\n\n## Testing\n- Test orchestration receives line counts\n- Test orchestration prompt includes file lengths\n- Test invalid suggestions are converted","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-08T08:14:35.561761-05:00","created_by":"tim","updated_at":"2026-01-08T09:58:12.280629-05:00","closed_at":"2026-01-08T09:58:12.280629-05:00","close_reason":"Implemented prompt guidance and orchestration integration, all 572 tests passing","dependencies":[{"issue_id":"pair_review-v58r","depends_on_id":"pair_review-roca","type":"blocks","created_at":"2026-01-08T08:14:54.180705-05:00","created_by":"tim"}]}
{"id":"pair_review-v7u","title":"Repository name styling looks like a link","description":"In the recent reviews table, repository names are styled in blue which makes them look like clickable links. Options:\n\n1. Remove blue color if not a link\n2. Make it an actual link to a future repository page\n3. Use a different color that doesn't imply interactivity","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-12-29T08:05:35.144948-05:00","updated_at":"2025-12-29T08:28:12.109331-05:00","closed_at":"2025-12-29T08:28:12.109331-05:00","dependencies":[{"issue_id":"pair_review-v7u","depends_on_id":"pair_review-jbp","type":"blocks","created_at":"2025-12-29T08:05:54.708069-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-van2","title":"Add AI provider selection to repo settings UI","description":"The repository settings UI currently only shows model selection, but does not allow selecting the AI provider. Users cannot choose between different AI providers (e.g., Claude, OpenAI, etc.) from the settings interface.\n\nCurrent behavior:\n- Only model dropdown/selection is visible in repo settings\n- AI provider selection is missing from the UI\n\nExpected behavior:\n- Show both AI provider and model selection in repo settings\n- Provider selection should come before model selection (since available models depend on the provider)\n- Model dropdown should update based on selected provider\n\nThis is important for users who want to use different AI providers or have configured multiple providers.\n\nRelated files:\n- Settings UI component that renders repo configuration\n- May need to update settings schema/form to include provider field","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-05T18:44:54.632831-05:00","created_by":"tim","updated_at":"2026-01-09T07:21:17.509494-05:00","closed_at":"2026-01-09T07:21:17.509494-05:00","close_reason":"Implemented AI provider selection in repo settings UI. Added provider toggle section before model selection, with dynamic model cards that update when provider changes. Provider selection is persisted to the database alongside model and instructions settings."}
{"id":"pair_review-vdbw","title":"Add LICENSE file to repository","description":"Add an appropriate open source license to the repository. This is required before general release.\n\nNeed to decide on license type (MIT, Apache 2.0, etc.) and create LICENSE file in the repository root.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-08T20:54:49.413972-05:00","created_by":"tim","updated_at":"2026-01-11T14:16:32.162326-05:00","closed_at":"2026-01-11T14:16:32.162326-05:00","close_reason":"Done"}
{"id":"pair_review-vdt2","title":"Add -h/--help CLI options with full documentation","description":"The CLI should support standard -h and --help flags that display comprehensive documentation of all available command-line options. This should include:\n- Usage examples (PR number, PR URL, --local mode)\n- Description of all flags and options\n- Configuration file location and format\n- Port configuration\n- Any other relevant command-line arguments\n\nThis improves discoverability and user experience by following CLI conventions.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-07T06:35:32.505678-05:00","created_by":"tim","updated_at":"2026-01-09T11:24:36.904613-05:00","closed_at":"2026-01-09T11:24:36.904613-05:00","close_reason":"Implemented -h/--help and -v/--version CLI flags with comprehensive documentation. Added printHelp() and printVersion() functions to main.js that display full CLI usage, options, examples, environment variables, and configuration details. Added 20 unit tests covering both parseArgs function and CLI help/version output. Updated README.md with new options in the documentation table."}
{"id":"pair_review-vg3a","title":"Clarify comment status model across AI suggestions and user comments","description":"The comment status model (active, dismissed, adopted, submitted, draft, inactive) has grown organically and the semantics are muddled, particularly around the 'draft' status.\n\n## Current state\n\nIn the **normal UI flow**:\n1. AI suggestions are created with status='active'\n2. User adopts a suggestion → AI suggestion becomes status='adopted', a new user comment is created\n3. User submits a draft review → user comments become status='draft'\n4. The state is: AI suggestions are 'adopted', user comments are 'draft'\n\nIn the **--ai-draft CLI flow**:\n1. AI suggestions are created with status='active'\n2. They're submitted directly to GitHub as a draft review (no user comments created)\n3. AI suggestions become status='draft'\n4. The state is: AI suggestions are 'draft', no user comments exist\n\n## Problems\n\n- 'draft' means different things depending on whether it's on an AI suggestion (submitted directly to GitHub) or a user comment (part of a pending GitHub draft review)\n- The --ai-draft path completely bypasses the adopt→user-comment→submit pipeline, creating a parallel lifecycle\n- The status filter fix (adding 'draft' to API queries) was needed because 'draft' wasn't originally considered a displayable state for AI suggestions\n- It's unclear what should happen if a user opens the web UI after --ai-draft: should they see the suggestions as adopted? as submitted? as something else entirely?\n- The CHECK constraint lists 6 statuses but there's no documentation of the state machine or valid transitions\n\n## Suggested improvements\n\n- Document the intended state machine for each comment source (ai vs user)\n- Consider whether --ai-draft suggestions need a distinct status (e.g. 'submitted') rather than reusing 'draft'\n- Consider whether the two flows (UI adopt-then-submit vs CLI direct-submit) should converge on a shared model\n- Add comments/docs to the schema explaining each status value","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-30T15:22:04.224702-05:00","created_by":"tim","updated_at":"2026-01-30T15:22:04.224702-05:00"}
{"id":"pair_review-vk21","title":"Phase 3: Custom Feature Preservation","description":"## Objective\nRe-implement pair-review custom features on top of @pierre/diffs output.\n\n## Custom Features to Preserve\n\n### Expandable Context Gaps\n- HunkParser.createGapSection() creates expand up/down/all controls\n- Auto-expand for small gaps (\u003c6 lines)\n- Must work between @pierre/diffs rendered hunks\n\n### Generated File Badges\n- DiffRenderer.createFileHeader() with generated badge\n- Collapse/expand toggle for generated files\n- Stats summary (+insertions/-deletions)\n\n### Function Context Headers\n- Hunk headers showing function context (e.g., @@ ... @@ function foo())\n- Headers disappear when function definition becomes visible\n- DiffRenderer.updateFunctionContextVisibility()\n\n### Comment Integration\n- Comment button placement on each line\n- Drag-to-select for multi-line comments\n- CommentManager integration with @pierre/diffs annotations\n\n## Tasks\n- [ ] Implement expandable gaps overlay/injection\n- [ ] Port generated file badge to work with new rendering\n- [ ] Preserve function context header behavior\n- [ ] Integrate CommentManager with @pierre/diffs annotation framework\n- [ ] Implement SuggestionManager (AI suggestions) with annotations\n- [ ] Test multi-line comment range selection\n\n## Acceptance Criteria\n- All expand controls (up/down/all) work correctly\n- Generated files show badge and can collapse/expand\n- Function context headers appear and hide correctly\n- Comments can be added on any line type (insert/delete/context)\n- AI suggestions display inline and can be adopted/discarded\n\n## Estimated Effort\n16-32 hours\n\n## Dependencies\n- Phase 2 must be complete","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-09T07:04:49.577214-05:00","created_by":"tim","updated_at":"2026-01-09T07:04:49.577214-05:00","dependencies":[{"issue_id":"pair_review-vk21","depends_on_id":"pair_review-i6is","type":"blocks","created_at":"2026-01-09T07:04:58.103684-05:00","created_by":"tim"},{"issue_id":"pair_review-vk21","depends_on_id":"pair_review-pquz","type":"parent-child","created_at":"2026-01-09T07:05:04.92321-05:00","created_by":"tim"}]}
{"id":"pair_review-vnb","title":"Reorder segments and default to AI Findings","description":"1. Reorder segments to: AI Findings | Comments | All (move All to last position)\n2. Default selection should be AI Findings, not All\n3. Remember the segment selection in localStorage so it persists across page loads","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T13:36:04.009805-05:00","updated_at":"2026-01-03T13:44:30.978017-05:00","closed_at":"2026-01-03T13:44:30.978017-05:00","dependencies":[{"issue_id":"pair_review-vnb","depends_on_id":"pair_review-epg","type":"blocks","created_at":"2026-01-03T13:36:14.361169-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-w9x","title":"Bug: Adopted/dismissed AI suggestion background too dark in light mode","description":"The background color for adopted and/or dismissed AI suggestions appears too dark in light mode. The gray/dark background seems inconsistent with the light mode color scheme and may reduce readability.\n\nSee attached screenshot showing an adopted suggestion with a notably dark background in what appears to be light mode.\n\nQuestions to investigate:\n- Is this background color intentional for adopted/dismissed states?\n- Should adopted/dismissed suggestions have a different visual treatment?\n- If intentional, reconsider the color choice for better light mode consistency","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-01T12:25:39.068724-05:00","updated_at":"2026-01-01T12:30:13.619833-05:00","closed_at":"2026-01-01T12:30:13.619833-05:00"}
{"id":"pair_review-wa9z","title":"Suggestion blocks not wrapping text, causing wide diff panel and horizontal scrolling","description":"## Problem\nAI suggestion blocks in the diff panel do not wrap long lines of text, causing the entire diff panel to become very wide and requiring horizontal scrolling to read content.\n\n## Expected Behavior\nSuggestion text should wrap within the suggestion block container, maintaining a reasonable panel width.\n\n## Actual Behavior\nLong suggestion text extends horizontally without wrapping, forcing the user to scroll horizontally to read the full content.\n\n## Impact\n- Poor user experience when reviewing suggestions\n- Difficult to compare code and suggestions side-by-side\n- May affect readability of diff content as well\n\n## Investigation Needed\n- Check CSS for suggestion block elements (likely in public/css/styles.css)\n- Look for missing word-wrap, overflow-wrap, or white-space properties\n- Consider whether code blocks within suggestions need different handling than prose","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-23T15:11:02.81096-05:00","created_by":"tim","updated_at":"2026-01-24T08:45:20.832443-05:00","closed_at":"2026-01-24T08:45:20.832443-05:00","close_reason":"Fixed CSS text wrapping by adding overflow:hidden to suggestion/comment cells and containers, word-break:break-word to content blocks, and removing conflicting table-layout:auto rule"}
{"id":"pair_review-weff","title":"terminal logging integration","description":"It would be great if there was a way in the app to also see the logging that is currently sent to the terminal. I wouldn't want this to be too promininent, but a way to see it without switching to the terminal would be information. Either a button to pull up this streaming output, or a small view at the bottom of the window, that could be clicked to see the full stream. Frontend-design should be consulted for this.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T06:48:38.273069-05:00","created_by":"tim","updated_at":"2026-01-10T06:48:38.273069-05:00"}
{"id":"pair_review-wf8f","title":"Investigate Gemini using echo to output JSON responses","description":"## Problem\nGemini is attempting to use `echo` shell command to output its JSON analysis response:\n```\nError executing tool run_shell_command: Command \"echo '{\"level\": 3, \"suggestions\": [...]}'\" is not in the list of allowed tools\n```\n\n## Expected behavior\nGemini should output JSON directly to stdout, not via shell commands.\n\n## Possible causes\n1. Prompt confusion about how to return results\n2. Gemini CLI tool use vs response output misunderstanding\n3. Missing guidance in prompts about direct JSON output\n\n## Notes\n- Adding `echo` to allowed tools is risky due to potential file redirect abuse\n- The prompts do specify `**\u003e\u003e\u003e CRITICAL: Output ONLY valid JSON \u003c\u003c\u003c**` but Gemini may be interpreting this as needing to execute output\n- May need Gemini-specific guidance about response delivery\n\n## Related\nReview the Gemini prompt variants and baseline guidance for output instructions.","status":"open","priority":3,"issue_type":"bug","created_at":"2026-01-22T10:33:13.642426-05:00","created_by":"tim","updated_at":"2026-01-22T10:33:13.642426-05:00"}
{"id":"pair_review-wkt5","title":"Bug: Clear all user comments removes dismissed comments from display instead of updating them","description":"When dismissed user comments are currently displayed in the review panel and 'Clear all' is used for user comments:\n\n**Current behavior:** The user comments disappear entirely from the review panel.\n\n**Expected behavior:** The displayed comments should update to show their dismissed state (similar to how individual comment dismissal works), not be removed from the display.\n\n**To investigate:**\n- How Clear all handles the DOM update vs individual dismissal\n- Whether the filter/display logic needs to re-render dismissed comments after bulk clear\n- The difference between removing comments from display vs updating their visual state to dismissed","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-22T06:45:33.510172-05:00","created_by":"tim","updated_at":"2026-01-22T13:00:49.284422-05:00","closed_at":"2026-01-22T13:00:49.284422-05:00","close_reason":"Fixed clearAllUserComments to reload comments via loadUserComments() instead of clearing with setComments([]). Added 4 E2E tests for bulk deletion flow."}
{"id":"pair_review-wr0","title":"Expanded context comments fail GitHub API submission","description":"Comments on expanded context lines (lines revealed by clicking 'show more' but outside diff hunks) fail with 'Line could not be resolved' error from GitHub API. The same action works in GitHub's web UI, suggesting either: (1) GitHub uses a different API/GraphQL, (2) There's additional parameters needed, or (3) Web UI has special handling. Need to investigate how GitHub's web UI submits these comments.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-01T08:54:23.535277-05:00","updated_at":"2026-01-01T10:18:17.472136-05:00","closed_at":"2026-01-01T10:18:17.472136-05:00"}
{"id":"pair_review-wtog","title":"Phase 4: Provider variants","description":"Generate optimized prompt variants for non-Claude providers.\n\nProviders:\n1. Google (Gemini Flash, Pro, Ultra)\n2. OpenAI (GPT-4o-mini, GPT-4o, o1/o3)\n\nProcess for each:\n1. Run optimization tool with target model\n2. Extract overrides via Claude agent\n3. Validate variant integrity\n4. Test with real reviews\n5. Document provider-specific notes\n\nReference: docs/architecture/prompt-optimization.md sections 6, 12","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-13T21:05:56.206393-05:00","created_by":"tim","updated_at":"2026-01-13T21:05:56.206393-05:00","dependencies":[{"issue_id":"pair_review-wtog","depends_on_id":"pair_review-oh6a","type":"blocks","created_at":"2026-01-13T21:06:01.479175-05:00","created_by":"tim"}]}
{"id":"pair_review-x12","title":"E2E tests for AI analysis flow","description":"Test the core AI analysis workflow - triggering analysis, progress modal, AI suggestions in AIPanel, level filtering (L1/L2/L3/Final), adopt/edit/discard actions, SuggestionNavigator, segment control","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:09:45.782377-05:00","created_by":"tim","updated_at":"2026-01-05T07:32:50.650354-05:00","closed_at":"2026-01-05T07:32:50.650354-05:00","close_reason":"Implemented comprehensive e2e tests for AI analysis flow. Created tests/e2e/ai-analysis.spec.js with 35 tests covering: AI Analysis Button, Progress Modal, AI Panel, Segment Control, AI Suggestions Display, Suggestion Actions, Suggestion Navigation, Level Filtering, SuggestionNavigator Sidebar, and API Integration."}
{"id":"pair_review-xelv","title":"Unify PR and Local modes into single diff/review page with injected providers","description":"Currently local.js uses monkey-patching to override PRManager methods for Local mode, which is fragile and hard to maintain.\n\n## Current Problem\n- local.js monkey-patches PRManager methods (saveViewedState, loadViewedState, init, loadPR, etc.)\n- Mode-specific behavior is determined at runtime through conditionals and overrides\n- This approach makes the code harder to reason about and test\n- Adding new features requires changes in multiple places with careful consideration of both modes\n\n## Desired State\n- Single unified diff/review page component\n- Clean provider/adapter pattern for mode-specific behaviors (data fetching, state persistence, submission)\n- PRProvider: fetches from GitHub API, persists to database, submits reviews to GitHub\n- LocalProvider: fetches from local git diff, persists to localStorage, exports feedback to clipboard/file\n- Shared UI components and rendering logic\n- Mode determined at initialization, not through runtime monkey-patching\n\n## Benefits\n- Cleaner separation of concerns\n- Easier to add new modes (e.g., direct git diff mode, GitLab support)\n- More testable architecture\n- Reduced code duplication","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-09T22:07:51.60089-05:00","created_by":"tim","updated_at":"2026-01-09T22:07:51.60089-05:00"}
{"id":"pair_review-xigl","title":"Add tests for /api/file-content-original endpoint (PR and Local modes)","description":"The /api/file-content-original endpoint has NO test coverage for either PR mode or the newly added Local mode. This endpoint handles context expansion when viewing diffs.\n\n## Integration Tests Needed (routes.test.js)\n\n### Local Mode Tests (owner='local')\n1. Should detect owner='local' and use review ID instead of PR params\n2. Should return 400 for invalid/negative/zero review ID\n3. Should return 404 when local review not found\n4. Should return 404 when review exists but local_path is NULL\n5. Should return file content from local repository for valid request\n6. Should return 404 for non-existent file in local repo\n7. Should return 400 for path traversal attempts (security)\n8. Should return 400 when path is a directory\n\n### PR Mode Tests\n1. Should return file content from worktree for valid request\n2. Should return 400 when owner/repo/number missing\n3. Should return 400 for invalid PR number (non-numeric, negative, zero)\n4. Should return 404 when worktree doesn't exist\n5. Should handle URL-encoded file names correctly\n6. Should return 400 for path traversal attempts (security)\n7. Should return 404 for non-existent file\n8. Should return 400 when path is a directory\n\n## Database Tests Needed (database.test.js)\n\nTests for ReviewRepository.getLocalReviewById():\n1. Should retrieve local review by ID with all fields\n2. Should return null for non-existent review\n3. Should return null if review_type != 'local'\n4. Should include local_path and local_head_sha fields\n\n## E2E Tests (Optional)\n\nContext expansion user flows:\n1. Click to expand context shows additional lines\n2. Error handling when file content fails to load\n3. Local mode context expansion works correctly\n\nEstimate: ~50 test cases, ~800-1000 lines of test code","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T20:55:00.208727-05:00","created_by":"tim","updated_at":"2026-01-06T21:05:44.428492-05:00","closed_at":"2026-01-06T21:05:44.428492-05:00","close_reason":"Added 31 tests covering: Local mode (9 tests), PR mode (15 tests), and getLocalReviewById database method (7 tests). All tests passing."}
{"id":"pair_review-xjap","title":"Make SplitButton default action (Preview/Submit) sticky via localStorage","description":"The SplitButton component allows users to switch between Preview and Submit Review as the primary action, but this preference is not persisted.\n\n**Current behavior**: Default action is set per-session based on mode (PR mode defaults to Submit, Local mode defaults to Preview). When user selects the other action from dropdown, it becomes the new default for that session only.\n\n**Expected behavior**: The last-used action should be stored in localStorage and restored on page load, so user's preference persists across sessions.\n\n**Implementation notes**:\n- The `onSetDefault` callback exists but isn't wired up to localStorage\n- Should be global (not scoped per-review) since it's a user preference\n- Local mode should continue to always default to Preview (Submit is hidden)\n- Storage key suggestion: `pair-review-split-button-default-action`\n\nSee: public/js/components/SplitButton.js","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-21T12:01:24.899613-05:00","created_by":"tim","updated_at":"2026-01-21T12:28:48.198547-05:00","closed_at":"2026-01-21T12:28:48.198547-05:00","close_reason":"Added localStorage persistence to SplitButton. User's preferred action (Preview/Submit) now persists across sessions in PR mode. Local mode continues to always default to Preview."}
{"id":"pair_review-xkvf","title":"Add timeout guard to Gemini/Copilot/Codex/Cursor testAvailability","status":"open","priority":4,"issue_type":"task","created_at":"2026-02-07T13:51:22.693985-05:00","created_by":"tim","updated_at":"2026-02-07T13:51:22.693985-05:00"}
{"id":"pair_review-xnnw","title":"Support GITHUB_TOKEN from environment variable","description":"Allow users to provide GitHub token via GITHUB_TOKEN environment variable as an alternative to the config file.\n\nPriority order should be:\n1. GITHUB_TOKEN environment variable (highest priority)\n2. ~/.pair-review/config.json github_token field\n\nThis is more convenient for CI/CD environments and users who prefer environment variables. Many GitHub tools follow this convention.\n\nImplementation:\n- Check process.env.GITHUB_TOKEN first\n- Fall back to config file if not set\n- Update documentation to mention both options","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-09T06:37:44.434553-05:00","created_by":"tim","updated_at":"2026-01-10T20:02:31.058996-05:00","closed_at":"2026-01-10T20:02:31.058996-05:00","close_reason":"Implemented GITHUB_TOKEN environment variable support. The env var takes precedence over the config file's github_token field. Added getGitHubToken() function in config.js, updated main.js and server.js to use it, updated CLI help and --configure documentation, added comprehensive unit tests (8 new tests), and updated README. All 801 tests pass."}
{"id":"pair_review-xq3b","title":"PR URL pasted into index page not recognized for previously reviewed PRs","description":"When a GitHub PR URL is pasted into the index page for a PR that was previously reviewed, the application does not recognize it and fails to open the existing review. Expected behavior: pasting a URL for a previously reviewed PR should navigate to or open that previous review session.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-21T14:53:44.181431-05:00","created_by":"tim","updated_at":"2026-01-21T15:47:46.648157-05:00","closed_at":"2026-01-21T15:47:46.648157-05:00","close_reason":"Fixed case-sensitive repository matching. Added normalizeRepository() to lowercase owner/repo for consistent DB lookups."}
{"id":"pair_review-xsh","title":"AI analyzer: Handle local review metadata","description":"Adapt AI analyzer to work with local review context.\n\n## Changes to src/ai/analyzer.js\n\n### Metadata Handling\nFor local reviews, construct metadata object:\n```javascript\nconst localMetadata = {\n  title: `Local changes in ${repoName}`,\n  description: '', // Empty - no PR description equivalent\n  base_branch: currentBranch,\n  head_branch: currentBranch, // Same for local changes\n};\n```\n\n### Analysis Context\n- Level 1: Works unchanged (analyzes diff in isolation)\n- Level 2: Works unchanged (file context from filesystem)\n- Level 3: Works unchanged (codebase context from filesystem)\n\n### Notes\n- Analyzer already works with abstract prId and metadata\n- Minimal changes expected - just different metadata values\n- Consider: Should prompts mention 'local changes' vs 'PR changes'?","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T09:00:22.89303-05:00","created_by":"tim","updated_at":"2026-01-04T09:27:13.65521-05:00","closed_at":"2026-01-04T09:27:13.65521-05:00","close_reason":"Implementation complete, all 183 tests pass","dependencies":[{"issue_id":"pair_review-xsh","depends_on_id":"pair_review-8h3","type":"blocks","created_at":"2026-01-04T09:00:35.273688-05:00","created_by":"tim"},{"issue_id":"pair_review-xsh","depends_on_id":"pair_review-ba1","type":"blocks","created_at":"2026-01-04T09:00:36.681083-05:00","created_by":"tim"}]}
{"id":"pair_review-y15","title":"Settings icon blue color looks out of place - should use amber to match theme","description":"The settings gear icon in the toolbar uses a blue/purple color that doesn't match the rest of the application's visual theme. The amber/orange color used for the AI Analysis sparkle icon would be more consistent with the overall design language. The icon stands out as visually inconsistent with the neutral grays and amber accents used elsewhere in the UI.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T08:09:54.508394-05:00","updated_at":"2026-01-02T08:13:03.702304-05:00","closed_at":"2026-01-02T08:13:03.702304-05:00"}
{"id":"pair_review-y2q","title":"Add user config overrides for AI provider models","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-03T19:57:47.943363-05:00","updated_at":"2026-01-03T19:57:47.943363-05:00"}
{"id":"pair_review-y8v","title":"Write API route tests for core PR endpoints","description":"Create integration tests for the main API routes in src/routes/pr.js. Focus on: PR fetch/refresh, comments CRUD, AI suggestions endpoints, review submission. Use supertest for HTTP testing with mock database.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T22:05:27.526744-05:00","updated_at":"2026-01-02T22:45:17.103965-05:00","closed_at":"2026-01-02T22:45:17.103965-05:00","dependencies":[{"issue_id":"pair_review-y8v","depends_on_id":"pair_review-70n","type":"blocks","created_at":"2026-01-02T22:05:43.098858-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-yta","title":"Avoid re-suggesting dismissed AI suggestions on re-review","description":"When an AI suggestion is dismissed by the user, the system should remember this and avoid suggesting the same or very similar feedback on subsequent analysis runs. Implementation approaches to consider:\n\n1. **Embedding similarity**: Calculate embeddings for dismissed suggestions, compare new suggestions against them using cosine similarity, filter out matches above threshold\n2. **LLM comparison**: Pass dismissed suggestions as context to the AI and instruct it not to repeat similar feedback\n\nTrade-offs:\n- Embeddings: Faster, more deterministic, requires embedding model/API\n- LLM: Simpler implementation (just prompt engineering), but uses more tokens and may be less reliable\n\nRequires persisting dismissed suggestions (already tracked via status) and their content for comparison.","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-31T21:21:15.893355-05:00","updated_at":"2026-01-08T20:55:21.315499-05:00"}
{"id":"pair_review-yzro","title":"Evaluate removing Level 3 analysis for fast tier","description":"Evaluate whether Level 3 (codebase context analysis) should be removed for the fast tier.\n\n## Background\nLevel 3 requires:\n- Multi-step tool use to explore the codebase\n- Understanding architectural patterns across files\n- Cross-file dependency reasoning\n\nFast models like Haiku excel at speed and following straightforward instructions, but struggle with exactly what Level 3 demands. The concern is that Level 3 fast produces low-quality results that are worse than no Level 3 at all.\n\n## Questions to Resolve\n1. What happens in the UI/workflow when Level 3 is unavailable for a tier?\n2. Does the orchestration stage handle missing Level 3 input gracefully?\n3. Should fast tier users get Levels 1+2 only, with clear messaging?\n4. Are there fast models (future or current) that could handle Level 3 adequately?\n\n## Potential Changes\n- Remove src/ai/prompts/baseline/level3/fast.js\n- Update prompts/index.js to return null for level3+fast\n- Update analyzer.js to skip Level 3 for fast tier\n- Update UI to indicate Level 3 not available for fast tier\n- Update documentation\n\n## Alternative\nKeep Level 3 fast but document it as \"experimental/limited\" with clear expectations.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-14T21:33:23.709004-05:00","created_by":"tim","updated_at":"2026-02-05T07:13:42.639847-05:00","closed_at":"2026-02-05T07:13:42.639847-05:00","close_reason":"done"}
{"id":"pair_review-z1do","title":"File-Level Comments Support","description":"Enable file-level comments throughout the review workflow. This includes user-created file comments, AI suggestions at the file level, GitHub submission, and preview display.\n\n## Overview\nFile-level comments are observations about an entire file rather than specific lines. Use cases:\n- Architectural suggestions (e.g., \"consider splitting this file\")\n- Naming/organization feedback\n- Missing tests or documentation\n- High-level praise for well-structured code\n\n## Scope\n1. **Data Model**: Add is_file_level flag to comments schema\n2. **Backend API**: Endpoints for creating/retrieving file-level comments\n3. **Frontend UI**: File header comment zone with add/display/manage functionality\n4. **AI Integration**: Enable AI analyzer to produce file-level suggestions\n5. **GitHub Submission**: Include file-level comments in review submission\n6. **Preview Modal**: Display file-level comments in review preview\n\n## Design Reference\nSee design-refresh/file-level-comments.html for the approved UI component design.\n\n## Dependencies\n- Existing comment infrastructure (line-level comments work correctly)\n- GraphQL GitHub client (already supports file-level via subjectType: FILE)","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-05T14:44:07.917612-05:00","created_by":"tim","updated_at":"2026-01-05T15:11:25.279486-05:00","closed_at":"2026-01-05T15:11:25.279486-05:00","close_reason":"All sub-tasks completed: schema, backend API, AI analyzer, frontend UI, GitHub submission, preview modal"}
{"id":"pair_review-z1do.1","title":"Add is_file_level column to comments schema","description":"Add database schema support for file-level comments.\n\n## Changes Required\n1. Add `is_file_level BOOLEAN DEFAULT 0` column to comments table\n2. Add migration to alter existing table\n3. Add index for `(pr_id, file, is_file_level)` for efficient queries\n4. Update comment retrieval queries to include new column\n\n## Acceptance Criteria\n- [ ] Migration runs cleanly on existing databases\n- [ ] Existing comments default to is_file_level=0\n- [ ] Index improves query performance for file-level filtering\n\n## Files to Modify\n- src/database.js","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T14:44:27.932724-05:00","created_by":"tim","updated_at":"2026-01-05T14:57:25.806677-05:00","closed_at":"2026-01-05T14:57:25.806677-05:00","close_reason":"Schema migration complete: added is_file_level column and index","dependencies":[{"issue_id":"pair_review-z1do.1","depends_on_id":"pair_review-z1do","type":"parent-child","created_at":"2026-01-05T14:44:27.935676-05:00","created_by":"tim"}]}
{"id":"pair_review-z1do.2","title":"Backend API for file-level comments","description":"Add API endpoints for creating and retrieving file-level comments.\n\n## New Endpoints\n1. `POST /api/file-comment` - Create a file-level user comment\n   - Body: { pr_id, file, body, commit_sha }\n   - Sets is_file_level=1, line_start/line_end/diff_position=NULL\n\n2. Update `GET /api/pr/:owner/:repo/:number/comments` to include file-level comments\n   - Add query param `include_file_level=true` (default true)\n   - Return is_file_level flag in response\n\n## Acceptance Criteria\n- [ ] Can create file-level comment via API\n- [ ] File-level comments retrieved with other comments\n- [ ] Validation prevents file-level comments with line numbers\n- [ ] Edit/delete work the same as line-level comments\n\n## Files to Modify\n- src/routes/comments.js\n- src/routes/pr.js","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T14:44:29.241612-05:00","created_by":"tim","updated_at":"2026-01-05T15:03:05.034426-05:00","closed_at":"2026-01-05T15:03:05.034426-05:00","close_reason":"Implementation complete with tests","dependencies":[{"issue_id":"pair_review-z1do.2","depends_on_id":"pair_review-z1do","type":"parent-child","created_at":"2026-01-05T14:44:29.243612-05:00","created_by":"tim"},{"issue_id":"pair_review-z1do.2","depends_on_id":"pair_review-z1do","type":"blocks","created_at":"2026-01-05T14:44:29.245258-05:00","created_by":"tim"},{"issue_id":"pair_review-z1do.2","depends_on_id":"pair_review-z1do.1","type":"blocks","created_at":"2026-01-05T14:45:02.508314-05:00","created_by":"tim"}]}
{"id":"pair_review-z1do.3","title":"Frontend UI for file-level comments","description":"Implement the file-level comments UI component in the PR review page.\n\n## UI Components (see design-refresh/file-level-comments.html)\n1. **File Comments Zone** - Collapsible section between file header and diff\n   - Toggle button with comment count badge\n   - \"Add comment\" button\n   - Container for comment cards\n\n2. **File Comment Card** - Display individual file-level comments\n   - Source badge (AI/User)\n   - Author, timestamp, type tag\n   - Comment body\n   - Actions (edit/delete for user, adopt/dismiss for AI)\n\n3. **Comment Form** - Inline form for adding new comments\n   - Textarea with placeholder\n   - Cancel/Submit buttons\n\n4. **Header Indicator** - Shows count when zone is collapsed\n\n## Integration Points\n- Wire \"Add comment\" to POST /api/file-comment\n- Wire \"Adopt\" to existing adoption flow\n- Integrate with comment-manager.js patterns\n\n## Acceptance Criteria\n- [ ] Can add file-level comments from UI\n- [ ] Comments display correctly in zone\n- [ ] Zone collapses/expands smoothly\n- [ ] Count badge updates dynamically\n- [ ] Works in both light and dark themes\n\n## Files to Modify\n- public/pr.html\n- public/js/modules/comment-manager.js\n- public/css/pr.css","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T14:44:30.654482-05:00","created_by":"tim","updated_at":"2026-01-05T15:09:54.609947-05:00","closed_at":"2026-01-05T15:09:54.609947-05:00","close_reason":"Implementation complete with tests","dependencies":[{"issue_id":"pair_review-z1do.3","depends_on_id":"pair_review-z1do","type":"parent-child","created_at":"2026-01-05T14:44:30.656461-05:00","created_by":"tim"},{"issue_id":"pair_review-z1do.3","depends_on_id":"pair_review-z1do","type":"blocks","created_at":"2026-01-05T14:44:30.657391-05:00","created_by":"tim"},{"issue_id":"pair_review-z1do.3","depends_on_id":"pair_review-z1do.2","type":"blocks","created_at":"2026-01-05T14:45:02.534843-05:00","created_by":"tim"}]}
{"id":"pair_review-z1do.4","title":"AI analyzer support for file-level suggestions","description":"Enable the AI analyzer to produce file-level suggestions in addition to line-level ones.\n\n## Prompt Changes\nUpdate analysis prompts to request file-level observations:\n- Level 2 (file context): Can now suggest file-level concerns\n- Level 3 (codebase context): Primary source of architectural file-level suggestions\n\n## Output Schema Changes\nAllow suggestions without line numbers:\n\\`\\`\\`json\n{\n  \"file\": \"src/components/Auth.tsx\",\n  \"is_file_level\": true,\n  \"type\": \"refactor\",\n  \"title\": \"Consider splitting authentication concerns\",\n  \"description\": \"This file handles both OAuth and session management...\"\n}\n\\`\\`\\`\n\n## Storage Changes\n- Set is_file_level=1 when storing suggestions without line numbers\n- Ensure retrieval includes file-level AI suggestions\n\n## Acceptance Criteria\n- [ ] AI can produce file-level suggestions\n- [ ] Suggestions stored with is_file_level=1\n- [ ] File-level suggestions appear in AI suggestions API\n- [ ] Types: praise, issue, refactor, suggestion work at file level\n\n## Files to Modify\n- src/ai/analyzer.js\n- src/ai/prompts/ (if separate prompt files exist)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T14:44:52.044038-05:00","created_by":"tim","updated_at":"2026-01-05T15:03:05.036364-05:00","closed_at":"2026-01-05T15:03:05.036364-05:00","close_reason":"Implementation complete with tests","dependencies":[{"issue_id":"pair_review-z1do.4","depends_on_id":"pair_review-z1do","type":"parent-child","created_at":"2026-01-05T14:44:52.052757-05:00","created_by":"tim"},{"issue_id":"pair_review-z1do.4","depends_on_id":"pair_review-z1do","type":"blocks","created_at":"2026-01-05T14:44:52.054444-05:00","created_by":"tim"},{"issue_id":"pair_review-z1do.4","depends_on_id":"pair_review-z1do.1","type":"blocks","created_at":"2026-01-05T14:45:02.560171-05:00","created_by":"tim"}]}
{"id":"pair_review-z1do.5","title":"GitHub submission of file-level comments","description":"Include file-level comments when submitting reviews to GitHub.\n\n## GitHub API Support\nThe GraphQL API already supports file-level comments via subjectType: FILE.\nSee src/github/client.js submitReviewGraphQL function.\n\n## Changes Required\n1. Separate comments by type during submission:\n   - Line-level: existing flow with line/side\n   - File-level: use subjectType: FILE, omit line/side\n\n2. Update addPullRequestReviewThread mutation call:\n\\`\\`\\`javascript\n// For file-level comments:\n{\n  path: 'src/file.js',\n  subjectType: 'FILE',\n  body: 'comment text'\n}\n\\`\\`\\`\n\n## Acceptance Criteria\n- [ ] File-level comments submitted to GitHub correctly\n- [ ] Line-level comments still work as before\n- [ ] Mixed reviews (both types) submit successfully\n- [ ] Comments appear on GitHub PR in file header area\n\n## Files to Modify\n- src/github/client.js\n- src/routes/pr.js (review submission endpoint)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T14:44:53.496215-05:00","created_by":"tim","updated_at":"2026-01-05T15:09:54.611811-05:00","closed_at":"2026-01-05T15:09:54.611811-05:00","close_reason":"Implementation complete with tests","dependencies":[{"issue_id":"pair_review-z1do.5","depends_on_id":"pair_review-z1do","type":"parent-child","created_at":"2026-01-05T14:44:53.498261-05:00","created_by":"tim"},{"issue_id":"pair_review-z1do.5","depends_on_id":"pair_review-z1do","type":"blocks","created_at":"2026-01-05T14:44:53.499219-05:00","created_by":"tim"},{"issue_id":"pair_review-z1do.5","depends_on_id":"pair_review-z1do.2","type":"blocks","created_at":"2026-01-05T14:45:02.584509-05:00","created_by":"tim"}]}
{"id":"pair_review-z1do.6","title":"Preview modal file-level comment display","description":"Display file-level comments in the review preview modal.\n\n## Current Behavior\nPreviewModal.js shows line-level comments grouped by file with line numbers.\n\n## Required Changes\n1. Group file-level comments separately at top of each file section\n2. Visual distinction: \"File comment\" label instead of line number\n3. Include in \"Copy to Clipboard\" text output\n4. Count in total comments display\n\n## Preview Format\n\\`\\`\\`\n## src/components/Auth.tsx\n### File Comments\n- Consider splitting authentication concerns...\n\n### Line Comments\n- Line 42: This function should validate input...\n\\`\\`\\`\n\n## Acceptance Criteria\n- [ ] File-level comments appear in preview\n- [ ] Clear visual distinction from line comments\n- [ ] Included in clipboard copy\n- [ ] Included in comment count\n\n## Files to Modify\n- public/js/components/PreviewModal.js\n- public/css/pr.css (if new styles needed)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T14:44:54.675502-05:00","created_by":"tim","updated_at":"2026-01-05T15:11:15.779066-05:00","closed_at":"2026-01-05T15:11:15.779066-05:00","close_reason":"Preview modal now displays file-level comments","dependencies":[{"issue_id":"pair_review-z1do.6","depends_on_id":"pair_review-z1do","type":"parent-child","created_at":"2026-01-05T14:44:54.677432-05:00","created_by":"tim"},{"issue_id":"pair_review-z1do.6","depends_on_id":"pair_review-z1do","type":"blocks","created_at":"2026-01-05T14:44:54.67862-05:00","created_by":"tim"},{"issue_id":"pair_review-z1do.6","depends_on_id":"pair_review-z1do.3","type":"blocks","created_at":"2026-01-05T14:45:02.608567-05:00","created_by":"tim"}]}
{"id":"pair_review-z20h","title":"Migrate console.log/error to logger in src/routes/pr.js","description":"The file src/routes/pr.js has inconsistent logging - 19+ console.* calls and 9+ logger.* calls. Migrate remaining console.log/error calls to use the logger module for consistent log level management. Low priority cleanup task identified during PR #120 review.","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-28T07:42:56.705282-05:00","created_by":"tim","updated_at":"2026-01-28T07:43:04.951804-05:00"}
{"id":"pair_review-z4fj","title":"Fix incorrect syntax highlighting in diff view","description":"Syntax highlighting appears incorrect in the diff view. Code tokens are not being properly highlighted - keywords, method calls, and symbols are not receiving appropriate syntax coloring.\n\nThis affects readability of code in the diff view and makes it harder to quickly scan and understand changes.\n\nExample: Ruby code showing conditional logic with method calls and feature flags is not properly highlighted with distinct colors for keywords, method names, strings, and operators.\n\nRelated files:\n- public/js/modules/diff-renderer.js (likely handles syntax highlighting)\n- May need to integrate or fix a syntax highlighting library","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-05T14:52:48.784219-05:00","created_by":"tim","updated_at":"2026-01-13T20:52:16.626864-05:00","closed_at":"2026-01-13T20:52:16.626864-05:00","close_reason":"Wait for a reproducible example"}
{"id":"pair_review-zlh","title":"Add border/outline to segment control","description":"Segment control needs clearer visual distinction. Add a faint outline/border around the segments to make them more clearly delineated as separate options.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T13:36:03.983274-05:00","updated_at":"2026-01-03T13:44:30.979269-05:00","closed_at":"2026-01-03T13:44:30.979269-05:00","dependencies":[{"issue_id":"pair_review-zlh","depends_on_id":"pair_review-epg","type":"blocks","created_at":"2026-01-03T13:36:14.338823-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-zm4q","title":"AI suggestions not displayed for renamed files","description":"## Bug Description\n\nWhen a file is renamed in a PR, AI suggestions targeting the new filename cannot be displayed because the file's identifier in the diff view uses the rename syntax (e.g. `tests/unit/{suggestion-manager-getfileandlineinfo.test.js =\u003e suggestion-manager.test.js}`) rather than the plain new filename (`tests/unit/suggestion-manager.test.js`).\n\n## Steps to Reproduce\n1. Open a PR that includes a renamed file (e.g. PR #122)\n2. Have AI generate suggestions for lines in the renamed file\n3. Observe that suggestions are not inserted into the diff view\n\n## Expected Behavior\nAI suggestions should be matched and displayed against the new filename of a renamed file.\n\n## Actual Behavior\nThe suggestion lookup fails because the file identifier in the DOM uses the git rename format `{old =\u003e new}` which does not match the plain new filename the suggestion targets.\n\n## Example\nURL: http://localhost:3001/pr/in-the-loop-labs/pair-review/122#tests/unit/{suggestion-manager-getfileandlineinfo.test.js%20=%3E%20suggestion-manager.test.js}\n\nThe file is identified as `tests/unit/{suggestion-manager-getfileandlineinfo.test.js =\u003e suggestion-manager.test.js}` but suggestions reference `tests/unit/suggestion-manager.test.js`.\n\n## Likely Fix\nWhen matching suggestion filenames to diff files, resolve the rename syntax to the new filename before comparison.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-28T20:52:40.102415-05:00","created_by":"tim","updated_at":"2026-01-28T21:36:10.277229-05:00","closed_at":"2026-01-28T21:36:10.277229-05:00","close_reason":"Fixed by resolving git rename syntax in both frontend findFileElement() and backend validateSuggestionFilePaths()/storeSuggestions()"}
{"id":"pair_review-zys","title":"Show dialog when analysis completes with zero suggestions","description":"When AI analysis completes successfully but finds zero suggestions, show a dialog informing the user. This is often a positive outcome (e.g., when reviewing only for blockers or specific issues). The dialog should celebrate the clean result rather than leave the user wondering if something went wrong.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-03T21:31:47.489332-05:00","updated_at":"2026-01-11T14:16:59.319999-05:00","closed_at":"2026-01-11T14:16:59.319999-05:00","close_reason":"Primarily covered by exposing the analysis summary"}
