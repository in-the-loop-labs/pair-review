{"id":"pair_review-0ed","title":"Persist side panel expanded/collapsed state in localStorage","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T17:33:11.400722-05:00","updated_at":"2025-12-31T17:53:53.039731-05:00","closed_at":"2025-12-31T17:53:53.039731-05:00"}
{"id":"pair_review-0fh","title":"Remove worktree_path from pr_data JSON","description":"Worktree path is stored in both worktrees table and pr_data JSON. Remove duplication - worktrees table is source of truth.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-29T09:20:02.446966-05:00","updated_at":"2025-12-29T09:20:02.446966-05:00"}
{"id":"pair_review-0l0","title":"UI: Repo settings page for default instructions","description":"Create a settings page for each repo where users can configure default analysis instructions. These instructions will apply to all PRs in the repo unless overridden by PR-specific instructions. Page should have a form with textarea for instructions and save functionality.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T18:26:07.266194-05:00","updated_at":"2026-01-01T14:28:01.899024-05:00","closed_at":"2026-01-01T14:28:01.899024-05:00","dependencies":[{"issue_id":"pair_review-0l0","depends_on_id":"pair_review-f8b","type":"blocks","created_at":"2025-12-31T18:26:22.38828-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-0l0","depends_on_id":"pair_review-3o2","type":"blocks","created_at":"2025-12-31T18:26:24.687176-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-0oj","title":"Auto-cleanup stale worktrees on server start","description":"## Problem\nWorktrees accumulate on disk and are never cleaned up automatically.\n\n## Solution\nOn server startup, asynchronously clean up worktrees not accessed within retention period.\n\n## Implementation\n1. Add config option: `worktree_retention_days` (default: 7)\n2. Add `WorktreeManager.cleanupStaleWorktrees()` method:\n   - Query DB for worktrees where `last_accessed_at \u003c (now - retention_days)`\n   - For each stale worktree:\n     - Run `git worktree remove --force {path}`\n     - Delete directory if remove fails\n     - Delete DB record\n   - Log to console: \"Cleaned up N stale worktrees\"\n3. Call cleanup async after server starts (don't block startup)\n4. Add `git worktree prune` call to clean orphaned registrations\n\n## Logging\n- Console log only (silent to user)\n- Format: `[pair-review] Cleaned up 3 stale worktrees (older than 7 days)`\n\n## Dependencies\n- Requires worktrees database table (pair_review-452)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T15:56:21.67418-05:00","updated_at":"2025-12-28T16:29:09.862917-05:00","closed_at":"2025-12-28T16:29:09.862917-05:00","dependencies":[{"issue_id":"pair_review-0oj","depends_on_id":"pair_review-452","type":"blocks","created_at":"2025-12-28T15:56:34.986646-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-0oj","depends_on_id":"pair_review-e4k","type":"blocks","created_at":"2025-12-28T15:56:43.516493-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-11e","title":"Praise suggestions: Style with purple theme","description":"Update praise/positive suggestions to match prototype:\n- Purple left border instead of amber\n- Star icon\n- 'Nice Work' label instead of type badge\n- Purple-tinted gradient header\nFiles: public/js/pr.js, public/css/pr.css","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T21:04:40.853145-05:00","updated_at":"2025-12-30T21:47:11.773098-05:00","closed_at":"2025-12-30T21:47:11.773098-05:00","dependencies":[{"issue_id":"pair_review-11e","depends_on_id":"pair_review-1mp","type":"blocks","created_at":"2025-12-30T21:05:05.479866-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-11v","title":"AI suggestions sidebar disappears when empty","description":"this may be fixed by other issues, but this sidebar should never entirely disappear. It makes viewing level-specific suggestions invisible","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T09:19:20.418582-05:00","updated_at":"2025-12-27T09:19:20.418582-05:00"}
{"id":"pair_review-12o","title":"Bug: Adopted AI suggestions incorrectly show expanded content warning","description":"Adopted AI suggestions are displaying the 'expanded content' file comment warning even when the comment is on a line that is part of the original diff hunk, including lines that were actually modified in the diff.\n\nExpected behavior: Only show the expanded content warning for comments on lines that are truly outside the diff hunks (i.e., context lines that were expanded by the user).\n\nLikely cause: The line type detection logic is incorrectly classifying diff hunk lines as expanded content, possibly due to:\n- Incorrect position tracking when suggestions are adopted\n- Mismatch between how AI suggestions store line info vs how the warning logic checks it\n- Off-by-one errors in line number comparison","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-01T11:08:51.208029-05:00","updated_at":"2026-01-01T11:21:46.633762-05:00","closed_at":"2026-01-01T11:21:46.633762-05:00"}
{"id":"pair_review-13b","title":"when adopting AI suggestions do not remove from sidebar","description":"instead of removing there should be some other visual indication instead, such as the entry being all gray or otherwise de-emphasized in some way -- but not entirely removed. this suggestions are still present in the diff, but collapsed, so it should still be possible to navigate to them","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T09:02:19.696331-05:00","updated_at":"2025-12-28T08:14:38.828974-05:00","closed_at":"2025-12-28T08:14:38.828974-05:00"}
{"id":"pair_review-1l3","title":"Check for stale PR data before starting AI analysis","description":"Before initiating AI analysis, check if the local PR data is stale (i.e., the remote PR has been updated since last sync). If stale:\n\n1. Prompt user with options: refresh PR first (recommended) or continue with stale data\n2. Default/highlight the refresh option since users will most likely want current data\n3. Show what changed if possible (e.g., 'PR has 2 new commits since last sync')\n\nThis prevents wasted analysis on outdated code and avoids confusion when suggestions don't match the current PR state.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-01T10:09:25.665192-05:00","updated_at":"2026-01-03T21:57:48.468296-05:00","closed_at":"2026-01-03T21:57:48.468296-05:00"}
{"id":"pair_review-1mp","title":"Epic: Implement Design Refresh UI","description":"Migrate the current application UI to match the design-refresh prototype. This involves updating CSS styling, HTML structure, and JavaScript components to achieve visual parity with the prototype at design-refresh/index.html.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T21:03:47.98069-05:00","updated_at":"2025-12-30T21:47:21.622644-05:00","closed_at":"2025-12-30T21:47:21.622644-05:00"}
{"id":"pair_review-1tkf","title":"Suggestion text incorrectly includes both removed and added lines for modified line comments","description":"When adding a suggestion in the editor for a modified line (a line that was changed, showing both removed and added versions), the suggestion text incorrectly includes both the removed line and the added line.\n\n**Expected behavior:**\nOnly the line that the comment is being made on should be included in the suggestion text. For a comment on an added line (right side), only the added line should be included.\n\n**Actual behavior:**\nBoth the removed line (left side) and added line (right side) are included in the suggestion text.\n\n**Impact:**\nThis creates confusing suggestions that include code from both the old and new versions, making it unclear what the suggestion is actually proposing.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-05T19:37:05.256075-05:00","created_by":"tim","updated_at":"2026-01-06T08:37:39.790873-05:00","closed_at":"2026-01-06T08:37:39.790873-05:00","close_reason":"Fixed by filtering suggestion code extraction by side (LEFT/RIGHT)"}
{"id":"pair_review-1ui","title":"Bug: Re-analysis shows combined instructions instead of just custom instructions","description":"When re-running AI analysis, the custom instructions textarea is pre-populated with both repo default instructions AND the user's custom instructions combined, instead of just the user's custom instructions.\n\n**Steps to reproduce:**\n1. Configure repo default instructions in settings\n2. Run AI analysis with additional custom instructions\n3. Click to re-run analysis\n4. The textarea shows repo defaults + custom instructions combined\n\n**Expected behavior:**\n- Only the user's custom instructions should pre-populate the textarea\n- Repo default instructions are shown separately (in the banner)\n- The server handles combining them with XML tags\n\n**Current behavior:**\n- The combined instructions are stored in `reviews.custom_instructions`\n- On re-analysis, `fetchLastCustomInstructions()` returns the combined value\n- This leads to duplication when combined again with repo defaults\n\n**Fix needed:**\n- Store only the user's custom instructions (without repo defaults) in the review record\n- The server-side combining should happen fresh each time, not persist the combined result\n- Alternatively, store them as separate fields in the review record","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-01T21:15:15.078552-05:00","updated_at":"2026-01-02T08:07:40.429045-05:00","closed_at":"2026-01-02T08:07:40.429045-05:00"}
{"id":"pair_review-1w0","title":"AI suggestions: Add level indicator dots","description":"Add analysis level indicator to suggestion headers showing Line/File/Architecture levels:\n- 3 dots in header right side\n- Active dot highlighted in amber\n- Label text showing analysis type (e.g., 'LINE ANALYSIS')\n- Match prototype .ai-suggestion-level styling\nFiles: public/js/pr.js, public/css/pr.css","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T21:04:32.341948-05:00","updated_at":"2025-12-30T21:47:11.764909-05:00","closed_at":"2025-12-30T21:47:11.764909-05:00","dependencies":[{"issue_id":"pair_review-1w0","depends_on_id":"pair_review-1mp","type":"blocks","created_at":"2025-12-30T21:04:56.174238-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-27s","title":"Add API contract tests","description":"Add tests that verify API response shapes match frontend expectations.\n\n## Problem solved\nFrontend code expects specific property names (e.g., changed_files, file_changes).\nCurrent tests verify status codes but not exact response structure.\n\n## Implementation\n- Define expected response schemas for each endpoint\n- Test that actual responses match schemas exactly\n- Include property names, types, and required fields\n- Fail tests if response shape changes unexpectedly\n\n## Key endpoints to cover\n- GET /api/pr/:owner/:repo/:number (PR metadata)\n- GET /api/pr/:owner/:repo/:number/diff (files and diff)\n- GET /api/pr/:owner/:repo/:number/ai-suggestions\n- POST /api/user-comment (comment creation)\n\n## Benefits\n- Catches property name mismatches early\n- Documents API contracts explicitly\n- Prevents silent breaking changes","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-03T08:21:57.057273-05:00","updated_at":"2026-01-03T08:21:57.057273-05:00"}
{"id":"pair_review-28g","title":"Unified Review Navigation Panel","description":"Transform the AI Analysis panel into a unified Review panel with segmented navigation (All | AI Findings | Comments). Add keyboard navigation (j/k) and distinct styling for different item types.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-03T12:31:01.255874-05:00","updated_at":"2026-01-03T12:59:45.892834-05:00","closed_at":"2026-01-03T12:59:45.892834-05:00"}
{"id":"pair_review-2ip","title":"Settings page does not respect dark/light theme from PR page","description":"When navigating to the settings page from the PR page, the settings page always shows in light theme regardless of the current theme setting on the PR page.\n\n**Steps to reproduce:**\n1. Open a PR in the app\n2. Switch to dark theme using the theme toggle\n3. Click the settings icon to navigate to the settings page\n4. Settings page displays in light theme instead of dark\n\n**Expected behavior:**\nThe settings page should respect the same theme preference that's active on the PR page.\n\n**Likely cause:**\nTheme preference is stored in localStorage but the settings page may not be reading it on load, or uses different theme initialization logic.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T08:15:12.032814-05:00","updated_at":"2026-01-02T08:16:07.435393-05:00","closed_at":"2026-01-02T08:16:07.435393-05:00"}
{"id":"pair_review-2nn","title":"E2E tests for review submission","description":"Test review workflow - selecting review type, entering summary, submitting, success/failure toast feedback, different review types (Approve/Comment/Request Changes)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:09:47.740092-05:00","created_by":"tim","updated_at":"2026-01-05T07:21:48.938023-05:00","closed_at":"2026-01-05T07:21:48.938023-05:00","close_reason":"Closed"}
{"id":"pair_review-30u","title":"Validation and testing","description":"Verify all functionality in Chrome browser. Ensure existing tests pass. Test keyboard navigation, segment switching, and navigation to items in diff view.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:31:16.205193-05:00","updated_at":"2026-01-03T12:59:45.868778-05:00","closed_at":"2026-01-03T12:59:45.868778-05:00","dependencies":[{"issue_id":"pair_review-30u","depends_on_id":"pair_review-28g","type":"blocks","created_at":"2026-01-03T12:31:27.551927-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-30u","depends_on_id":"pair_review-419","type":"blocks","created_at":"2026-01-03T12:31:27.63069-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-30u","depends_on_id":"pair_review-9ce","type":"blocks","created_at":"2026-01-03T12:31:27.649139-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-30u","depends_on_id":"pair_review-d9j","type":"blocks","created_at":"2026-01-03T12:31:27.667878-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-38y","title":"URL input field should be much wider","description":"The URL input field on the landing page is still too narrow. It should be approximately 3 times its current width to properly accommodate GitHub PR URLs without truncation.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-29T08:05:31.540895-05:00","updated_at":"2025-12-29T08:28:12.108173-05:00","closed_at":"2025-12-29T08:28:12.108173-05:00","dependencies":[{"issue_id":"pair_review-38y","depends_on_id":"pair_review-jbp","type":"blocks","created_at":"2025-12-29T08:05:54.642524-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-3am","title":"Bug: Commit SHA not updated in UI after refreshing PR","description":"After refreshing a PR to fetch the latest changes, the commit SHA displayed in the UI is not updated to reflect the new HEAD. The UI continues showing the old SHA even though the diff content has been refreshed.\n\nExpected behavior: The displayed commit SHA should update to match the latest fetched commit after a PR refresh.\n\nLikely cause: The SHA display element is not being re-rendered or the state variable holding the SHA is not being updated when PR data is refreshed.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-01T11:13:49.054664-05:00","updated_at":"2026-01-01T11:58:11.081625-05:00","closed_at":"2026-01-01T11:58:11.081625-05:00"}
{"id":"pair_review-3e6d","title":"Improve E2E test database isolation between test files","description":"The E2E test suite creates a single in-memory SQLite database (`:memory:`) in global-setup.js that persists across all test files. While this is fast, it means tests aren't truly isolated from each other - data created in one test file can affect tests in another file.\n\n**Current state:**\n- Single in-memory database shared across all tests\n- `workers: 1` mitigates parallelism issues\n- Tests can see leftover data from previous test files\n\n**Potential improvements:**\n1. Create a fresh database for each test file in a `beforeAll` hook\n2. Add a mechanism to reset tables to a known state between test files\n3. Use file-based databases with unique names per test file\n\n**Short-term mitigation (already in place):**\n- `fullyParallel: false` and `workers: 1` prevent parallel test execution\n- Comment added to document this shared state\n\nThis becomes more important as the test suite grows and timing issues can cause tests to interfere with each other.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-05T08:14:29.861696-05:00","created_by":"tim","updated_at":"2026-01-05T08:14:29.861696-05:00"}
{"id":"pair_review-3ig","title":"Consolidate comment buttons into split button","description":"## Problem\nThe PR header has 3 comment-related buttons that clutter the UI:\n- Preview Comments\n- Clear Comments  \n- N comments (Submit Review)\n\n## Solution\nReplace with a single **split button** pattern:\n\n```\n┌──────────────────┬───┐\n│   2 comments     │ ▾ │  ← Two click targets\n└──────────────────┴───┘\n        ↓            ↓\n   Primary       Dropdown\n   Action        Menu\n```\n\n### Behavior\n- **Click main area** → executes configurable primary action (Submit Review or Preview)\n- **Click dropdown arrow** → shows menu with all options:\n  ```\n  ┌─────────────────┐\n  │ ✓ Submit Review │  ← checkmark shows current default\n  │   Preview       │\n  │ ───────────────│\n  │   Clear All     │\n  └─────────────────┘\n  ```\n\n### Configuration\nAdd to `~/.pair-review/config.json`:\n```json\n{\n  \"comment_button_action\": \"submit\"  // or \"preview\"\n}\n```\n\nDefault: \"submit\" (most users want quick submission)\n\n### Implementation Details\n\n1. **Create SplitButton component** (`public/js/components/SplitButton.js`)\n   - Renders button with main area + dropdown arrow\n   - Handles click events for both targets\n   - Manages dropdown open/close state\n   - Closes dropdown on outside click\n\n2. **Update pr.js header rendering** (around line 468)\n   - Remove: Preview Comments, Clear Comments, N comments buttons\n   - Add: Single split button instance\n   - Wire up actions: openPreviewModal(), clearAllUserComments(), openReviewModal()\n\n3. **Add API endpoint** for config\n   - GET `/api/config` - returns user config including comment_button_action\n   - Already may exist, just need to add new field\n\n4. **CSS styling** (`public/css/pr.css`)\n   - Split button styling matching existing btn-primary/green style\n   - Dropdown menu styling\n   - Checkmark indicator for current default\n   - Separator line before Clear All (destructive action)\n\n### Files to modify\n- `public/js/components/SplitButton.js` (new)\n- `public/js/pr.js` (header buttons ~line 468, updateCommentCount)\n- `public/css/pr.css` (split button styles)\n- `src/server.js` or config handler (if config endpoint needs update)\n\n### Reference\nSimilar patterns:\n- VS Code Run button with debug config dropdown\n- GitHub \"Merge pull request\" dropdown\n- Chrome download button","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-28T13:01:15.891622-05:00","updated_at":"2025-12-28T13:22:01.510553-05:00","closed_at":"2025-12-28T13:22:01.510553-05:00"}
{"id":"pair_review-3o2","title":"DB schema: Repo settings table for persistent configuration","description":"Create new database table to store per-repo settings including default analysis instructions. Table should key off repo identifier (owner/repo) and support future extension for other repo-level settings.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T18:26:05.864283-05:00","updated_at":"2026-01-01T14:18:45.769445-05:00","closed_at":"2026-01-01T14:18:45.769445-05:00","dependencies":[{"issue_id":"pair_review-3o2","depends_on_id":"pair_review-f8b","type":"blocks","created_at":"2025-12-31T18:26:22.344443-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-3ru","title":"Middle panel sizing incorrect on initial load until AI panel toggled","description":"The diff view middle panel doesn't size correctly on initial page load. Toggling the AI panel causes a recalculation that fixes it. Fixed by changing flex: 1 to flex: 1 1 0 on .diff-view to force flex-basis: 0 calculation.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T09:01:55.60817-05:00","updated_at":"2025-12-31T09:02:02.512319-05:00","closed_at":"2025-12-31T09:02:02.512319-05:00"}
{"id":"pair_review-3ur","title":"UI: Add navigation for user comments like AI suggestions","description":"Add a navigator component for user comments similar to the existing AI suggestion navigator. Currently users must scroll through the diff to find their comments, or use the preview panel which only shows text without edit capability.\n\nDesired functionality:\n- List of user comments with ability to jump to each one in the diff\n- Edit capability from the navigator (or quick jump to edit in place)\n- Visual indicator of comment count\n- Possibly filter/sort options (by file, by status if we add draft/submitted states)\n\nCould potentially unify with or mirror the AI suggestion navigator pattern for consistency.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T21:26:43.921839-05:00","updated_at":"2026-01-04T19:13:44.325013-05:00","closed_at":"2026-01-04T19:13:44.325013-05:00","close_reason":"Implemented - user comments integrated into AIPanel with Comments segment, navigation, and count display"}
{"id":"pair_review-416","title":"Add provider to config schema","description":"Add provider field to config (global and per-repo). Default to claude. Store in ~/.pair-review/config.json and repo settings.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:41:50.62802-05:00","updated_at":"2026-01-03T13:00:35.082341-05:00","closed_at":"2026-01-03T13:00:35.082341-05:00"}
{"id":"pair_review-419","title":"Track and display user comments in Review panel","description":"Integrate with CommentManager to load user comments (including adopted suggestions). Display comments in the findings list when 'Comments' or 'All' segment is selected. Comments should show their type, location, and preview text.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:31:16.122466-05:00","updated_at":"2026-01-03T12:46:05.895798-05:00","closed_at":"2026-01-03T12:46:05.895798-05:00","dependencies":[{"issue_id":"pair_review-419","depends_on_id":"pair_review-28g","type":"blocks","created_at":"2026-01-03T12:31:27.494366-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-419","depends_on_id":"pair_review-8v7","type":"blocks","created_at":"2026-01-03T12:31:27.571314-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-41r","title":"Separate index.html and pr.html pages","description":"Currently the landing page and PR review page share index.html, which causes issues with elements appearing where they shouldn't. These should be separate HTML files:\n\n- index.html: Landing page with URL input and recent reviews\n- pr.html: PR review page with diff view, sidebars, etc.\n\nThis is a cleaner architecture that avoids CSS/JS conflicts and show/hide logic.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T08:05:33.62306-05:00","updated_at":"2025-12-29T08:26:46.101998-05:00","closed_at":"2025-12-29T08:26:46.101998-05:00","dependencies":[{"issue_id":"pair_review-41r","depends_on_id":"pair_review-jbp","type":"blocks","created_at":"2025-12-29T08:05:54.686022-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-44k","title":"Fix navigation counter bug (8 of 7)","description":"Navigation counter has bugs:\n- Starts at '- of 7' which looks odd (should maybe show '0 of 7' or just '7 items')\n- Goes up to '8 of 7' which is clearly wrong\n- Need to investigate the counting logic","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-03T13:36:04.035438-05:00","updated_at":"2026-01-03T13:44:30.979702-05:00","closed_at":"2026-01-03T13:44:30.979702-05:00","dependencies":[{"issue_id":"pair_review-44k","depends_on_id":"pair_review-epg","type":"blocks","created_at":"2026-01-03T13:36:14.381756-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-452","title":"Add dedicated worktrees database table","description":"## Problem\nWorktree paths are currently stored in `pr_metadata.pr_data` JSON blob. This makes queries for cleanup, recently-used lists, and tracking difficult.\n\n## Solution\nCreate a dedicated `worktrees` table:\n\n```sql\nCREATE TABLE worktrees (\n  id TEXT PRIMARY KEY,           -- Random ID (like beads naming)\n  pr_number INTEGER NOT NULL,\n  repository TEXT NOT NULL,      -- owner/repo format\n  branch TEXT NOT NULL,          -- PR head branch\n  path TEXT NOT NULL,            -- Full filesystem path\n  created_at TEXT NOT NULL,      -- ISO timestamp\n  last_accessed_at TEXT NOT NULL,-- ISO timestamp, updated on each use\n  UNIQUE(pr_number, repository)\n);\n\nCREATE INDEX idx_worktrees_last_accessed ON worktrees(last_accessed_at);\nCREATE INDEX idx_worktrees_repo ON worktrees(repository);\n```\n\n## Implementation\n1. Add table creation to `src/database.js`\n2. Add migration logic to handle existing worktrees (scan directory, populate table)\n3. Create WorktreeRepository class with CRUD methods:\n   - `create(prInfo)` → returns worktree record\n   - `findByPR(prNumber, repository)` → returns worktree or null\n   - `updateLastAccessed(id)` → touches last_accessed_at\n   - `findStale(olderThan)` → returns worktrees not accessed since date\n   - `delete(id)` → removes record\n   - `listRecent(limit)` → returns recently accessed worktrees\n\n## Notes\n- Keep `pr_metadata.pr_data` blob for backward compat but stop writing worktree_path there\n- Random ID generation should match beads style (alphanumeric, ~6 chars)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T15:55:47.036368-05:00","updated_at":"2025-12-28T16:08:29.231282-05:00","closed_at":"2025-12-28T16:08:29.231282-05:00","dependencies":[{"issue_id":"pair_review-452","depends_on_id":"pair_review-e4k","type":"blocks","created_at":"2025-12-28T15:56:43.415803-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-4a5","title":"Update GitHub client to use line/side/commit_id API","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T21:40:15.535398-05:00","updated_at":"2025-12-31T21:43:49.084277-05:00","closed_at":"2025-12-31T21:43:49.084277-05:00","dependencies":[{"issue_id":"pair_review-4a5","depends_on_id":"pair_review-f3v","type":"blocks","created_at":"2025-12-31T21:40:23.053043-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-4d8","title":"CLI: Add --local flag with optional path argument","description":"Add --local flag to pair-review CLI.\n\n## Changes to bin/pair-review.js\n- Add option: `--local [path]` - Review uncommitted local changes\n- Path is optional, defaults to current working directory\n\n## Changes to src/main.js\n- Early branch: detect `flags.local` before PR argument parsing\n- If local mode: call `handleLocalReview(targetPath, flags)`\n- If PR mode: existing `handlePullRequestReview()` flow\n\n## Validation\n- Verify target path is a git repository\n- Error if path doesn't exist or isn't a git repo","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T09:00:18.351805-05:00","created_by":"tim","updated_at":"2026-01-04T09:22:50.8454-05:00","closed_at":"2026-01-04T09:22:50.8454-05:00","close_reason":"Implementation complete, all 183 tests pass","dependencies":[{"issue_id":"pair_review-4d8","depends_on_id":"pair_review-8h3","type":"blocks","created_at":"2026-01-04T09:00:35.111482-05:00","created_by":"tim"},{"issue_id":"pair_review-4d8","depends_on_id":"pair_review-gvx","type":"blocks","created_at":"2026-01-04T09:00:36.514894-05:00","created_by":"tim"}]}
{"id":"pair_review-4k0","title":"Use random IDs for worktree directory names","description":"## Problem\nCurrent naming `{owner}-{repo}-{number}` is predictable and suggests these directories are for user access. They should be for application use only.\n\n## Solution\nUse random alphanumeric IDs (like beads issue naming) for worktree directories:\n- Before: `~/.pair-review/worktrees/anthropic-pair-review-123`\n- After: `~/.pair-review/worktrees/x7k` or `~/.pair-review/worktrees/a3m9p`\n\n## Implementation\n1. Update `WorktreeManager.createWorktreeForPR()` to:\n   - Generate random ID (6 alphanumeric chars)\n   - Use ID as directory name\n   - Store mapping in worktrees table\n2. Update `getWorktreePath()` to look up path from DB by PR info\n3. Remove any logic that derives path from PR number\n\n## Dependencies\n- Requires worktrees database table (pair_review-452)\n\n## Migration\n- Existing worktrees can be renamed or left as-is until cleanup\n- New worktrees use random naming immediately","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T15:56:20.310439-05:00","updated_at":"2025-12-28T16:19:15.852915-05:00","closed_at":"2025-12-28T16:19:15.852915-05:00","dependencies":[{"issue_id":"pair_review-4k0","depends_on_id":"pair_review-452","type":"blocks","created_at":"2025-12-28T15:56:34.943059-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-4k0","depends_on_id":"pair_review-e4k","type":"blocks","created_at":"2025-12-28T15:56:43.462161-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-4qyk","title":"Review and clarify E2E test file responsibilities for comment tests","description":"## Background\n\nReview feedback noted potential overlap between `comments-review.spec.js` and `comment-crud.spec.js`.\n\n## Analysis\n\n### comments-review.spec.js (296 lines)\nTests focused on:\n- **Comment Creation** (4 tests): Basic form display, textarea, buttons, cancel behavior\n- **Review Modal** (4 tests): Review button, modal opening, review event options, cancel\n- **API Integration** (3 tests): PR data fetch, diff fetch, error handling\n- **UI State Management** (2 tests): UI updates, file selection\n- **Accessibility** (3 tests): Headings, buttons, keyboard nav\n\n### comment-crud.spec.js (660 lines)\nTests focused on:\n- **Comment Creation and Submission** (4 tests): Full typing/submit flow, keyboard shortcuts\n- **Comment Editing** (4 tests): Edit mode, save, cancel\n- **Comment Deletion** (4 tests): Delete flow, confirmation dialog\n- **Multi-line Drag Selection** (3 tests)\n- **Comment Persistence** (2 tests): Refresh, navigation\n- **Comment API Integration** (3 tests): Save, delete, update APIs\n- **Comment Display** (3 tests): Timestamp, line info, icons\n\n## Overlap Assessment\n\nThe overlap is **minor and intentional**:\n- `comments-review.spec.js` tests basic comment form behavior as part of the review workflow\n- `comment-crud.spec.js` provides comprehensive CRUD testing\n\n### Current Division of Responsibility\n- **comments-review.spec.js**: Review submission workflow, general UI, accessibility\n- **comment-crud.spec.js**: Complete comment lifecycle (CRUD operations)\n\n## Recommendation\n\n**Low priority** - The current division is reasonable:\n1. Files have distinct purposes despite some overlap\n2. Overlap is in basic \"sanity check\" tests that are quick to run\n3. Merging could create an unwieldy large file\n\n### If consolidation is desired:\n- Move the 4 basic \"Comment Creation\" tests from `comments-review.spec.js` to `comment-crud.spec.js`\n- Rename `comments-review.spec.js` to `review-submission.spec.js` to clarify its purpose\n- Keep API Integration, UI State, and Accessibility tests in the review file\n\n## Decision\nThis is a low-priority cleanup task. Consider addressing during a larger test refactoring effort.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T10:32:50.61043-05:00","created_by":"tim","updated_at":"2026-01-05T10:33:08.87848-05:00"}
{"id":"pair_review-4sj","title":"Pass custom instructions to orchestration layer for filtering","description":"Custom instructions are passed to Levels 1-3 but NOT to the orchestration step. This means the orchestration can't use user preferences to filter or prioritize suggestions.\n\n**Current behavior:**\n- `customInstructions` passed to `analyzeLevel1/2/3` ✓\n- `orchestrateWithAI(allSuggestions, prMetadata)` - no instructions\n- `buildOrchestrationPrompt` - no instructions parameter\n\n**Expected behavior:**\n- Orchestration should receive custom instructions\n- Use them to prioritize/filter suggestions based on user focus areas\n- Example: If user selected 'Security' focus, orchestration should favor security-related findings\n\n**Implementation:**\n1. Add `customInstructions` parameter to `orchestrateWithAI()`\n2. Add `customInstructions` parameter to `buildOrchestrationPrompt()`\n3. Include instructions section in orchestration prompt\n4. Pass `customInstructions` through from `analyzeAllLevels()`\n\n**Files to modify:**\n- `src/ai/analyzer.js`: `orchestrateWithAI`, `buildOrchestrationPrompt`, `analyzeAllLevels`","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-01T21:20:51.914494-05:00","updated_at":"2026-01-02T08:10:30.076524-05:00","closed_at":"2026-01-02T08:10:30.076524-05:00"}
{"id":"pair_review-4ui","title":"Future: Reply to AI suggestions as iterative feedback","description":"Allow users to reply to individual AI suggestions. These replies would be stored and incorporated as additional context/instructions when re-running analysis. This creates a conversational feedback loop where the AI can refine its suggestions based on reviewer feedback. Example: User replies 'This pattern is intentional for performance reasons' to a suggestion, and future analysis rounds consider this context. Depends on the custom instructions infrastructure being in place first.","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-31T18:35:58.447329-05:00","updated_at":"2025-12-31T18:36:13.15488-05:00","dependencies":[{"issue_id":"pair_review-4ui","depends_on_id":"pair_review-f8b","type":"blocks","created_at":"2025-12-31T18:36:06.752312-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-4ui","depends_on_id":"pair_review-jlp","type":"blocks","created_at":"2025-12-31T18:36:06.783365-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-4z8","title":"Page over-scrolls leaving white region at bottom","description":"The PR review page allows scrolling beyond the content, revealing a white/blank region at the bottom of the viewport. This suggests a CSS layout issue - likely the body/container height is not properly constrained to the viewport, or there's extra margin/padding causing content to extend beyond what's visible.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T08:23:34.0589-05:00","updated_at":"2025-12-31T08:24:45.683937-05:00","closed_at":"2025-12-31T08:24:45.683937-05:00"}
{"id":"pair_review-5d1g","title":"Improve E2E test mocking with dependency injection","description":"The E2E test setup in global-setup.js modifies class prototypes directly (e.g., GitHubClient.prototype.fetchPullRequest). This global mutation persists for the entire Node process and has several limitations:\n\n- Makes tests order-dependent\n- Prevents parallel test execution\n- Mocks cannot be reset or varied between different test scenarios\n\n**Current approach** (in global-setup.js):\n```javascript\nGitHubClient.prototype.fetchPullRequest = async () =\u003e mockGitHubResponses.fetchPullRequest;\n```\n\n**Proposed solution:**\nUse dependency injection where GitHubClient is instantiated with mock functions, or use a mock factory that routes receive. This would allow:\n- Per-test mock variations\n- Test isolation\n- Potential parallel test execution\n\nFor now, this approach is pragmatic for a local test app and works correctly.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-05T08:01:25.487769-05:00","created_by":"tim","updated_at":"2026-01-05T08:01:25.487769-05:00"}
{"id":"pair_review-5vi","title":"CLI should open PR page directly, not landing page","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-29T08:35:36.782001-05:00","updated_at":"2025-12-29T08:37:31.598826-05:00","closed_at":"2025-12-29T08:37:31.598826-05:00"}
{"id":"pair_review-5wj","title":"Simplify AI findings item display","description":"The finding items are visually busy. Consider:\n- Show only filename (line number available on hover via title attribute)\n- Icon is redundant with category text - pick one\n- Icons are not unique per category (same icon for multiple categories) - either make unique or remove\n- Consult frontend-design skill for cleaner layout","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T13:36:04.060975-05:00","updated_at":"2026-01-03T13:44:30.980133-05:00","closed_at":"2026-01-03T13:44:30.980133-05:00","dependencies":[{"issue_id":"pair_review-5wj","depends_on_id":"pair_review-epg","type":"blocks","created_at":"2026-01-03T13:36:14.401479-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-68n","title":"Write tests for AI analyzer orchestration","description":"Create unit tests for src/ai/analyzer.js. Test the 3-level analysis system, orchestration logic, suggestion deduplication, and error handling. Mock Claude CLI responses.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-02T22:05:28.59471-05:00","updated_at":"2026-01-02T22:05:28.59471-05:00","dependencies":[{"issue_id":"pair_review-68n","depends_on_id":"pair_review-70n","type":"blocks","created_at":"2026-01-02T22:05:43.125049-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-6cz","title":"Add unit tests for CodexProvider.parseCodexResponse","description":"Add unit tests for the parseCodexResponse method to lock in expectations and prevent regressions.\n\nTest cases needed:\n- Valid JSONL with agent_message containing JSON\n- Malformed JSONL lines (should skip gracefully)\n- Agent message containing non-JSON text\n- Raw stdout JSON fallback when no agent_message found\n- Empty stdout handling\n\nReference: src/ai/codex-provider.js:192","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-03T20:53:46.608688-05:00","updated_at":"2026-01-03T20:53:46.608688-05:00"}
{"id":"pair_review-6kr","title":"P1: All comments submitted as file-level instead of only expanded lines","description":"When adopting AI suggestions, the diff_position and side were not being passed to the user comment creation API. This caused all adopted comments to be treated as expanded context lines and submitted as file-level comments instead of line-level comments. Fixed by extracting diffPosition and side from the target row in getFileAndLineInfo() and passing them through createUserCommentFromSuggestion() to the API.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-01T10:34:27.243119-05:00","updated_at":"2026-01-01T10:57:19.257665-05:00","closed_at":"2026-01-01T10:57:19.257665-05:00"}
{"id":"pair_review-6mb","title":"API routes: Add /api/local/* endpoints","description":"Add parallel API routes for local review mode.\n\n## New File: src/routes/local.js\n\n### Endpoints\n- `GET /api/local/:reviewId` - Get local review metadata\n- `GET /api/local/:reviewId/diff` - Get local diff\n- `POST /api/local/:reviewId/analyze` - Start AI analysis\n- `POST /api/local/:reviewId/analyze/level2` - Level 2 analysis\n- `POST /api/local/:reviewId/analyze/level3` - Level 3 analysis\n- `GET /api/local/:reviewId/suggestions` - Get AI suggestions\n- `GET /api/local/:reviewId/user-comments` - Get user comments\n- `POST /api/local/:reviewId/user-comments` - Add user comment\n- `DELETE /api/local/:reviewId/user-comments` - Delete comments\n\n### Implementation Notes\n- Reuse existing analysis/comment logic where possible\n- No submit-review endpoint (GitHub submission disabled)\n- reviewId is the database ID, not the path@sha identifier\n\n## Register Routes\n- Add to src/server.js route setup","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T09:00:20.520539-05:00","created_by":"tim","updated_at":"2026-01-04T09:27:13.653314-05:00","closed_at":"2026-01-04T09:27:13.653314-05:00","close_reason":"Implementation complete, all 183 tests pass","dependencies":[{"issue_id":"pair_review-6mb","depends_on_id":"pair_review-8h3","type":"blocks","created_at":"2026-01-04T09:00:35.197491-05:00","created_by":"tim"},{"issue_id":"pair_review-6mb","depends_on_id":"pair_review-ba1","type":"blocks","created_at":"2026-01-04T09:00:36.602312-05:00","created_by":"tim"}]}
{"id":"pair_review-6mcq","title":"Local mode should check if files have changed before analysis","description":"In PR mode, the system checks if the PR state has changed (new commits, etc.) before initiating analysis to avoid analyzing stale data. Local mode currently lacks this check - it should verify that the working directory files haven't changed since the last analysis was initiated. Without this, users could start an analysis, make additional edits to files, and receive results that don't match their current working state. The fix should compare file modification times or content hashes before analysis to warn or prompt the user if files have changed.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-06T11:25:46.94712-05:00","created_by":"tim","updated_at":"2026-01-06T12:19:11.436005-05:00","closed_at":"2026-01-06T12:19:11.436005-05:00","close_reason":"Implemented check-stale endpoint for local mode that compares stored diff stats with current working directory state. Frontend now shows dialog when files have changed, offering Refresh \u0026 Analyze, Analyze Anyway, or Cancel options."}
{"id":"pair_review-6qg","title":"Navigation: Add link to repo settings from PR view","description":"Add a navigation element (link or button) in the PR view that allows users to access the repo settings page. Consider placement in header or sidebar where it's discoverable but not intrusive.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T18:26:08.17695-05:00","updated_at":"2026-01-01T14:28:01.90379-05:00","closed_at":"2026-01-01T14:28:01.90379-05:00","dependencies":[{"issue_id":"pair_review-6qg","depends_on_id":"pair_review-f8b","type":"blocks","created_at":"2025-12-31T18:26:22.436209-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-6qg","depends_on_id":"pair_review-0l0","type":"blocks","created_at":"2025-12-31T18:26:25.683573-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-70n","title":"Set up test framework (Vitest) for pair-review","description":"Install Vitest test framework and configure it for the project. Create basic test structure with tests/unit/, tests/integration/ directories. Add test scripts to package.json.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T22:05:26.701982-05:00","updated_at":"2026-01-02T22:09:17.045015-05:00","closed_at":"2026-01-02T22:09:17.045015-05:00"}
{"id":"pair_review-73j","title":"Test stability and coverage improvements","description":"Improve test coverage to catch frontend-backend integration issues like those found during the codebase health refactoring.\n\nCurrent test coverage:\n- Database layer: good (116 tests)\n- API routes: good (60 tests)\n- Frontend: none\n- E2E flows: none\n- API contracts: none\n\nGoals:\n- Catch regressions before they reach production\n- Verify frontend correctly consumes API responses\n- Test complete user flows end-to-end\n- Ensure API response shapes match frontend expectations","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-03T08:21:33.515718-05:00","updated_at":"2026-01-03T08:21:33.515718-05:00","dependencies":[{"issue_id":"pair_review-73j","depends_on_id":"pair_review-gxh","type":"blocks","created_at":"2026-01-03T08:22:07.431165-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-73j","depends_on_id":"pair_review-27s","type":"blocks","created_at":"2026-01-03T08:22:07.457037-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-73j","depends_on_id":"pair_review-o75","type":"blocks","created_at":"2026-01-03T08:22:07.479486-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-73j","depends_on_id":"pair_review-lmk","type":"blocks","created_at":"2026-01-03T08:22:07.503103-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-73j","depends_on_id":"pair_review-x12","type":"blocks","created_at":"2026-01-05T07:10:00.510117-05:00","created_by":"tim"},{"issue_id":"pair_review-73j","depends_on_id":"pair_review-hdq","type":"blocks","created_at":"2026-01-05T07:10:01.689325-05:00","created_by":"tim"},{"issue_id":"pair_review-73j","depends_on_id":"pair_review-2nn","type":"blocks","created_at":"2026-01-05T07:10:03.190303-05:00","created_by":"tim"},{"issue_id":"pair_review-73j","depends_on_id":"pair_review-f3f","type":"blocks","created_at":"2026-01-05T07:10:04.703493-05:00","created_by":"tim"},{"issue_id":"pair_review-73j","depends_on_id":"pair_review-nwv","type":"blocks","created_at":"2026-01-05T07:10:05.647206-05:00","created_by":"tim"},{"issue_id":"pair_review-73j","depends_on_id":"pair_review-mxo","type":"blocks","created_at":"2026-01-05T07:10:06.599742-05:00","created_by":"tim"},{"issue_id":"pair_review-73j","depends_on_id":"pair_review-r62","type":"blocks","created_at":"2026-01-05T07:10:07.494736-05:00","created_by":"tim"}]}
{"id":"pair_review-7a5","title":"Abstract model selection from Claude-specific to provider-agnostic tiers","description":"The current model selection UI is tightly coupled to Claude-specific model names (Haiku, Sonnet, Opus). Per the original design intention to support multiple AI providers, refactor to use provider-agnostic tiers: Fast, Balanced, and Thorough. Each tier would have provider-specific descriptions/mappings. For example:\n\n- **Fast**: Quick analysis, lower cost (Claude: Haiku, OpenAI: GPT-4o-mini, etc.)\n- **Balanced**: Good tradeoff of speed and quality (Claude: Sonnet, OpenAI: GPT-4o, etc.)  \n- **Thorough**: Most comprehensive analysis (Claude: Opus, OpenAI: o1, etc.)\n\nThis aligns with the adapter pattern mentioned in CLAUDE.md for future AI provider extensibility. The mapping between tiers and actual models would be defined per-provider in the adapter configuration.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-02T13:31:26.457031-05:00","updated_at":"2026-01-03T21:41:25.089899-05:00","closed_at":"2026-01-03T13:03:50.459913-05:00"}
{"id":"pair_review-7g5","title":"AI suggestions: Remove confidence percentage display","description":"The prototype does not show confidence percentages on suggestions. Remove or hide the confidence display from AI suggestion cards to match the cleaner prototype design.\nFiles: public/js/pr.js, public/css/pr.css","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T21:04:33.596219-05:00","updated_at":"2025-12-30T21:46:02.341721-05:00","closed_at":"2025-12-30T21:46:02.341721-05:00","dependencies":[{"issue_id":"pair_review-7g5","depends_on_id":"pair_review-1mp","type":"blocks","created_at":"2025-12-30T21:04:58.555494-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-7rho","title":"Support Graphite URLs for PR review","description":"Add support for pasting Graphite URLs as input to pair-review. The GitHub PR number can be extracted from Graphite URLs and used to open the review.\n\nGraphite is a popular tool for managing stacked PRs on GitHub. Users should be able to use Graphite URLs directly instead of needing to extract the PR number manually.\n\nExample Graphite URL format (to research):\n- https://app.graphite.dev/github/pr/...\n\nImplementation:\n- Update URL parsing logic to detect Graphite URLs\n- Extract GitHub PR number from Graphite URL format\n- Use extracted PR number to proceed with normal review flow\n- Should work with both CLI and web interface inputs\n\nRelated files:\n- CLI entry point that parses PR input\n- URL parsing/validation logic","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-05T15:02:31.612823-05:00","created_by":"tim","updated_at":"2026-01-07T13:21:45.539287-05:00","closed_at":"2026-01-07T13:21:45.539287-05:00","close_reason":"Implemented Graphite URL support for both .dev and .com domains with full test coverage"}
{"id":"pair_review-7yo","title":"Refactor ClaudeCLI to ClaudeProvider","description":"Wrap existing ClaudeCLI in a ClaudeProvider that implements the AIProvider interface.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:41:47.554598-05:00","updated_at":"2026-01-03T12:52:41.328891-05:00","closed_at":"2026-01-03T12:52:41.328891-05:00","dependencies":[{"issue_id":"pair_review-7yo","depends_on_id":"pair_review-bnm","type":"blocks","created_at":"2026-01-03T12:42:06.782689-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-821","title":"Database migration not applying: last_ai_run_id column missing","description":"Console error persists: 'Failed to update pr_metadata with last_ai_run_id: SQLITE_ERROR: no such column: last_ai_run_id'\n\n## Root Cause Confirmed\nDatabase has schema version **5** but code has CURRENT_SCHEMA_VERSION **3**. Migration logic skips all migrations when currentVersion \u003e= CURRENT_SCHEMA_VERSION (5 \u003e= 3), so migration 3 (which adds last_ai_run_id) never runs.\n\nThis happened because another worktree/branch with higher schema version ran against the same database.\n\n## Fix Required\nChange migration approach from version-only checks to **column existence checks**:\n1. On startup, verify required columns exist regardless of version number\n2. Run ALTER TABLE for any missing columns\n3. Or: Always run the column-existence checks in each migration, not just when version is lower\n\n## Workaround\n```bash\nsqlite3 ~/.pair-review/database.db \"ALTER TABLE pr_metadata ADD COLUMN last_ai_run_id TEXT;\"\n```\n\nRelated: pair_review-k21 (proper database migration version tracking)","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-04T20:26:16.247486-05:00","created_by":"tim","updated_at":"2026-01-06T12:09:48.524883-05:00","closed_at":"2026-01-06T12:09:48.524883-05:00","close_reason":"Closed"}
{"id":"pair_review-87y","title":"Add back navigation from settings page to originating PR","description":"Currently there's no way to navigate back from the repo settings page to a PR page you might have come from. Add a contextual back link at the top of the settings page that says something like 'Return to PR#57'. Implementation approach: Store the referring PR context in localStorage when navigating to settings from a PR page. On settings page load, check localStorage for this context and render the back link if present. Clear the stored context when appropriate (e.g., when navigating directly to settings, or after using the back link).","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-02T08:25:59.439329-05:00","updated_at":"2026-01-02T11:35:11.548387-05:00","closed_at":"2026-01-02T11:35:11.548387-05:00"}
{"id":"pair_review-8h3","title":"Local Mode: Review uncommitted changes without GitHub","description":"Add --local flag to pair-review for reviewing uncommitted local changes.\n\n## Overview\nEnable pair-review to work with local uncommitted changes instead of GitHub PRs. This replaces local-review with a more capable AI-integrated solution.\n\n## Key Decisions\n- **Identifier**: repo-path + HEAD-sha (new session on commit)\n- **Persistence**: SQLite database (consistent with PR mode)\n- **Worktree**: Skip entirely for local mode\n- **CLI**: `pair-review --local [path]` explicit flag\n- **Diff scope**: Unstaged changes + untracked files (matches local-review)\n- **Routes**: Parallel /api/local/* routes (Option A)\n\n## Disabled in Local Mode\n- Submit Review to GitHub\n- PR metadata display\n\n## UI Changes\n- 'Local Mode' badge in header\n- Current branch name displayed (styled differently)\n- Repository name from filesystem path\n\n## Out of Scope (Future)\n- Staged vs unstaged separation\n- Branch-based sessions (vs HEAD-based)","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-04T08:59:36.116975-05:00","created_by":"tim","updated_at":"2026-01-04T09:38:45.213076-05:00","closed_at":"2026-01-04T09:38:45.213076-05:00","close_reason":"All 6 subtasks complete. Local mode fully implemented."}
{"id":"pair_review-8hw","title":"Add path normalization utility for file paths","description":"Create a utility function to normalize file paths consistently across the codebase. This is foundational for file path validation work.\n\nRequirements:\n- Normalize ./src/foo.js → src/foo.js\n- Handle double slashes: src//foo.js → src/foo.js\n- Strip leading/trailing slashes consistently\n- Apply to both diff file paths and AI suggestion paths\n\nThis enables reliable string matching for the database failsafe filter and other validation layers.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T15:13:48.707126-05:00","created_by":"tim","updated_at":"2026-01-04T15:21:40.065783-05:00","closed_at":"2026-01-04T15:21:40.065783-05:00","close_reason":"Implemented multi-level file path validation"}
{"id":"pair_review-8kf","title":"Improve empty state UI in Review panel","description":"The empty state in the Review panel (before AI analysis runs) looks incomplete:\n\nCurrent issues:\n- '— of 0' navigation counter looks broken when empty\n- Tabs showing '(0)' three times emphasizes emptiness\n- Plain 'No AI suggestions for this PR' message doesn't guide user action\n- Lots of wasted vertical space\n\nRecommended improvements:\n1. Hide navigation counter when count is zero\n2. Hide or dim tab counts when zero\n3. Replace plain text with structured empty state:\n   - Icon (subtle sparkle)\n   - Headline: 'Ready for AI Review'\n   - Subtext: 'Click Analyze with AI to get suggestions'\n   - Optional tip about 3-level analysis\n4. Differentiate 'never run' vs 'zero results' states:\n   - Before: 'Ready for AI Review'\n   - After with zero: '✓ No issues found - AI analysis complete'\n\nSee frontend-design skill recommendations for CSS approach.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-04T08:22:40.13106-05:00","created_by":"tim","updated_at":"2026-01-04T12:04:40.044771-05:00","closed_at":"2026-01-04T12:04:40.044771-05:00","close_reason":"Implemented structured empty states with icons and guidance"}
{"id":"pair_review-8mr","title":"Split public/js/pr.js into focused modules","description":"public/js/pr.js is ~21k tokens (over 20k limit). Split into: diff-renderer.js (diff parsing/rendering), comment-manager.js (comment UI), suggestion-manager.js (AI suggestion handling), line-tracker.js (line number mapping). Keep PRManager as thin orchestrator.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T22:05:30.602837-05:00","updated_at":"2026-01-02T23:19:30.776258-05:00","closed_at":"2026-01-02T23:19:30.776258-05:00","dependencies":[{"issue_id":"pair_review-8mr","depends_on_id":"pair_review-y8v","type":"blocks","created_at":"2026-01-02T22:05:45.977928-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-8p6","title":"Fix hidden suggestion expansion performance and edge cases","description":"Address feedback: 1) O(n*m) performance issue - build visible line lookup map, 2) Extract file element lookup helper, 3) Create getLineNumber helper, 4) Handle line ranges (lineEnd), 5) Add better debugging, 6) Filter suggestions on unmodified files in orchestration","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T18:34:37.038953-05:00","updated_at":"2025-12-31T18:37:25.669766-05:00","closed_at":"2025-12-31T18:37:25.669766-05:00"}
{"id":"pair_review-8s6","title":"Add pagination or 'Show more' for older worktrees on index page","description":"Currently the index page only shows recent worktrees. Users should be able to access older worktrees that are still valid but not displayed.\n\nOptions:\n- 'Show more' button to load additional worktrees\n- Pagination controls\n- Infinite scroll\n\nThis would allow users to return to PRs they reviewed previously without having to re-enter the PR URL.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-04T19:50:20.100262-05:00","created_by":"tim","updated_at":"2026-01-04T19:50:20.100262-05:00"}
{"id":"pair_review-8t9","title":"Add subtle grid background pattern","description":"Add the subtle grid pattern overlay from the prototype design:\n- Applied to body::before pseudo-element\n- 24px grid size\n- Very subtle white lines (rgba(255,255,255,0.01))\n- pointer-events: none, z-index: 0\nFiles: public/css/pr.css","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T21:04:36.397859-05:00","updated_at":"2025-12-30T21:46:02.363131-05:00","closed_at":"2025-12-30T21:46:02.363131-05:00","dependencies":[{"issue_id":"pair_review-8t9","depends_on_id":"pair_review-1mp","type":"blocks","created_at":"2025-12-30T21:05:01.606341-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-8uli","title":"Local mode file path normalization inconsistency","description":"In local mode, some file paths are normalized and displayed as relative paths while others remain absolute. This inconsistency may result in AI suggestions that cannot be attached to files because the path formats don't match.\n\nPotential impact:\n- AI suggestions may fail to display inline with the correct files\n- Path comparison logic may not find matching files\n- User confusion when paths appear differently in the UI\n\nAreas to investigate:\n- File path handling in local-review.js\n- Path normalization in the diff display\n- AI suggestion path matching logic\n- Consistency between frontend and backend path representations","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-07T13:51:10.563713-05:00","created_by":"tim","updated_at":"2026-01-07T13:51:10.563713-05:00"}
{"id":"pair_review-8v7","title":"Add segmented control to AI Panel","description":"Replace 'AI Analysis' title with 'Review' and add segmented control with three options: All | AI Findings | Comments. Show counts in each segment. Wire up click handlers to switch views.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:31:16.096055-05:00","updated_at":"2026-01-03T12:36:16.698265-05:00","closed_at":"2026-01-03T12:36:16.698265-05:00","dependencies":[{"issue_id":"pair_review-8v7","depends_on_id":"pair_review-28g","type":"blocks","created_at":"2026-01-03T12:31:27.472982-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-991","title":"Bug: Cannot adopt/edit AI suggestions on deleted lines","description":"When attempting to adopt or edit an AI suggestion on a deleted line in the diff, an error appears: 'Failed to adopt suggestion: Could not determine file and line information'. This should now be supported after the recent side/LEFT handling improvements, but something is still failing in the adoption flow for deleted lines.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-01T12:22:08.0053-05:00","updated_at":"2026-01-01T12:37:39.400047-05:00","closed_at":"2026-01-01T12:37:39.400047-05:00"}
{"id":"pair_review-9bz","title":"Allow selective file review via checkboxes in diff file list","description":"Add the ability to customize which files are included in AI analysis by presenting checkboxes next to each file in the diff file list. Users could select/deselect files before triggering analysis, and the AI prompts would be adjusted to only analyze the selected files. This would be useful for: (1) Large PRs where users want to focus AI analysis on specific areas, (2) Excluding generated files, config changes, or lock files from review, (3) Iterative reviews where some files have already been manually reviewed.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-02T08:13:20.955622-05:00","updated_at":"2026-01-02T08:13:20.955622-05:00"}
{"id":"pair_review-9ce","title":"Implement j/k keyboard navigation","description":"Add global keyboard handlers for j/k to navigate through the active list (respecting current segment filter). Show navigation counter (e.g., '2 of 5'). Highlight current item in panel and scroll to it in diff view.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:31:16.150129-05:00","updated_at":"2026-01-03T12:52:22.682238-05:00","closed_at":"2026-01-03T12:52:22.682238-05:00","dependencies":[{"issue_id":"pair_review-9ce","depends_on_id":"pair_review-28g","type":"blocks","created_at":"2026-01-03T12:31:27.513651-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-9ce","depends_on_id":"pair_review-8v7","type":"blocks","created_at":"2026-01-03T12:31:27.590646-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-9rj","title":"Worktree delete uses parseInt on TEXT id","description":"The delete endpoint does parseInt(req.params.id) but worktree IDs are TEXT (alphanumeric strings like 'x2z'), causing parseInt to return NaN","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-29T09:19:51.428113-05:00","updated_at":"2025-12-29T09:21:54.731385-05:00","closed_at":"2025-12-29T09:21:54.731385-05:00"}
{"id":"pair_review-9s7","title":"Add toggle to include/exclude staged changes in local mode","description":"## Summary\nAdd a UI toggle in local mode to optionally include staged changes in the diff view and AI review.\n\n## Current Behavior\n- Local mode only shows unstaged changes + untracked files\n- Staged changes are excluded from both display and AI review\n- Users can use `git add` to 'hide' files from review\n\n## Proposed Behavior\n- Add a toggle switch in the toolbar (e.g., 'Include Staged')\n- Default: OFF (current behavior - unstaged only)\n- When ON: Include both staged and unstaged changes\n- Toggle state persists in localStorage\n- Affects both diff display and AI analysis\n\n## Implementation Notes\n\n### Effort: Low-medium (~30-60 min)\n\nInfrastructure already exists - `generateLocalDiff()` already generates staged diff separately, just doesn't include it.\n\n### Changes Required\n\n1. **UI** (local.html): Add toggle switch in toolbar area\n2. **State** (local.js): Store toggle in localStorage, pass to API calls\n3. **Backend** (routes/local.js): Add `?includeStaged=true` query param to:\n   - GET /api/local/:reviewId/diff\n   - POST /api/local/:reviewId/refresh\n4. **Diff generation** (local-review.js): Conditionally combine staged+unstaged based on param\n5. **Frontend** (local.js): Re-fetch diff when toggle changes\n\n### Related Code\n- `generateLocalDiff()` in src/local-review.js already tracks staged separately\n- Stats already count staged files (shown as 'excluded from review')","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-04T15:17:52.059492-05:00","created_by":"tim","updated_at":"2026-01-04T15:17:52.059492-05:00"}
{"id":"pair_review-9tw","title":"add syntax high-lighting","description":"Use a library to do this","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:51:02.674219-05:00","updated_at":"2025-12-28T11:47:37.398279-05:00","closed_at":"2025-12-28T11:47:37.398279-05:00"}
{"id":"pair_review-a39","title":"AI Panel: Style depth level checkmarks","description":"Update analysis depth indicators in AI panel:\n- Complete levels show green checkmark icon in green-tinted box\n- Active level shows pulsing amber dot\n- Pending levels show gray circle\n- Use .depth-level-complete class styling from prototype\nFiles: public/css/pr.css, public/js/components/AIPanel.js","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T21:04:37.591808-05:00","updated_at":"2025-12-30T21:47:11.779885-05:00","closed_at":"2025-12-30T21:47:11.779885-05:00","dependencies":[{"issue_id":"pair_review-a39","depends_on_id":"pair_review-1mp","type":"blocks","created_at":"2025-12-30T21:05:02.438283-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-a4d","title":"Wrap long lines","description":"the github UI wraps long lines in the diff display. pair-review should do the same. When a line is wrapped, no line number is shown in the gutter. This must be handled correctly for line selection for commenting, etc.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:47:22.374732-05:00","updated_at":"2025-12-27T09:42:46.785704-05:00","closed_at":"2025-12-27T09:42:46.785704-05:00"}
{"id":"pair_review-ae9","title":"start review from web UI","description":"should be able to paste in a PR URL and have the running UI create workspace to view diff; maybe optionally start the AI review though that could be a separate step for simplicity","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T08:26:05.337455-05:00","updated_at":"2025-12-28T16:45:39.805603-05:00","closed_at":"2025-12-28T16:45:39.805603-05:00","dependencies":[{"issue_id":"pair_review-ae9","depends_on_id":"pair_review-e4k","type":"blocks","created_at":"2025-12-28T15:56:43.559511-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-ana","title":"AI suggestions: Update action button styling","description":"Update suggestion action buttons to match prototype:\n- Adopt: green background (#3fb950), white text, checkmark icon\n- Edit: gray background with border, pencil icon\n- Dismiss: transparent, gray text turns red on hover, X icon\n- All buttons should have icons before text\nFiles: public/js/pr.js, public/css/pr.css","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T21:04:34.579838-05:00","updated_at":"2025-12-30T21:46:02.348945-05:00","closed_at":"2025-12-30T21:46:02.348945-05:00","dependencies":[{"issue_id":"pair_review-ana","depends_on_id":"pair_review-1mp","type":"blocks","created_at":"2025-12-30T21:04:59.720866-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-b2b","title":"Delete worktree button does nothing on landing page","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-29T08:35:37.783385-05:00","updated_at":"2025-12-29T08:37:31.599907-05:00","closed_at":"2025-12-29T08:37:31.599907-05:00"}
{"id":"pair_review-b8y","title":"Hide AI sidebar on landing page","description":"The collapsed AI suggestions sidebar still appears on the landing/index page when no PR is displayed. It should only be visible on PR review pages.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-29T08:05:32.534182-05:00","updated_at":"2025-12-29T08:26:47.275132-05:00","closed_at":"2025-12-29T08:26:47.275132-05:00","dependencies":[{"issue_id":"pair_review-b8y","depends_on_id":"pair_review-jbp","type":"blocks","created_at":"2025-12-29T08:05:54.665252-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-ba1","title":"Local review handler: Generate diff and manage sessions","description":"Create core local review handler module.\n\n## New File: src/local-review.js\n\n### handleLocalReview(targetPath, flags)\n1. Validate git repository (find .git root)\n2. Get HEAD sha for session identity\n3. Build ReviewContext object\n4. Check for existing session or create new\n5. Generate local diff\n6. Start server with local context\n\n### generateLocalDiff(repoPath)\n- Run `git diff --no-color --no-ext-diff --unified=25` (unstaged changes)\n- Get untracked files via `git ls-files --others --exclude-standard`\n- Read untracked file contents (with 1MB limit, binary detection)\n- Return combined diff structure\n\n### Session Identity\n- ID format: `${absolutePath}@${headSha}`\n- New session created when HEAD changes (after commit)\n\n## Helper Functions\n- `findGitRoot(path)` - walk up to find .git\n- `getHeadSha(repoPath)` - git rev-parse HEAD\n- `getUntrackedFiles(repoPath)` - with content reading","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T09:00:19.769198-05:00","created_by":"tim","updated_at":"2026-01-04T09:22:50.847304-05:00","closed_at":"2026-01-04T09:22:50.847304-05:00","close_reason":"Implementation complete, all 183 tests pass","dependencies":[{"issue_id":"pair_review-ba1","depends_on_id":"pair_review-8h3","type":"blocks","created_at":"2026-01-04T09:00:35.1542-05:00","created_by":"tim"},{"issue_id":"pair_review-ba1","depends_on_id":"pair_review-gvx","type":"blocks","created_at":"2026-01-04T09:00:36.55785-05:00","created_by":"tim"}]}
{"id":"pair_review-bcd","title":"File tree: Group files by directory","description":"Update file tree sidebar to group files by parent directory like prototype:\n- Show folder icons with directory names as group headers\n- Files indented under their directory group\n- Collapsible groups (optional)\nFiles: public/js/pr.js, public/css/pr.css","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T21:04:35.391898-05:00","updated_at":"2025-12-30T21:46:02.356366-05:00","closed_at":"2025-12-30T21:46:02.356366-05:00","dependencies":[{"issue_id":"pair_review-bcd","depends_on_id":"pair_review-1mp","type":"blocks","created_at":"2025-12-30T21:05:00.508286-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-bi8","title":"Add UI to view custom instructions used for AI analysis","description":"Custom instructions are stored on review records in the database (via `upsertCustomInstructions`), but there's no way to view them in the UI after an analysis completes.\n\n**Current behavior:**\n- User enters custom instructions in the analysis config modal\n- Instructions are saved to the review record in `custom_instructions` column\n- After analysis, there's no UI element showing what instructions were used\n\n**Expected behavior:**\n- Users should be able to see what custom instructions were used for a given analysis\n- This could be displayed in:\n  - The AI findings panel header/metadata\n  - An expandable section showing \"Analysis settings used\"\n  - The analysis progress modal summary\n\n**Technical notes:**\n- Data is already stored in `reviews.custom_instructions`\n- The `/api/pr/:owner/:repo/:number` endpoint could include this in response\n- Consider also showing the repo default instructions that were applied","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-01T21:05:32.991497-05:00","updated_at":"2026-01-01T21:05:32.991497-05:00"}
{"id":"pair_review-bnm","title":"Create AI provider abstraction layer","description":"Create a base AIProvider class/interface with execute() and testAvailability() methods. Both ClaudeProvider and GeminiProvider will implement this.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:41:45.017866-05:00","updated_at":"2026-01-03T12:52:41.32735-05:00","closed_at":"2026-01-03T12:52:41.32735-05:00"}
{"id":"pair_review-br3x","title":"Refactor local.js PUT/DELETE endpoints to use CommentRepository","description":"The PUT and DELETE file-comment endpoints in src/routes/local.js (lines ~1155 and ~1208) use direct db.run calls instead of CommentRepository methods.\n\nCurrent state:\n- POST /api/local/:reviewId/file-comment uses CommentRepository.createFileComment() ✓\n- PUT /api/local/:reviewId/file-comment/:commentId uses direct run() call\n- DELETE /api/local/:reviewId/file-comment/:commentId uses direct run() call\n\nSuggested refactoring:\n1. Add updateFileComment() method to CommentRepository\n2. Add deleteFileComment() method to CommentRepository (soft delete)\n3. Update PUT endpoint to use repository method\n4. Update DELETE endpoint to use repository method\n\nThis is a style/consistency improvement, not a bug fix. The current code works correctly.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T13:08:07.487674-05:00","created_by":"tim","updated_at":"2026-01-07T13:08:07.487674-05:00"}
{"id":"pair_review-bro","title":"GitHub icon uses wrong color in dark mode","description":"In the header toolbar, the GitHub icon appears blue in dark mode while other icons use the standard light/muted color scheme.\n\nExpected: GitHub icon should use the same color treatment as other toolbar icons (refresh, theme toggle, settings) - likely the light highlight color, possibly inverted for dark mode.\n\nLocation: Header toolbar, rightmost icon","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-04T08:22:40.982122-05:00","created_by":"tim","updated_at":"2026-01-04T08:38:27.564594-05:00","closed_at":"2026-01-04T08:38:27.564594-05:00","close_reason":"Fixed GitHub icon to use text-tertiary color in dark mode"}
{"id":"pair_review-ccl","title":"Analysis modal shows 'Analysis Complete' while analysis still running","description":"The analysis progress modal displays 'Analysis Complete' button prematurely while analysis is still in progress. The button text should reflect the actual analysis state (e.g., 'Analyzing...' or show progress) until analysis truly completes.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-03T21:30:38.11971-05:00","updated_at":"2026-01-04T14:46:57.871087-05:00","closed_at":"2026-01-04T14:46:57.871087-05:00","close_reason":"May no longer be an issue - closing until it resurfaces"}
{"id":"pair_review-cd1v","title":"Add E2E tests for context expansion in diff view","description":"Context expansion (clicking arrows to show more lines around changes in the diff view) has no E2E test coverage.\n\n## E2E Tests Needed\n\n### PR Mode\n1. Click expand arrows to show additional context lines above/below changes\n2. Verify expanded lines display with correct line numbers\n3. Handle error gracefully when file content fails to load\n\n### Local Mode\n1. Context expansion works correctly with local review sessions\n2. Files are read from local repository path (not worktree)\n3. Error handling for missing/moved files\n\n## Notes\n- Integration tests for /api/file-content-original endpoint already exist (routes.test.js)\n- These E2E tests would verify the full UI flow from click to rendered expanded context\n- Lower priority since integration tests cover the API contract","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-07T06:28:35.80131-05:00","created_by":"tim","updated_at":"2026-01-07T06:28:35.80131-05:00"}
{"id":"pair_review-cre","title":"AI sidebar navigation jumps to wrong suggestion after dismissing","description":"## Problem\nNavigation to suggestions from the AI sidebar sometimes moves to the wrong location in the code -- the location of a different suggestion.\n\n## Reproduction\n1. Have multiple AI suggestions displayed\n2. Dismiss one or more suggestions\n3. Click on a remaining suggestion in the AI sidebar\n4. Observe that navigation goes to the wrong code location\n\n## Root Cause Hypothesis\nThe AI panel appears to be using the index of non-dismissed suggestions in the UI rather than pulling navigation information directly from the entry that the user interacts with.\n\n## Expected Behavior\nClicking on a suggestion in the AI sidebar should navigate to that specific suggestion's location, regardless of which other suggestions have been dismissed.\n\n## Fix Approach\nThe click handler should extract file/line information from the clicked element's data attributes (data-file, data-line) rather than relying on array indices that may become stale after dismissals.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T16:27:10.075569-05:00","updated_at":"2025-12-31T16:43:40.592655-05:00","closed_at":"2025-12-31T16:43:40.592655-05:00"}
{"id":"pair_review-ctt","title":"Deleted line comment highlights multiple deleted lines incorrectly","description":"When clicking to comment on a deleted line, not just that line but other deleted lines also get highlighted. The selection/highlighting logic appears to be incorrectly selecting multiple lines when only one deleted line is clicked.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-01T08:49:49.517433-05:00","updated_at":"2026-01-01T12:05:13.058771-05:00","closed_at":"2026-01-01T12:05:13.058771-05:00"}
{"id":"pair_review-cu8","title":"diff display should use more of full window width when sidebars are collapsed","description":"This should be more like gitHub in terms of using most of the window width","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:49:47.191183-05:00","updated_at":"2025-12-27T10:24:50.951641-05:00","closed_at":"2025-12-27T10:24:50.951641-05:00"}
{"id":"pair_review-cwm","title":"Changed Files count shows zero in PR mode","description":"In regular PR review mode (not local mode), the 'Changed Files' count badge in the sidebar header shows zero instead of the actual number of changed files.\n\nThis was likely introduced during the local mode refactor when file count updating was added to local.js but may have broken the equivalent functionality in PR mode.\n\nThe fix likely involves ensuring that the file count is updated in pr.js when diff data is loaded, similar to how it's done in local.js:\n```javascript\nconst fileCountEl = document.querySelector('.file-count');\nif (fileCountEl) {\n  fileCountEl.textContent = files.length;\n}\n```","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-04T15:35:11.237946-05:00","created_by":"tim","updated_at":"2026-01-04T20:01:39.049017-05:00","closed_at":"2026-01-04T20:01:39.049017-05:00","close_reason":"Fixed in commit"}
{"id":"pair_review-d7n","title":"AI suggestions for lines that are not visible","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:46:08.631773-05:00","updated_at":"2025-12-31T20:39:48.812705-05:00","closed_at":"2025-12-31T20:39:48.812705-05:00"}
{"id":"pair_review-d9j","title":"Style differentiation for Findings vs Comments","description":"Add distinct visual styling to differentiate AI findings from user comments: different icons, subtle color treatment (e.g., purple accent for user comments vs existing colors for AI findings), and clear visual hierarchy.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:31:16.177705-05:00","updated_at":"2026-01-03T12:58:12.496366-05:00","closed_at":"2026-01-03T12:58:12.496366-05:00","dependencies":[{"issue_id":"pair_review-d9j","depends_on_id":"pair_review-28g","type":"blocks","created_at":"2026-01-03T12:31:27.532906-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-d9j","depends_on_id":"pair_review-8v7","type":"blocks","created_at":"2026-01-03T12:31:27.611418-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-dam","title":"UI: Capture custom instructions before PR analysis","description":"Add textarea/input field in the PR view that allows users to specify custom instructions before triggering AI analysis. Instructions should indicate what aspects to focus on. When re-running analysis, show previous instructions so user can reuse or modify them.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T18:26:04.776209-05:00","updated_at":"2026-01-01T14:18:45.778017-05:00","closed_at":"2026-01-01T14:18:45.778017-05:00","dependencies":[{"issue_id":"pair_review-dam","depends_on_id":"pair_review-f8b","type":"blocks","created_at":"2025-12-31T18:26:22.300484-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-dam","depends_on_id":"pair_review-fvd","type":"blocks","created_at":"2025-12-31T18:26:23.732922-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-dgm","title":"Add support for file-level user comments","description":"Enable users to add comments at the file level (not tied to a specific line). Currently the UI only supports line-level comments. File-level comments are useful for high-level observations about a file's overall structure, naming, or approach.\n\nImplementation notes:\n- GitHub submission of file-level comments is already supported\n- Data model changes likely required to store file-level comments (comments without line/position)\n- UI needs a way to add/view file-level comments (perhaps in the file header area)","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-02T16:05:25.858233-05:00","updated_at":"2026-01-05T14:45:03.725872-05:00","closed_at":"2026-01-05T14:45:03.725872-05:00","close_reason":"Replaced by epic pair_review-z1do with comprehensive implementation plan"}
{"id":"pair_review-do9","title":"Update Analyzer to use provider abstraction","description":"Change Analyzer to use provider factory instead of directly instantiating ClaudeCLI.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:41:49.550759-05:00","updated_at":"2026-01-03T12:55:03.786898-05:00","closed_at":"2026-01-03T12:55:03.786898-05:00","dependencies":[{"issue_id":"pair_review-do9","depends_on_id":"pair_review-7yo","type":"blocks","created_at":"2026-01-03T12:42:08.769683-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-do9","depends_on_id":"pair_review-n5z","type":"blocks","created_at":"2026-01-03T12:42:09.873218-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-e1d","title":"Add UI to view previous AI analysis runs","description":"Now that AI analysis history is preserved in the database (suggestions are no longer deleted), add UI to view previous analysis runs.\n\nFoundation work done in pair_review-ec2:\n- Old suggestions kept in DB with their ai_run_id\n- Query filters by latest ai_run_id by default\n\nUI to add:\n- Dropdown in Review panel: 'Latest analysis' / 'Jan 4, 2:15p' / 'Jan 3, 11:30a'\n- Selecting older run queries by that ai_run_id instead of latest\n- Show timestamp and maybe suggestion count for each run","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-04T09:49:00.530767-05:00","created_by":"tim","updated_at":"2026-01-04T09:49:00.530767-05:00"}
{"id":"pair_review-e4k","title":"Worktree management","description":"## Overview\nImprove how pair-review manages git worktrees for PR reviews. Currently worktrees are created with predictable names, never cleaned up, and recreated on each use.\n\n## Goals\n1. **Dedicated database tracking** - Move from JSON blob storage to proper `worktrees` table\n2. **Random naming** - Use DB-driven random IDs instead of `{owner}-{repo}-{number}` to indicate these are for app use only\n3. **Worktree reuse** - Refresh existing worktrees instead of recreating; error if local changes exist\n4. **Auto-cleanup** - Clean up stale worktrees (default: 7 days) on server start, configurable retention\n5. **Recent reviews UI** - Landing page shows recently reviewed PRs across all repos\n6. **Start from URL** - Create worktree from PR URL via web UI (existing issue ae9)\n\n## Sub-issues\n- **452**: Add dedicated worktrees database table (start here)\n- **4k0**: Use random IDs for worktree directory names\n- **k7u**: Reuse existing worktree when reopening same PR\n- **0oj**: Auto-cleanup stale worktrees on server start\n- **su1**: Add recently reviewed PRs list to landing page\n- **ae9**: Start review from web UI","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-27T09:14:28.91021-05:00","updated_at":"2025-12-28T16:45:41.212873-05:00","closed_at":"2025-12-28T16:45:41.212873-05:00"}
{"id":"pair_review-ebz","title":"Handle stale worktrees in recent reviews","description":"Old worktrees appear in recent reviews list but clicking them leads to 404 errors. Need to either: (1) validate worktree directories exist before showing them, (2) auto-cleanup stale entries on server start, or (3) add a cleanup command. Should not show non-functional entries to users.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-29T11:48:25.816735-05:00","updated_at":"2025-12-29T11:50:10.392035-05:00","closed_at":"2025-12-29T11:50:10.392035-05:00"}
{"id":"pair_review-ec2","title":"Clear analysis results in UI when new analysis starts","description":"When a user starts a new analysis run, the previous analysis results should be cleared immediately from the UI.\n\nCurrent behavior: Old results remain visible while new analysis is running, which can be confusing.\n\nExpected behavior: Clear all previous suggestions/results as soon as the new analysis begins, showing only the loading/progress state until new results arrive.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-03T21:21:10.242884-05:00","updated_at":"2026-01-04T09:48:49.266307-05:00","closed_at":"2026-01-04T09:48:49.266307-05:00","close_reason":"Clear UI on analysis start, preserve history by querying latest ai_run_id instead of deleting"}
{"id":"pair_review-ecj","title":"Diff display missing lines between hunks with no expand control","description":"**Bug**: The unified diff display has gaps in line numbers between hunks, with no way to expand/reveal the missing lines.\n\n**Observed behavior**:\nIn the screenshot, the diff shows:\n- Lines 669-671 (left) / 718-720 (right) as context\n- Then a hunk header `@@ -699,8 +748,8 @@`\n- But lines 672-698 (left) / 721-747 (right) are completely missing\n\nThere should be ~28 lines between the context and the hunk header, but:\n1. These lines are not displayed\n2. There's no expand/reveal control to show them\n3. Users cannot access this portion of the diff\n\n**Expected behavior**:\nBetween hunks, there should be an expandable context area (like GitHub's \"Load more...\" or expand arrows) that allows users to reveal hidden lines between the displayed context and the next hunk.\n\n**Impact**: High - users cannot see portions of the diff, potentially missing important context for their review.\n\n**Likely cause**: The diff parser or renderer may be collapsing context between hunks without providing an expand mechanism, or the expand controls are not being rendered in certain cases.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-02T11:40:46.8171-05:00","updated_at":"2026-01-02T13:48:37.843347-05:00","closed_at":"2026-01-02T13:48:37.843347-05:00"}
{"id":"pair_review-epg","title":"Review panel UI refinement","description":"Address feedback on the new Review panel navigation UI. Consult frontend-design skill for refinements to reduce visual clutter while maintaining functionality.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-03T13:35:46.167983-05:00","updated_at":"2026-01-03T13:45:14.813198-05:00","closed_at":"2026-01-03T13:45:14.813198-05:00"}
{"id":"pair_review-ezw","title":"AI suggestion and user comment width should never be greater than diff display width","description":"This should be helped by wrapping long lines: pair_review-a4d","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:48:33.629798-05:00","updated_at":"2026-01-01T12:34:50.531712-05:00","closed_at":"2026-01-01T12:34:50.531712-05:00"}
{"id":"pair_review-f3f","title":"E2E tests for toast notifications","description":"Test success and error toast notifications, toast dismissal","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-05T07:09:48.500437-05:00","created_by":"tim","updated_at":"2026-01-05T07:09:48.500437-05:00"}
{"id":"pair_review-f3v","title":"Update user-comment endpoint to accept commit_sha","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T21:40:14.556475-05:00","updated_at":"2025-12-31T21:43:49.080333-05:00","closed_at":"2025-12-31T21:43:49.080333-05:00","dependencies":[{"issue_id":"pair_review-f3v","depends_on_id":"pair_review-m3j","type":"blocks","created_at":"2025-12-31T21:40:23.020503-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-f8b","title":"Customizable AI Analysis Configuration","description":"Epic for implementing user-configurable AI analysis settings. This allows users to customize how the AI reviewer behaves, what types of feedback it provides, and adjust analysis parameters to match their workflow and preferences.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-31T18:13:53.082846-05:00","updated_at":"2026-01-01T14:28:16.530815-05:00","closed_at":"2026-01-01T14:28:16.530815-05:00"}
{"id":"pair_review-fqwt","title":"Consolidate E2E test helper functions into shared module","description":"## Problem\n\nSeveral helper functions are defined within individual E2E spec files, leading to duplication and maintenance challenges:\n\n### In `ai-analysis.spec.js`:\n- `handleAnalysisModals(page)` - Complex conditional logic to manage config modal and confirm dialog states\n- `triggerAnalysisAndWait(page)` - Triggers AI analysis and waits for completion\n- `seedAISuggestions(page)` - Pre-seeds AI suggestions via API\n\n### In `comment-crud.spec.js`:\n- `cleanupAllComments(page)` - Deletes all user comments via API\n- `openCommentFormOnLine(page, lineIndex)` - Opens comment form on a specific line\n\n## Issues\n1. **Duplication**: Similar helpers exist across files\n2. **Complexity**: `handleAnalysisModals` contains complex conditional logic with try/catch for different states\n3. **Maintenance burden**: Changes need to be made in multiple places\n\n## Proposed Solution\n\n1. Move common helpers to `tests/e2e/helpers.js` (which already exists with `waitForDiffToRender`)\n2. Review and simplify complex helpers:\n   - Break `handleAnalysisModals` into smaller, focused functions\n   - Create separate handlers for config modal and confirm dialog\n3. Consider grouping helpers by domain:\n   - Analysis helpers (modal handling, seeding suggestions)\n   - Comment helpers (CRUD operations, form interactions)\n\n## Acceptance Criteria\n- [ ] All reusable helpers consolidated into `helpers.js`\n- [ ] Complex helpers broken down into smaller, focused functions\n- [ ] All E2E tests pass after refactoring\n- [ ] Improved test isolation through clearer helper boundaries","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T10:32:07.485092-05:00","created_by":"tim","updated_at":"2026-01-05T10:32:22.809183-05:00"}
{"id":"pair_review-fvd","title":"DB schema: Store custom instructions per analysis run","description":"Add field(s) to store user-provided custom instructions for each analysis run. Instructions should be associated with the analysis so they can be retrieved when re-running. Consider adding to existing reviews table or creating analysis_runs table.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T18:26:03.893778-05:00","updated_at":"2026-01-01T14:18:45.775257-05:00","closed_at":"2026-01-01T14:18:45.775257-05:00","dependencies":[{"issue_id":"pair_review-fvd","depends_on_id":"pair_review-f8b","type":"blocks","created_at":"2025-12-31T18:26:22.249111-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-g12j","title":"AI analysis should apply comments to specific lines, not surrounding methods","description":"Currently AI suggestions sometimes target a broader context (like an entire method) when the actual issue is on a specific line. The prompts should be strengthened to encourage the AI to:\n\n1. Apply comments directly to the specific line(s) that need attention\n2. Avoid commenting on the method/function signature when the issue is in the body\n3. Be more precise about which exact line contains the bug/issue/improvement\n\nThis would improve the usefulness of suggestions by making them more actionable and easier to review.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-07T06:20:48.721699-05:00","created_by":"tim","updated_at":"2026-01-07T06:20:48.721699-05:00"}
{"id":"pair_review-g7f","title":"Split src/routes/pr.js into focused route modules","description":"## Problem\nsrc/routes/pr.js has grown to 2600+ lines, making it difficult to navigate and maintain.\n\n## Solution\nSplit into focused route modules:\n- `routes/analysis.js` - AI analysis endpoints (/api/analyze/*)\n- `routes/worktrees.js` - Worktree management (/api/worktrees/*)  \n- `routes/comments.js` - Comment CRUD (/api/user-comment/*, /api/ai-suggestion/*)\n- `routes/pr.js` - Core PR data endpoints (/api/pr/*)\n\n## Implementation\n1. Create new route files with extracted endpoints\n2. Update src/server.js to mount the new routers\n3. Ensure shared utilities (like broadcastProgress, getModel) are properly shared\n4. Update any imports in tests\n\n## Notes\nShould be done alongside pair_review-rhh (codebase health epic)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T16:14:39.694292-05:00","updated_at":"2026-01-02T22:58:44.228282-05:00","closed_at":"2026-01-02T22:58:44.228282-05:00","dependencies":[{"issue_id":"pair_review-g7f","depends_on_id":"pair_review-y8v","type":"blocks","created_at":"2026-01-02T22:05:45.927561-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-g7f","depends_on_id":"pair_review-tka","type":"blocks","created_at":"2026-01-02T22:05:45.953125-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-g8zw","title":"Validate AI suggestion line numbers against file length","description":"AI suggestions are sometimes attached to line numbers that don't exist in a file. Need to validate that line_start and line_end are within the file's line count. Validation should happen in: 1) Orchestration step before passing to final analysis, 2) Before database insertion. A simple check: line_start \u003c= file_line_count \u0026\u0026 line_end \u003c= file_line_count.","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-05T07:38:45.593748-05:00","created_by":"tim","updated_at":"2026-01-05T14:35:57.638101-05:00"}
{"id":"pair_review-gcg","title":"Middle panel allows horizontal scroll - suggestions overflow","description":"The diff view middle panel allows horizontal scrolling because suggestion cards and diff content overflow the panel width. Fixed by: 1) Adding overflow-x:hidden to diff-view and diff-container, 2) Adding min-width:0 to flex items, 3) Adding table-layout:fixed to diff table, 4) Adding word-wrap to suggestion body text","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T08:47:01.983503-05:00","updated_at":"2025-12-31T08:47:08.13078-05:00","closed_at":"2025-12-31T08:47:08.13078-05:00"}
{"id":"pair_review-gk3","title":"Untangle AI suggestion show/hide state management","description":"Complex state management issues with AI suggestion visibility and status:\n\n## Current Behavior Problems\n\n1. **AI Panel not updated when suggestion is shown/hidden**: Clicking Show/Hide on a collapsed suggestion doesn't update the AI panel sidebar state.\n\n2. **State ambiguity for adopted vs dismissed**:\n   - Adopted suggestion → Show clicked: Should remain 'adopted' in sidebar (just expanding UI)\n   - Dismissed suggestion → Show clicked: Currently restores to 'active' via API, but sidebar may not update\n\n3. **Edge case: Adopted then user comment deleted**:\n   - User adopts suggestion → suggestion collapses, user comment created\n   - User deletes the user comment\n   - AI suggestion is still collapsed but orphaned\n   - Expected: Should revert to 'dismissed' state in AI panel\n   - Current: State is unclear\n\n## Root Cause\nMultiple code paths handle collapsing/expanding with inconsistent state sync:\n- collapseAISuggestion() for adoption\n- dismissSuggestion() for dismissal  \n- restoreSuggestion() handles both toggle and restore differently\n\n## Suggested Fix\n1. Refactor to single source of truth for suggestion state\n2. Ensure AI panel sidebar always reflects backend state\n3. Handle orphaned adopted suggestions (deleted user comment) gracefully","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-01T13:12:09.79273-05:00","updated_at":"2026-01-01T13:12:09.79273-05:00"}
{"id":"pair_review-gvx","title":"Database schema: Add local review support","description":"Add database migrations and methods to support local reviews.\n\n## Schema Changes\n- Add `review_type` column ('pr' | 'local') with default 'pr'\n- Add `local_path` column (TEXT, nullable)\n- Add `local_head_sha` column (TEXT, nullable)\n- Make `pr_number` nullable for new inserts\n- Add unique index on (local_path, local_head_sha) WHERE review_type='local'\n\n## New Methods\n- `upsertLocalReview(context)` - create/resume local review session\n- `getLocalReview(path, headSha)` - lookup existing session\n- `getLocalReviewById(id)` - fetch by ID for routes\n\n## Notes\n- SQLite can't alter NOT NULL, so handle at app layer\n- Existing PR reviews unaffected (backward compatible)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T09:00:16.658485-05:00","created_by":"tim","updated_at":"2026-01-04T09:19:44.004881-05:00","closed_at":"2026-01-04T09:19:44.004881-05:00","close_reason":"Schema changes implemented, all 183 tests pass","dependencies":[{"issue_id":"pair_review-gvx","depends_on_id":"pair_review-8h3","type":"blocks","created_at":"2026-01-04T09:00:35.066784-05:00","created_by":"tim"}]}
{"id":"pair_review-gxh","title":"Add end-to-end tests with Playwright","description":"Add E2E tests that verify complete user flows work correctly.\n\n## Scope\n- Set up Playwright test framework\n- Test PR page loads and renders correctly\n- Test AI analysis flow (trigger, progress, results)\n- Test comment creation and editing\n- Test review submission\n\n## Key scenarios\n- Load PR page via URL path (/pr/owner/repo/number)\n- Verify file list populates\n- Verify diff renders with line numbers\n- Verify AI suggestions display after analysis\n- Verify comments can be created/edited/deleted\n\n## Benefits\n- Catches frontend-backend integration issues\n- Verifies UI renders correctly\n- Tests realistic user workflows","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T08:21:55.892454-05:00","updated_at":"2026-01-04T21:50:03.316548-05:00","closed_at":"2026-01-04T21:50:03.316548-05:00","close_reason":"Implemented Playwright e2e test framework with 33 passing tests covering PR page load, diff display, file navigation, comment creation, review modal, API integration, UI state management, and accessibility"}
{"id":"pair_review-gyxd","title":"Refactor LocalManager to use Strategy/Adapter pattern instead of monkey-patching","description":"The LocalManager class currently uses monkey-patching to override PRManager methods at runtime. While this works for the current local app context, it creates architectural fragility:\n\n**Current issues:**\n- Tight coupling between LocalManager and PRManager\n- Changes to PRManager could silently break local mode\n- No tests catch regressions in patched methods\n- Harder to understand behavior since methods change at runtime\n\n**Suggested refactoring approaches:**\n1. **Strategy pattern**: PRManager delegates to an 'apiStrategy' object with different implementations for PR vs local mode\n2. **Adapter pattern**: Define a common interface, implement LocalReviewManager and PRManager as interchangeable implementations\n3. **Inheritance**: LocalManager extends PRManager and overrides specific methods\n\n**Benefits of refactoring:**\n- Explicit interface definition\n- Easier to test each mode independently\n- Reduces risk of silent regressions\n- More maintainable codebase\n\n**Current state:**\n- Monkey-patching is documented with comments explaining the approach\n- Initialization order is documented\n- Working correctly for current use case\n\nThis is low priority (P4) since the current approach works and this is a local app with a single maintainer. Consider addressing when adding more modes or significant PRManager changes.","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-05T10:42:25.361019-05:00","created_by":"tim","updated_at":"2026-01-05T10:42:25.361019-05:00"}
{"id":"pair_review-hdq","title":"E2E tests for comment submission","description":"Test complete comment lifecycle - typing and submitting comments, comment appearing in diff, editing comments, deleting comments, multi-line drag selection","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:09:46.721162-05:00","created_by":"tim","updated_at":"2026-01-05T07:29:16.262572-05:00","closed_at":"2026-01-05T07:29:16.262572-05:00","close_reason":"Closed"}
{"id":"pair_review-hin0","title":"Add overall assessment comment when no suggestions to post","description":"When the AI analysis completes with no suggestions to post, the orchestration layer should leave a single praise comment with the overall assessment. This provides feedback to the user even when no issues are found.\n\n**Current behavior:**\n- When no issues are found, the review has no AI comments\n\n**Desired behavior:**\n- Leave a single praise comment containing the overall assessment\n- This gives the reviewer confidence that the analysis ran and found no issues\n- Could include summary like 'Looks good! No issues found in these changes.'\n\n**Future consideration:**\n- May want to always include an overall assessment comment (not just when no suggestions)\n- This would provide consistent feedback regardless of whether issues were found\n\n**Implementation notes:**\n- Modify orchestration layer instructions in analyzer.js\n- The praise comment should summarize what was reviewed and affirm the code quality","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-05T08:14:41.984108-05:00","created_by":"tim","updated_at":"2026-01-05T08:14:41.984108-05:00"}
{"id":"pair_review-hke","title":"Level 3 AI analysis may suggest non-existent file paths","description":"Level 3 (codebase context) AI analysis sometimes generates suggestions that reference file paths which don't exist in the PR diff.\n\n**Fix approach (multi-level):**\n- pair_review-8hw: Path normalization utility (foundation)\n- pair_review-q61: Database failsafe filter (guarantees clean UI)\n- pair_review-toh: Explicit file list in prompts (reduces hallucinations)\n- pair_review-i60: Orchestration validation (catches issues earlier)\n\nRoot causes:\n1. AI hallucinating file paths based on codebase patterns\n2. AI referencing files that exist in repo but aren't in the PR\n3. Path normalization issues between AI output and diff file names","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T21:19:27.114635-05:00","updated_at":"2026-01-04T15:21:40.071334-05:00","closed_at":"2026-01-04T15:21:40.071334-05:00","close_reason":"Implemented multi-level file path validation"}
{"id":"pair_review-i60","title":"Add orchestration validation for suggestion file paths","description":"Add a validation step in the orchestration layer that verifies AI suggestion file paths exist in the PR diff.\n\nRequirements:\n- Validate each suggestion's file path against the diff file list\n- Use normalized paths for comparison\n- Discard suggestions with invalid paths (don't attempt correction)\n- Log discarded suggestions for debugging\n- Keep validation logic simple - just check existence, no fuzzy matching\n\nNote: This is validation only, NOT correction. Correction is risky because:\n- Can't reliably determine what AI 'meant' to reference\n- Fuzzy matching could reassign suggestions to wrong files\n- Misattributed suggestions are worse than missing ones","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T15:13:51.810383-05:00","created_by":"tim","updated_at":"2026-01-04T15:21:40.070257-05:00","closed_at":"2026-01-04T15:21:40.070257-05:00","close_reason":"Implemented multi-level file path validation","dependencies":[{"issue_id":"pair_review-i60","depends_on_id":"pair_review-8hw","type":"blocks","created_at":"2026-01-04T15:14:05.854183-05:00","created_by":"tim"}]}
{"id":"pair_review-igp","title":"Respect .gitattributes linguist-generated files","description":"Files marked with linguist-generated=true in .gitattributes (like package-lock.json, generated code) should be hidden or collapsed by default in the diff view, similar to how GitHub handles them.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-29T11:31:05.970149-05:00","updated_at":"2025-12-29T16:58:42.365511-05:00","closed_at":"2025-12-29T16:58:42.365511-05:00"}
{"id":"pair_review-ijd","title":"Add history/library of custom instructions for AI analysis","description":"Create a way to save, reuse, and manage custom instructions for AI analysis.\n\nFeatures to consider:\n- Save current custom instructions as a named preset\n- Library of saved presets (per-repo and/or global)\n- Quick-select from saved presets when configuring analysis\n- Edit/delete saved presets\n- Import/export presets\n\nUse cases:\n- Different instruction sets for different types of PRs (security review, performance review, etc.)\n- Team-shared instruction templates\n- Project-specific review guidelines that persist across sessions","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-04T09:09:43.560372-05:00","created_by":"tim","updated_at":"2026-01-04T09:09:43.560372-05:00"}
{"id":"pair_review-jbp","title":"Landing page polish","description":"Collection of UI/UX improvements for the landing page to achieve professional quality.\n\n## Issues\n- 38y: URL input field width\n- b8y: Hide AI sidebar on landing page  \n- 41r: Separate index.html and pr.html pages\n- v7u: Repository name styling","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-29T08:05:45.924775-05:00","updated_at":"2025-12-29T08:28:21.591188-05:00","closed_at":"2025-12-29T08:28:21.591188-05:00"}
{"id":"pair_review-jlp","title":"Analyzer: Integrate custom instructions into AI prompts","description":"Modify the AI analyzer prompts to incorporate both PR-level and repo-level custom instructions. Both should be sent to the AI with clear indication that PR instructions take priority over repo instructions when there's conflict. Use supplement model - combine both instruction sets. Use whatever instructions are available (repo only, PR only, or both).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T18:26:09.356792-05:00","updated_at":"2026-01-01T14:18:45.782995-05:00","closed_at":"2026-01-01T14:18:45.782995-05:00","dependencies":[{"issue_id":"pair_review-jlp","depends_on_id":"pair_review-f8b","type":"blocks","created_at":"2025-12-31T18:26:22.460341-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-jlp","depends_on_id":"pair_review-fvd","type":"blocks","created_at":"2025-12-31T18:26:26.812915-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-jlp","depends_on_id":"pair_review-3o2","type":"blocks","created_at":"2025-12-31T18:26:26.843132-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-jmu","title":"Cmd+Enter should save when creating a user comment","description":"Add keyboard shortcut support so users can press Cmd+Enter (Mac) or Ctrl+Enter (Windows/Linux) to save a comment instead of clicking the save button","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T18:23:25.099236-05:00","updated_at":"2026-01-01T10:25:06.816212-05:00","closed_at":"2026-01-01T10:25:06.816212-05:00"}
{"id":"pair_review-jq0","title":"Adopted AI suggestions disappear from AI panel after browser refresh","description":"## Problem\nAdopted AI suggestions are handled incorrectly when the browser is refreshed.\n\n## Current Behavior\nAfter adopting an AI suggestion and refreshing the browser:\n1. The adopted suggestion no longer appears in the AI panel\n2. The suggestion appears TWICE as user comments:\n   - The adopted user comment (correct)\n   - The original AI suggestion styled inline like a user comment (incorrect duplicate)\n3. This creates confusing duplicate display in the diff view\n\n## Expected Behavior\nAfter browser refresh:\n1. Adopted suggestions should remain in the AI panel with \"adopted\" status styling (green tint, no strikethrough)\n2. Only the resulting user comment from adoption should be visible inline\n3. The original AI suggestion should NOT be rendered as a user comment\n4. The adopted state should be properly persisted and restored\n\n## Root Cause Hypothesis\nThe adopted AI suggestions may be getting saved/loaded through a code path that treats them as user comments, causing them to be rendered twice - once through the user comments system and once through whatever is incorrectly styling the AI suggestion as a user comment.\n\n## Impact\n- Users lose visibility of which AI suggestions they've adopted in the AI panel\n- Duplicate comments clutter the diff view and cause confusion\n- The AI panel count/stats become inaccurate after refresh","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T16:29:21.159164-05:00","updated_at":"2025-12-31T16:48:12.127787-05:00","closed_at":"2025-12-31T16:48:12.127787-05:00"}
{"id":"pair_review-k21","title":"Implement proper database migration version tracking","description":"The database.js file has 5 migrations defined (versions 1-5) but there's no schema_version table or PRAGMA user_version check before running migrations. This means migrations might run repeatedly or in the wrong order, potentially corrupting the database.\n\n**Current behavior:**\n- Migrations are defined but version tracking relies on checking if columns/tables exist\n- No explicit version number stored in the database\n- Risk of migrations running out of order or being skipped\n\n**Suggested implementation:**\n- Use SQLite's PRAGMA user_version to track the current schema version\n- Check the current version before running migrations\n- Only apply migrations not yet executed\n- Update user_version after each successful migration\n\n**Example pattern:**\n```javascript\nconst currentVersion = db.pragma('user_version', { simple: true });\nif (currentVersion \u003c CURRENT_SCHEMA_VERSION) {\n  for (let v = currentVersion + 1; v \u003c= CURRENT_SCHEMA_VERSION; v++) {\n    migrations[v](db);\n    db.pragma(`user_version = ${v}`);\n  }\n}\n```\n\nThis is a fundamental database migration pattern that ensures migrations apply exactly once and in sequence.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-04T18:58:34.484872-05:00","created_by":"tim","updated_at":"2026-01-04T18:58:34.484872-05:00"}
{"id":"pair_review-k48y","title":"Diff view line number gaps prevent comment placement on expanded lines","description":"Significant regression: The diff view displays gaps in RIGHT side line numbers when expanding context. In the screenshot, line numbers jump from 1031 to 1069 (missing lines 1032-1068), but the actual code lines are shown.\n\nThis breaks the comment placement feature because:\n- Comments are supposed to be placed on hidden lines that get expanded\n- When line numbers have gaps, comments cannot be correctly positioned within the diff view\n- The line number tracking appears to be out of sync with the actual displayed content\n\nSymptoms observed:\n- LEFT line numbers: 1030, 1031, (missing), 1032, 1033, 1034, 1035\n- RIGHT line numbers: 1068, 1069, 1070, 1071, 1072, 1073 (but gap between 1031 and 1069 visible)\n- The visual display shows contiguous code but line numbers don't match\n\nAreas to investigate:\n- Diff rendering logic for expanded context sections\n- Line number calculation when expanding hidden lines\n- Context expansion code that reveals lines for comment placement","status":"open","priority":1,"issue_type":"bug","created_at":"2026-01-07T14:32:59.11647-05:00","created_by":"tim","updated_at":"2026-01-07T14:32:59.11647-05:00"}
{"id":"pair_review-k5z","title":"Legacy worktrees are orphaned and not cleaned up","description":"## Problem\nAfter disabling the broken migration (commit 51bd68e), legacy worktrees created before the random ID system are now orphaned:\n\n1. **Not in Recent Reviews** - They have no database records\n2. **Not auto-cleaned** - Cleanup only works on DB records\n3. **Disk space waste** - Users accumulate orphaned worktrees\n4. **Duplicates created** - Opening an old PR creates a NEW worktree instead of reusing\n\n## Root Cause\nThe migration was disabled because it couldn't reliably parse directory names like `in-the-loop-labs-pair-review-123` - it's ambiguous which hyphen separates owner from repo when repo names contain hyphens.\n\n## User Experience Impact\n- Old reviews invisible in UI\n- Disk fills up with orphaned worktrees\n- Re-reviewing old PRs wastes time cloning again\n\n## Recommended Fix: Smart Detection\nWhen `createWorktreeForPR` is called:\n1. Check DB for existing record (current behavior)\n2. If not found, construct legacy path from PR info: `${owner}-${repo}-${number}`\n3. Check if that legacy directory exists AND is a valid git worktree\n4. If yes: create DB record for it and reuse (no parsing ambiguity - we know the owner/repo)\n5. If no: create new worktree with random ID (current behavior)\n\nThis works because we already have the parsed PR info from GitHub - no need to reverse-parse the directory name.\n\n## Implementation\nModify `GitWorktreeManager.createWorktreeForPR()` in `src/git/worktree.js`:\n```javascript\n// After DB lookup fails, before generating new random ID:\nconst legacyDirName = `${prInfo.owner}-${prInfo.repo}-${prInfo.number}`;\nconst legacyPath = path.join(this.worktreeBaseDir, legacyDirName);\nif (await this.pathExists(legacyPath)) {\n  // Validate it's a git worktree and create DB record\n  // Then reuse it\n}\n```","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-29T16:14:40.409453-05:00","updated_at":"2025-12-29T16:24:53.964125-05:00","closed_at":"2025-12-29T16:24:53.964125-05:00"}
{"id":"pair_review-k7u","title":"Reuse existing worktree when reopening same PR","description":"## Problem\nCurrently, opening a PR always deletes and recreates the worktree. This is wasteful if the worktree already exists.\n\n## Solution\nWhen opening a PR:\n1. Check if worktree exists in DB for this PR\n2. If exists and directory is valid:\n   - Check for local uncommitted changes\n   - If local changes exist → **error** (user must resolve manually)\n   - If clean → refresh from remote (git fetch + reset to PR head)\n   - Update `last_accessed_at` timestamp\n3. If not exists → create new worktree as usual\n\n## Implementation\n1. Add `WorktreeManager.refreshWorktree(worktreeRecord)` method:\n   - `git status --porcelain` to check for changes\n   - Throw error if uncommitted changes detected\n   - `git fetch origin pull/{number}/head` \n   - `git reset --hard FETCH_HEAD`\n2. Update `createWorktreeForPR()` to check DB first\n3. Add `WorktreeManager.hasLocalChanges(worktreePath)` helper\n\n## Error Message\n\"Worktree has uncommitted changes. Please resolve manually at: {path}\"\n\n## Dependencies\n- Requires worktrees database table (pair_review-452)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T15:56:21.508022-05:00","updated_at":"2025-12-28T16:25:23.759805-05:00","closed_at":"2025-12-28T16:25:23.759805-05:00","dependencies":[{"issue_id":"pair_review-k7u","depends_on_id":"pair_review-452","type":"blocks","created_at":"2025-12-28T15:56:34.965844-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-k7u","depends_on_id":"pair_review-e4k","type":"blocks","created_at":"2025-12-28T15:56:43.493547-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-kc6","title":"worktree naming convention","description":"instead of just using a random identifier for worktrees we should use a convention that indidcates that it came from pair-review. I.e. pair-review--xyz. Including the org + repo name is likely redundant as it is already a worktree for the repo it is associated with.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T12:23:51.866154-05:00","updated_at":"2026-01-04T19:50:47.837834-05:00","closed_at":"2026-01-04T19:50:47.837834-05:00","close_reason":"Implemented in commit 0649d51"}
{"id":"pair_review-ked","title":"Add provider selection to UI","description":"Add provider dropdown/selector to AnalysisConfigModal. Model options should change based on selected provider.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:41:51.779796-05:00","updated_at":"2026-01-03T13:03:50.410235-05:00","closed_at":"2026-01-03T13:03:50.410235-05:00","dependencies":[{"issue_id":"pair_review-ked","depends_on_id":"pair_review-do9","type":"blocks","created_at":"2026-01-03T12:42:11.579846-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-ked","depends_on_id":"pair_review-416","type":"blocks","created_at":"2026-01-03T12:42:12.684736-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-kes","title":"Fix N+1 query in recent worktrees endpoint","description":"The /api/worktrees/recent endpoint fetches worktrees then queries pr_metadata individually for each. Should use JOIN query instead.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T09:20:03.302894-05:00","updated_at":"2025-12-29T09:21:57.040464-05:00","closed_at":"2025-12-29T09:21:57.040464-05:00"}
{"id":"pair_review-ku8","title":"Auto-expand hidden lines when AI suggestions target them","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T18:11:22.226972-05:00","updated_at":"2025-12-31T18:15:24.057671-05:00","closed_at":"2025-12-31T18:15:24.057671-05:00"}
{"id":"pair_review-l7mm","title":"Dark mode: Edit and Dismiss button icon highlights too dark","description":"In dark mode, the highlight color for icons on Edit and Dismiss buttons is too dark, making them difficult to see against the dark background.\n\n**Expected behavior:**\nIcon highlights should be lighter in dark mode for better visibility and contrast.\n\n**Actual behavior:**\nThe highlight color is too dark, reducing visibility of the icons.\n\n**Affected components:**\n- Edit button icon\n- Dismiss button icon\n\n**Visual reference:**\nSee screenshot showing dark highlights that blend too much with the dark background.","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-05T20:40:36.348396-05:00","created_by":"tim","updated_at":"2026-01-06T07:23:11.865503-05:00","closed_at":"2026-01-06T07:23:11.865503-05:00","close_reason":"Fixed by updating hover styles to use proper CSS variables without hardcoded dark fallbacks. Edit button now uses --color-bg-secondary and --color-text-primary for better contrast in dark mode."}
{"id":"pair_review-lmk","title":"Add TypeScript for shared API types","description":"Add TypeScript type definitions shared between frontend and backend.\n\n## Problem solved\nProperty name mismatches between frontend and backend (e.g., files vs changed_files)\nare only caught at runtime. Type checking would catch these at build time.\n\n## Implementation approach\n1. Create shared types in src/types/ directory\n2. Define interfaces for API request/response shapes\n3. Add JSDoc type annotations to existing JS files (gradual adoption)\n4. Or convert critical files to TypeScript\n\n## Key types needed\n- PRMetadata - PR data from main endpoint\n- DiffResponse - diff endpoint response\n- Comment - user comment structure\n- AISuggestion - AI suggestion structure\n\n## Benefits\n- Compile-time checking of property names\n- IDE autocomplete and error detection\n- Self-documenting API contracts","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-03T08:21:59.794613-05:00","updated_at":"2026-01-03T08:21:59.794613-05:00"}
{"id":"pair_review-m3j","title":"Add commit_sha column to comments table","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T21:40:13.641056-05:00","updated_at":"2025-12-31T21:40:57.474728-05:00","closed_at":"2025-12-31T21:40:57.474728-05:00"}
{"id":"pair_review-m3p","title":"Apply file path validation to local mode analysis","description":"The multi-level file path validation approach implemented in PR #69 for PR mode needs to also be applied to local mode support (currently in progress).\n\nPR #69 added:\n- Path normalization utility for consistent comparison\n- Explicit file list in Level 2/3 analysis prompts\n- Orchestration validation to filter invalid paths\n- Database failsafe filter before storing suggestions\n\nWhen local mode analysis is implemented, ensure the same validation layers are applied:\n1. Include changed files list in prompts (from git diff or staged files)\n2. Validate suggestion paths against the actual changed files\n3. Filter invalid paths before storage\n\nReference: https://github.com/in-the-loop-labs/pair-review/pull/69","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T19:09:24.580877-05:00","created_by":"tim","updated_at":"2026-01-06T12:10:53.287932-05:00","closed_at":"2026-01-06T12:10:53.287932-05:00","close_reason":"Implemented in commit 589f510: changedFiles parameter threaded through all analysis methods, path validation at each level, database failsafe uses changedFiles for local mode"}
{"id":"pair_review-mb7","title":"Add Gemini CLI as alternative AI provider","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-03T12:41:27.377115-05:00","updated_at":"2026-01-03T13:03:50.435216-05:00","closed_at":"2026-01-03T13:03:50.435216-05:00"}
{"id":"pair_review-moe","title":"Add checkbox to clear user comments when re-analyzing","description":"When re-running AI analysis on a PR that has existing suggestions, a dialog warns that previous AI results will be cleared. \n\nConsider adding a checkbox option to also clear user comments at the same time. This would be useful when:\n- Starting fresh on a significantly changed PR\n- User comments were based on old AI suggestions that are being replaced\n- User wants a clean slate for the new analysis\n\nThe checkbox should be unchecked by default (preserving user comments is the safer default). Label could be something like 'Also clear my comments'.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-04T08:44:56.655607-05:00","created_by":"tim","updated_at":"2026-01-04T08:44:56.655607-05:00"}
{"id":"pair_review-mxo","title":"E2E tests for complete user workflows","description":"Test full workflows like: Load PR -\u003e Run AI -\u003e Adopt suggestion -\u003e Add comment -\u003e Submit review","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-05T07:09:50.539921-05:00","created_by":"tim","updated_at":"2026-01-05T07:09:50.539921-05:00"}
{"id":"pair_review-mzl","title":"Update AI prompts to allow comments on any line in modified files","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T18:11:21.349196-05:00","updated_at":"2025-12-31T18:15:24.054259-05:00","closed_at":"2025-12-31T18:15:24.054259-05:00"}
{"id":"pair_review-n5z","title":"Implement GeminiProvider for Gemini CLI","description":"Create GeminiProvider implementing AIProvider. Use positional prompt with -o json output format. Models: gemini-2.5-flash (fast), gemini-2.5-pro (balanced), gemini-2.5-pro (thorough).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:41:48.594499-05:00","updated_at":"2026-01-03T12:52:41.330643-05:00","closed_at":"2026-01-03T12:52:41.330643-05:00","dependencies":[{"issue_id":"pair_review-n5z","depends_on_id":"pair_review-bnm","type":"blocks","created_at":"2026-01-03T12:42:07.801403-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-nn5","title":"Preview modal shows incorrect/duplicate comments vs button count","description":"## Problem\nThe Preview modal is not correctly showing only the current user comments. The comment count on the button doesn't match what appears in the preview.\n\n## Current Behavior\n- Button shows N comments (e.g., \"Preview (3)\")\n- Preview modal contains more comments than expected\n- Includes doubled-up comments from AI suggestions\n- Count mismatch between button and preview content\n\n## Expected Behavior\n- Button count should accurately reflect the number of user comments\n- Preview should show exactly those comments, no more, no less\n- No duplicate entries from AI suggestions\n- Preview content should match the count displayed on the button\n\n## Related Issues\nThis may be related to pair_review-jq0 (adopted AI suggestions handled incorrectly on refresh) - the duplicate AI suggestion comments could be contaminating the preview.\n\n## Impact\n- Users cannot trust the comment count\n- Preview is unreliable for reviewing what will be submitted\n- Potential for submitting duplicate or unexpected comments to GitHub","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-31T16:39:52.932738-05:00","updated_at":"2025-12-31T17:06:40.870998-05:00","closed_at":"2025-12-31T17:06:40.870998-05:00"}
{"id":"pair_review-nwv","title":"E2E tests for theme toggle","description":"Test dark/light mode switching","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-05T07:09:49.680907-05:00","created_by":"tim","updated_at":"2026-01-05T07:09:49.680907-05:00"}
{"id":"pair_review-nxs","title":"Refactor createGapSection and createCollapsedSection to extract shared logic","description":"The createGapSection and createCollapsedSection functions in public/js/pr.js share ~140 lines of nearly identical logic for determining icon display, creating buttons, and attaching event handlers. Extract shared logic into helper functions (e.g., createExpandButton, determineIconDisplay, attachExpansionHandler) to reduce duplication and improve maintainability.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T08:53:32.750789-05:00","updated_at":"2026-01-02T23:24:41.825393-05:00","closed_at":"2026-01-02T23:24:41.825393-05:00","dependencies":[{"issue_id":"pair_review-nxs","depends_on_id":"pair_review-y8v","type":"blocks","created_at":"2026-01-02T22:05:46.001553-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-o4c","title":"Consider splitting pr.css into smaller files","description":"pr.css has grown large and contains styles for many different components (dialogs, toasts, diff view, header, etc). Consider splitting into smaller, more maintainable files:\n\n- components/dialog.css\n- components/toast.css  \n- components/header.css\n- diff.css\n- etc.\n\nThis would improve maintainability and make it easier to find relevant styles.","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-04T08:43:38.154463-05:00","created_by":"tim","updated_at":"2026-01-04T08:43:38.154463-05:00"}
{"id":"pair_review-o75","title":"Add frontend unit tests","description":"Add unit tests for critical frontend JavaScript modules.\n\n## Modules to test\n- public/js/pr.js - PRManager class\n- public/js/modules/hunk-parser.js - diff parsing\n- public/js/modules/line-tracker.js - line number tracking\n- public/js/modules/comment-manager.js - comment handling\n- public/js/modules/suggestion-manager.js - AI suggestions\n\n## Key functions to test\n- parseUnifiedDiff() - splits diff by file\n- loadAndDisplayFiles() - fetches and renders diff\n- updateFileList() - populates sidebar\n- renderDiff() - renders diff content\n\n## Implementation\n- Use Vitest with jsdom environment\n- Mock fetch() for API calls\n- Test DOM manipulation results","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-03T08:21:58.609262-05:00","updated_at":"2026-01-03T08:21:58.609262-05:00"}
{"id":"pair_review-oow","title":"Update frontend to send commit_sha with comments","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T21:40:16.499453-05:00","updated_at":"2025-12-31T21:43:49.085942-05:00","closed_at":"2025-12-31T21:43:49.085942-05:00","dependencies":[{"issue_id":"pair_review-oow","depends_on_id":"pair_review-m3j","type":"blocks","created_at":"2025-12-31T21:40:23.083176-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-p8n","title":"Change AI suggestion icon from single sparkle to sparkles","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-31T17:33:12.435408-05:00","updated_at":"2025-12-31T17:53:53.043807-05:00","closed_at":"2025-12-31T17:53:53.043807-05:00"}
{"id":"pair_review-pfu","title":"Frontend: Local mode detection and UI adaptations","description":"Update frontend to support local review mode.\n\n## Mode Detection\n- Detect URL pattern: `/local/:reviewId` vs `/pr/:owner/:repo/:number`\n- Set global mode flag for conditional rendering\n\n## UI Changes - Header\n- Add 'Local Mode' badge (highly visible)\n- Show current branch name (styled differently than PR branch)\n- Show repository name (from filesystem path basename)\n- Hide/remove PR-specific metadata (title, author, description)\n\n## UI Changes - Actions\n- Hide 'Submit Review to GitHub' button\n- Keep 'Export Comments' functionality (make more prominent?)\n- Keep AI analysis buttons (unchanged)\n\n## API Calls\n- Route to /api/local/* endpoints when in local mode\n- Route to /api/pr/* endpoints when in PR mode\n\n## Styling\n- Local Mode badge should be distinct (different color than PR elements)\n- Branch name should indicate 'reviewing changes TO this branch' not 'reviewing this branch'","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T09:00:21.786494-05:00","created_by":"tim","updated_at":"2026-01-04T09:38:44.212392-05:00","closed_at":"2026-01-04T09:38:44.212392-05:00","close_reason":"Frontend implementation complete with local.html and local.js","dependencies":[{"issue_id":"pair_review-pfu","depends_on_id":"pair_review-8h3","type":"blocks","created_at":"2026-01-04T09:00:35.235082-05:00","created_by":"tim"},{"issue_id":"pair_review-pfu","depends_on_id":"pair_review-6mb","type":"blocks","created_at":"2026-01-04T09:00:36.642396-05:00","created_by":"tim"}]}
{"id":"pair_review-pqb","title":"Hide type badges or restyle to prototype","description":"The prototype shows 'AI Suggestion' badge instead of type-specific badges. Either:\n- Replace type badges (Design, Improvement, Bug) with unified 'AI Suggestion' badge\n- Or restyle type badges to be more subtle and consistent\nFiles: public/js/pr.js, public/css/pr.css","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T21:04:39.823156-05:00","updated_at":"2025-12-30T21:46:02.369573-05:00","closed_at":"2025-12-30T21:46:02.369573-05:00","dependencies":[{"issue_id":"pair_review-pqb","depends_on_id":"pair_review-1mp","type":"blocks","created_at":"2025-12-30T21:05:04.692134-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-pqh","title":"Bug: Dark mode syntax highlight blue too low contrast","description":"The blue color used for values (strings, etc.) in dark mode syntax highlighting has insufficient contrast, making it hard to read:\n\n1. Against green (addition) backgrounds - very poor readability\n2. Against red (deletion) backgrounds - very poor readability  \n3. Even on unmodified lines - still too dark\n\nThe blue needs to be brighter/lighter for adequate contrast in all cases. This affects code readability during review.\n\nSee attached screenshot showing the issue on a green addition line where the blue string values are barely visible.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-01T11:21:13.6125-05:00","updated_at":"2026-01-01T12:05:13.031845-05:00","closed_at":"2026-01-01T12:05:13.031845-05:00"}
{"id":"pair_review-ptt","title":"Index page should link each repo to its settings page","description":"Now that repository settings exist (for configuring AI analysis customizations like focus areas and custom instructions), the index page should provide a way to access these settings for each repository. Add a settings icon/link next to each repository entry on the index page that navigates to the repo settings page.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-02T08:24:19.373841-05:00","updated_at":"2026-01-02T11:35:11.547591-05:00","closed_at":"2026-01-02T11:35:11.547591-05:00"}
{"id":"pair_review-q61","title":"Add database failsafe filter for invalid suggestion paths","description":"Add a final validation layer before saving AI suggestions to the database that filters out suggestions with file paths not in the PR diff.\n\nRequirements:\n- Compare suggestion file paths against the list of files in the PR diff\n- Use normalized paths for comparison\n- Log filtered suggestions (for debugging/tuning upstream processes)\n- Silent to users - they never see filtered garbage\n- Must be deterministic and simple\n\nThis guarantees no invalid suggestions reach the UI regardless of upstream failures.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-04T15:13:49.606881-05:00","created_by":"tim","updated_at":"2026-01-04T15:21:40.067845-05:00","closed_at":"2026-01-04T15:21:40.067845-05:00","close_reason":"Implemented multi-level file path validation","dependencies":[{"issue_id":"pair_review-q61","depends_on_id":"pair_review-8hw","type":"blocks","created_at":"2026-01-04T15:14:05.827714-05:00","created_by":"tim"}]}
{"id":"pair_review-qaj","title":"add support for context7","description":"This MCP could be useful for providing context on frameworks and libraries during review. It should be passed as a command line arg to . The pair-review configuration (or env variable) could be used for specifying a context7 API key.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T08:52:42.774364-05:00","updated_at":"2025-12-27T08:52:42.774364-05:00"}
{"id":"pair_review-qxu","title":"AI suggestion cards: Apply prototype card styling","description":"Update .ai-suggestion CSS to match prototype:\n- Remove any light/white backgrounds\n- Ensure consistent dark tertiary background (#181c23)\n- Amber left border (3px solid)\n- Amber glow shadow (box-shadow: 0 0 20px rgba(245,158,11,0.2))\n- Header with gradient background (amber-subtle → transparent)\n- Proper overflow:hidden and border-radius:6px\nFiles: public/css/pr.css","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T21:04:31.001466-05:00","updated_at":"2025-12-30T21:46:02.334645-05:00","closed_at":"2025-12-30T21:46:02.334645-05:00","dependencies":[{"issue_id":"pair_review-qxu","depends_on_id":"pair_review-1mp","type":"blocks","created_at":"2025-12-30T21:04:55.191321-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-r2g","title":"UI: Display latest commit SHA on PR page","description":"Show the latest commit SHA that was synced/fetched in the PR page UI. This helps reviewers understand exactly which version of the code they are reviewing, especially useful when PRs are updated during a review session. Consider placement in the header area near PR title/metadata.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T21:00:36.491345-05:00","updated_at":"2026-01-01T10:20:52.155106-05:00","closed_at":"2026-01-01T10:20:52.155106-05:00"}
{"id":"pair_review-r62","title":"E2E tests for split button dropdown","description":"Test split button dropdown options, not just main button","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-05T07:09:51.372494-05:00","created_by":"tim","updated_at":"2026-01-05T07:09:51.372494-05:00"}
{"id":"pair_review-r7r","title":"Diff view: Update hunk header styling","description":"Update diff hunk headers to match prototype:\n- 'Expand N lines' button with expand icon\n- Hunk info showing @@ diff locations in muted color\n- Background color matching tertiary bg\nFiles: public/css/pr.css","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T21:04:38.443928-05:00","updated_at":"2025-12-30T21:46:02.375187-05:00","closed_at":"2025-12-30T21:46:02.375187-05:00","dependencies":[{"issue_id":"pair_review-r7r","depends_on_id":"pair_review-1mp","type":"blocks","created_at":"2025-12-30T21:05:03.540571-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-rat","title":"add model selector when triggering AI analysis from UI","description":"Instead of starting analysis immediately there should be an intermediate dialog with an option to select the model. In the future, this dialog could grow to support other options like custom instructions","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T09:13:51.751693-05:00","updated_at":"2026-01-01T14:18:45.78107-05:00","closed_at":"2026-01-01T14:18:45.78107-05:00"}
{"id":"pair_review-rhh","title":"codebase health","description":"some files are getting large. how should the codebase be refactored for long-term maintenanc","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-27T09:15:29.949674-05:00","updated_at":"2026-01-02T23:25:05.707533-05:00","closed_at":"2026-01-02T23:25:05.707533-05:00","dependencies":[{"issue_id":"pair_review-rhh","depends_on_id":"pair_review-g7f","type":"blocks","created_at":"2025-12-29T16:15:26.225629-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-rhh","depends_on_id":"pair_review-8mr","type":"blocks","created_at":"2026-01-02T22:05:47.192892-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-rhh","depends_on_id":"pair_review-nxs","type":"blocks","created_at":"2026-01-02T22:05:47.214985-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-s26","title":"Improve diff hunk header display - hide raw @@ syntax, emphasize function context","description":"## Problem\n\nThe current diff view displays raw unified diff headers like:\n`@@ -5405,9 +5417,25 @@ body:not([data-theme=\"dark\"]) .theme-icon-light {`\n\nThis exposes developer plumbing as UI. The `@@` markers and line position metadata (-5405,9 +5417,25) are noise - this information is already visible in the line number columns.\n\n## Analysis: What's Useful vs. Noise\n\n| Element | Example | Usefulness | Verdict |\n|---------|---------|------------|---------|\n| `@@` markers | `@@...@@` | None - syntax artifact | **Remove** |\n| Old position | `-5405,9` | Low - visible in gutter | **Remove** |\n| New position | `+5417,25` | Low - visible in gutter | **Remove** |\n| Function context | `.theme-icon-light {` | **High** - orientation | **Emphasize** |\n\n## How Major Platforms Handle This\n\n**GitHub** (gold standard):\n- Completely hides `@@` syntax and line number metadata\n- Shows **only** the function context in a subtle, muted row\n- Uses light blue/gray background with smaller, dimmed text\n- Treats it as a \"section divider\" not a data row\n\n**GitLab**: Similar - function context only, de-emphasized styling\n\n**VS Code**: Shows function context as collapsible section header, no raw diff syntax\n\n## Recommended Visual Treatment\n\n```\nCURRENT (noisy):\n@@ -5405,9 +5417,25 @@ body:not([data-theme=\"dark\"]) .theme-icon-light {\n\nRECOMMENDED (clean):\nƒ  .theme-icon-light { ...\n```\n\n## Implementation Steps\n\n### 1. Parse and Extract Function Context\n\nCurrently in `pr.js` line ~1062:\n```javascript\nheaderRow.innerHTML = `\u003ctd colspan=\"2\" class=\"d2h-info\"\u003e${block.header}\u003c/td\u003e`;\n```\n\nChange to extract only function context:\n```javascript\nfunction extractFunctionContext(header) {\n  // header format: \"@@ -old,count +new,count @@ optional context\"\n  const match = header.match(/^@@[^@]+@@\\s*(.*)$/);\n  return match ? match[1].trim() : null;\n}\n\nconst functionContext = extractFunctionContext(block.header);\nconst contextDisplay = functionContext \n  ? `\u003cspan class=\"hunk-context-icon\"\u003eƒ\u003c/span\u003e${escapeHtml(functionContext)}`\n  : '···';  // fallback for headers without function context\n```\n\n### 2. Update Styling\n\n```css\n.d2h-info {\n  /* De-emphasize - navigational, not primary content */\n  font-size: 0.85em;\n  color: var(--color-text-muted);\n  opacity: 0.7;\n  font-family: var(--font-mono);\n  \n  /* Subtle background - lighter than current teal */\n  background: var(--color-bg-subtle);\n  \n  /* Visual breathing room */\n  padding: 4px 12px;\n  \n  /* Differentiate from code */\n  font-style: italic;\n}\n\n.hunk-context-icon {\n  margin-right: 8px;\n  opacity: 0.5;\n}\n```\n\n### 3. Dynamic Visibility Rules\n\nThe function context should be hidden/minimized when:\n\n1. **Definition is visible**: If expanded context includes a line matching the function pattern, the header becomes redundant\n2. **Hunks merge**: When expanding causes two hunks to become adjacent (no gap), remove second header\n3. **Replace with divider**: When hiding, optionally replace with subtle `───` break\n\n```javascript\nfunction shouldShowFunctionContext(hunk, expandedLines, previousHunkEnd) {\n  // Check if expanded context includes the function definition\n  const functionPattern = extractFunctionPattern(hunk.context);\n  const definitionVisible = functionPattern \u0026\u0026 expandedLines.some(line =\u003e \n    line.content.includes(functionPattern)\n  );\n  \n  // Check if this hunk has merged with the previous one\n  const mergedWithPrevious = previousHunkEnd \u0026\u0026 hunk.startLine \u003c= previousHunkEnd + 1;\n  \n  return !definitionVisible \u0026\u0026 !mergedWithPrevious;\n}\n```\n\n## Context Visibility Matrix\n\n| Scenario | Context Visible | Function Header |\n|----------|-----------------|-----------------|\n| Initial diff view | Only changed lines + 3 context | **Show** |\n| Partially expanded | ~10-20 extra lines | **Show** |\n| Fully expanded to function | Function definition visible | **Hide** (redundant) |\n| Hunks merged together | Continuous code block | **Hide** (misleading) |\n\n## Key Insight\n\nThe function context header is a **compression artifact** - it exists because git shows only a slice of the file. Once the user can see the actual function/selector definition in the expanded code, the header becomes redundant.\n\n**Goal**: Show function context when it provides orientation you can't get from visible code. Hide it when the code provides that orientation itself.\n\n## Files to Modify\n\n- `public/js/pr.js` - line ~1062 (header rendering), gap detection logic\n- `public/css/pr.css` - `.d2h-info` styling updates\n\n## Related\n\nThis is a UX improvement identified during the diff hunk bug fix work (beads-ecj).","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-02T14:02:45.477656-05:00","updated_at":"2026-01-02T15:49:17.656484-05:00","closed_at":"2026-01-02T15:49:17.656484-05:00"}
{"id":"pair_review-s33","title":"UI Redesign: Command Center Elegance","description":"Implement the full design refresh based on the prototype in design-refresh/. Key goals:\n- Position AI as a prominent co-reviewer with amber/gold identity\n- Sticky header that remains at top of window\n- Three-panel layout with AI Analysis Panel on right\n- Refined typography and spacing throughout\n- Professional, streamlined, minimal aesthetic focused on productivity\n\nReference: design-refresh/index.html","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-30T19:38:02.070042-05:00","updated_at":"2025-12-30T19:52:42.437222-05:00","closed_at":"2025-12-30T19:52:42.437222-05:00"}
{"id":"pair_review-s33.1","title":"Sticky header with PR info and actions","description":"Implement a sticky header that remains positioned at the top of the window as user scrolls through the diff.\n\nHeader should include:\n- Logo/branding on left\n- PR title, number, branch info in center\n- Stats (+/-lines, file count)\n- Action buttons on right (View on GitHub, Submit Review)\n\nReference: design-refresh/index.html .header styles","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T19:38:16.88726-05:00","updated_at":"2025-12-30T19:51:23.795126-05:00","closed_at":"2025-12-30T19:51:23.795126-05:00","dependencies":[{"issue_id":"pair_review-s33.1","depends_on_id":"pair_review-s33","type":"parent-child","created_at":"2025-12-30T19:38:16.887606-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-s33.2","title":"AI Analysis Panel (right sidebar)","description":"Add a dedicated AI Analysis Panel on the right side of the layout.\n\nPanel should include:\n- AI avatar/status indicator\n- Analysis depth indicator (Line/File/Codebase levels)\n- Findings summary with clickable list\n- Review progress tracker\n- Quick actions (Re-analyze, Explain Changes)\n- Future: Chat input placeholder\n\nThis makes AI a first-class co-reviewer presence rather than just inline suggestions.\n\nReference: design-refresh/index.html .ai-panel styles","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T19:38:17.89044-05:00","updated_at":"2025-12-30T19:51:23.797274-05:00","closed_at":"2025-12-30T19:51:23.797274-05:00","dependencies":[{"issue_id":"pair_review-s33.2","depends_on_id":"pair_review-s33","type":"parent-child","created_at":"2025-12-30T19:38:17.890773-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-s33.2","depends_on_id":"pair_review-s33.3","type":"blocks","created_at":"2025-12-30T19:38:49.692624-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-s33.3","title":"Three-panel layout structure","description":"Refactor the main layout to support three panels:\n- Left: File tree sidebar (existing, refined)\n- Center: Diff view (existing)\n- Right: AI Analysis Panel (new)\n\nThe layout should:\n- Use flexbox for responsive sizing\n- Support collapsing sidebars\n- Maintain usability at different viewport widths\n- Have consistent spacing and borders\n\nReference: design-refresh/index.html .main-layout styles","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T19:38:18.804184-05:00","updated_at":"2025-12-30T19:51:23.79651-05:00","closed_at":"2025-12-30T19:51:23.79651-05:00","dependencies":[{"issue_id":"pair_review-s33.3","depends_on_id":"pair_review-s33","type":"parent-child","created_at":"2025-12-30T19:38:18.804525-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-s33.4","title":"AI status indicator in file sidebar","description":"Add an AI co-reviewer status section at the bottom of the file tree sidebar.\n\nShould show:\n- AI avatar with animated ring when active\n- Status text (Analyzing... / Analysis complete)\n- Findings count badge\n\nThis provides persistent visibility of AI state without requiring scroll.\n\nReference: design-refresh/index.html .ai-sidebar-status styles","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-30T19:38:33.530776-05:00","updated_at":"2025-12-30T19:51:23.797628-05:00","closed_at":"2025-12-30T19:51:23.797628-05:00","dependencies":[{"issue_id":"pair_review-s33.4","depends_on_id":"pair_review-s33","type":"parent-child","created_at":"2025-12-30T19:38:33.531112-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-s33.4","depends_on_id":"pair_review-s33.3","type":"blocks","created_at":"2025-12-30T19:38:50.556918-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-s33.5","title":"Typography and font refresh","description":"Update typography to use the new font stack:\n- UI text: DM Sans (Google Fonts)\n- Code: JetBrains Mono (Google Fonts)\n\nAdd font imports to pr.html and update CSS font-family declarations.\n\nReference: design-refresh/styles.css font variables","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T19:38:34.484378-05:00","updated_at":"2025-12-30T19:51:23.796937-05:00","closed_at":"2025-12-30T19:51:23.796937-05:00","dependencies":[{"issue_id":"pair_review-s33.5","depends_on_id":"pair_review-s33","type":"parent-child","created_at":"2025-12-30T19:38:34.484798-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-s33.6","title":"Review submission modal redesign","description":"Update the review submission modal with the new design aesthetic.\n\nChanges:\n- Cleaner modal styling with backdrop blur\n- Review summary (comments count, AI suggestions adopted)\n- Status selector as visual radio buttons (Approve/Comment/Request Changes)\n- Refined button styling\n\nReference: design-refresh/index.html .review-modal styles","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T19:38:35.614539-05:00","updated_at":"2025-12-30T19:52:34.08008-05:00","closed_at":"2025-12-30T19:52:34.08008-05:00","dependencies":[{"issue_id":"pair_review-s33.6","depends_on_id":"pair_review-s33","type":"parent-child","created_at":"2025-12-30T19:38:35.615147-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-su1","title":"Add recently reviewed PRs list to landing page","description":"## Problem\nNo way to see or reopen previously reviewed PRs from the web UI. Users must remember PR numbers/URLs.\n\n## Solution\nAdd a \"Recent Reviews\" section to the landing page showing recently accessed worktrees.\n\n## UI Design\n```\n┌─────────────────────────────────────────────┐\n│  pair-review                                │\n├─────────────────────────────────────────────┤\n│                                             │\n│  [ Enter PR URL to start review ]  [Start] │\n│                                             │\n│  ─────────────────────────────────────────  │\n│                                             │\n│  Recent Reviews                             │\n│                                             │\n│  anthropic/pair-review #123                 │\n│  Fix authentication bug                     │\n│  Last opened: 2 hours ago              [→]  │\n│                                             │\n│  anthropic/claude-code #456                 │\n│  Add new feature                            │\n│  Last opened: 3 days ago               [→]  │\n│                                             │\n└─────────────────────────────────────────────┘\n```\n\n## Implementation\n1. Add API endpoint: `GET /api/worktrees/recent?limit=10`\n   - Returns list with: repository, pr_number, pr_title, last_accessed_at\n   - Join with pr_metadata for title\n2. Create landing page component (or update existing)\n3. Each item links to `/pr/{owner}/{repo}/{number}`\n4. Show all repos (cross-repository list)\n\n## Future enhancements (not in scope)\n- Search/filter by repo\n- Sort options\n- Pagination\n\n## Dependencies\n- Requires worktrees database table (pair_review-452)\n- Requires worktree reuse logic (so clicking opens existing)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-28T15:56:23.160887-05:00","updated_at":"2025-12-28T16:35:36.781128-05:00","closed_at":"2025-12-28T16:35:36.781128-05:00","dependencies":[{"issue_id":"pair_review-su1","depends_on_id":"pair_review-452","type":"blocks","created_at":"2025-12-28T15:56:35.00672-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-su1","depends_on_id":"pair_review-k7u","type":"blocks","created_at":"2025-12-28T15:56:35.027112-05:00","created_by":"daemon","metadata":"{}"},{"issue_id":"pair_review-su1","depends_on_id":"pair_review-e4k","type":"blocks","created_at":"2025-12-28T15:56:43.538123-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-swf","title":"Remove debug console.log for diffPosition","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-01T11:45:37.976692-05:00","updated_at":"2026-01-01T11:45:37.976692-05:00"}
{"id":"pair_review-szr","title":"Bug: User comments cleared after submitting review to GitHub","description":"After submitting a review to GitHub, user comments no longer appear when previewing comments. The comments seem to be cleared/deleted upon submission.\n\nExpected behavior: User comments should persist after submission so users can see what they submitted, or at minimum have a record of submitted reviews.\n\nPossible causes:\n- Comments being deleted from database after successful GitHub submission\n- Query filtering out comments with a 'submitted' status\n- Comments being moved to a different table/status without updating preview logic\n\nThis affects the ability to review what was submitted and breaks the workflow if a user wants to reference their past comments.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-01T11:09:51.752573-05:00","updated_at":"2026-01-01T11:33:40.613922-05:00","closed_at":"2026-01-01T11:33:40.613922-05:00"}
{"id":"pair_review-tcv","title":"Convert backend from CommonJS to ES modules","description":"## Background\nThe backend uses CommonJS (require/module.exports) while the frontend and tests use ES modules. This causes friction with test mocking - vi.mock() only works with ES imports, requiring workarounds like vi.spyOn() on prototypes.\n\n## Scope\n- ~116 require() calls to convert to import\n- All module.exports to export\n- Replace __dirname/__filename with import.meta.url workarounds\n- Add \"type\": \"module\" to package.json\n\n## Benefits\n- Better test mocking support (vi.mock() works directly)\n- Modern JavaScript standard\n- Better static analysis and tree-shaking\n- Consistency with frontend code patterns\n\n## Notes\n- Low priority - current vi.spyOn() approach works fine\n- Good test coverage now exists to catch regressions\n- Mechanical but tedious work","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-03T07:45:56.066406-05:00","updated_at":"2026-01-03T07:45:56.066406-05:00"}
{"id":"pair_review-tka","title":"Write tests for database operations","description":"Create unit tests for src/database.js. Test CRUD operations for PRs, comments, AI suggestions. Use in-memory SQLite for fast tests. Test transaction handling and schema integrity.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T22:05:29.539368-05:00","updated_at":"2026-01-02T22:14:23.20915-05:00","closed_at":"2026-01-02T22:14:23.20915-05:00","dependencies":[{"issue_id":"pair_review-tka","depends_on_id":"pair_review-70n","type":"blocks","created_at":"2026-01-02T22:05:43.153149-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-toh","title":"Add explicit file list to Level 2/3 analysis prompts","description":"Include the dynamic list of changed files in the analysis prompts for Level 2 and Level 3 analysis to reduce file path hallucinations.\n\nRequirements:\n- Add the list of files from the PR diff to the analysis prompt\n- Include clear instruction: 'suggestions should ONLY reference these files: [list]'\n- Apply to Level 2 (file context) and Level 3 (codebase context) analysis\n- Token cost is minimal since file paths are short strings\n\nThis provides explicit grounding for the AI to check against.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T15:13:50.538205-05:00","created_by":"tim","updated_at":"2026-01-04T15:21:40.06903-05:00","closed_at":"2026-01-04T15:21:40.06903-05:00","close_reason":"Implemented multi-level file path validation"}
{"id":"pair_review-u1x","title":"AI Panel: Depth status shows 'Not started' after analysis completes","description":"The Analysis Depth section shows 'Not started' and all levels as pending (empty circles) even after analysis has completed and findings are displayed. Expected: After analysis completes, depth levels should show as complete (green checkmarks). Root cause: AIPanel.updateDepthStatus() may not be called when findings are loaded from existing analysis.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-30T22:06:52.963202-05:00","updated_at":"2025-12-31T16:42:12.545178-05:00","closed_at":"2025-12-31T16:42:12.545178-05:00"}
{"id":"pair_review-udd","title":"Add programmatic filter for AI suggestions on non-PR files","description":"The orchestrator prompt instructs AI to filter out suggestions for files not in the PR diff, but this relies on AI compliance. Add a post-processing step that programmatically removes any suggestions targeting files not in the actual PR diff list, as a safeguard against Level 2/3 analysis including suggestions from imported files or dependencies.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-31T21:50:04.748199-05:00","updated_at":"2026-01-04T15:14:05.879582-05:00","closed_at":"2026-01-04T15:14:05.879582-05:00","close_reason":"Covered by pair_review-q61 (database failsafe filter)"}
{"id":"pair_review-uxzh","title":"Local mode should respect .gitattributes and not expand generated files","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-06T20:50:22.216813-05:00","created_by":"tim","updated_at":"2026-01-06T20:50:22.216813-05:00"}
{"id":"pair_review-v0of","title":"Allow starting local mode with no changes, refresh after changes added","description":"Currently local mode requires uncommitted changes to exist before starting. It would be useful to:\n\n1. Start local mode even when working directory is clean (no changes)\n2. Show empty diff view or helpful message\n3. Allow user to make changes in their editor\n4. Provide refresh button to reload diff after changes are made\n\n## Use Case\nDeveloper wants to start pair-review session, then make changes while getting live feedback. Current workflow requires changes first, then starting the tool.\n\n## Benefits\n- More flexible workflow\n- Allows exploratory coding with AI feedback\n- Better matches natural development flow (start tool, make changes, review)\n\n## Implementation Notes\n- Need to handle empty diff gracefully in UI\n- Refresh mechanism already exists for staleness detection\n- May need to poll or watch for filesystem changes","status":"open","priority":4,"issue_type":"feature","created_at":"2026-01-07T06:34:44.338537-05:00","created_by":"tim","updated_at":"2026-01-07T06:34:44.338537-05:00"}
{"id":"pair_review-v7u","title":"Repository name styling looks like a link","description":"In the recent reviews table, repository names are styled in blue which makes them look like clickable links. Options:\n\n1. Remove blue color if not a link\n2. Make it an actual link to a future repository page\n3. Use a different color that doesn't imply interactivity","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-12-29T08:05:35.144948-05:00","updated_at":"2025-12-29T08:28:12.109331-05:00","closed_at":"2025-12-29T08:28:12.109331-05:00","dependencies":[{"issue_id":"pair_review-v7u","depends_on_id":"pair_review-jbp","type":"blocks","created_at":"2025-12-29T08:05:54.708069-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-van2","title":"Add AI provider selection to repo settings UI","description":"The repository settings UI currently only shows model selection, but does not allow selecting the AI provider. Users cannot choose between different AI providers (e.g., Claude, OpenAI, etc.) from the settings interface.\n\nCurrent behavior:\n- Only model dropdown/selection is visible in repo settings\n- AI provider selection is missing from the UI\n\nExpected behavior:\n- Show both AI provider and model selection in repo settings\n- Provider selection should come before model selection (since available models depend on the provider)\n- Model dropdown should update based on selected provider\n\nThis is important for users who want to use different AI providers or have configured multiple providers.\n\nRelated files:\n- Settings UI component that renders repo configuration\n- May need to update settings schema/form to include provider field","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-05T18:44:54.632831-05:00","created_by":"tim","updated_at":"2026-01-05T18:44:54.632831-05:00"}
{"id":"pair_review-vdt2","title":"Add -h/--help CLI options with full documentation","description":"The CLI should support standard -h and --help flags that display comprehensive documentation of all available command-line options. This should include:\n- Usage examples (PR number, PR URL, --local mode)\n- Description of all flags and options\n- Configuration file location and format\n- Port configuration\n- Any other relevant command-line arguments\n\nThis improves discoverability and user experience by following CLI conventions.","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-07T06:35:32.505678-05:00","created_by":"tim","updated_at":"2026-01-07T06:35:32.505678-05:00"}
{"id":"pair_review-vnb","title":"Reorder segments and default to AI Findings","description":"1. Reorder segments to: AI Findings | Comments | All (move All to last position)\n2. Default selection should be AI Findings, not All\n3. Remember the segment selection in localStorage so it persists across page loads","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T13:36:04.009805-05:00","updated_at":"2026-01-03T13:44:30.978017-05:00","closed_at":"2026-01-03T13:44:30.978017-05:00","dependencies":[{"issue_id":"pair_review-vnb","depends_on_id":"pair_review-epg","type":"blocks","created_at":"2026-01-03T13:36:14.361169-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-w9x","title":"Bug: Adopted/dismissed AI suggestion background too dark in light mode","description":"The background color for adopted and/or dismissed AI suggestions appears too dark in light mode. The gray/dark background seems inconsistent with the light mode color scheme and may reduce readability.\n\nSee attached screenshot showing an adopted suggestion with a notably dark background in what appears to be light mode.\n\nQuestions to investigate:\n- Is this background color intentional for adopted/dismissed states?\n- Should adopted/dismissed suggestions have a different visual treatment?\n- If intentional, reconsider the color choice for better light mode consistency","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-01T12:25:39.068724-05:00","updated_at":"2026-01-01T12:30:13.619833-05:00","closed_at":"2026-01-01T12:30:13.619833-05:00"}
{"id":"pair_review-wr0","title":"Expanded context comments fail GitHub API submission","description":"Comments on expanded context lines (lines revealed by clicking 'show more' but outside diff hunks) fail with 'Line could not be resolved' error from GitHub API. The same action works in GitHub's web UI, suggesting either: (1) GitHub uses a different API/GraphQL, (2) There's additional parameters needed, or (3) Web UI has special handling. Need to investigate how GitHub's web UI submits these comments.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-01T08:54:23.535277-05:00","updated_at":"2026-01-01T10:18:17.472136-05:00","closed_at":"2026-01-01T10:18:17.472136-05:00"}
{"id":"pair_review-x12","title":"E2E tests for AI analysis flow","description":"Test the core AI analysis workflow - triggering analysis, progress modal, AI suggestions in AIPanel, level filtering (L1/L2/L3/Final), adopt/edit/discard actions, SuggestionNavigator, segment control","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T07:09:45.782377-05:00","created_by":"tim","updated_at":"2026-01-05T07:32:50.650354-05:00","closed_at":"2026-01-05T07:32:50.650354-05:00","close_reason":"Implemented comprehensive e2e tests for AI analysis flow. Created tests/e2e/ai-analysis.spec.js with 35 tests covering: AI Analysis Button, Progress Modal, AI Panel, Segment Control, AI Suggestions Display, Suggestion Actions, Suggestion Navigation, Level Filtering, SuggestionNavigator Sidebar, and API Integration."}
{"id":"pair_review-xigl","title":"Add tests for /api/file-content-original endpoint (PR and Local modes)","description":"The /api/file-content-original endpoint has NO test coverage for either PR mode or the newly added Local mode. This endpoint handles context expansion when viewing diffs.\n\n## Integration Tests Needed (routes.test.js)\n\n### Local Mode Tests (owner='local')\n1. Should detect owner='local' and use review ID instead of PR params\n2. Should return 400 for invalid/negative/zero review ID\n3. Should return 404 when local review not found\n4. Should return 404 when review exists but local_path is NULL\n5. Should return file content from local repository for valid request\n6. Should return 404 for non-existent file in local repo\n7. Should return 400 for path traversal attempts (security)\n8. Should return 400 when path is a directory\n\n### PR Mode Tests\n1. Should return file content from worktree for valid request\n2. Should return 400 when owner/repo/number missing\n3. Should return 400 for invalid PR number (non-numeric, negative, zero)\n4. Should return 404 when worktree doesn't exist\n5. Should handle URL-encoded file names correctly\n6. Should return 400 for path traversal attempts (security)\n7. Should return 404 for non-existent file\n8. Should return 400 when path is a directory\n\n## Database Tests Needed (database.test.js)\n\nTests for ReviewRepository.getLocalReviewById():\n1. Should retrieve local review by ID with all fields\n2. Should return null for non-existent review\n3. Should return null if review_type != 'local'\n4. Should include local_path and local_head_sha fields\n\n## E2E Tests (Optional)\n\nContext expansion user flows:\n1. Click to expand context shows additional lines\n2. Error handling when file content fails to load\n3. Local mode context expansion works correctly\n\nEstimate: ~50 test cases, ~800-1000 lines of test code","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-06T20:55:00.208727-05:00","created_by":"tim","updated_at":"2026-01-06T21:05:44.428492-05:00","closed_at":"2026-01-06T21:05:44.428492-05:00","close_reason":"Added 31 tests covering: Local mode (9 tests), PR mode (15 tests), and getLocalReviewById database method (7 tests). All tests passing."}
{"id":"pair_review-xsh","title":"AI analyzer: Handle local review metadata","description":"Adapt AI analyzer to work with local review context.\n\n## Changes to src/ai/analyzer.js\n\n### Metadata Handling\nFor local reviews, construct metadata object:\n```javascript\nconst localMetadata = {\n  title: `Local changes in ${repoName}`,\n  description: '', // Empty - no PR description equivalent\n  base_branch: currentBranch,\n  head_branch: currentBranch, // Same for local changes\n};\n```\n\n### Analysis Context\n- Level 1: Works unchanged (analyzes diff in isolation)\n- Level 2: Works unchanged (file context from filesystem)\n- Level 3: Works unchanged (codebase context from filesystem)\n\n### Notes\n- Analyzer already works with abstract prId and metadata\n- Minimal changes expected - just different metadata values\n- Consider: Should prompts mention 'local changes' vs 'PR changes'?","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-04T09:00:22.89303-05:00","created_by":"tim","updated_at":"2026-01-04T09:27:13.65521-05:00","closed_at":"2026-01-04T09:27:13.65521-05:00","close_reason":"Implementation complete, all 183 tests pass","dependencies":[{"issue_id":"pair_review-xsh","depends_on_id":"pair_review-8h3","type":"blocks","created_at":"2026-01-04T09:00:35.273688-05:00","created_by":"tim"},{"issue_id":"pair_review-xsh","depends_on_id":"pair_review-ba1","type":"blocks","created_at":"2026-01-04T09:00:36.681083-05:00","created_by":"tim"}]}
{"id":"pair_review-y15","title":"Settings icon blue color looks out of place - should use amber to match theme","description":"The settings gear icon in the toolbar uses a blue/purple color that doesn't match the rest of the application's visual theme. The amber/orange color used for the AI Analysis sparkle icon would be more consistent with the overall design language. The icon stands out as visually inconsistent with the neutral grays and amber accents used elsewhere in the UI.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T08:09:54.508394-05:00","updated_at":"2026-01-02T08:13:03.702304-05:00","closed_at":"2026-01-02T08:13:03.702304-05:00"}
{"id":"pair_review-y2q","title":"Add user config overrides for AI provider models","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-03T19:57:47.943363-05:00","updated_at":"2026-01-03T19:57:47.943363-05:00"}
{"id":"pair_review-y8v","title":"Write API route tests for core PR endpoints","description":"Create integration tests for the main API routes in src/routes/pr.js. Focus on: PR fetch/refresh, comments CRUD, AI suggestions endpoints, review submission. Use supertest for HTTP testing with mock database.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T22:05:27.526744-05:00","updated_at":"2026-01-02T22:45:17.103965-05:00","closed_at":"2026-01-02T22:45:17.103965-05:00","dependencies":[{"issue_id":"pair_review-y8v","depends_on_id":"pair_review-70n","type":"blocks","created_at":"2026-01-02T22:05:43.098858-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-yta","title":"Avoid re-suggesting dismissed AI suggestions on re-review","description":"When an AI suggestion is dismissed by the user, the system should remember this and avoid suggesting the same or very similar feedback on subsequent analysis runs. Implementation approaches to consider:\n\n1. **Embedding similarity**: Calculate embeddings for dismissed suggestions, compare new suggestions against them using cosine similarity, filter out matches above threshold\n2. **LLM comparison**: Pass dismissed suggestions as context to the AI and instruct it not to repeat similar feedback\n\nTrade-offs:\n- Embeddings: Faster, more deterministic, requires embedding model/API\n- LLM: Simpler implementation (just prompt engineering), but uses more tokens and may be less reliable\n\nRequires persisting dismissed suggestions (already tracked via status) and their content for comparison.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-31T21:21:15.893355-05:00","updated_at":"2025-12-31T21:21:15.893355-05:00"}
{"id":"pair_review-z1do","title":"File-Level Comments Support","description":"Enable file-level comments throughout the review workflow. This includes user-created file comments, AI suggestions at the file level, GitHub submission, and preview display.\n\n## Overview\nFile-level comments are observations about an entire file rather than specific lines. Use cases:\n- Architectural suggestions (e.g., \"consider splitting this file\")\n- Naming/organization feedback\n- Missing tests or documentation\n- High-level praise for well-structured code\n\n## Scope\n1. **Data Model**: Add is_file_level flag to comments schema\n2. **Backend API**: Endpoints for creating/retrieving file-level comments\n3. **Frontend UI**: File header comment zone with add/display/manage functionality\n4. **AI Integration**: Enable AI analyzer to produce file-level suggestions\n5. **GitHub Submission**: Include file-level comments in review submission\n6. **Preview Modal**: Display file-level comments in review preview\n\n## Design Reference\nSee design-refresh/file-level-comments.html for the approved UI component design.\n\n## Dependencies\n- Existing comment infrastructure (line-level comments work correctly)\n- GraphQL GitHub client (already supports file-level via subjectType: FILE)","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-05T14:44:07.917612-05:00","created_by":"tim","updated_at":"2026-01-05T15:11:25.279486-05:00","closed_at":"2026-01-05T15:11:25.279486-05:00","close_reason":"All sub-tasks completed: schema, backend API, AI analyzer, frontend UI, GitHub submission, preview modal"}
{"id":"pair_review-z1do.1","title":"Add is_file_level column to comments schema","description":"Add database schema support for file-level comments.\n\n## Changes Required\n1. Add `is_file_level BOOLEAN DEFAULT 0` column to comments table\n2. Add migration to alter existing table\n3. Add index for `(pr_id, file, is_file_level)` for efficient queries\n4. Update comment retrieval queries to include new column\n\n## Acceptance Criteria\n- [ ] Migration runs cleanly on existing databases\n- [ ] Existing comments default to is_file_level=0\n- [ ] Index improves query performance for file-level filtering\n\n## Files to Modify\n- src/database.js","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T14:44:27.932724-05:00","created_by":"tim","updated_at":"2026-01-05T14:57:25.806677-05:00","closed_at":"2026-01-05T14:57:25.806677-05:00","close_reason":"Schema migration complete: added is_file_level column and index","dependencies":[{"issue_id":"pair_review-z1do.1","depends_on_id":"pair_review-z1do","type":"parent-child","created_at":"2026-01-05T14:44:27.935676-05:00","created_by":"tim"}]}
{"id":"pair_review-z1do.2","title":"Backend API for file-level comments","description":"Add API endpoints for creating and retrieving file-level comments.\n\n## New Endpoints\n1. `POST /api/file-comment` - Create a file-level user comment\n   - Body: { pr_id, file, body, commit_sha }\n   - Sets is_file_level=1, line_start/line_end/diff_position=NULL\n\n2. Update `GET /api/pr/:owner/:repo/:number/comments` to include file-level comments\n   - Add query param `include_file_level=true` (default true)\n   - Return is_file_level flag in response\n\n## Acceptance Criteria\n- [ ] Can create file-level comment via API\n- [ ] File-level comments retrieved with other comments\n- [ ] Validation prevents file-level comments with line numbers\n- [ ] Edit/delete work the same as line-level comments\n\n## Files to Modify\n- src/routes/comments.js\n- src/routes/pr.js","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T14:44:29.241612-05:00","created_by":"tim","updated_at":"2026-01-05T15:03:05.034426-05:00","closed_at":"2026-01-05T15:03:05.034426-05:00","close_reason":"Implementation complete with tests","dependencies":[{"issue_id":"pair_review-z1do.2","depends_on_id":"pair_review-z1do","type":"parent-child","created_at":"2026-01-05T14:44:29.243612-05:00","created_by":"tim"},{"issue_id":"pair_review-z1do.2","depends_on_id":"pair_review-z1do","type":"blocks","created_at":"2026-01-05T14:44:29.245258-05:00","created_by":"tim"},{"issue_id":"pair_review-z1do.2","depends_on_id":"pair_review-z1do.1","type":"blocks","created_at":"2026-01-05T14:45:02.508314-05:00","created_by":"tim"}]}
{"id":"pair_review-z1do.3","title":"Frontend UI for file-level comments","description":"Implement the file-level comments UI component in the PR review page.\n\n## UI Components (see design-refresh/file-level-comments.html)\n1. **File Comments Zone** - Collapsible section between file header and diff\n   - Toggle button with comment count badge\n   - \"Add comment\" button\n   - Container for comment cards\n\n2. **File Comment Card** - Display individual file-level comments\n   - Source badge (AI/User)\n   - Author, timestamp, type tag\n   - Comment body\n   - Actions (edit/delete for user, adopt/dismiss for AI)\n\n3. **Comment Form** - Inline form for adding new comments\n   - Textarea with placeholder\n   - Cancel/Submit buttons\n\n4. **Header Indicator** - Shows count when zone is collapsed\n\n## Integration Points\n- Wire \"Add comment\" to POST /api/file-comment\n- Wire \"Adopt\" to existing adoption flow\n- Integrate with comment-manager.js patterns\n\n## Acceptance Criteria\n- [ ] Can add file-level comments from UI\n- [ ] Comments display correctly in zone\n- [ ] Zone collapses/expands smoothly\n- [ ] Count badge updates dynamically\n- [ ] Works in both light and dark themes\n\n## Files to Modify\n- public/pr.html\n- public/js/modules/comment-manager.js\n- public/css/pr.css","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T14:44:30.654482-05:00","created_by":"tim","updated_at":"2026-01-05T15:09:54.609947-05:00","closed_at":"2026-01-05T15:09:54.609947-05:00","close_reason":"Implementation complete with tests","dependencies":[{"issue_id":"pair_review-z1do.3","depends_on_id":"pair_review-z1do","type":"parent-child","created_at":"2026-01-05T14:44:30.656461-05:00","created_by":"tim"},{"issue_id":"pair_review-z1do.3","depends_on_id":"pair_review-z1do","type":"blocks","created_at":"2026-01-05T14:44:30.657391-05:00","created_by":"tim"},{"issue_id":"pair_review-z1do.3","depends_on_id":"pair_review-z1do.2","type":"blocks","created_at":"2026-01-05T14:45:02.534843-05:00","created_by":"tim"}]}
{"id":"pair_review-z1do.4","title":"AI analyzer support for file-level suggestions","description":"Enable the AI analyzer to produce file-level suggestions in addition to line-level ones.\n\n## Prompt Changes\nUpdate analysis prompts to request file-level observations:\n- Level 2 (file context): Can now suggest file-level concerns\n- Level 3 (codebase context): Primary source of architectural file-level suggestions\n\n## Output Schema Changes\nAllow suggestions without line numbers:\n\\`\\`\\`json\n{\n  \"file\": \"src/components/Auth.tsx\",\n  \"is_file_level\": true,\n  \"type\": \"refactor\",\n  \"title\": \"Consider splitting authentication concerns\",\n  \"description\": \"This file handles both OAuth and session management...\"\n}\n\\`\\`\\`\n\n## Storage Changes\n- Set is_file_level=1 when storing suggestions without line numbers\n- Ensure retrieval includes file-level AI suggestions\n\n## Acceptance Criteria\n- [ ] AI can produce file-level suggestions\n- [ ] Suggestions stored with is_file_level=1\n- [ ] File-level suggestions appear in AI suggestions API\n- [ ] Types: praise, issue, refactor, suggestion work at file level\n\n## Files to Modify\n- src/ai/analyzer.js\n- src/ai/prompts/ (if separate prompt files exist)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T14:44:52.044038-05:00","created_by":"tim","updated_at":"2026-01-05T15:03:05.036364-05:00","closed_at":"2026-01-05T15:03:05.036364-05:00","close_reason":"Implementation complete with tests","dependencies":[{"issue_id":"pair_review-z1do.4","depends_on_id":"pair_review-z1do","type":"parent-child","created_at":"2026-01-05T14:44:52.052757-05:00","created_by":"tim"},{"issue_id":"pair_review-z1do.4","depends_on_id":"pair_review-z1do","type":"blocks","created_at":"2026-01-05T14:44:52.054444-05:00","created_by":"tim"},{"issue_id":"pair_review-z1do.4","depends_on_id":"pair_review-z1do.1","type":"blocks","created_at":"2026-01-05T14:45:02.560171-05:00","created_by":"tim"}]}
{"id":"pair_review-z1do.5","title":"GitHub submission of file-level comments","description":"Include file-level comments when submitting reviews to GitHub.\n\n## GitHub API Support\nThe GraphQL API already supports file-level comments via subjectType: FILE.\nSee src/github/client.js submitReviewGraphQL function.\n\n## Changes Required\n1. Separate comments by type during submission:\n   - Line-level: existing flow with line/side\n   - File-level: use subjectType: FILE, omit line/side\n\n2. Update addPullRequestReviewThread mutation call:\n\\`\\`\\`javascript\n// For file-level comments:\n{\n  path: 'src/file.js',\n  subjectType: 'FILE',\n  body: 'comment text'\n}\n\\`\\`\\`\n\n## Acceptance Criteria\n- [ ] File-level comments submitted to GitHub correctly\n- [ ] Line-level comments still work as before\n- [ ] Mixed reviews (both types) submit successfully\n- [ ] Comments appear on GitHub PR in file header area\n\n## Files to Modify\n- src/github/client.js\n- src/routes/pr.js (review submission endpoint)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T14:44:53.496215-05:00","created_by":"tim","updated_at":"2026-01-05T15:09:54.611811-05:00","closed_at":"2026-01-05T15:09:54.611811-05:00","close_reason":"Implementation complete with tests","dependencies":[{"issue_id":"pair_review-z1do.5","depends_on_id":"pair_review-z1do","type":"parent-child","created_at":"2026-01-05T14:44:53.498261-05:00","created_by":"tim"},{"issue_id":"pair_review-z1do.5","depends_on_id":"pair_review-z1do","type":"blocks","created_at":"2026-01-05T14:44:53.499219-05:00","created_by":"tim"},{"issue_id":"pair_review-z1do.5","depends_on_id":"pair_review-z1do.2","type":"blocks","created_at":"2026-01-05T14:45:02.584509-05:00","created_by":"tim"}]}
{"id":"pair_review-z1do.6","title":"Preview modal file-level comment display","description":"Display file-level comments in the review preview modal.\n\n## Current Behavior\nPreviewModal.js shows line-level comments grouped by file with line numbers.\n\n## Required Changes\n1. Group file-level comments separately at top of each file section\n2. Visual distinction: \"File comment\" label instead of line number\n3. Include in \"Copy to Clipboard\" text output\n4. Count in total comments display\n\n## Preview Format\n\\`\\`\\`\n## src/components/Auth.tsx\n### File Comments\n- Consider splitting authentication concerns...\n\n### Line Comments\n- Line 42: This function should validate input...\n\\`\\`\\`\n\n## Acceptance Criteria\n- [ ] File-level comments appear in preview\n- [ ] Clear visual distinction from line comments\n- [ ] Included in clipboard copy\n- [ ] Included in comment count\n\n## Files to Modify\n- public/js/components/PreviewModal.js\n- public/css/pr.css (if new styles needed)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T14:44:54.675502-05:00","created_by":"tim","updated_at":"2026-01-05T15:11:15.779066-05:00","closed_at":"2026-01-05T15:11:15.779066-05:00","close_reason":"Preview modal now displays file-level comments","dependencies":[{"issue_id":"pair_review-z1do.6","depends_on_id":"pair_review-z1do","type":"parent-child","created_at":"2026-01-05T14:44:54.677432-05:00","created_by":"tim"},{"issue_id":"pair_review-z1do.6","depends_on_id":"pair_review-z1do","type":"blocks","created_at":"2026-01-05T14:44:54.67862-05:00","created_by":"tim"},{"issue_id":"pair_review-z1do.6","depends_on_id":"pair_review-z1do.3","type":"blocks","created_at":"2026-01-05T14:45:02.608567-05:00","created_by":"tim"}]}
{"id":"pair_review-z4fj","title":"Fix incorrect syntax highlighting in diff view","description":"Syntax highlighting appears incorrect in the diff view. Code tokens are not being properly highlighted - keywords, method calls, and symbols are not receiving appropriate syntax coloring.\n\nThis affects readability of code in the diff view and makes it harder to quickly scan and understand changes.\n\nExample: Ruby code showing conditional logic with method calls and feature flags is not properly highlighted with distinct colors for keywords, method names, strings, and operators.\n\nRelated files:\n- public/js/modules/diff-renderer.js (likely handles syntax highlighting)\n- May need to integrate or fix a syntax highlighting library","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-05T14:52:48.784219-05:00","created_by":"tim","updated_at":"2026-01-05T14:52:48.784219-05:00"}
{"id":"pair_review-zlh","title":"Add border/outline to segment control","description":"Segment control needs clearer visual distinction. Add a faint outline/border around the segments to make them more clearly delineated as separate options.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T13:36:03.983274-05:00","updated_at":"2026-01-03T13:44:30.979269-05:00","closed_at":"2026-01-03T13:44:30.979269-05:00","dependencies":[{"issue_id":"pair_review-zlh","depends_on_id":"pair_review-epg","type":"blocks","created_at":"2026-01-03T13:36:14.338823-05:00","created_by":"daemon","metadata":"{}"}]}
{"id":"pair_review-zys","title":"Show dialog when analysis completes with zero suggestions","description":"When AI analysis completes successfully but finds zero suggestions, show a dialog informing the user. This is often a positive outcome (e.g., when reviewing only for blockers or specific issues). The dialog should celebrate the clean result rather than leave the user wondering if something went wrong.","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-03T21:31:47.489332-05:00","updated_at":"2026-01-03T21:31:47.489332-05:00"}
