<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <script>
        // Initialize theme immediately to prevent flash
        (function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        })();
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI-powered local code review assistant">
    <title>Pair Review - Local Mode</title>

    <!-- Google Fonts: DM Sans and JetBrains Mono -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,400&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- PR Display Styles -->
    <link rel="stylesheet" href="/css/pr.css">
    <link rel="stylesheet" href="/css/styles.css">

    <!-- Highlight.js for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" media="(prefers-color-scheme: light)">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" media="(prefers-color-scheme: dark)">

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
            background-color: #f6f8fa;
            color: #24292f;
            line-height: 1.5;
            font-size: 14px;
        }

        /* Dark theme overrides */
        body[data-theme="dark"] {
            background-color: #0d1117;
            color: #c9d1d9;
        }

        /* On the dedicated local page, always show the pr-container */
        #pr-container {
            display: block !important;
        }

        /* Local Mode Badge Styles */
        .local-mode-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            color: #ffffff;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);
            margin-right: 12px;
        }

        .local-mode-badge svg {
            width: 12px;
            height: 12px;
        }

        /* Dark theme for local mode badge */
        [data-theme="dark"] .local-mode-badge {
            background: linear-gradient(135deg, #7c3aed 0%, #4f46e5 100%);
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.4);
        }

        /* Local mode header info */
        .local-header-info {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 13px;
            color: var(--color-text-secondary);
        }

        .local-header-info .info-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .local-header-info .info-label {
            color: var(--color-text-tertiary);
            font-weight: 500;
        }

        .local-header-info .info-value {
            color: var(--color-text-primary);
            font-weight: 500;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
        }

        /* Branch badge styling for local mode */
        .local-branch-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            background-color: var(--color-bg-tertiary);
            border: 1px solid var(--color-border-primary);
            border-radius: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--color-text-primary);
        }

        .local-branch-badge svg {
            color: var(--color-text-tertiary);
        }

    </style>
</head>
<body>
    <!-- App wrapper -->
    <div class="app" id="pr-container">
        <!-- Sticky Header -->
        <header class="header" id="pr-header">
            <div class="header-left">
                <a href="/" class="logo">
                    <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" width="24" height="24">
                        <path transform="rotate(-50 12 12)" d="M18.178 8c5.096 0 5.096 8 0 8-5.095 0-7.133-8-12.356-8-5.096 0-5.096 8 0 8 5.223 0 7.26-8 12.356-8z"/>
                    </svg>
                    <span class="logo-text">pair<span class="logo-accent">review</span></span>
                </a>
                <!-- Local Mode Badge -->
                <span class="local-mode-badge">
                    <svg viewBox="0 0 16 16" fill="currentColor">
                        <path d="M2 2.5A2.5 2.5 0 0 1 4.5 0h8.75a.75.75 0 0 1 .75.75v12.5a.75.75 0 0 1-.75.75h-2.5a.75.75 0 0 1 0-1.5h1.75v-2h-8a1 1 0 0 0-.714 1.7.75.75 0 1 1-1.072 1.05A2.495 2.495 0 0 1 2 11.5v-9Zm10.5-1h-8a1 1 0 0 0-1 1v6.708A2.486 2.486 0 0 1 4.5 9h8ZM5 12.25v3.25a.25.25 0 0 0 .4.2l1.45-1.087a.25.25 0 0 1 .3 0L8.6 15.7a.25.25 0 0 0 .4-.2v-3.25a.25.25 0 0 0-.25-.25h-3.5a.25.25 0 0 0-.25.25Z"/>
                    </svg>
                    Local Mode
                </span>
                <!-- Local header info -->
                <div class="local-header-info" id="local-header-info">
                    <div class="info-item">
                        <span class="info-label">Repository:</span>
                        <span class="info-value" id="local-repo-name">--</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Branch:</span>
                        <span class="local-branch-badge" id="local-branch-name">
                            <svg viewBox="0 0 16 16" fill="currentColor" width="12" height="12">
                                <path d="M11.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122V6A2.5 2.5 0 0110 8.5H6a1 1 0 00-1 1v1.128a2.251 2.251 0 11-1.5 0V5.372a2.25 2.25 0 111.5 0v1.836A2.492 2.492 0 016 7h4a1 1 0 001-1v-.628A2.25 2.25 0 019.5 3.25zM4.25 12a.75.75 0 100 1.5.75.75 0 000-1.5zM3.5 3.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0z"/>
                            </svg>
                            <span id="local-branch-text">--</span>
                        </span>
                    </div>
                </div>
            </div>
            <div class="header-center">
                <h1 class="pr-title" id="pr-title-text">Uncommitted Changes</h1>
            </div>
            <div class="header-right">
                <div class="header-icon-group">
                    <button class="btn btn-icon" id="theme-toggle" title="Toggle theme">
                        <svg class="theme-icon-light" viewBox="0 0 16 16" fill="currentColor" width="16" height="16">
                            <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Zm0-1.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5Zm0-10.5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0V.75A.75.75 0 0 1 8 0Zm0 13a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5A.75.75 0 0 1 8 13ZM2.343 2.343a.75.75 0 0 1 1.061 0l1.06 1.061a.75.75 0 0 1-1.06 1.06l-1.06-1.06a.75.75 0 0 1 0-1.06Zm9.193 9.193a.75.75 0 0 1 1.06 0l1.061 1.06a.75.75 0 0 1-1.06 1.061l-1.061-1.06a.75.75 0 0 1 0-1.061ZM16 8a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1 0-1.5h1.5A.75.75 0 0 1 16 8ZM3 8a.75.75 0 0 1-.75.75H.75a.75.75 0 0 1 0-1.5h1.5A.75.75 0 0 1 3 8Zm10.657-5.657a.75.75 0 0 1 0 1.061l-1.061 1.06a.75.75 0 1 1-1.06-1.06l1.06-1.06a.75.75 0 0 1 1.06 0Zm-9.193 9.193a.75.75 0 0 1 0 1.06l-1.06 1.061a.75.75 0 0 1-1.061-1.06l1.06-1.061a.75.75 0 0 1 1.061 0Z"/>
                        </svg>
                        <svg class="theme-icon-dark" viewBox="0 0 16 16" fill="currentColor" width="16" height="16" style="display: none;">
                            <path d="M9.598 1.591a.749.749 0 0 1 .785-.175 7.001 7.001 0 1 1-8.967 8.967.75.75 0 0 1 .961-.96 5.5 5.5 0 0 0 7.046-7.046.75.75 0 0 1 .175-.786Z"/>
                        </svg>
                    </button>
                </div>
                <div id="split-button-placeholder"></div>
            </div>
        </header>

        <!-- Main Three-Panel Layout -->
        <div class="main-layout">
            <!-- File Tree Sidebar (Left) -->
            <aside class="sidebar files-sidebar" id="files-sidebar">
                <div class="sidebar-header">
                    <span class="sidebar-title">Changed Files</span>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span class="sidebar-count" id="sidebar-file-count">0</span>
                        <button class="sidebar-collapse-btn" id="sidebar-collapse-btn" title="Close panel">
                            <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <nav class="file-tree" id="file-list">
                    <!-- File tree will be loaded here -->
                </nav>

            </aside>

            <!-- Diff View (Center) -->
            <main class="diff-view">
                <div class="diff-toolbar">
                    <button class="sidebar-toggle-collapsed" id="sidebar-toggle-collapsed" title="Show file tree">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="m4.177 7.823 2.396-2.396A.25.25 0 0 1 7 5.604v4.792a.25.25 0 0 1-.427.177L4.177 8.177a.25.25 0 0 1 0-.354Z"></path>
                            <path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v12.5A1.75 1.75 0 0 1 14.25 16H1.75A1.75 1.75 0 0 1 0 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25H9.5v-13Zm12.5 13a.25.25 0 0 0 .25-.25V1.75a.25.25 0 0 0-.25-.25H11v13Z"></path>
                        </svg>
                    </button>
                    <div class="toolbar-meta" id="toolbar-meta">
                        <span class="toolbar-stat toolbar-stat-additions" id="pr-additions">+0</span>
                        <span class="toolbar-stat toolbar-stat-deletions" id="pr-deletions">-0</span>
                        <span class="toolbar-files" id="pr-files-count">0 files</span>
                        <span class="toolbar-separator"></span>
                        <span class="toolbar-commit" id="pr-commit" title="Click to copy full SHA">
                            <svg viewBox="0 0 16 16" fill="currentColor" width="12" height="12">
                                <path d="M11.93 8.5a4.002 4.002 0 0 1-7.86 0H.75a.75.75 0 0 1 0-1.5h3.32a4.002 4.002 0 0 1 7.86 0h3.32a.75.75 0 0 1 0 1.5Zm-1.43-.75a2.5 2.5 0 1 0-5 0 2.5 2.5 0 0 0 5 0Z"/>
                            </svg>
                            <span id="pr-commit-sha">HEAD</span>
                            <button type="button" class="toolbar-commit-copy" id="pr-commit-copy" title="Copy full SHA" aria-label="Copy full SHA">
                                <svg viewBox="0 0 16 16" fill="currentColor" width="10" height="10">
                                    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path>
                                    <path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
                                </svg>
                            </button>
                        </span>
                    </div>
                    <div class="diff-stats" id="diff-stats"></div>
                    <div class="toolbar-actions">
                        <button class="btn btn-sm btn-secondary" id="analyze-btn" title="Analyze with AI">
                            <svg class="analyze-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                                <path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z"/>
                            </svg>
                            <span class="btn-text">Analyze</span>
                        </button>
                        <button class="btn btn-sm btn-icon" id="ai-panel-toggle" title="Toggle Review panel">
                            <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                                <path d="M6.823 7.823a.25.25 0 0 1 0 .354l-2.396 2.396A.25.25 0 0 1 4 10.396V5.604a.25.25 0 0 1 .427-.177Z"></path>
                                <path d="M1.75 0h12.5C15.216 0 16 .784 16 1.75v12.5A1.75 1.75 0 0 1 14.25 16H1.75A1.75 1.75 0 0 1 0 14.25V1.75C0 .784.784 0 1.75 0ZM1.5 1.75v12.5c0 .138.112.25.25.25H9.5v-13H1.75a.25.25 0 0 0-.25.25ZM11 14.5h3.25a.25.25 0 0 0 .25-.25V1.75a.25.25 0 0 0-.25-.25H11Z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="diff-container" class="diff-container">
                    <div class="loading">Loading changes...</div>
                </div>
            </main>

            <!-- AI Analysis Panel (Right) -->
            <aside class="ai-panel" id="ai-panel">
                <div class="ai-panel-header">
                    <div class="ai-panel-title">
                        <div class="ai-avatar-small">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="14" height="14">
                                <path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z"/>
                                <path d="M18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456z"/>
                            </svg>
                        </div>
                        <span>Review</span>
                    </div>
                    <button class="ai-panel-close" id="ai-panel-close" title="Close panel">
                        <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                            <path d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.75.75 0 1 1 1.06 1.06L9.06 8l3.22 3.22a.75.75 0 1 1-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 0 1-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"/>
                        </svg>
                    </button>
                </div>

                <!-- Segment Control -->
                <div class="segment-control" id="segment-control">
                    <div class="segment-control-inner">
                        <button class="segment-btn active" data-segment="ai">AI <span class="segment-count">(0)</span></button>
                        <button class="segment-btn" data-segment="comments">User <span class="segment-count">(0)</span></button>
                        <button class="segment-btn" data-segment="all">All <span class="segment-count">(0)</span></button>
                    </div>
                </div>

                <!-- Level Filter -->
                <div class="level-filter" id="level-filter">
                    <button class="level-pill active" data-level="final" title="Curated suggestions from all levels">Overall</button>
                    <button class="level-pill" data-level="1" title="Line-level analysis">Line</button>
                    <button class="level-pill" data-level="2" title="File-level analysis">File</button>
                    <button class="level-pill" data-level="3" title="Codebase-level analysis">Codebase</button>
                </div>

                <!-- Findings Summary -->
                <div class="findings-summary" id="findings-summary">
                    <div class="findings-header">
                        <span class="findings-count" id="findings-count">0 items</span>
                    </div>
                    <div class="findings-list" id="findings-list">
                        <div class="findings-empty">
                            <p>No AI analysis yet. Click "Analyze" to get started.</p>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Diff2Html Library -->
    <script src="https://cdn.jsdelivr.net/npm/diff2html@3.4.47/bundles/js/diff2html.min.js"></script>

    <!-- Highlight.js for syntax highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Markdown-it Library for rendering markdown in comments -->
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.2/dist/markdown-it.min.js"></script>

    <!-- Markdown renderer utility -->
    <script src="/js/utils/markdown.js"></script>

    <!-- Components -->
    <script src="/js/components/Toast.js"></script>
    <script src="/js/components/ConfirmDialog.js"></script>
    <script src="/js/components/ProgressModal.js"></script>
    <script src="/js/components/AnalysisConfigModal.js"></script>
    <script src="/js/components/StatusIndicator.js"></script>
    <script src="/js/components/SuggestionNavigator.js"></script>
    <script src="/js/components/ReviewModal.js"></script>
    <script src="/js/components/PreviewModal.js"></script>
    <script src="/js/components/SplitButton.js"></script>
    <script src="/js/components/AIPanel.js"></script>

    <!-- PR Modules (must load before pr.js) -->
    <script src="/js/modules/hunk-parser.js"></script>
    <script src="/js/modules/line-tracker.js"></script>
    <script src="/js/modules/diff-renderer.js"></script>
    <script src="/js/modules/comment-manager.js"></script>
    <script src="/js/modules/suggestion-manager.js"></script>

    <!-- Local Mode Configuration -->
    <script>
        // Set local mode flag before loading main JS
        window.PAIR_REVIEW_LOCAL_MODE = true;
    </script>

    <!-- PR JavaScript (shared with local mode) -->
    <script src="/js/pr.js"></script>

    <!-- Local Mode JavaScript -->
    <script src="/js/local.js"></script>
</body>
</html>
