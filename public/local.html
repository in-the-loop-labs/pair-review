<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <script>
        // Initialize theme immediately to prevent flash
        (function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        })();
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI-powered local code review assistant">
    <title>Pair Review - Local Mode</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <!-- Google Fonts: DM Sans and JetBrains Mono -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,400&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- PR Display Styles -->
    <link rel="stylesheet" href="/css/pr.css">
    <link rel="stylesheet" href="/css/ai-summary-modal.css">
    <link rel="stylesheet" href="/css/styles.css">

    <!-- Highlight.js for syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" media="(prefers-color-scheme: light)">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" media="(prefers-color-scheme: dark)">

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
            background-color: #f6f8fa;
            color: #24292f;
            line-height: 1.5;
            font-size: 14px;
        }

        /* Dark theme overrides */
        body[data-theme="dark"] {
            background-color: #0d1117;
            color: #c9d1d9;
        }

        /* On the dedicated local page, always show the pr-container */
        #pr-container {
            display: block !important;
        }

        /* Local Mode Badge Styles */
        .local-mode-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            color: #ffffff;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);
            margin-right: 12px;
        }

        .local-mode-badge svg {
            width: 12px;
            height: 12px;
        }

        /* Dark theme for local mode badge */
        [data-theme="dark"] .local-mode-badge {
            background: linear-gradient(135deg, #7c3aed 0%, #4f46e5 100%);
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.4);
        }

        /* Branch badge styling for local mode */
        .local-branch-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            background-color: var(--color-bg-tertiary);
            border: 1px solid var(--color-border-primary);
            border-radius: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--color-text-primary);
        }

        .local-branch-badge svg {
            color: var(--color-text-tertiary);
        }

        /* Dark mode improvements for header icon buttons */
        [data-theme="dark"] .header-icon-group {
            background: var(--color-bg-tertiary);
            border-color: var(--color-border-primary);
        }

        [data-theme="dark"] .header-icon-group .btn-icon {
            color: var(--color-text-primary);
        }

        [data-theme="dark"] .header-icon-group .btn-icon:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Local header info - compact single row */
        .local-header-info {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 13px;
            color: var(--color-text-secondary);
        }

        .local-header-info .info-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .local-header-info .info-value {
            color: var(--color-text-primary);
            font-weight: 600;
            font-size: 14px;
        }

        /* Path display in toolbar-meta (with left truncation) */
        .toolbar-path {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--color-text-secondary);
            max-width: 300px;
            overflow: hidden;
        }

        .toolbar-path svg {
            flex-shrink: 0;
            color: var(--color-text-tertiary);
        }

        .toolbar-path > span {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            direction: rtl;
            text-align: left;
        }

        .toolbar-path > span > span {
            direction: ltr;
            unicode-bidi: bidi-override;
        }

    </style>
</head>
<body>
    <!-- App wrapper -->
    <div class="app" id="pr-container">
        <!-- Sticky Header -->
        <header class="header" id="pr-header">
            <div class="header-left">
                <a href="/" class="logo">
                    <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" width="24" height="24">
                        <path transform="rotate(-50 12 12)" d="M18.178 8c5.096 0 5.096 8 0 8-5.095 0-7.133-8-12.356-8-5.096 0-5.096 8 0 8 5.223 0 7.26-8 12.356-8z"/>
                    </svg>
                    <span class="logo-text">pair<span class="logo-accent">review</span></span>
                </a>
                <!-- Local Mode Badge -->
                <span class="local-mode-badge">
                    <svg viewBox="0 0 16 16" fill="currentColor">
                        <path d="M2 2.5A2.5 2.5 0 0 1 4.5 0h8.75a.75.75 0 0 1 .75.75v12.5a.75.75 0 0 1-.75.75h-2.5a.75.75 0 0 1 0-1.5h1.75v-2h-8a1 1 0 0 0-.714 1.7.75.75 0 1 1-1.072 1.05A2.495 2.495 0 0 1 2 11.5v-9Zm10.5-1h-8a1 1 0 0 0-1 1v6.708A2.486 2.486 0 0 1 4.5 9h8ZM5 12.25v3.25a.25.25 0 0 0 .4.2l1.45-1.087a.25.25 0 0 1 .3 0L8.6 15.7a.25.25 0 0 0 .4-.2v-3.25a.25.25 0 0 0-.25-.25h-3.5a.25.25 0 0 0-.25.25Z"/>
                    </svg>
                    Local
                </span>
                <!-- Local header info - compact row -->
                <div class="local-header-info" id="local-header-info">
                    <div class="info-item">
                        <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14" style="color: var(--color-text-tertiary);">
                            <path d="M2 2.5A2.5 2.5 0 0 1 4.5 0h8.75a.75.75 0 0 1 .75.75v12.5a.75.75 0 0 1-.75.75h-2.5a.75.75 0 0 1 0-1.5h1.75v-2h-8a1 1 0 0 0-.714 1.7.75.75 0 1 1-1.072 1.05A2.495 2.495 0 0 1 2 11.5Zm10.5-1H4.5a1 1 0 0 0-1 1v6.708A2.486 2.486 0 0 1 4.5 9h8ZM5 12.25v3.25a.25.25 0 0 0 .4.2l1.45-1.087a.25.25 0 0 1 .3 0L8.6 15.7a.25.25 0 0 0 .4-.2v-3.25a.25.25 0 0 0-.25-.25h-3.5a.25.25 0 0 0-.25.25Z"/>
                        </svg>
                        <span class="info-value" id="local-repo-name">--</span>
                    </div>
                    <div class="info-item">
                        <span class="local-branch-badge" id="local-branch-name">
                            <svg viewBox="0 0 16 16" fill="currentColor" width="12" height="12">
                                <path d="M11.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122V6A2.5 2.5 0 0110 8.5H6a1 1 0 00-1 1v1.128a2.251 2.251 0 11-1.5 0V5.372a2.25 2.25 0 111.5 0v1.836A2.492 2.492 0 016 7h4a1 1 0 001-1v-.628A2.25 2.25 0 019.5 3.25zM4.25 12a.75.75 0 100 1.5.75.75 0 000-1.5zM3.5 3.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0z"/>
                            </svg>
                            <span id="local-branch-text">--</span>
                        </span>
                    </div>
                </div>
            </div>
            <div class="header-center">
                <!-- Title area intentionally left empty for local mode -->
                <!-- The "Local Mode" badge and header info provide sufficient context -->
            </div>
            <div class="header-right">
                <div class="header-icon-group">
                    <button class="btn btn-icon" id="local-refresh-btn" title="Refresh diff from directory">
                        <svg viewBox="0 0 16 16" fill="currentColor" width="16" height="16">
                            <path d="M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 1 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z"/>
                        </svg>
                    </button>
                    <button class="btn btn-icon" id="theme-toggle" title="Toggle theme">
                        <svg class="theme-icon-light" viewBox="0 0 16 16" fill="currentColor" width="16" height="16">
                            <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Zm0-1.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5Zm0-10.5a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0V.75A.75.75 0 0 1 8 0Zm0 13a.75.75 0 0 1 .75.75v1.5a.75.75 0 0 1-1.5 0v-1.5A.75.75 0 0 1 8 13ZM2.343 2.343a.75.75 0 0 1 1.061 0l1.06 1.061a.75.75 0 0 1-1.06 1.06l-1.06-1.06a.75.75 0 0 1 0-1.06Zm9.193 9.193a.75.75 0 0 1 1.06 0l1.061 1.06a.75.75 0 0 1-1.06 1.061l-1.061-1.06a.75.75 0 0 1 0-1.061ZM16 8a.75.75 0 0 1-.75.75h-1.5a.75.75 0 0 1 0-1.5h1.5A.75.75 0 0 1 16 8ZM3 8a.75.75 0 0 1-.75.75H.75a.75.75 0 0 1 0-1.5h1.5A.75.75 0 0 1 3 8Zm10.657-5.657a.75.75 0 0 1 0 1.061l-1.061 1.06a.75.75 0 1 1-1.06-1.06l1.06-1.06a.75.75 0 0 1 1.06 0Zm-9.193 9.193a.75.75 0 0 1 0 1.06l-1.06 1.061a.75.75 0 0 1-1.061-1.06l1.06-1.061a.75.75 0 0 1 1.061 0Z"/>
                        </svg>
                        <svg class="theme-icon-dark" viewBox="0 0 16 16" fill="currentColor" width="16" height="16" style="display: none;">
                            <path d="M9.598 1.591a.749.749 0 0 1 .785-.175 7.001 7.001 0 1 1-8.967 8.967.75.75 0 0 1 .961-.96 5.5 5.5 0 0 0 7.046-7.046.75.75 0 0 1 .175-.786Z"/>
                        </svg>
                    </button>
                    <a class="btn btn-icon settings-link" id="settings-link" href="#" title="Repository settings" style="display: none;">
                        <svg viewBox="0 0 16 16" fill="currentColor" width="16" height="16">
                            <path d="M8 0a8.2 8.2 0 0 1 .701.031C9.444.095 9.99.645 10.16 1.29l.288 1.107c.018.066.079.158.212.224.231.114.454.243.668.386.123.082.233.09.299.071l1.103-.303c.644-.176 1.392.021 1.82.63.27.385.506.792.704 1.218.315.675.111 1.422-.364 1.891l-.814.806c-.049.048-.098.147-.088.294.016.257.016.515 0 .772-.01.147.038.246.088.294l.814.806c.475.469.679 1.216.364 1.891a7.977 7.977 0 0 1-.704 1.217c-.428.61-1.176.807-1.82.63l-1.102-.302c-.067-.019-.177-.011-.3.071a5.909 5.909 0 0 1-.668.386c-.133.066-.194.158-.211.224l-.29 1.106c-.168.646-.715 1.196-1.458 1.26a8.006 8.006 0 0 1-1.402 0c-.743-.064-1.289-.614-1.458-1.26l-.289-1.106c-.018-.066-.079-.158-.212-.224a5.738 5.738 0 0 1-.668-.386c-.123-.082-.233-.09-.299-.071l-1.103.303c-.644.176-1.392-.021-1.82-.63a8.12 8.12 0 0 1-.704-1.218c-.315-.675-.111-1.422.363-1.891l.815-.806c.05-.048.098-.147.088-.294a6.214 6.214 0 0 1 0-.772c.01-.147-.038-.246-.088-.294l-.815-.806C.635 6.045.431 5.298.746 4.623a7.92 7.92 0 0 1 .704-1.217c.428-.61 1.176-.807 1.82-.63l1.102.302c.067.019.177.011.3-.071.214-.143.437-.272.668-.386.133-.066.194-.158.211-.224l.29-1.106C6.009.645 6.556.095 7.299.03 7.53.01 7.764 0 8 0Zm-.571 1.525c-.036.003-.108.036-.137.146l-.289 1.105c-.147.561-.549.967-.998 1.189-.173.086-.34.183-.5.29-.417.278-.97.423-1.529.27l-1.103-.303c-.109-.03-.175.016-.195.045-.22.312-.412.644-.573.99-.014.031-.021.11.059.19l.815.806c.411.406.562.957.53 1.456a4.709 4.709 0 0 0 0 .582c.032.499-.119 1.05-.53 1.456l-.815.806c-.081.08-.073.159-.059.19.162.346.353.677.573.989.02.03.085.076.195.046l1.102-.303c.56-.153 1.113-.008 1.53.27.161.107.328.204.501.29.447.222.85.629.997 1.189l.289 1.105c.029.109.101.143.137.146a6.6 6.6 0 0 0 1.142 0c.036-.003.108-.036.137-.146l.289-1.105c.147-.561.549-.967.998-1.189.173-.086.34-.183.5-.29.417-.278.97-.423 1.529-.27l1.103.303c.109.029.175-.016.195-.045.22-.313.411-.644.573-.99.014-.031.021-.11-.059-.19l-.815-.806c-.411-.406-.562-.957-.53-1.456a4.709 4.709 0 0 0 0-.582c-.032-.499.119-1.05.53-1.456l.815-.806c.081-.08.073-.159.059-.19a6.464 6.464 0 0 0-.573-.989c-.02-.03-.085-.076-.195-.046l-1.102.303c-.56.153-1.113.008-1.53-.27a4.44 4.44 0 0 0-.501-.29c-.447-.222-.85-.629-.997-1.189l-.289-1.105c-.029-.11-.101-.143-.137-.146a6.6 6.6 0 0 0-1.142 0ZM11 8a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM9.5 8a1.5 1.5 0 1 0-3.001.001A1.5 1.5 0 0 0 9.5 8Z"/>
                        </svg>
                    </a>
                </div>
                <div id="split-button-placeholder"></div>
            </div>
        </header>

        <!-- Main Three-Panel Layout -->
        <div class="main-layout">
            <!-- File Tree Sidebar (Left) -->
            <aside class="sidebar files-sidebar" id="files-sidebar">
                <div class="sidebar-header">
                    <span class="sidebar-title">Changed Files</span>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span class="sidebar-count" id="sidebar-file-count">0</span>
                        <button class="sidebar-collapse-btn" id="sidebar-collapse-btn" title="Close panel">
                            <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l3.22 3.22a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-3.22 3.22a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <nav class="file-tree" id="file-list">
                    <!-- File tree will be loaded here -->
                </nav>
                <div class="resize-handle resize-handle-right" data-panel="sidebar"></div>
            </aside>

            <!-- Diff View (Center) -->
            <main class="diff-view">
                <div class="diff-toolbar">
                    <button class="sidebar-toggle-collapsed" id="sidebar-toggle-collapsed" title="Show file tree">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="m4.177 7.823 2.396-2.396A.25.25 0 0 1 7 5.604v4.792a.25.25 0 0 1-.427.177L4.177 8.177a.25.25 0 0 1 0-.354Z"></path>
                            <path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v12.5A1.75 1.75 0 0 1 14.25 16H1.75A1.75 1.75 0 0 1 0 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25H9.5v-13Zm12.5 13a.25.25 0 0 0 .25-.25V1.75a.25.25 0 0 0-.25-.25H11v13Z"></path>
                        </svg>
                    </button>
                    <div class="toolbar-meta" id="toolbar-meta">
                        <span class="toolbar-branch" id="pr-branch">
                            <svg viewBox="0 0 16 16" fill="currentColor" width="12" height="12">
                                <path d="M11.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122V6A2.5 2.5 0 0110 8.5H6a1 1 0 00-1 1v1.128a2.251 2.251 0 11-1.5 0V5.372a2.25 2.25 0 111.5 0v1.836A2.492 2.492 0 016 7h4a1 1 0 001-1v-.628A2.25 2.25 0 019.5 3.25zM4.25 12a.75.75 0 100 1.5.75.75 0 000-1.5zM3.5 3.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0z"/>
                            </svg>
                            <span id="pr-branch-name">--</span>
                            <button type="button" class="toolbar-branch-copy toolbar-copy-btn" id="pr-branch-copy" title="Copy branch name" aria-label="Copy branch name">
                                <svg viewBox="0 0 16 16" fill="currentColor" width="10" height="10">
                                    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path>
                                    <path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
                                </svg>
                            </button>
                        </span>
                        <span class="toolbar-separator"></span>
                        <span class="toolbar-stat toolbar-stat-additions" id="pr-additions">+0</span>
                        <span class="toolbar-stat toolbar-stat-deletions" id="pr-deletions">-0</span>
                        <span class="toolbar-files" id="pr-files-count">0 files</span>
                        <span class="toolbar-separator"></span>
                        <span class="toolbar-commit" id="pr-commit" title="Click to copy full SHA">
                            <svg viewBox="0 0 16 16" fill="currentColor" width="12" height="12">
                                <path d="M11.93 8.5a4.002 4.002 0 0 1-7.86 0H.75a.75.75 0 0 1 0-1.5h3.32a4.002 4.002 0 0 1 7.86 0h3.32a.75.75 0 0 1 0 1.5Zm-1.43-.75a2.5 2.5 0 1 0-5 0 2.5 2.5 0 0 0 5 0Z"/>
                            </svg>
                            <span id="pr-commit-sha">HEAD</span>
                            <button type="button" class="toolbar-commit-copy toolbar-copy-btn" id="pr-commit-copy" title="Copy full SHA" aria-label="Copy full SHA">
                                <svg viewBox="0 0 16 16" fill="currentColor" width="10" height="10">
                                    <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path>
                                    <path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
                                </svg>
                            </button>
                        </span>
                        <span class="toolbar-separator"></span>
                        <span class="toolbar-path" id="local-path-text" title="">
                            <svg viewBox="0 0 16 16" fill="currentColor" width="12" height="12">
                                <path d="M1.75 1A1.75 1.75 0 0 0 0 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75 0 0 0 16 13.25v-8.5A1.75 1.75 0 0 0 14.25 3H7.5a.25.25 0 0 1-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75Z"/>
                            </svg>
                            <span id="local-path-inner">--</span>
                        </span>
                    </div>
                    <div class="diff-stats" id="diff-stats"></div>
                    <div class="toolbar-actions">
                        <!-- Progress Dots (visible during analysis) -->
                        <div class="analysis-progress-dots" id="analysis-progress-dots" style="display: none;">
                            <span class="progress-dot" data-phase="level1" title="Level 1: Diff"></span>
                            <span class="progress-dot" data-phase="level2" title="Level 2: File"></span>
                            <span class="progress-dot" data-phase="level3" title="Level 3: Codebase"></span>
                            <span class="progress-dot" data-phase="orchestration" title="Orchestration"></span>
                        </div>
                        <button class="btn btn-sm btn-secondary" id="analyze-btn" title="Analyze with AI">
                            <svg class="analyze-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                                <path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z"/>
                            </svg>
                            <span class="btn-text">Analyze</span>
                        </button>
                        <button class="btn btn-sm btn-icon" id="ai-panel-toggle" title="Toggle Review panel">
                            <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                                <path d="M6.823 7.823a.25.25 0 0 1 0 .354l-2.396 2.396A.25.25 0 0 1 4 10.396V5.604a.25.25 0 0 1 .427-.177Z"></path>
                                <path d="M1.75 0h12.5C15.216 0 16 .784 16 1.75v12.5A1.75 1.75 0 0 1 14.25 16H1.75A1.75 1.75 0 0 1 0 14.25V1.75C0 .784.784 0 1.75 0ZM1.5 1.75v12.5c0 .138.112.25.25.25H9.5v-13H1.75a.25.25 0 0 0-.25.25ZM11 14.5h3.25a.25.25 0 0 0 .25-.25V1.75a.25.25 0 0 0-.25-.25H11Z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="diff-container" class="diff-container">
                    <div class="loading">Loading changes...</div>
                </div>
            </main>

            <!-- AI Analysis Panel (Right) -->
            <aside class="ai-panel" id="ai-panel">
                <div class="resize-handle resize-handle-left" data-panel="ai-panel"></div>
                <div class="ai-panel-header">
                    <div class="ai-panel-title">
                        <button class="ai-avatar-small ai-summary-btn" id="ai-summary-btn" aria-label="View AI summary" title="View AI Summary">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" width="14" height="14">
                                <path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z"/>
                                <path d="M18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456z"/>
                            </svg>
                        </button>
                        <span>Review</span>
                    </div>
                    <button class="ai-panel-close" id="ai-panel-close" title="Close panel">
                        <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                            <path d="M3.72 3.72a.75.75 0 0 1 1.06 0L8 6.94l3.22-3.22a.75.75 0 1 1 1.06 1.06L9.06 8l3.22 3.22a.75.75 0 1 1-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 0 1-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 0 1 0-1.06Z"/>
                        </svg>
                    </button>
                </div>

                <!-- Analysis Context Section -->
                <div class="analysis-context" id="analysis-context">
                    <!-- Empty state -->
                    <div class="analysis-context-empty" id="analysis-context-empty">
                        <svg class="analysis-context-empty-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z"/>
                        </svg>
                        <span>No AI analysis yet</span>
                    </div>

                    <!-- Selector (hidden until analysis exists) -->
                    <div class="analysis-context-selector" id="analysis-context-selector" style="display: none;">
                        <button class="analysis-context-btn" id="analysis-context-btn">
                            <span class="analysis-context-label" id="analysis-context-label">--</span>
                            <svg class="dropdown-caret" width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
                                <path d="M2.5 4.5L6 8L9.5 4.5" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>

                    <!-- Split-panel dropdown (hidden by default) -->
                    <div class="analysis-context-dropdown" id="analysis-context-dropdown">
                        <div class="analysis-run-list" id="analysis-context-list">
                            <!-- Populated by JavaScript -->
                        </div>
                        <div class="analysis-preview-panel" id="analysis-context-preview">
                            <!-- Populated by JavaScript on hover -->
                        </div>
                    </div>
                </div>

                <!-- Segment Control -->
                <div class="segment-control" id="segment-control">
                    <div class="segment-control-inner">
                        <button class="segment-btn active" data-segment="ai">AI <span class="segment-count">(0)</span></button>
                        <button class="segment-btn" data-segment="comments">User <span class="segment-count">(0)</span></button>
                        <button class="segment-btn" data-segment="all">All <span class="segment-count">(0)</span></button>
                    </div>
                </div>

                <!-- Level Filter -->
                <div class="level-filter" id="level-filter">
                    <button class="level-pill active" data-level="final" title="Curated suggestions from all levels">Overall</button>
                    <button class="level-pill" data-level="1" title="Line-level analysis">Line</button>
                    <button class="level-pill" data-level="2" title="File-level analysis">File</button>
                    <button class="level-pill" data-level="3" title="Codebase-level analysis">Codebase</button>
                </div>

                <!-- Findings Summary -->
                <div class="findings-summary" id="findings-summary">
                    <div class="findings-header">
                        <span class="findings-count" id="findings-count">0 items</span>
                    </div>
                    <div class="findings-list" id="findings-list">
                        <div class="findings-empty">
                            <p>No AI analysis yet. Click "Analyze" to get started.</p>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Diff2Html Library -->
    <script src="https://cdn.jsdelivr.net/npm/diff2html@3.4.47/bundles/js/diff2html.min.js"></script>

    <!-- Highlight.js for syntax highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Markdown-it Library for rendering markdown in comments -->
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.2/dist/markdown-it.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it-emoji@2.0.2/dist/markdown-it-emoji.min.js"></script>

    <!-- Markdown renderer utility -->
    <script src="/js/utils/markdown.js"></script>

    <!-- Tier icons utility -->
    <script src="/js/utils/tier-icons.js"></script>

    <!-- Suggestion UI utility -->
    <script src="/js/utils/suggestion-ui.js"></script>

    <!-- File order utility -->
    <script src="/js/utils/file-order.js"></script>

    <!-- Components -->
    <script src="/js/components/Toast.js"></script>
    <script src="/js/components/ConfirmDialog.js"></script>
    <script src="/js/components/ProgressModal.js"></script>
    <script src="/js/components/AnalysisConfigModal.js"></script>
    <script src="/js/components/StatusIndicator.js"></script>
    <script src="/js/components/SuggestionNavigator.js"></script>
    <script src="/js/components/ReviewModal.js"></script>
    <script src="/js/components/PreviewModal.js"></script>
    <script src="/js/components/SplitButton.js"></script>
    <script src="/js/components/AISummaryModal.js"></script>
    <script src="/js/components/AIPanel.js"></script>
    <script src="/js/components/EmojiPicker.js"></script>
    <script src="/js/components/KeyboardShortcuts.js"></script>

    <!-- PR Modules (must load before pr.js) -->
    <script src="/js/modules/storage-cleanup.js"></script>
    <script src="/js/modules/gap-coordinates.js"></script>
    <script src="/js/modules/hunk-parser.js"></script>
    <script src="/js/modules/line-tracker.js"></script>
    <script src="/js/modules/diff-renderer.js"></script>
    <script src="/js/modules/comment-manager.js"></script>
    <script src="/js/modules/suggestion-manager.js"></script>
    <script src="/js/modules/file-comment-manager.js"></script>
    <script src="/js/modules/panel-resizer.js"></script>
    <script src="/js/modules/analysis-history.js"></script>

    <!-- Local Mode Configuration -->
    <script>
        // Set local mode flag before loading main JS
        window.PAIR_REVIEW_LOCAL_MODE = true;
    </script>

    <!-- PR JavaScript (shared with local mode) -->
    <script src="/js/pr.js"></script>

    <!-- Local Mode JavaScript -->
    <script src="/js/local.js"></script>
</body>
</html>
