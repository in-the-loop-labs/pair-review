# pair-review

> Your AI-powered code review partner - Close the feedback loop between you and AI coding agents

[![npm version](https://img.shields.io/npm/v/@in-the-loop-labs/pair-review)](https://www.npmjs.com/package/@in-the-loop-labs/pair-review)
[![License: GPL-3.0](https://img.shields.io/badge/License-GPL%203.0-blue.svg)](LICENSE)
[![Node.js >= 20](https://img.shields.io/badge/node-%3E%3D20-brightgreen)](https://nodejs.org)

[GitHub Repository](https://github.com/in-the-loop-labs/pair-review)

![pair-review screenshot](https://raw.githubusercontent.com/in-the-loop-labs/pair-review/main/docs/screenshot.png)

## What is pair-review?

pair-review is a local web application that transforms how you review code, especially code generated by AI coding agents like Claude Code, Cursor, and others. It helps you provide structured feedback and ensures quality through human oversight.

### Two Core Value Propositions

1. **Tight Feedback Loop for AI Coding Agents**
   - Review AI-generated code with clarity and precision
   - Provide structured feedback in markdown format
   - Copy and paste feedback directly back to your coding agent
   - Create a continuous improvement cycle where you stay in control

2. **AI-Assisted Human Review Partner**
   - Get AI-powered suggestions to accelerate your reviews
   - Highlight potential issues and noteworthy code patterns
   - You make the final decisions - adopt, edit, or discard AI suggestions
   - Add your own comments alongside AI insights

## Why pair-review?

- **Local-First**: All data and processing happens on your machine - no cloud dependencies
- **GitHub-Familiar UI**: Interface feels instantly familiar to GitHub users
- **Human-in-the-Loop**: AI suggests, you decide
- **Multiple AI Providers**: Support for Claude, Gemini, Codex, and Copilot. Use your existing subscription!
- **Progressive**: Start simple with manual review, add AI analysis when you need it

## Quick Start

### Installation

**Option 1: No installation required (npx)**

```bash
npx @in-the-loop-labs/pair-review <PR-number-or-URL or --local>
```

**Option 2: Global install**

```bash
npm install -g @in-the-loop-labs/pair-review
pair-review <PR-number-or-URL>
```

> **Tip:** Create an alias for frequent use:
> ```bash
> alias pr='npx @in-the-loop-labs/pair-review'
> ```

Either way, pair-review will:
1. Check out the PR branch locally (using git worktrees)
2. Open the web UI in your browser
3. Show you a familiar diff view

> **Note:** The examples below use the shorter `pair-review` command. If you're using npx without a global install, substitute `npx @in-the-loop-labs/pair-review` instead.

### Review a Pull Request

```bash
# By PR number (in a GitHub repo)
pair-review 123

# By full GitHub URL
pair-review https://github.com/owner/repo/pull/123

# Review local uncommitted changes
pair-review --local
```

### Basic Workflow

1. **Review the diff** - See all file changes in a familiar GitHub-like interface
2. **Optional: Trigger AI analysis** - Get 3-level AI review insights:
   - Level 1: Issues in changed lines only
   - Level 2: Consistency within file context
   - Level 3: Architectural consistency across codebase
3. **Add comments** - Adopt AI suggestions or write your own
4. **Export feedback** - Copy as markdown to paste back to your coding agent
5. **Submit review** - Post to GitHub with approval status (or keep it local)

## Command Line Interface

### Basic Usage

```bash
# Review a pull request by number
pair-review <PR-number>

# Review a pull request by URL
pair-review <PR-URL>

# Review local uncommitted changes in the current directory or a specified path
pair-review --local [path]
```

### Options

| Option | Description |
|--------|-------------|
| `<PR-number>` | PR number to review (requires being in a GitHub repo) |
| `<PR-URL>` | Full GitHub PR URL (e.g., `https://github.com/owner/repo/pull/123`) |
| `--ai` | Automatically run AI analysis when the review loads |
| `--ai-draft` | Run AI analysis and save suggestions as a draft review on GitHub |
| `--configure` | Show setup instructions and configuration options |
| `-d`, `--debug` | Enable verbose debug logging for troubleshooting |
| `-h`, `--help` | Show help message with full CLI documentation |
| `-l`, `--local [path]` | Review local uncommitted changes. Optional path defaults to current directory |
| `--model <name>` | Override the AI model (currently only applies to Claude). Options: `opus`, `sonnet`, `haiku`. Default: `sonnet` |
| `-v`, `--version` | Show version number |

### Examples

```bash
pair-review 123                        # Review PR #123 in current repo
pair-review https://github.com/owner/repo/pull/456
pair-review --local                    # Review uncommitted local changes
pair-review 123 --ai                   # Auto-run AI analysis
```

## Configuration

On first run, pair-review will prompt you to configure the application.

**Token Requirements:**
- **Local mode** (`--local`): Works without a GitHub token - no configuration needed
- **PR review mode**: Requires a GitHub Personal Access Token to fetch PR data and submit reviews

Configuration is stored in `~/.pair-review/config.json`:

```json
{
  "github_token": "ghp_your_token_here",
  "port": 3000,
  "theme": "light"
}
```

### Environment Variables

pair-review supports several environment variables for customizing behavior:

| Variable | Description | Default |
|----------|-------------|---------|
| `GITHUB_TOKEN` | GitHub Personal Access Token (takes precedence over config file) | - |
| `PAIR_REVIEW_CLAUDE_CMD` | Custom command to invoke Claude CLI | `claude` |
| `PAIR_REVIEW_GEMINI_CMD` | Custom command to invoke Gemini CLI | `gemini` |
| `PAIR_REVIEW_CODEX_CMD` | Custom command to invoke Codex CLI | `codex` |
| `PAIR_REVIEW_COPILOT_CMD` | Custom command to invoke Copilot CLI | `copilot` |
| `PAIR_REVIEW_MODEL` | Override the AI model to use (same as `--model` flag) | Provider default |

**Note:** `GITHUB_TOKEN` is the standard environment variable used by many GitHub tools (gh CLI, GitHub Actions, etc.). When set, it takes precedence over the `github_token` field in the config file.

**Note:** The `--model` CLI flag is shorthand for setting `PAIR_REVIEW_MODEL`. If both are specified, the CLI flag takes precedence.

These variables are useful when:
- Your CLI tools are installed in a non-standard location
- You need to use a wrapper script or custom binary
- You want to force a specific model for all reviews

**Examples:**

```bash
# Use GitHub token from environment variable (CI/CD friendly)
GITHUB_TOKEN="ghp_xxxx" pair-review 123

# Use a custom path for Claude CLI
PAIR_REVIEW_CLAUDE_CMD="/usr/local/bin/claude" pair-review 123

# Use a wrapper command (supports multi-word commands)
PAIR_REVIEW_CLAUDE_CMD="devx claude" pair-review 123

# Use Gemini with npx
PAIR_REVIEW_GEMINI_CMD="npx gemini" pair-review --local

# Force a specific model for this review
PAIR_REVIEW_MODEL="opus" pair-review 123

# Combine multiple settings
PAIR_REVIEW_CLAUDE_CMD="/opt/claude/bin/claude" PAIR_REVIEW_MODEL="haiku" pair-review 123
```

**Note:** Multi-word commands (containing spaces) are supported. The application automatically handles these by using shell mode for execution.

### GitHub Token

Create a Personal Access Token (PAT) with these scopes:
- `repo` (full control of private repositories)
- `read:org` (if reviewing organization repos)

[Create token on GitHub](https://github.com/settings/tokens/new)

### AI Provider Configuration

pair-review integrates with AI providers via their CLI tools:

- **Claude**: Uses Claude Code
- **Gemini**: Uses Gemini CLI
- **Codex**: Uses Codex CLI
- **GitHub Copilot**: Uses Copilot CLI

You can select your preferred provider and model in the repository settings UI.

## Features

### Three-Level AI Analysis

pair-review's AI analysis system examines your code changes at increasing levels of context:

- **Level 1 - Isolation**: Analyzes only the changed lines for bugs and issues
- **Level 2 - File Context**: Checks consistency within the entire file
- **Level 3 - Codebase Context**: Validates architectural patterns across the codebase

This progressive approach keeps analysis focused while catching issues at every scope.

### Review Feedback Export

The killer feature for AI coding agent workflows:

1. Add comments during your review (manual or AI-assisted)
2. Click "Preview Review" to see formatted markdown
3. Copy the markdown
4. Paste into your coding agent's chat
5. Agent iterates based on your feedback

The markdown includes file paths, line numbers, and your comments - everything the agent needs to understand and act on your feedback.

### Inline Comments

- Add comments directly on specific lines
- See all comments in context with the diff
- Edit or discard AI suggestions before finalizing
- Comments include file and line number for precision

### Local Mode

Review **unstaged**, uncommitted changes before creating a PR:

```bash
pair-review --local
```

Perfect for:
- Self-review before committing
- Getting AI feedback on work-in-progress
- Iterating with a coding agent on local changes
- Reviewing only the unstaged files that are still changing
- Staging the files you've already reviewed and viewing the next round of changes

## Development

### Prerequisites

- Node.js 20.0.0 or higher
- Git

### Running Locally

```bash
# Install dependencies
npm install

# Run tests
npm test

# Run tests in watch mode
npm run test:watch

# Run E2E tests
npm run test:e2e

# Run E2E tests with visible browser
npm run test:e2e:headed

# Start development server
npm run dev
```

### Architecture

- **Backend**: Node.js + Express
- **Frontend**: Vanilla JavaScript (no framework)
- **Database**: SQLite for local storage
- **AI Integration**: CLI-based adapter pattern for multiple providers
- **Git**: Uses git worktrees for clean PR checkout

## Use Cases

### 1. Reviewing AI-Generated Code

You're working with a coding agent on a new feature:

1. The coding agent generates code changes
2. Run `pair-review --local` to review
3. Add comments on issues or improvements needed
4. Copy the markdown feedback
5. Paste back to the agent: "Address my review feedback: [paste]"
6. The coding agent iterates based on your comments
7. Repeat until satisfied

### 2. Team Pull Request Review

Standard GitHub PR review workflow:

1. Run `pair-review <PR-URL>`
2. Optional: Trigger AI analysis for initial insights
3. Review code, adopt useful AI suggestions
4. Add your own expert comments
5. Submit review to GitHub with approval status

### 3. Self-Review Before Committing

Before creating a PR:

1. Make local changes
2. Run `pair-review --local`
3. Review your own changes (with or without AI)
4. Catch issues early
5. Commit with confidence

## FAQ

**Q: Does my code get sent to the cloud?**
A: Not by pair-review. Pair-review keeps all its data locally. AI providers that you use for review may communicate with their servers.

**Q: Do I need to use AI analysis?**
A: No. pair-review works great as a local review UI without AI. Trigger analysis only when you want it.

**Q: Which AI provider should I use?**
A: Any that you have configured locally. Claude excels at code review, but try different providers to see what works best for you.

**Q: Can I use this for non-GitHub repos?**
A: Local mode (`--local`) works with any git repository. PR review mode requires GitHub.

**Q: How do I give feedback to a coding agent?**
A: Add comments during review, click "Preview Review", copy the markdown, and paste it into your coding agent's chat interface.

**Q: Something isn't working right. What should I try first?**
A: Try refreshing your browser. Many transient issues resolve with a simple page refresh.

## Contributing

Contributions welcome! Please:

1. Check existing issues or create a new one
2. Fork the repository
3. Create a feature branch
4. Write tests for changes, especially bug fixes
5. Submit a pull request

## License

GPL-3.0 License - see LICENSE file for details

---

**Start reviewing better code today:**

```bash
npx @in-the-loop-labs/pair-review <PR-number-or-URL or --local>
```
