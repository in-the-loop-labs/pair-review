<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pair Review – AI-Powered Code Review</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,400&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <div class="logo">
          <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 18l2-2-2-2M8 18l-2-2 2-2M12 4v16"/>
          </svg>
          <span class="logo-text">pair<span class="logo-accent">review</span></span>
        </div>
        <div class="breadcrumb">
          <span class="breadcrumb-org">anthropics</span>
          <span class="breadcrumb-sep">/</span>
          <span class="breadcrumb-repo">claude-code</span>
          <span class="breadcrumb-pr">#847</span>
        </div>
      </div>
      <div class="header-center">
        <h1 class="pr-title">feat: Add streaming response support for tool calls</h1>
        <div class="pr-meta">
          <span class="pr-branch">
            <svg viewBox="0 0 16 16" fill="currentColor" width="12" height="12">
              <path d="M11.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122V6A2.5 2.5 0 0110 8.5H6a1 1 0 00-1 1v1.128a2.251 2.251 0 11-1.5 0V5.372a2.25 2.25 0 111.5 0v1.836A2.492 2.492 0 016 7h4a1 1 0 001-1v-.628A2.25 2.25 0 019.5 3.25zM4.25 12a.75.75 0 100 1.5.75.75 0 000-1.5zM3.5 3.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0z"/>
            </svg>
            feature/streaming-tools
          </span>
          <span class="pr-stat pr-stat-additions">+347</span>
          <span class="pr-stat pr-stat-deletions">-89</span>
          <span class="pr-files">12 files</span>
        </div>
      </div>
      <div class="header-right">
        <button class="btn btn-secondary">
          <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
            <path d="M8 9.5a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"/>
            <path d="M8 0a8 8 0 100 16A8 8 0 008 0zM1.5 8a6.5 6.5 0 1113 0 6.5 6.5 0 01-13 0z"/>
          </svg>
          View on GitHub
        </button>
        <button class="btn btn-primary">
          <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
            <path d="M3.5 8a.5.5 0 01.5-.5h8a.5.5 0 010 1H4a.5.5 0 01-.5-.5z"/>
            <path d="M8 3.5a.5.5 0 01.5.5v8a.5.5 0 01-1 0V4a.5.5 0 01.5-.5z"/>
          </svg>
          Submit Review
        </button>
      </div>
    </header>

    <!-- Main Layout -->
    <div class="main-layout">
      <!-- File Tree Sidebar -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <span class="sidebar-title">Changed Files</span>
          <span class="sidebar-count">12</span>
        </div>
        <nav class="file-tree">
          <div class="file-group">
            <div class="file-group-header">
              <svg class="folder-icon" viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                <path d="M1.75 1A1.75 1.75 0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75 0 0016 13.25v-8.5A1.75 1.75 0 0014.25 3H7.5a.25.25 0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"/>
              </svg>
              <span>src/streaming</span>
            </div>
            <div class="file-list">
              <a href="#stream-handler" class="file-item active" data-status="modified">
                <span class="file-name">StreamHandler.ts</span>
                <span class="file-changes">+124 -12</span>
              </a>
              <a href="#tool-stream" class="file-item" data-status="added">
                <span class="file-name">ToolStreamProcessor.ts</span>
                <span class="file-changes">+89</span>
              </a>
              <a href="#types" class="file-item" data-status="modified">
                <span class="file-name">types.ts</span>
                <span class="file-changes">+34 -8</span>
              </a>
            </div>
          </div>
          <div class="file-group">
            <div class="file-group-header">
              <svg class="folder-icon" viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                <path d="M1.75 1A1.75 1.75 0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75 0 0016 13.25v-8.5A1.75 1.75 0 0014.25 3H7.5a.25.25 0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"/>
              </svg>
              <span>src/tools</span>
            </div>
            <div class="file-list">
              <a href="#tool-executor" class="file-item" data-status="modified">
                <span class="file-name">ToolExecutor.ts</span>
                <span class="file-changes">+67 -45</span>
              </a>
              <a href="#tool-registry" class="file-item" data-status="modified">
                <span class="file-name">ToolRegistry.ts</span>
                <span class="file-changes">+23 -14</span>
              </a>
            </div>
          </div>
          <div class="file-group">
            <div class="file-group-header">
              <svg class="folder-icon" viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                <path d="M1.75 1A1.75 1.75 0 000 2.75v10.5C0 14.216.784 15 1.75 15h12.5A1.75 1.75 0 0016 13.25v-8.5A1.75 1.75 0 0014.25 3H7.5a.25.25 0 01-.2-.1l-.9-1.2C6.07 1.26 5.55 1 5 1H1.75z"/>
              </svg>
              <span>tests</span>
            </div>
            <div class="file-list">
              <a href="#stream-test" class="file-item" data-status="added">
                <span class="file-name">StreamHandler.test.ts</span>
                <span class="file-changes">+156</span>
              </a>
            </div>
          </div>
        </nav>

        <!-- AI Status in Sidebar -->
        <div class="ai-sidebar-status">
          <div class="ai-avatar">
            <div class="ai-avatar-ring"></div>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z"/>
              <path d="M18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456z"/>
            </svg>
          </div>
          <div class="ai-status-info">
            <span class="ai-status-label">AI Co-reviewer</span>
            <span class="ai-status-text">Analysis complete</span>
          </div>
          <div class="ai-findings-badge">4</div>
        </div>
      </aside>

      <!-- Diff View -->
      <main class="diff-view">
        <!-- File Header -->
        <div class="diff-file" id="stream-handler">
          <div class="diff-file-header">
            <div class="diff-file-info">
              <span class="diff-file-status" data-status="modified">M</span>
              <span class="diff-file-path">src/streaming/StreamHandler.ts</span>
            </div>
            <div class="diff-file-actions">
              <button class="diff-action-btn" title="Expand all">
                <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                  <path d="M8.177.677l2.896 2.896a.25.25 0 01-.177.427H8.75v1.25a.75.75 0 01-1.5 0V4H5.104a.25.25 0 01-.177-.427L7.823.677a.25.25 0 01.354 0zM7.25 10.75a.75.75 0 011.5 0V12h2.146a.25.25 0 01.177.427l-2.896 2.896a.25.25 0 01-.354 0l-2.896-2.896A.25.25 0 015.104 12H7.25v-1.25z"/>
                </svg>
              </button>
              <button class="diff-action-btn" title="View file">
                <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                  <path d="M2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0113.25 16h-9.5A1.75 1.75 0 012 14.25V1.75z"/>
                </svg>
              </button>
            </div>
          </div>

          <!-- Diff Content -->
          <div class="diff-content">
            <!-- Collapsed context -->
            <div class="diff-hunk-header">
              <button class="expand-context-btn">
                <svg viewBox="0 0 16 16" fill="currentColor" width="12" height="12">
                  <path d="M8.177 14.323l2.896-2.896a.25.25 0 00-.177-.427H8.75V9.75a.75.75 0 00-1.5 0V11H5.104a.25.25 0 00-.177.427l2.896 2.896a.25.25 0 00.354 0zM7.25 5.25a.75.75 0 001.5 0V4h2.146a.25.25 0 00.177-.427L8.177.677a.25.25 0 00-.354 0L4.927 3.573a.25.25 0 00.177.427H7.25v1.25z"/>
                </svg>
                Expand 23 lines
              </button>
              <span class="hunk-info">@@ -45,7 +45,12 @@ export class StreamHandler</span>
            </div>

            <!-- Code lines -->
            <div class="diff-lines">
              <div class="diff-line diff-context">
                <span class="line-num line-num-old">45</span>
                <span class="line-num line-num-new">45</span>
                <span class="line-content"><span class="code-keyword">export</span> <span class="code-keyword">class</span> <span class="code-class">StreamHandler</span> {</span>
              </div>
              <div class="diff-line diff-context">
                <span class="line-num line-num-old">46</span>
                <span class="line-num line-num-new">46</span>
                <span class="line-content">  <span class="code-keyword">private</span> buffer: <span class="code-type">StreamBuffer</span>;</span>
              </div>
              <div class="diff-line diff-context">
                <span class="line-num line-num-old">47</span>
                <span class="line-num line-num-new">47</span>
                <span class="line-content">  <span class="code-keyword">private</span> isProcessing: <span class="code-type">boolean</span> = <span class="code-literal">false</span>;</span>
              </div>
              <div class="diff-line diff-deletion">
                <span class="line-num line-num-old">48</span>
                <span class="line-num line-num-new"></span>
                <span class="line-content">  <span class="code-keyword">private</span> toolCallbacks: <span class="code-type">Map</span><<span class="code-type">string</span>, <span class="code-type">Function</span>>;</span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">48</span>
                <span class="line-content">  <span class="code-keyword">private</span> toolCallbacks: <span class="code-type">Map</span><<span class="code-type">string</span>, <span class="code-type">ToolCallback</span>>;</span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">49</span>
                <span class="line-content">  <span class="code-keyword">private</span> streamQueue: <span class="code-type">AsyncQueue</span><<span class="code-type">StreamChunk</span>>;</span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">50</span>
                <span class="line-content">  <span class="code-keyword">private</span> abortController: <span class="code-type">AbortController</span> | <span class="code-literal">null</span> = <span class="code-literal">null</span>;</span>
              </div>
            </div>

            <!-- AI Suggestion Inline -->
            <div class="ai-suggestion">
              <div class="ai-suggestion-header">
                <div class="ai-suggestion-badge">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                    <path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z"/>
                  </svg>
                  AI Suggestion
                </div>
                <div class="ai-suggestion-level">
                  <span class="level-dot level-1 active"></span>
                  <span class="level-dot level-2"></span>
                  <span class="level-dot level-3"></span>
                  <span class="level-label">Line Analysis</span>
                </div>
              </div>
              <div class="ai-suggestion-body">
                <p class="ai-suggestion-text">Consider initializing <code>streamQueue</code> in the constructor with a bounded capacity to prevent memory issues during high-throughput scenarios. The <code>AsyncQueue</code> without limits could grow unbounded.</p>
                <div class="ai-suggestion-code">
                  <pre><code><span class="code-keyword">private</span> streamQueue = <span class="code-keyword">new</span> <span class="code-class">AsyncQueue</span><<span class="code-type">StreamChunk</span>>({
  maxSize: <span class="code-literal">1000</span>,
  onOverflow: <span class="code-string">'drop-oldest'</span>
});</code></pre>
                </div>
              </div>
              <div class="ai-suggestion-actions">
                <button class="ai-action ai-action-adopt">
                  <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                    <path d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"/>
                  </svg>
                  Adopt
                </button>
                <button class="ai-action ai-action-edit">
                  <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                    <path d="M11.013 1.427a1.75 1.75 0 012.474 0l1.086 1.086a1.75 1.75 0 010 2.474l-8.61 8.61c-.21.21-.47.364-.756.445l-3.251.93a.75.75 0 01-.927-.928l.929-3.25c.081-.286.235-.547.445-.758l8.61-8.61z"/>
                  </svg>
                  Edit
                </button>
                <button class="ai-action ai-action-dismiss">
                  <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                    <path d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"/>
                  </svg>
                  Dismiss
                </button>
              </div>
            </div>

            <!-- More code lines -->
            <div class="diff-lines">
              <div class="diff-line diff-context">
                <span class="line-num line-num-old">49</span>
                <span class="line-num line-num-new">51</span>
                <span class="line-content"></span>
              </div>
              <div class="diff-line diff-context">
                <span class="line-num line-num-old">50</span>
                <span class="line-num line-num-new">52</span>
                <span class="line-content">  <span class="code-keyword">constructor</span>(options: <span class="code-type">StreamOptions</span>) {</span>
              </div>
              <div class="diff-line diff-context">
                <span class="line-num line-num-old">51</span>
                <span class="line-num line-num-new">53</span>
                <span class="line-content">    <span class="code-keyword">this</span>.buffer = <span class="code-keyword">new</span> <span class="code-class">StreamBuffer</span>(options.bufferSize);</span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">54</span>
                <span class="line-content">    <span class="code-keyword">this</span>.toolCallbacks = <span class="code-keyword">new</span> <span class="code-class">Map</span>();</span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">55</span>
                <span class="line-content">    <span class="code-keyword">this</span>.streamQueue = <span class="code-keyword">new</span> <span class="code-class">AsyncQueue</span>();</span>
              </div>
              <div class="diff-line diff-context">
                <span class="line-num line-num-old">52</span>
                <span class="line-num line-num-new">56</span>
                <span class="line-content">  }</span>
              </div>
            </div>

            <!-- Collapsed context -->
            <div class="diff-hunk-header">
              <button class="expand-context-btn">
                <svg viewBox="0 0 16 16" fill="currentColor" width="12" height="12">
                  <path d="M8.177 14.323l2.896-2.896a.25.25 0 00-.177-.427H8.75V9.75a.75.75 0 00-1.5 0V11H5.104a.25.25 0 00-.177.427l2.896 2.896a.25.25 0 00.354 0zM7.25 5.25a.75.75 0 001.5 0V4h2.146a.25.25 0 00.177-.427L8.177.677a.25.25 0 00-.354 0L4.927 3.573a.25.25 0 00.177.427H7.25v1.25z"/>
                </svg>
                Expand 15 lines
              </button>
              <span class="hunk-info">@@ -67,4 +72,28 @@ export class StreamHandler</span>
            </div>

            <!-- New method addition -->
            <div class="diff-lines">
              <div class="diff-line diff-context">
                <span class="line-num line-num-old">67</span>
                <span class="line-num line-num-new">72</span>
                <span class="line-content">  }</span>
              </div>
              <div class="diff-line diff-context">
                <span class="line-num line-num-old">68</span>
                <span class="line-num line-num-new">73</span>
                <span class="line-content"></span>
              </div>
              <div class="diff-line diff-addition has-comment" data-line="74">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">74</span>
                <span class="line-content">  <span class="code-keyword">async</span> <span class="code-function">processToolStream</span>(</span>
                <button class="add-comment-btn" title="Add comment">
                  <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                    <path d="M8 0a8 8 0 100 16A8 8 0 008 0zM1.5 8a6.5 6.5 0 1113 0 6.5 6.5 0 01-13 0z"/>
                    <path d="M7.25 4.5a.75.75 0 011.5 0v2.75h2.75a.75.75 0 010 1.5H8.75v2.75a.75.75 0 01-1.5 0V8.75H4.5a.75.75 0 010-1.5h2.75V4.5z"/>
                  </svg>
                </button>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">75</span>
                <span class="line-content">    toolId: <span class="code-type">string</span>,</span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">76</span>
                <span class="line-content">    input: <span class="code-type">AsyncIterable</span><<span class="code-type">StreamChunk</span>>,</span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">77</span>
                <span class="line-content">    signal?: <span class="code-type">AbortSignal</span></span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">78</span>
                <span class="line-content">  ): <span class="code-type">Promise</span><<span class="code-type">ToolResult</span>> {</span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">79</span>
                <span class="line-content">    <span class="code-keyword">const</span> callback = <span class="code-keyword">this</span>.toolCallbacks.<span class="code-function">get</span>(toolId);</span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">80</span>
                <span class="line-content">    <span class="code-keyword">if</span> (!callback) {</span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">81</span>
                <span class="line-content">      <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-class">Error</span>(<span class="code-string">`Unknown tool: </span><span class="code-keyword">${</span>toolId<span class="code-keyword">}</span><span class="code-string">`</span>);</span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">82</span>
                <span class="line-content">    }</span>
              </div>
            </div>

            <!-- Human comment -->
            <div class="comment-thread">
              <div class="comment human-comment">
                <div class="comment-header">
                  <img class="comment-avatar" src="https://avatars.githubusercontent.com/u/1?v=4" alt="User avatar">
                  <span class="comment-author">you</span>
                  <span class="comment-time">Draft</span>
                </div>
                <div class="comment-body">
                  <p>Should we add a timeout here? If the tool callback hangs, this could block the entire stream processing.</p>
                </div>
                <div class="comment-actions">
                  <button class="comment-action">Edit</button>
                  <button class="comment-action">Delete</button>
                </div>
              </div>
            </div>

            <!-- More additions -->
            <div class="diff-lines">
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">83</span>
                <span class="line-content"></span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">84</span>
                <span class="line-content">    <span class="code-keyword">let</span> result: <span class="code-type">Partial</span><<span class="code-type">ToolResult</span>> = {};</span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">85</span>
                <span class="line-content">    <span class="code-keyword">for await</span> (<span class="code-keyword">const</span> chunk <span class="code-keyword">of</span> input) {</span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">86</span>
                <span class="line-content">      <span class="code-keyword">if</span> (signal?.<span class="code-property">aborted</span>) {</span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">87</span>
                <span class="line-content">        <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-class">AbortError</span>(<span class="code-string">'Tool stream aborted'</span>);</span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">88</span>
                <span class="line-content">      }</span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">89</span>
                <span class="line-content">      result = <span class="code-keyword">await</span> callback.<span class="code-function">process</span>(chunk, result);</span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">90</span>
                <span class="line-content">    }</span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">91</span>
                <span class="line-content"></span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">92</span>
                <span class="line-content">    <span class="code-keyword">return</span> result <span class="code-keyword">as</span> <span class="code-type">ToolResult</span>;</span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">93</span>
                <span class="line-content">  }</span>
              </div>
            </div>

            <!-- AI Suggestion - File level -->
            <div class="ai-suggestion ai-suggestion-file">
              <div class="ai-suggestion-header">
                <div class="ai-suggestion-badge">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14">
                    <path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z"/>
                  </svg>
                  AI Suggestion
                </div>
                <div class="ai-suggestion-level">
                  <span class="level-dot level-1"></span>
                  <span class="level-dot level-2 active"></span>
                  <span class="level-dot level-3"></span>
                  <span class="level-label">File Analysis</span>
                </div>
              </div>
              <div class="ai-suggestion-body">
                <p class="ai-suggestion-text">The <code>processToolStream</code> method doesn't validate the result type before casting. Consider adding runtime validation to ensure type safety, especially since this handles external input.</p>
                <div class="ai-suggestion-code">
                  <pre><code><span class="code-keyword">if</span> (!<span class="code-function">isValidToolResult</span>(result)) {
  <span class="code-keyword">throw</span> <span class="code-keyword">new</span> <span class="code-class">ValidationError</span>(
    <span class="code-string">`Invalid tool result for </span><span class="code-keyword">${</span>toolId<span class="code-keyword">}</span><span class="code-string">`</span>,
    result
  );
}
<span class="code-keyword">return</span> result;</code></pre>
                </div>
              </div>
              <div class="ai-suggestion-actions">
                <button class="ai-action ai-action-adopt">
                  <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                    <path d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"/>
                  </svg>
                  Adopt
                </button>
                <button class="ai-action ai-action-edit">
                  <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                    <path d="M11.013 1.427a1.75 1.75 0 012.474 0l1.086 1.086a1.75 1.75 0 010 2.474l-8.61 8.61c-.21.21-.47.364-.756.445l-3.251.93a.75.75 0 01-.927-.928l.929-3.25c.081-.286.235-.547.445-.758l8.61-8.61z"/>
                  </svg>
                  Edit
                </button>
                <button class="ai-action ai-action-dismiss">
                  <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                    <path d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"/>
                  </svg>
                  Dismiss
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Second File -->
        <div class="diff-file" id="tool-stream">
          <div class="diff-file-header">
            <div class="diff-file-info">
              <span class="diff-file-status" data-status="added">A</span>
              <span class="diff-file-path">src/streaming/ToolStreamProcessor.ts</span>
            </div>
            <div class="diff-file-actions">
              <button class="diff-action-btn" title="Expand all">
                <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                  <path d="M8.177.677l2.896 2.896a.25.25 0 01-.177.427H8.75v1.25a.75.75 0 01-1.5 0V4H5.104a.25.25 0 01-.177-.427L7.823.677a.25.25 0 01.354 0zM7.25 10.75a.75.75 0 011.5 0V12h2.146a.25.25 0 01.177.427l-2.896 2.896a.25.25 0 01-.354 0l-2.896-2.896A.25.25 0 015.104 12H7.25v-1.25z"/>
                </svg>
              </button>
              <button class="diff-action-btn" title="View file">
                <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                  <path d="M2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0113.25 16h-9.5A1.75 1.75 0 012 14.25V1.75z"/>
                </svg>
              </button>
            </div>
          </div>

          <div class="diff-content">
            <div class="diff-lines">
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">1</span>
                <span class="line-content"><span class="code-keyword">import</span> { <span class="code-type">StreamChunk</span>, <span class="code-type">ToolCallback</span> } <span class="code-keyword">from</span> <span class="code-string">'./types'</span>;</span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">2</span>
                <span class="line-content"></span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">3</span>
                <span class="line-content"><span class="code-comment">/**</span></span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">4</span>
                <span class="line-content"><span class="code-comment"> * Processes streaming tool calls with backpressure support.</span></span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">5</span>
                <span class="line-content"><span class="code-comment"> */</span></span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">6</span>
                <span class="line-content"><span class="code-keyword">export</span> <span class="code-keyword">class</span> <span class="code-class">ToolStreamProcessor</span> {</span>
              </div>
            </div>

            <!-- AI Praise -->
            <div class="ai-suggestion ai-suggestion-praise">
              <div class="ai-suggestion-header">
                <div class="ai-suggestion-badge ai-badge-praise">
                  <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                    <path d="M8 .25a.75.75 0 01.673.418l1.882 3.815 4.21.612a.75.75 0 01.416 1.279l-3.046 2.97.719 4.192a.75.75 0 01-1.088.791L8 12.347l-3.766 1.98a.75.75 0 01-1.088-.79l.72-4.194L.818 6.374a.75.75 0 01.416-1.28l4.21-.611L7.327.668A.75.75 0 018 .25z"/>
                  </svg>
                  Nice Work
                </div>
                <div class="ai-suggestion-level">
                  <span class="level-dot level-1"></span>
                  <span class="level-dot level-2"></span>
                  <span class="level-dot level-3 active"></span>
                  <span class="level-label">Architecture</span>
                </div>
              </div>
              <div class="ai-suggestion-body">
                <p class="ai-suggestion-text">Good separation of concerns by creating a dedicated processor class. The backpressure support will be important as tool calls become more complex. This aligns well with the existing streaming patterns in the codebase.</p>
              </div>
              <div class="ai-suggestion-actions">
                <button class="ai-action ai-action-dismiss">
                  <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                    <path d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"/>
                  </svg>
                  Got it
                </button>
              </div>
            </div>

            <div class="diff-lines">
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">7</span>
                <span class="line-content">  <span class="code-keyword">private</span> highWaterMark = <span class="code-literal">16</span>;</span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">8</span>
                <span class="line-content">  <span class="code-keyword">private</span> pendingChunks: <span class="code-type">StreamChunk</span>[] = [];</span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">9</span>
                <span class="line-content"></span>
              </div>
              <div class="diff-line diff-addition">
                <span class="line-num line-num-old"></span>
                <span class="line-num line-num-new">10</span>
                <span class="line-content">  <span class="code-keyword">constructor</span>(<span class="code-keyword">private</span> callback: <span class="code-type">ToolCallback</span>) {}</span>
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- AI Analysis Panel -->
      <aside class="ai-panel">
        <div class="ai-panel-header">
          <div class="ai-panel-title">
            <div class="ai-avatar-small">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z"/>
                <path d="M18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456z"/>
              </svg>
            </div>
            <span>AI Analysis</span>
          </div>
          <button class="ai-panel-settings">
            <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
              <path d="M8 0a8 8 0 100 16A8 8 0 008 0zm0 14.5a6.5 6.5 0 110-13 6.5 6.5 0 010 13zM6.5 7.75A.75.75 0 017.25 7h1a.75.75 0 01.75.75v3.5a.75.75 0 01-.75.75h-1a.75.75 0 01-.75-.75v-3.5zm.75-3a1 1 0 112 0 1 1 0 01-2 0z"/>
            </svg>
          </button>
        </div>

        <!-- Analysis Depth Indicator -->
        <div class="analysis-depth">
          <div class="depth-header">
            <span class="depth-label">Analysis Depth</span>
            <span class="depth-status">Complete</span>
          </div>
          <div class="depth-levels">
            <div class="depth-level depth-level-complete">
              <div class="depth-level-indicator">
                <div class="depth-level-icon">
                  <svg viewBox="0 0 16 16" fill="currentColor" width="12" height="12">
                    <path d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"/>
                  </svg>
                </div>
                <span class="depth-level-label">Line</span>
              </div>
              <div class="depth-level-desc">Changes in isolation</div>
            </div>
            <div class="depth-level depth-level-complete">
              <div class="depth-level-indicator">
                <div class="depth-level-icon">
                  <svg viewBox="0 0 16 16" fill="currentColor" width="12" height="12">
                    <path d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"/>
                  </svg>
                </div>
                <span class="depth-level-label">File</span>
              </div>
              <div class="depth-level-desc">Consistency within file</div>
            </div>
            <div class="depth-level depth-level-complete">
              <div class="depth-level-indicator">
                <div class="depth-level-icon">
                  <svg viewBox="0 0 16 16" fill="currentColor" width="12" height="12">
                    <path d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"/>
                  </svg>
                </div>
                <span class="depth-level-label">Codebase</span>
              </div>
              <div class="depth-level-desc">Architectural consistency</div>
            </div>
          </div>
        </div>

        <!-- Findings Summary -->
        <div class="findings-summary">
          <div class="findings-header">
            <span class="findings-label">Findings</span>
            <span class="findings-count">4 items</span>
          </div>
          <div class="findings-list">
            <button class="finding-item finding-issue active">
              <div class="finding-icon">
                <svg viewBox="0 0 16 16" fill="currentColor" width="12" height="12">
                  <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047z"/>
                </svg>
              </div>
              <div class="finding-content">
                <span class="finding-title">Unbounded queue</span>
                <span class="finding-location">StreamHandler.ts:49</span>
              </div>
            </button>
            <button class="finding-item finding-issue">
              <div class="finding-icon">
                <svg viewBox="0 0 16 16" fill="currentColor" width="12" height="12">
                  <path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047z"/>
                </svg>
              </div>
              <div class="finding-content">
                <span class="finding-title">Missing validation</span>
                <span class="finding-location">StreamHandler.ts:92</span>
              </div>
            </button>
            <button class="finding-item finding-praise">
              <div class="finding-icon">
                <svg viewBox="0 0 16 16" fill="currentColor" width="12" height="12">
                  <path d="M8 .25a.75.75 0 01.673.418l1.882 3.815 4.21.612a.75.75 0 01.416 1.279l-3.046 2.97.719 4.192a.75.75 0 01-1.088.791L8 12.347l-3.766 1.98a.75.75 0 01-1.088-.79l.72-4.194L.818 6.374a.75.75 0 01.416-1.28l4.21-.611L7.327.668A.75.75 0 018 .25z"/>
                </svg>
              </div>
              <div class="finding-content">
                <span class="finding-title">Good separation</span>
                <span class="finding-location">ToolStreamProcessor.ts</span>
              </div>
            </button>
            <button class="finding-item finding-info">
              <div class="finding-icon">
                <svg viewBox="0 0 16 16" fill="currentColor" width="12" height="12">
                  <path d="M8 0a8 8 0 100 16A8 8 0 008 0zm0 4a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 018 4zm0 9a1 1 0 110-2 1 1 0 010 2z"/>
                </svg>
              </div>
              <div class="finding-content">
                <span class="finding-title">Consider timeout</span>
                <span class="finding-location">StreamHandler.ts:79</span>
              </div>
            </button>
          </div>
        </div>

        <!-- Review Progress -->
        <div class="review-progress">
          <div class="progress-header">
            <span class="progress-label">Review Progress</span>
            <span class="progress-count">2 of 4 addressed</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: 50%"></div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="ai-actions">
          <button class="ai-quick-action">
            <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
              <path d="M5.433 2.304A4.492 4.492 0 008 1.5a4.49 4.49 0 00-3.891 2.252.25.25 0 01-.218.126H1.25a.25.25 0 00-.25.25v.75c0 .138.112.25.25.25h2.664a4.5 4.5 0 001.137 1.469c-.3.318-.488.734-.53 1.192a.25.25 0 01-.25.223H1.25a.25.25 0 00-.25.25v.75c0 .138.112.25.25.25h3.023c.2 1.194.831 2.231 1.727 2.932v.556a.75.75 0 001.5 0v-.088c.24.054.49.084.75.084.26 0 .51-.03.75-.084v.088a.75.75 0 001.5 0v-.556a4.484 4.484 0 001.727-2.932h3.023a.25.25 0 00.25-.25v-.75a.25.25 0 00-.25-.25h-3.021a.25.25 0 01-.25-.223 2.485 2.485 0 00-.53-1.192 4.5 4.5 0 001.137-1.469h2.664a.25.25 0 00.25-.25v-.75a.25.25 0 00-.25-.25h-2.64a.25.25 0 01-.218-.126A4.492 4.492 0 008 1.5a4.492 4.492 0 00-2.567.804z"/>
            </svg>
            Re-analyze
          </button>
          <button class="ai-quick-action">
            <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
              <path d="M0 2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0114.25 15H1.75A1.75 1.75 0 010 13.25V2.75zm1.75-.25a.25.25 0 00-.25.25v10.5c0 .138.112.25.25.25h12.5a.25.25 0 00.25-.25V2.75a.25.25 0 00-.25-.25H1.75zM3.5 4.75a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5a.75.75 0 01-.75-.75zm.75 2.25a.75.75 0 000 1.5h4.5a.75.75 0 000-1.5h-4.5z"/>
            </svg>
            Explain Changes
          </button>
        </div>

        <!-- Future: Chat input -->
        <div class="ai-chat-preview">
          <div class="chat-input-wrapper">
            <input type="text" class="chat-input" placeholder="Ask about this PR..." disabled>
            <button class="chat-send" disabled>
              <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                <path d="M.989 8l6.075-1.958L5.106.385A.75.75 0 016.17.1l9.5 7.25a.75.75 0 010 1.2l-9.5 7.5a.75.75 0 01-1.21-.59V9.05L.989 8zm1.556-.333l3.61 1.164a.75.75 0 01.448.963l-.001.003L6 11.46V14.14l7.17-5.64L6 3.136V5.75a.75.75 0 01-.455.689L2.545 7.667z"/>
              </svg>
            </button>
          </div>
          <span class="chat-coming-soon">Chat coming soon</span>
        </div>
      </aside>
    </div>

    <!-- Submit Review Modal Preview -->
    <div class="review-modal" style="display: none;">
      <div class="modal-backdrop"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h2>Submit Review</h2>
          <button class="modal-close">×</button>
        </div>
        <div class="modal-body">
          <div class="review-summary">
            <div class="summary-item">
              <span class="summary-label">Your comments</span>
              <span class="summary-value">1</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">AI suggestions adopted</span>
              <span class="summary-value">2</span>
            </div>
          </div>
          <div class="review-status-selector">
            <label class="status-option">
              <input type="radio" name="review-status" value="approve">
              <span class="status-badge status-approve">
                <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                  <path d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 111.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"/>
                </svg>
                Approve
              </span>
            </label>
            <label class="status-option">
              <input type="radio" name="review-status" value="comment" checked>
              <span class="status-badge status-comment">
                <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                  <path d="M1 2.75C1 1.784 1.784 1 2.75 1h10.5c.966 0 1.75.784 1.75 1.75v7.5A1.75 1.75 0 0113.25 12H9.06l-2.573 2.573A1.458 1.458 0 014 13.543V12H2.75A1.75 1.75 0 011 10.25v-7.5z"/>
                </svg>
                Comment
              </span>
            </label>
            <label class="status-option">
              <input type="radio" name="review-status" value="request-changes">
              <span class="status-badge status-changes">
                <svg viewBox="0 0 16 16" fill="currentColor" width="14" height="14">
                  <path d="M2.75 1A1.75 1.75 0 001 2.75v10.5c0 .966.784 1.75 1.75 1.75h10.5A1.75 1.75 0 0015 13.25v-7.5a.75.75 0 00-1.5 0v7.5a.25.25 0 01-.25.25H2.75a.25.25 0 01-.25-.25V2.75a.25.25 0 01.25-.25h7.5a.75.75 0 000-1.5h-7.5z"/>
                  <path d="M13.78 4.22a.75.75 0 00-1.06-1.06L8.5 7.38 6.78 5.66a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.06 0l4.75-4.75z"/>
                </svg>
                Request Changes
              </span>
            </label>
          </div>
          <textarea class="review-body" placeholder="Leave a comment..."></textarea>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary">Cancel</button>
          <button class="btn btn-primary">Submit Review</button>
        </div>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
