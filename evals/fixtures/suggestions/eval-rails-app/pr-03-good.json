[
  {
    "file": "app/controllers/tasks_controller.rb",
    "line_start": 113,
    "line_end": 113,
    "type": "security",
    "title": "Overly permissive strong parameters — mass assignment risk",
    "description": "The task_params method permits user_id, project_id, and admin. This allows malicious users to reassign tasks to other users, move tasks between projects, or set an admin flag. Only permit the fields that users should control: title, description, status, priority, due_date.",
    "is_file_level": false,
    "confidence": "high"
  },
  {
    "file": "app/controllers/tasks_controller.rb",
    "line_start": 11,
    "line_end": 11,
    "type": "performance",
    "title": "N+1 query — missing eager loading of user association",
    "description": "Tasks are loaded without .includes(:user), but the view accesses task.user&.name for each task, triggering a separate query per row. Add .includes(:user) to the query.",
    "is_file_level": false,
    "confidence": "high"
  },
  {
    "file": "app/controllers/tasks_controller.rb",
    "line_start": 23,
    "line_end": 68,
    "type": "design",
    "title": "Fat controller — extract business logic to service object",
    "description": "The create action is 46 lines with inline priority calculation, notification building, and audit logging. Per project conventions (CLAUDE.md), this should be extracted to a CreateTaskService.",
    "is_file_level": false,
    "confidence": "high"
  },
  {
    "file": "app/models/task.rb",
    "line_start": 12,
    "line_end": 15,
    "type": "bug",
    "title": "Missing presence validation on title",
    "description": "The Task model validates status, priority, and description but omits title validation. Blank titles are accepted, and nil titles cause a database-level error instead of a clean validation message.",
    "is_file_level": false,
    "confidence": "high"
  },
  {
    "file": "app/controllers/tasks_controller.rb",
    "line_start": 78,
    "line_end": 92,
    "type": "code-style",
    "title": "Inconsistent error handling pattern",
    "description": "The update action uses inline begin/rescue blocks including a broad `rescue StandardError`, while the rest of the application uses rescue_from at the controller level. This is inconsistent and the StandardError rescue swallows unexpected errors.",
    "is_file_level": false,
    "confidence": "medium"
  },
  {
    "file": "app/controllers/tasks_controller.rb",
    "line_start": 28,
    "line_end": 28,
    "type": "bug",
    "title": "Auto-assigning current_user overrides the Unassigned option",
    "description": "The line @task.user ||= current_user always replaces a nil assignee with the current user, but the form provides an explicit Unassigned option. When a user selects Unassigned, this line silently overrides that choice.",
    "is_file_level": false,
    "confidence": "high"
  },
  {
    "file": "app/controllers/tasks_controller.rb",
    "line_start": 30,
    "line_end": 40,
    "type": "bug",
    "title": "Priority auto-escalation silently overrides user selection",
    "description": "Lines 30-40 override the user-submitted priority based on due-date heuristics. If a user explicitly selects low priority for a task due tomorrow, the controller silently changes it to high.",
    "is_file_level": false,
    "confidence": "high"
  },
  {
    "file": "app/controllers/tasks_controller.rb",
    "line_start": 57,
    "line_end": 62,
    "type": "bug",
    "title": "Audit log fires before save — logs events that may not happen",
    "description": "The audit logging runs before @task.save. If validation fails, the log will contain a misleading 'Task created' entry for a task that was never persisted.",
    "is_file_level": false,
    "confidence": "high"
  },
  {
    "file": "app/views/projects/show.html.erb",
    "line_start": 49,
    "line_end": 49,
    "type": "performance",
    "title": "N+1 query in project show view",
    "description": "The project show view queries tasks directly in the template without eager-loading, and accesses task.user&.name for each task, triggering a separate query per task.",
    "is_file_level": false,
    "confidence": "high"
  },
  {
    "file": "app/views/projects/show.html.erb",
    "line_start": 57,
    "line_end": 57,
    "type": "bug",
    "title": "Status badge missing cancelled state",
    "description": "The status badge logic handles completed and in_progress but falls through to warning for cancelled tasks, creating an inconsistency with other views.",
    "is_file_level": false,
    "confidence": "medium"
  }
]
