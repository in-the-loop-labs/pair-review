{"id": "06-001", "file": "app/models/task.rb", "line_start": 28, "line_end": 30, "type": "performance", "severity": "medium", "title": "LIKE query on title and description without database index", "description": "The search scope uses ILIKE with leading wildcards (e.g., '%query%') on title and description columns, but there is no database index to support this pattern. Leading-wildcard LIKE queries cannot use standard B-tree indexes, so every search will perform a full table scan. For a growing task table, this becomes increasingly slow.", "hint": "Add a GIN index with pg_trgm extension for trigram-based ILIKE support, or use PostgreSQL full-text search with a tsvector column and GIN index."}
{"id": "06-002", "file": "app/models/task.rb", "line_start": 28, "line_end": 33, "type": "improvement", "severity": "low", "title": "Hand-rolled ILIKE search should use pg_search gem", "description": "The search implementation uses raw ILIKE queries, which is a common but fragile approach. It doesn't handle relevance ranking, stemming, or stop words. The pg_search gem provides proper full-text search backed by PostgreSQL's tsvector, with relevance ranking and much better performance out of the box.", "hint": "Consider using the pg_search gem with its pg_search_scope for proper full-text search with relevance ranking."}
{"id": "06-003", "file": "app/models/task.rb", "line_start": 28, "line_end": 33, "type": "code-style", "severity": "medium", "title": "Raw SQL in search scopes violates Active Record convention", "description": "Both the search scope (line 29: raw SQL WHERE with ILIKE) and by_status_text scope (line 32: raw SQL with PostgreSQL type cast '::text') use raw SQL strings instead of Active Record query methods. The project's CONTRIBUTING.md explicitly requires 'Active Record scopes (no raw SQL)'. The by_status_text scope is particularly problematic as it uses PostgreSQL-specific casting syntax, making the code database-dependent.", "hint": "Use Arel or Active Record query methods. For search, consider using .where(Task.arel_table[:title].matches(...)) or the pg_search gem. For status filtering, use the existing enum scope .by_status instead of raw SQL casting."}
{"id": "06-004", "file": "app/models/task.rb", "line_start": 28, "line_end": 30, "type": "bug", "severity": "low", "title": "Search scope does not handle nil query gracefully", "description": "Calling Task.search(nil) will generate a query with '%nil%' interpolated, or potentially raise an error depending on how the parameter is passed. The scope assumes query is always a non-nil string. When called from the controller, params[:q] could be nil if the parameter is present but empty in certain edge cases.", "hint": "Add a nil/blank guard in the scope, e.g., return all if query is blank, or add a .presence check before calling the scope."}
{"id": "06-005", "file": "app/controllers/tasks_controller.rb", "line_start": 25, "line_end": 25, "type": "performance", "severity": "medium", "title": "Unnecessary eager loading of associations for search results", "description": "The index action eager-loads :project, :user, and :notifications via .includes, but the task index view only displays task title, status, priority, user name, and due date. The :notifications association is never accessed in the view, resulting in unnecessary database queries loading all notifications for every listed task. The :project is already available as @project.", "hint": "Remove :notifications from the includes call. Since @project is already loaded, :project may also be unnecessary depending on the view implementation."}
{"id": "06-006", "file": "app/controllers/tasks_controller.rb", "line_start": 13, "line_end": 23, "type": "code-style", "severity": "low", "title": "Inconsistent filter parameter naming convention", "description": "The filter parameters use three different naming conventions: params[:q] for text search, params[:status_filter] for status (with a _filter suffix), and params[:priority] for priority (bare name). This inconsistency extends to the view where the form fields use matching but inconsistent names. Parameters should follow a consistent convention.", "hint": "Standardize on a consistent naming scheme: either all bare names (q, status, priority), all with filter prefix (filter_q, filter_status, filter_priority), or use a nested params hash (filter[q], filter[status], filter[priority])."}
{"id": "06-007", "file": "app/controllers/tasks_controller.rb", "line_start": 8, "line_end": 27, "type": "design", "severity": "medium", "title": "Search and filtering logic belongs in model or service, not controller", "description": "The index action builds up a complex query chain with multiple conditional .where clauses for search, status filtering, and priority filtering. This violates the project's convention of keeping controllers thin and putting business logic in models (scopes) or service objects. The filtering logic should be encapsulated in a model scope like Task.filter_by(params) or extracted to a TaskSearchService.", "hint": "Create a composite scope on Task (e.g., scope :filter_by) that accepts a hash of filter parameters and chains the appropriate conditions, or extract a TaskSearchService class following the project's service object convention."}
