{"id": "08-001", "file": "app/controllers/api/v1/tasks_controller.rb", "line_start": 22, "line_end": 31, "type": "design", "severity": "medium", "title": "Inconsistent serialization between index and show actions — snake_case vs camelCase", "description": "The index action (lines 22-31) builds JSON inline with snake_case keys (due_date, assignee), while show/create/update use serialize_task which returns camelCase keys (dueDate, createdAt, assignedUser). Clients consuming this API will encounter two different JSON key conventions from the same resource endpoint. This is a pre-existing inconsistency being carried forward in the refactor.", "hint": "Unify both paths by using a single serializer (e.g., TaskSerializer) for all actions, or at minimum ensure the inline hash in index uses the same key convention as serialize_task."}
{"id": "08-002", "file": "app/controllers/api/v1/tasks_controller.rb", "line_start": 9, "line_end": 9, "type": "security", "severity": "medium", "title": "Unauthenticated show action with no authorization check", "description": "Line 9 skips authentication for the show action via skip_before_action :authenticate_user!, and the show action on line 34-35 does not call `authorize @task`. This means any unauthenticated user can view any task by ID without authorization checks, exposing potentially sensitive task data. This is a pre-existing IDOR vulnerability being carried forward in the refactor.", "hint": "Either remove :show from skip_before_action :authenticate_user!, or add `authorize @task` inside the show method to enforce the Pundit policy."}
{"id": "08-003", "file": "app/controllers/concerns/api_responder.rb", "line_start": 7, "line_end": 9, "type": "security", "severity": "high", "title": "CSRF protection silently disabled for all controllers that include ApiResponder", "description": "The ApiResponder concern bundles `skip_before_action :verify_authenticity_token` inside its `included` block (lines 7-9), meaning any controller that includes this concern to get the render_success/render_errors helpers also silently loses CSRF protection. This couples an unrelated security decision to response formatting helpers. If a non-API controller (e.g., one serving HTML forms) accidentally includes ApiResponder for convenience, CSRF protection is silently disabled, widening the attack surface.", "hint": "Move the CSRF skip out of the concern and into each API controller explicitly, or split the concern into separate modules — one for response helpers and one for API-specific security configuration."}
{"id": "08-004", "file": "app/models/concerns/filterable.rb", "line_start": 14, "line_end": 14, "type": "security", "severity": "low", "title": "public_send dispatches to any by_* scope without an allowlist", "description": "The filter_by method uses public_send(\"by_#{key}\", value) to dynamically call scopes based on user-supplied parameter keys. While respond_to? provides a basic guard, it allows dispatching to any public method matching the by_* pattern — not just intended filter scopes. If a model defines a method like by_sql or by_pass for unrelated purposes, an attacker could invoke it by passing the corresponding key in filter params.", "hint": "Add an explicit allowlist of permitted filter fields, e.g., a `filterable_fields` class method similar to searchable_fields in the Searchable concern, and check against it before calling public_send."}
{"id": "08-005", "file": "app/models/concerns/searchable.rb", "line_start": 14, "line_end": 14, "type": "bug", "severity": "high", "title": "Arel matches generates case-sensitive LIKE instead of ILIKE — search regression on PostgreSQL", "description": "The Searchable concern uses `arel_table[f].matches(...)` which generates a SQL LIKE clause. The previous implementation in Project used `WHERE name ILIKE ?` and Task used `WHERE title ILIKE :q OR description ILIKE :q` for case-insensitive search. On PostgreSQL, LIKE is case-sensitive while ILIKE is case-insensitive. This refactor silently regresses search to case-sensitive matching, so searching for 'taskflow' will no longer find 'TaskFlow'. The existing spec 'is case-insensitive' in project_spec.rb would catch this.", "hint": "Use `arel_table[f].matches(\"%..%\", nil, true)` to generate ILIKE on PostgreSQL, or use Arel::Nodes::NamedFunction.new('LOWER', ...) for portable case-insensitive matching."}
{"id": "08-006", "file": "spec/models/project_spec.rb", "line_start": 69, "line_end": 82, "type": "bug", "severity": "medium", "title": "Test suite still references removed search_by_name scope", "description": "The project_spec.rb file contains a `describe '.search_by_name'` block (lines 69-82) that tests the old scope which was removed from the Project model in this PR. The model now uses the Searchable concern which defines a `.search` scope instead of `.search_by_name`. These tests will fail with a NoMethodError at runtime because the scope no longer exists. The tests were not updated to match the new API.", "hint": "Rename the describe block to '.search' and update the test calls from `described_class.search_by_name(...)` to `described_class.search(...)`."}
{"id": "08-007", "file": "app/models/concerns/filterable.rb", "type": "improvement", "severity": "low", "title": "Missing unit tests for extracted Filterable and Searchable concerns", "description": "The PR extracts filtering and searching logic into reusable Filterable and Searchable concerns but does not include any unit tests for these new modules. The concerns contain non-trivial logic (dynamic dispatch, Arel query building, blank-handling) that should be tested independently of the models that include them. Without dedicated tests, regressions in the shared logic could go undetected.", "hint": "Add spec/models/concerns/filterable_spec.rb and spec/models/concerns/searchable_spec.rb testing edge cases like blank params, unknown filter keys, empty search queries, and multi-field search.", "is_file_level": true}
