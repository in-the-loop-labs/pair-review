{"id": "04-001", "file": "app/controllers/api/v1/tasks_controller.rb", "line_start": 49, "line_end": 49, "type": "bug", "severity": "medium", "title": "Create action returns 200 instead of 201 for successful resource creation", "description": "The create action renders with `status: :ok` (HTTP 200) instead of `status: :created` (HTTP 201). REST conventions and Rails defaults both expect 201 Created when a new resource is successfully persisted. This may break clients that check for 201 to confirm creation.", "hint": "Change `status: :ok` to `status: :created`"}
{"id": "04-002", "file": "app/controllers/api/v1/tasks_controller.rb", "line_start": 8, "line_end": 8, "type": "security", "severity": "critical", "title": "Show endpoint bypasses authentication — any task viewable without login", "description": "Line 8 skips authentication for the show action, and the show method on lines 38-40 does not call `authorize @task`. This means any unauthenticated user can view any task by ID, including tasks in private projects. Combined with sequential integer IDs, this is an insecure direct object reference (IDOR) vulnerability.", "hint": "Remove :show from skip_before_action, or add `authorize @task` inside the show action to enforce Pundit policy"}
{"id": "04-003", "file": "app/controllers/api/v1/tasks_controller.rb", "line_start": 92, "line_end": 95, "type": "code-style", "severity": "low", "title": "Inconsistent JSON key format — camelCase mixed with snake_case", "description": "The serialize_task method uses camelCase for some keys (dueDate, createdAt, updatedAt, assignedUser) but snake_case for others (project_id). The project's CONTRIBUTING.md mandates snake_case everywhere. The TaskSerializer class uses consistent snake_case, making this doubly inconsistent.", "hint": "Use snake_case for all keys: due_date, created_at, updated_at, assigned_user (or use the TaskSerializer)"}
{"id": "04-004", "file": "app/controllers/api/v1/tasks_controller.rb", "line_start": 26, "line_end": 35, "type": "design", "severity": "medium", "title": "Index action builds JSON inline instead of using TaskSerializer", "description": "The index action constructs JSON via an inline map block rather than using the TaskSerializer class that was created for this purpose. The CONTRIBUTING.md explicitly states 'API responses must use serializers (not to_json)'. The TaskSerializer exists in app/serializers/task_serializer.rb but is completely unused.", "hint": "Use TaskSerializer: `render json: tasks.map { |t| TaskSerializer.new(t).as_json }`"}
{"id": "04-005", "file": "app/controllers/api/v1/tasks_controller.rb", "line_start": 16, "line_end": 16, "type": "performance", "severity": "medium", "title": "N+1 query — tasks loaded without eager-loading user association", "description": "The index action loads tasks with `@project.tasks` without `.includes(:user)`, but then accesses `t.user&.name` on line 33 for each task. This triggers a separate SQL query for each task's user association, causing an N+1 query problem that degrades linearly with the number of tasks.", "hint": "Add eager loading: `@project.tasks.includes(:user)`"}
{"id": "04-006", "file": "app/controllers/api/v1/tasks_controller.rb", "line_start": 6, "line_end": 7, "type": "security", "severity": "low", "title": "API endpoints lack rate limiting — vulnerable to abuse", "description": "The API controller has no rate limiting or throttling mechanism. Without rate limiting, the endpoints are vulnerable to brute-force enumeration of task IDs (especially with the unauthenticated show endpoint), denial of service, and data scraping. This is particularly concerning for a public-facing API.", "hint": "Add Rack::Attack or a similar rate-limiting middleware for API endpoints", "is_file_level": true}
{"id": "04-007", "file": "app/controllers/api/v1/tasks_controller.rb", "line_start": 6, "line_end": 8, "type": "improvement", "severity": "low", "title": "No API versioning headers or content-type enforcement", "description": "The API does not check Accept headers, enforce Content-Type: application/json on requests, or return versioning headers (e.g., X-API-Version). This makes it harder for clients to detect breaking changes and allows non-JSON requests to be processed.", "hint": "Add a before_action to verify Accept/Content-Type headers and set response headers with API version", "is_file_level": true}
{"id": "04-008", "file": "app/controllers/api/v1/tasks_controller.rb", "line_start": 85, "line_end": 102, "type": "design", "severity": "medium", "title": "Private serialize_task method duplicates and diverges from TaskSerializer", "description": "The controller defines a private serialize_task method that duplicates the serialization logic already in TaskSerializer, but with different key names (camelCase vs snake_case) and a different structure for the user association (assignedUser vs user). This violates DRY and will cause the two representations to drift further apart over time.", "hint": "Remove serialize_task and use TaskSerializer.new(task).as_json in show, create, and update actions"}
