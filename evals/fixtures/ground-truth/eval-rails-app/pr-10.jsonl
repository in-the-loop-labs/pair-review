{"id": "10-001", "file": "config/initializers/sidekiq.rb", "line_start": 5, "line_end": 5, "type": "security", "severity": "critical", "title": "Hardcoded Redis production password committed to source control", "description": "Line 5 contains a hardcoded Redis password in the constant REDIS_URL: 'redis://:p4ssw0rd_pr0d@redis.internal.example.com:6379/0'. This password is committed to version control and visible to anyone with repository access. Even though it is used as a fallback default in ENV.fetch on lines 8 and 12, the plaintext credential is still exposed in the source. Secrets should never be stored in code â€” use environment variables, Rails credentials (rails credentials:edit), or a secrets manager.", "hint": "Remove the hardcoded REDIS_URL constant entirely. Use ENV.fetch('REDIS_URL') without a fallback, or provide a safe localhost default: ENV.fetch('REDIS_URL', 'redis://localhost:6379/0'). Store production credentials in Rails encrypted credentials or environment variables."}
{"id": "10-002", "file": "config/initializers/cors.rb", "line_start": 7, "line_end": 7, "type": "security", "severity": "high", "title": "CORS allows all origins with wildcard, enabling cross-site requests from any domain", "description": "Line 7 sets origins to '*', which allows any website to make cross-origin requests to the API endpoints. This means a malicious site could make API calls on behalf of authenticated users if credentials are ever enabled, or exfiltrate data from unauthenticated endpoints. While credentials: false on line 12 prevents cookies from being sent, the wildcard origin is still overly permissive and should be restricted to known frontend domains.", "hint": "Replace origins '*' with a whitelist of allowed domains, ideally loaded from environment configuration: origins ENV.fetch('CORS_ORIGINS', 'http://localhost:3000').split(',')"}
{"id": "10-003", "file": "config/environments/production.rb", "line_start": 21, "line_end": 21, "type": "security", "severity": "medium", "title": "Debug-level logging enabled in production environment", "description": "Line 21 sets config.log_level = :debug in the production environment. Debug logging records verbose internal details including SQL queries with bind parameters, full request parameters, and framework internals. This creates several problems: (1) log volume increases dramatically, consuming disk space and making it harder to find important entries, (2) sensitive data like passwords, tokens, or PII in parameters may be logged in plaintext, (3) performance overhead from generating and writing verbose log messages. Production should use :info or :warn.", "hint": "Change config.log_level from :debug to :info (standard) or :warn (quiet). Use :debug only in development or when actively troubleshooting a production issue, controlled via environment variable: config.log_level = ENV.fetch('LOG_LEVEL', 'info').to_sym"}
{"id": "10-004", "file": "db/seeds.rb", "line_start": 9, "line_end": 10, "type": "security", "severity": "low", "title": "Seed data uses weak hardcoded passwords for user accounts", "description": "Lines 9-10 create the admin user with password 'password123' and lines 15-16 create the demo user with password 'demo1234'. While seed data is intended for development, these weak passwords are problematic: (1) developers often run seeds in staging environments, (2) if seeds are accidentally run in production they create accounts with trivially guessable passwords, (3) the admin account specifically could grant elevated privileges.", "hint": "Use SecureRandom.hex(16) for seed passwords, or pull from environment variables: ENV.fetch('ADMIN_PASSWORD', SecureRandom.hex(16)). Print the generated password to stdout so developers can use it."}
{"id": "10-005", "file": "app/middleware/request_logger.rb", "line_start": 19, "line_end": 19, "type": "security", "severity": "medium", "title": "Middleware logs Authorization headers containing sensitive credentials", "description": "Line 19 captures the HTTP_AUTHORIZATION header into the request_info hash, and line 31 logs it to Rails.logger. Authorization headers typically contain bearer tokens, API keys, or base64-encoded credentials. Writing these to log files means anyone with log access can extract authentication credentials. Logs are often aggregated in centralized systems (ELK, CloudWatch) with broader access than the application itself.", "hint": "Remove 'Authorization' from the logged headers entirely, or redact it by replacing the token portion with '[REDACTED]' before logging. Also avoid logging request.params as it may contain passwords or tokens."}
{"id": "10-006", "file": "app/middleware/request_logger.rb", "line_start": 1, "line_end": 1, "type": "code-style", "severity": "low", "title": "Missing frozen_string_literal magic comment required by project rubocop config", "description": "The file is missing the '# frozen_string_literal: true' magic comment that is required by the project's .rubocop.yml (Style/FrozenStringLiteralComment with EnforcedStyle: always). Every other Ruby file in the project includes this header. This means string literals in this file are mutable, which is inconsistent with the rest of the codebase and slightly less memory-efficient.", "hint": "Add '# frozen_string_literal: true' as the second line of the file (after the SPDX license header)."}
{"id": "10-007", "file": "app/middleware/request_logger.rb", "line_start": 8, "line_end": 34, "type": "code-style", "severity": "medium", "title": "Method exceeds 15-line limit configured in project rubocop rules", "description": "The call method spans lines 8-34 (27 lines of code), which exceeds the project's Metrics/MethodLength max of 15 configured in .rubocop.yml. The method mixes request parsing, header collection, response delegation, timing calculation, and log formatting into a single long method.", "hint": "Extract helper methods: a build_request_info(env) method for lines 12-25, and a log_request(request_info, status, duration) method for the logging on line 31. This brings each method under the 15-line limit and improves readability."}
{"id": "10-008", "file": "app/middleware/request_logger.rb", "line_start": 31, "line_end": 31, "type": "code-style", "severity": "low", "title": "Line exceeds 120-character limit configured in project rubocop rules", "description": "Line 31 is 202 characters long, well over the 120-character max configured in .rubocop.yml (Layout/LineLength). The long string interpolation concatenates method, path, status, duration, IP, and auth header into a single line.", "hint": "Break the log message across multiple lines using string concatenation or a heredoc, or build the message parts into a formatted string variable before passing to Rails.logger.info."}
{"id": "10-009", "file": "db/migrate/20240401000001_add_performance_indexes.rb", "line_start": 7, "line_end": 12, "type": "improvement", "severity": "medium", "title": "Migration adds composite indexes but omits single-column foreign key indexes on user_id columns", "description": "The migration adds useful composite indexes on tasks(project_id, status) and notifications(recipient_id, read), but omits indexes on comments.user_id and tasks.user_id. These are foreign key columns used in joins and lookups (e.g., User.assigned_tasks, Comment belongs_to :user) and without indexes, these queries require full table scans. The migration's own comments acknowledge these are missing, suggesting they were considered but deliberately skipped.", "hint": "Add single-column indexes: add_index :tasks, :user_id and add_index :comments, :user_id. Foreign key columns should generally always be indexed for join performance."}
