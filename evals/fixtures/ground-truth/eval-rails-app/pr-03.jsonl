{"id": "03-001", "file": "app/controllers/tasks_controller.rb", "line_start": 113, "line_end": 113, "type": "security", "severity": "critical", "title": "Mass assignment vulnerability via overly permissive strong parameters", "description": "The task_params method permits user_id, project_id, and a non-existent admin field. This allows malicious users to reassign tasks to arbitrary users, move tasks between projects, or potentially escalate privileges via the admin parameter.", "hint": "Remove user_id, project_id, and admin from permitted params. Only permit :title, :description, :status, :priority, :due_date"}
{"id": "03-002", "file": "app/controllers/tasks_controller.rb", "line_start": 11, "line_end": 11, "type": "performance", "severity": "high", "title": "N+1 query — tasks loaded without eager loading user association", "description": "The index action loads tasks with `@project.tasks.order(created_at: :desc)` without `.includes(:user)`. The view template then accesses `task.user&.name` for each task, triggering a separate SQL query per task.", "hint": "Add .includes(:user) to the query: @project.tasks.includes(:user).order(created_at: :desc)"}
{"id": "03-003", "file": "app/controllers/tasks_controller.rb", "line_start": 23, "line_end": 68, "type": "design", "severity": "medium", "title": "Fat controller — business logic belongs in service object", "description": "The create action is 46 lines with inline priority calculation (lines 30-40), notification building (lines 42-55), and audit logging (lines 57-62). CLAUDE.md explicitly requires service objects for business logic and thin controllers.", "hint": "Extract to a CreateTaskService that handles priority calculation, notification dispatch, and audit logging"}
{"id": "03-004", "file": "app/models/task.rb", "line_start": 12, "line_end": 15, "type": "bug", "severity": "high", "title": "Missing presence validation on title", "description": "The Task model validates status, priority, and description length but does not validate title presence. While the database has a NOT NULL constraint on title, blank strings pass through with no error, and nil values produce a database-level exception instead of a clean validation error.", "hint": "Add validates :title, presence: true to the model validations"}
{"id": "03-005", "file": "app/controllers/tasks_controller.rb", "line_start": 78, "line_end": 92, "type": "code-style", "severity": "low", "title": "Inconsistent error handling — inline rescue instead of rescue_from", "description": "The update action uses inline begin/rescue blocks including a broad `rescue StandardError => e` that swallows all exceptions. The rest of the application uses rescue_from at the controller level (see ApplicationController). The StandardError rescue is particularly concerning as it silently handles unexpected errors.", "hint": "Remove inline rescue blocks. Use rescue_from or let ApplicationController handle errors consistently"}
{"id": "03-006", "file": "app/controllers/tasks_controller.rb", "line_start": 28, "line_end": 28, "type": "bug", "severity": "medium", "title": "Auto-assigning current_user silently overrides the Unassigned form option", "description": "The line @task.user ||= current_user always replaces a nil assignee with the current user. But the form provides an explicit Unassigned option and the model declares user as optional. When a user selects Unassigned, this line overrides that choice.", "hint": "Remove this line or only apply when user_id wasn't submitted: @task.user = current_user unless params[:task].key?(:user_id)"}
{"id": "03-007", "file": "app/controllers/tasks_controller.rb", "line_start": 30, "line_end": 40, "type": "bug", "severity": "medium", "title": "Priority auto-escalation silently overrides user-selected priority", "description": "Lines 30-40 override the user-submitted priority based on due-date heuristics. If a user explicitly selects low priority for a task due tomorrow, the controller silently changes it to high. This only runs in create, not update, creating an inconsistency.", "hint": "Only apply when user hasn't explicitly set a priority, or extract to service object"}
{"id": "03-008", "file": "app/controllers/tasks_controller.rb", "line_start": 57, "line_end": 62, "type": "bug", "severity": "medium", "title": "Audit log fires before save — logs events that may never happen", "description": "The audit logging on lines 57-62 runs before @task.save on line 64. If validation fails, the log will contain a misleading Task created entry for a task that was never persisted.", "hint": "Move audit logging inside the if @task.save success branch"}
{"id": "03-009", "file": "app/views/projects/show.html.erb", "line_start": 49, "line_end": 49, "type": "performance", "severity": "medium", "title": "N+1 query in project show view — tasks loaded without eager-loading", "description": "The project show view executes @project.tasks.order(created_at: :desc).limit(5) directly in the template, and accesses task.user&.name for each task, triggering a separate query per task. Query logic also belongs in the controller, not the view.", "hint": "Move query to controller with .includes(:user) and use an instance variable"}
{"id": "03-010", "file": "app/views/projects/show.html.erb", "line_start": 57, "line_end": 57, "type": "bug", "severity": "low", "title": "Status badge missing cancelled state — inconsistent with other views", "description": "The status badge logic handles completed and in_progress but falls through to warning for cancelled tasks. The tasks index and show views explicitly handle cancelled with a secondary badge, creating a visible inconsistency.", "hint": "Add task.cancelled? check with secondary badge to match other views"}
