{"id": "03-001", "file": "app/controllers/tasks_controller.rb", "line_start": 113, "line_end": 113, "type": "security", "severity": "critical", "title": "Mass assignment vulnerability via overly permissive strong parameters", "description": "The task_params method permits user_id, project_id, and a non-existent admin field. This allows malicious users to reassign tasks to arbitrary users, move tasks between projects, or potentially escalate privileges via the admin parameter.", "hint": "Remove user_id, project_id, and admin from permitted params. Only permit :title, :description, :status, :priority, :due_date"}
{"id": "03-002", "file": "app/controllers/tasks_controller.rb", "line_start": 11, "line_end": 11, "type": "performance", "severity": "high", "title": "N+1 query — tasks loaded without eager loading user association", "description": "The index action loads tasks with `@project.tasks.order(created_at: :desc)` without `.includes(:user)`. The view template then accesses `task.user&.name` for each task, triggering a separate SQL query per task.", "hint": "Add .includes(:user) to the query: @project.tasks.includes(:user).order(created_at: :desc)"}
{"id": "03-003", "file": "app/controllers/tasks_controller.rb", "line_start": 23, "line_end": 68, "type": "design", "severity": "medium", "title": "Fat controller — business logic belongs in service object", "description": "The create action is 46 lines with inline priority calculation (lines 30-40), notification building (lines 42-55), and audit logging (lines 57-62). CLAUDE.md explicitly requires service objects for business logic and thin controllers.", "hint": "Extract to a CreateTaskService that handles priority calculation, notification dispatch, and audit logging"}
{"id": "03-004", "file": "app/models/task.rb", "line_start": 12, "line_end": 15, "type": "bug", "severity": "high", "title": "Missing presence validation on title", "description": "The Task model validates status, priority, and description length but does not validate title presence. While the database has a NOT NULL constraint on title, blank strings pass through with no error, and nil values produce a database-level exception instead of a clean validation error.", "hint": "Add validates :title, presence: true to the model validations"}
{"id": "03-005", "file": "app/controllers/tasks_controller.rb", "line_start": 78, "line_end": 92, "type": "code-style", "severity": "low", "title": "Inconsistent error handling — inline rescue instead of rescue_from", "description": "The update action uses inline begin/rescue blocks including a broad `rescue StandardError => e` that swallows all exceptions. The rest of the application uses rescue_from at the controller level (see ApplicationController). The StandardError rescue is particularly concerning as it silently handles unexpected errors.", "hint": "Remove inline rescue blocks. Use rescue_from or let ApplicationController handle errors consistently"}
